//JAVATARI
var Javatari={PRESETS:"",CARTRIDGE_URL:"",AUTODETECT_URL:"",STATE_URL:"",CARTRIDGE_FORMAT:"",NETPLAY_JOIN:"",NETPLAY_NICK:"",AUTO_START:!1,AUTO_POWER_ON_DELAY:-1,CARTRIDGE_SHOW_RECENT:!1,CARTRIDGE_CHANGE_DISABLED:!1,CARTRIDGE_LABEL_COLORS:"",SCREEN_RESIZE_DISABLED:!1,SCREEN_CONSOLE_PANEL_DISABLED:!0,SCREEN_ELEMENT_ID:"javatari-screen",CONSOLE_PANEL_ELEMENT_ID:-1,SCREEN_FULLSCREEN_MODE:-1,SCREEN_CRT_MODE:0,SCREEN_FILTER_MODE:-3,SCREEN_DEFAULT_SCALE:-1,SCREEN_DEFAULT_ASPECT:1,SCREEN_CANVAS_SIZE:2,SCREEN_CONTROL_BAR:1,SCREEN_FORCE_HOST_NATIVE_FPS:-1,SCREEN_VSYNCH_MODE:-2,AUDIO_MONITOR_BUFFER_BASE:-3,AUDIO_MONITOR_BUFFER_SIZE:-1,AUDIO_SIGNAL_BUFFER_RATIO:2,AUDIO_SIGNAL_ADD_FRAMES:3,PADDLES_MODE:-1,TOUCH_MODE:-1,IMAGES_PATH:"images/",PAGE_BACK_CSS:"",SERVER_ADDRESS:"webmsx.azurewebsites.net/",SERVER_KEEPALIVE:0,RESET:0,ALLOW_URL_PARAMETERS:!1};function onUpdateReady(){alert("A new version is available!\nJavatari will restart..."),window.applicationCache.swapCache(),window.location.reload()}Javatari.PRESETS_CONFIG={},jt=window.jt||{},(JavatariFullScreenSetup={apply:function(){if(!this.cssApplied){var t=document.createElement("style");t.type="text/css",t.innerHTML=this.css,document.head.appendChild(t),this.cssApplied=!0}document.documentElement.classList.toggle("jt-full-screen",this.shouldStartInFullScreen())},shouldStartInFullScreen:function(){return window.Javatari?1===Javatari.SCREEN_FULLSCREEN_MODE||-1===Javatari.SCREEN_FULLSCREEN_MODE&&this.isBrowserStandaloneMode():this.isBrowserStandaloneMode()},isBrowserStandaloneMode:function(){return navigator.standalone||window.matchMedia("(display-mode: standalone)").matches},css:"html.jt-full-screen, html.jt-full-screen body {   background: black;}html.jt-full-screen .jt-full-screen-hidden {   display: none;}html:not(.jt-full-screen) .jt-full-screen-only {   display: none;}"}).apply(),jt.Util=new function(){"use strict";function t(t,e){return t.name<e.name?-1:t.name>e.name?1:0}function e(t){return t.stopPropagation(),t.cancelable&&t.preventDefault(),!1}this.logs=[],this.log=function(t){},this.warning=function(t){},this.error=function(t){},this.message=function(t){console.info(t),alert(t)},this.asNormalArray=function(t){return t instanceof Array?t:this.arrayCopy(t,0,Array(t.length))},this.arrayFill=function(t,e,n,i){if(t.fill)return t.fill(e,n,i);void 0===n&&(n=0);for(var r=(void 0===i?t.length:i)-1;r>=n;r-=1)t[r]=e;return t},this.arrayFillSegment=function(t,e,n,i){for(var r=n;r-- >e;)t[r]=i;return t},this.arrayCopy=function(t,e,n,i,r){i=i||0;for(var o=r?e+r:t.length;e<o;)n[i++]=t[e++];return n},this.arrayAdd=function(t,e){return t[t.length]=e,t},this.arrayRemoveAllElement=function(t,e){for(var n;(n=t.indexOf(e))>=0;)t.splice(n,1);return t},this.arraysConcatAll=function(t){for(var e=0,n=0;n<t.length;++n)e+=t[n].length;var i=new t[0].constructor(e),r=0;for(n=0;n<t.length;++n)this.arrayCopy(t[n],0,i,r),r+=t[n].length;return i},this.arrayRemove=function(t,e){var n=t.indexOf(e);n<0||t.splice(n,1)},this.arraysEqual=function(t,e){var n=t.length;if(n!==e.length)return!1;for(;n--;)if(t[n]!==e[n])return!1;return!0},this.reverseInt8=function(t){return(1&t)<<7|(2&t)<<5|(4&t)<<3|(8&t)<<1|(16&t)>>1|(32&t)>>3|(64&t)>>5|(128&t)>>7},this.int8BitArrayToByteString=function(t,e,n){if(null===t||void 0==t)return t;void 0===e&&(e=0),void 0===n&&(n=t.length-e);for(var i="",r=e,o=e+n;r<o;r+=1)i+=String.fromCharCode(255&t[r]);return i},this.byteStringToInt8BitArray=function(t,e){if(null==t)return t;if("null"==t)return null;if("undefined"!=t){for(var n=t.length,i=e&&e.length===n?e:new(e?e.constructor:Array)(n),r=0;r<n;r+=1)i[r]=255&t.charCodeAt(r);return i}},this.int32BitArrayToByteString=function(t,e,n){if(null===t||void 0==t)return t;void 0===e&&(e=0),void 0===n&&(n=t.length-e);for(var i="",r=e,o=e+n;r<o;r+=1)i+=String.fromCharCode(255&t[r])+String.fromCharCode(t[r]>>8&255)+String.fromCharCode(t[r]>>16&255)+String.fromCharCode(t[r]>>24&255);return i},this.byteStringToInt32BitArray=function(t,e){if(null==t)return t;if("null"==t)return null;if("undefined"!=t){for(var n=t.length/4|0,i=e&&e.length===n?e:new(e?e.constructor:Array)(n),r=0,o=0;r<n;r+=1,o+=4)i[r]=255&t.charCodeAt(o)|(255&t.charCodeAt(o+1))<<8|(255&t.charCodeAt(o+2))<<16|(255&t.charCodeAt(o+3))<<24;return i}},this.storeInt8BitArrayToStringBase64=function(t){return null==t?t:0===t.length?"":btoa(this.int8BitArrayToByteString(t))},this.restoreStringBase64ToInt8BitArray=function(t,e){return null==t?t:"null"==t?null:"undefined"!=t?""==t?[]:this.byteStringToInt8BitArray(atob(t),e):void 0},this.compressInt8BitArrayToStringBase64=function(t,e){return null==t?t:0===t.length?"":e<t.length?this.storeInt8BitArrayToStringBase64(JSZip.compressions.DEFLATE.compress(t.slice(0,e))):this.storeInt8BitArrayToStringBase64(JSZip.compressions.DEFLATE.compress(t))},this.uncompressStringBase64ToInt8BitArray=function(t,e,n){if(null==t)return t;if("null"==t)return null;if("undefined"!=t){if(""==t)return[];var i=JSZip.compressions.DEFLATE.uncompress(atob(t));return e&&(n||e.length===i.length)?this.arrayCopy(i,0,e):this.arrayCopy(i,0,new(e?e.constructor:Array)(i.length))}},this.storeInt32BitArrayToStringBase64=function(t){return null==t?t:0===t.length?"":btoa(this.int32BitArrayToByteString(t))},this.restoreStringBase64ToInt32BitArray=function(t,e){return null==t?t:"null"==t?null:"undefined"!=t?""==t?[]:this.byteStringToInt32BitArray(atob(t),e):void 0},this.compressStringToStringBase64=function(t){return null==t?t:0===t.length?t:this.storeInt8BitArrayToStringBase64(JSZip.compressions.DEFLATE.compress(t))},this.uncompressStringBase64ToString=function(t){return null==t?t:"null"==t?null:"undefined"!=t?""==t?t:this.int8BitArrayToByteString(JSZip.compressions.DEFLATE.uncompress(atob(t))):void 0},this.toHex2=function(t){if(null==t)return t;var e=t.toString(16).toUpperCase();return t>=0&&e.length%2?"0"+e:e},this.toHex4=function(t){if(null==t)return t;var e=t.toString(16).toUpperCase();if(t<0)return e;switch(e.length){case 4:default:return e;case 3:return"0"+e;case 2:return"00"+e;case 1:return"000"+e}},this.escapeHtml=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\//g,"&#047;").replace(/\?/g,"&#063;").replace(/\-/g,"&#045;").replace(/\|/g,"&#0124;")},this.arrayFind=function(t,e){if(t.find)return t.find(e);for(var n=0,i=t.length;n<i;++n)if(e(t[n],n,t))return t[n]},this.arrayFindIndex=function(t,e){if(t.findIndex)return t.findIndex(e);for(var n=0,i=t.length;n<i;++n)if(e(t[n],n,t))return n;return -1},this.arrayIndexOfSubArray=function(t,e,n,i){var r=e.length,o=t.length,a=i||1;a:for(var s=n;s>=0&&s<o;s+=a){for(var l=0;l<r;l+=1)if(t[s+l]!==e[l])continue a;return s}return -1},this.stringCountOccurrences=function(t,e){for(var n=0,i=0,r=t.length;i<r;++i)t[i]==e&&++n;return n},this.stringStartsWith=function(t,e){return t.startsWith?t.startsWith(e):t.substr(0,e.length)===e},this.stringEndsWith=function(t,e){return t.endsWith?t.endsWith(e):t.substr(t.length-e.length)===e},this.checkContentIsZIP=function(t){if(t&&80===t[0]&&75===t[1])try{return new JSZip(t)}catch(e){}return null},this.getZIPFilesSorted=function(e){var n=e.file(/.+/);return n.sort(t),n},this.checkContentIsGZIP=function(t){if(!t||31!==t[0]||139!==t[1]||8!==t[2])return null;try{var e=t[3],n=2&e,i=4&e,r=8&e,o=16&e,a=10;if(i){var s=t[a++]|t[a++]<<8;a+=s}if(r||o)for(;0!==t[a++];);return n&&(a+=2),JSZip.compressions.DEFLATE.uncompress(t.slice(a,t.length-8))}catch(l){return null}},this.leafFilename=function(t){return((t&&t.indexOf("/")>=0?t.split("/").pop():t)||"").trim()},this.leafFilenameNoExtension=function(t){var e=this.leafFilename(t),n=e.lastIndexOf(".");return n<=0?e:e.substr(0,n).trim()},this.leafFilenameOnlyExtension=function(t){var e=this.leafFilename(t),n=e.lastIndexOf(".");return n<=0?"":e.substr(n+1).trim()},this.dump=function(t,e,n,i){var r="",o=e||0;i=i||1;for(var a=0;a<i;a++){for(var s=0;s<n;s++){var l=t[o++];r+=void 0!=l?l.toString(16,2)+" ":"? "}r+="   "}console.log(r)},this.browserInfo=function(){if(this.browserInfoAvailable)return this.browserInfoAvailable;var t,e=navigator.userAgent,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(n[1]))return t=/\brv[ :]+(\d+)/g.exec(e)||[],this.browserInfoAvailable={name:"IE",version:t[1]||""};if("Chrome"===n[1]&&null!=(t=e.match(/\bOPR\/(\d+)/)))return this.browserInfoAvailable={name:"OPERA",version:t[1]};n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&n.splice(1,1,t[1]);var i=n[0].toUpperCase();return this.browserInfoAvailable={name:this.isIOSDevice()||"NETSCAPE"===i?"SAFARI":i,version:n[1]}},this.userLanguage=function(){return(navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage||"en-US").trim()},this.browserCurrentURL=function(){return window.location.origin+window.location.pathname},this.isOfficialHomepage=function(){var t=window.location;return t&&"javatari.org"===t.hostname.toLowerCase()&&(""===t.port||"80"===t.port)},this.isTouchDevice=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},this.isMobileDevice=function(){return this.isTouchDevice()&&/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)},this.isIOSDevice=function(){return/ipad|iphone|ipod/i.test(navigator.userAgent)},this.isBrowserStandaloneMode=function(){return navigator.standalone||window.matchMedia("(display-mode: standalone)").matches},this.onTapOrMouseDown=function(t,e){this.addEventsListener(t,this.isTouchDevice()?"touchstart mousedown":"mousedown",e)},this.onTapOrMouseDownWithBlock=function(t,n){function i(t){return n(t),e(t)}this.addEventsListener(t,this.isTouchDevice()?"touchstart mousedown":"mousedown",i)},this.onTapOrMouseUpWithBlock=function(t,n){function i(t){return n(t),e(t)}this.addEventsListener(t,this.isTouchDevice()?"touchstart mouseup":"mouseup",i)},this.onTapOrMouseDownWithBlockUIG=function(t,n){function i(t){if("touchend"===t.type&&!t.target.jtNeedsUIG)return e(t);var i="touchstart"===t.type&&t.target.jtNeedsUIG,r="touchend"===t.type;return n(t,i,r),e(t)}this.addEventsListener(t,this.isTouchDevice()?"touchstart touchend mousedown":"mousedown",i)},this.blockEvent=e,this.addEventsListener=function(t,e,n,i){e=e.split(" ");for(var r=0;r<e.length;++r)e[r]&&t.addEventListener(e[r],n,i)},this.removeEventsListener=function(t,e,n,i){e=e.split(" ");for(var r=0;r<e.length;++r)e[r]&&t.removeEventListener(e[r],n,i)},this.insertCSS=function(t){var e=document.createElement("style");e.type="text/css",e.innerHTML=t,document.head.appendChild(e)},this.scaleToFitParentHeight=function(t,e,n){var i=e.clientHeight-n-20,r=t.clientHeight,o=r<i?1:i/r;t.style.transform="translateY(-"+(n/2|0)+"px) scale("+o.toFixed(4)+")"},this.scaleToFitParentWidth=function(t,e,n){var i=e.clientWidth-(2*n|0),r=t.clientWidth,o=r<i?1:i/r,a=Math.floor((i-(r*o|0))/2+n);t.style.left=a+"px",t.style.right="initial",t.style.transform="scale("+o.toFixed(4)+")"},this.log2=function(t){return Math.log(t)/Math.log(2)},this.exp2=function(t){return Math.pow(2,t)},this.performanceNow=function(){return this.performanceNow.startOffset?Date.now()-this.performanceNow.startOffset:window.performance.now()}},window.performance&&window.performance.now||(jt.Util.performanceNow.startOffset=Date.now()),jt.MD5=function(t){"use strict";function e(t){var e=(t>>>0).toString(16);return"00000000".substr(0,8-e.length)+e}function n(t){for(var e=[],n=0;n<8;n++)e.push(255&t),t>>>=8;return e}function i(t,e){return t<<e&4294967295|t>>>32-e}function r(t,e,n){return t&e|~t&n}function o(t,e,n){return n&t|~n&e}function a(t,e,n){return t^e^n}function s(t,e,n){return e^(t|~n)}function l(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function c(t){for(var e=[],n=0;n<t.length;n++)if(127>=t.charCodeAt(n))e.push(t.charCodeAt(n));else for(var i=encodeURIComponent(t.charAt(n)).substr(1).split("%"),r=0;r<i.length;r++)e.push(parseInt(i[r],16));return e}function d(t,n,i,r){for(var o="",a=0,s=0,l=3;l>=0;l--)s=arguments[l],a=255&s,s>>>=8,a<<=8,a|=255&s,s>>>=8,a<<=8,a|=255&s,s>>>=8,a<<=8,a|=s,o+=e(a);return o}function u(t){for(var e=Array(t.length),n=0;n<t.length;n++)e[n]=t[n];return e}function f(t,e){return 4294967295&t+e}var $=null,h=null;return"string"==typeof t?$=c(t):t.constructor==Array?0===t.length?$=t:"string"==typeof t[0]?$=function(t){for(var e=[],n=0;n<t.length;n++)e=e.concat(c(t[n]));return e}(t):"number"==typeof t[0]?$=t:h=typeof t[0]:"undefined"!=typeof ArrayBuffer?t instanceof ArrayBuffer?$=u(new Uint8Array(t)):t instanceof Uint8Array||t instanceof Int8Array?$=u(t):t instanceof Uint32Array||t instanceof Int32Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Float32Array||t instanceof Float64Array?$=u(new Uint8Array(t.buffer)):h=typeof t:h=typeof t,h&&alert("MD5 type mismatch, cannot process "+h),function(){function t(t,e,n,r){var o=E;E=m,m=S,S=f(S,i(f(v,f(t,f(e,n))),r)),v=o}var e=$.length;$.push(128);var c=$.length%64;if(c>56){for(var u=0;u<64-c;u++)$.push(0);c=$.length%64}for(u=0;u<56-c;u++)$.push(0);$=$.concat(n(8*e));var h=1732584193,_=4023233417,p=2562383102,g=271733878,v=0,S=0,m=0,E=0;for(u=0;u<$.length/64;u++){v=h,S=_;var T=64*u;t(r(S,m=p,E=g),3614090360,l($,T),7),t(r(S,m,E),3905402710,l($,T+4),12),t(r(S,m,E),606105819,l($,T+8),17),t(r(S,m,E),3250441966,l($,T+12),22),t(r(S,m,E),4118548399,l($,T+16),7),t(r(S,m,E),1200080426,l($,T+20),12),t(r(S,m,E),2821735955,l($,T+24),17),t(r(S,m,E),4249261313,l($,T+28),22),t(r(S,m,E),1770035416,l($,T+32),7),t(r(S,m,E),2336552879,l($,T+36),12),t(r(S,m,E),4294925233,l($,T+40),17),t(r(S,m,E),2304563134,l($,T+44),22),t(r(S,m,E),1804603682,l($,T+48),7),t(r(S,m,E),4254626195,l($,T+52),12),t(r(S,m,E),2792965006,l($,T+56),17),t(r(S,m,E),1236535329,l($,T+60),22),t(o(S,m,E),4129170786,l($,T+4),5),t(o(S,m,E),3225465664,l($,T+24),9),t(o(S,m,E),643717713,l($,T+44),14),t(o(S,m,E),3921069994,l($,T),20),t(o(S,m,E),3593408605,l($,T+20),5),t(o(S,m,E),38016083,l($,T+40),9),t(o(S,m,E),3634488961,l($,T+60),14),t(o(S,m,E),3889429448,l($,T+16),20),t(o(S,m,E),568446438,l($,T+36),5),t(o(S,m,E),3275163606,l($,T+56),9),t(o(S,m,E),4107603335,l($,T+12),14),t(o(S,m,E),1163531501,l($,T+32),20),t(o(S,m,E),2850285829,l($,T+52),5),t(o(S,m,E),4243563512,l($,T+8),9),t(o(S,m,E),1735328473,l($,T+28),14),t(o(S,m,E),2368359562,l($,T+48),20),t(a(S,m,E),4294588738,l($,T+20),4),t(a(S,m,E),2272392833,l($,T+32),11),t(a(S,m,E),1839030562,l($,T+44),16),t(a(S,m,E),4259657740,l($,T+56),23),t(a(S,m,E),2763975236,l($,T+4),4),t(a(S,m,E),1272893353,l($,T+16),11),t(a(S,m,E),4139469664,l($,T+28),16),t(a(S,m,E),3200236656,l($,T+40),23),t(a(S,m,E),681279174,l($,T+52),4),t(a(S,m,E),3936430074,l($,T),11),t(a(S,m,E),3572445317,l($,T+12),16),t(a(S,m,E),76029189,l($,T+24),23),t(a(S,m,E),3654602809,l($,T+36),4),t(a(S,m,E),3873151461,l($,T+48),11),t(a(S,m,E),530742520,l($,T+60),16),t(a(S,m,E),3299628645,l($,T+8),23),t(s(S,m,E),4096336452,l($,T),6),t(s(S,m,E),1126891415,l($,T+28),10),t(s(S,m,E),2878612391,l($,T+56),15),t(s(S,m,E),4237533241,l($,T+20),21),t(s(S,m,E),1700485571,l($,T+48),6),t(s(S,m,E),2399980690,l($,T+12),10),t(s(S,m,E),4293915773,l($,T+40),15),t(s(S,m,E),2240044497,l($,T+4),21),t(s(S,m,E),1873313359,l($,T+32),6),t(s(S,m,E),4264355552,l($,T+60),10),t(s(S,m,E),2734768916,l($,T+24),15),t(s(S,m,E),1309151649,l($,T+52),21),t(s(S,m,E),4149444226,l($,T+16),6),t(s(S,m,E),3174756917,l($,T+44),10),t(s(S,m,E),718787259,l($,T+8),15),t(s(S,m,E),3951481745,l($,T+36),21),h=f(h,v),_=f(_,S),p=f(p,m),g=f(g,E)}return d(g,p,_,h).toUpperCase()}()},function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.JSZip=t()}}(function(){return(function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw Error("Cannot find module '"+a+"'")}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){return r(e[a][1][t]||t)},c,c.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r})({1:[function(t,e,n){"use strict";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(t){for(var e,n,r,o,a,s,l,c="",d=0;d<t.length;)e=t.charCodeAt(d++),n=t.charCodeAt(d++),r=t.charCodeAt(d++),o=e>>2,a=(3&e)<<4|n>>4,s=(15&n)<<2|r>>6,l=63&r,isNaN(n)?s=l=64:isNaN(r)&&(l=64),c=c+i.charAt(o)+i.charAt(a)+i.charAt(s)+i.charAt(l);return c},n.decode=function(t){var e,n,r,o,a,s,l,c="",d=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<t.length;)o=i.indexOf(t.charAt(d++)),a=i.indexOf(t.charAt(d++)),s=i.indexOf(t.charAt(d++)),l=i.indexOf(t.charAt(d++)),e=o<<2|a>>4,n=(15&a)<<4|s>>2,r=(3&s)<<6|l,c+=String.fromCharCode(e),64!=s&&(c+=String.fromCharCode(n)),64!=l&&(c+=String.fromCharCode(r));return c}},{}],2:[function(t,e){"use strict";function n(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}n.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},e.exports=n},{}],3:[function(t,e,n){"use strict";n.STORE={magic:"\0\0",compress:function(t){return t},uncompress:function(t){return t},compressInputType:null,uncompressInputType:null},n.DEFLATE=t("./flate")},{"./flate":8}],4:[function(t,e){"use strict";var n=t("./utils"),i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];e.exports=function(t,e){if(void 0===t||!t.length)return 0;var r="string"!==n.getTypeOf(t);void 0===e&&(e=0);var o=0,a=0,s=0;e^=-1;for(var l=0,c=t.length;c>l;l++)o=i[a=255&(e^(s=r?t[l]:t.charCodeAt(l)))],e=e>>>8^o;return -1^e}},{"./utils":21}],5:[function(t,e){"use strict";function n(){this.data=null,this.length=0,this.index=0}var i=t("./utils");n.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<t||0>t)throw Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return i.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1)}},e.exports=n},{"./utils":21}],6:[function(t,e,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!1,n.date=null,n.compression=null,n.comment=null},{}],7:[function(t,e,n){"use strict";var i=t("./utils");n.string2binary=function(t){return i.string2binary(t)},n.string2Uint8Array=function(t){return i.transformTo("uint8array",t)},n.uint8Array2String=function(t){return i.transformTo("string",t)},n.string2Blob=function(t){var e=i.transformTo("arraybuffer",t);return i.arrayBuffer2Blob(e)},n.arrayBuffer2Blob=function(t){return i.arrayBuffer2Blob(t)},n.transformTo=function(t,e){return i.transformTo(t,e)},n.getTypeOf=function(t){return i.getTypeOf(t)},n.checkSupport=function(t){return i.checkSupport(t)},n.MAX_VALUE_16BITS=i.MAX_VALUE_16BITS,n.MAX_VALUE_32BITS=i.MAX_VALUE_32BITS,n.pretty=function(t){return i.pretty(t)},n.findCompression=function(t){return i.findCompression(t)},n.isRegExp=function(t){return i.isRegExp(t)}},{"./utils":21}],8:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=t("pako");n.uncompressInputType=i?"uint8array":"array",n.compressInputType=i?"uint8array":"array",n.magic="\b\0",n.compress=function(t){return r.deflateRaw(t)},n.uncompress=function(t){return r.inflateRaw(t)}},{pako:24}],9:[function(t,e){"use strict";function n(t,e){return this instanceof n?(this.files={},this.comment=null,this.root="",t&&this.load(t,e),void(this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t})):new n(t,e)}var i=t("./base64");n.prototype=t("./object"),n.prototype.load=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.utils=t("./deprecatedPublicUtils"),n.base64={encode:function(t){return i.encode(t)},decode:function(t){return i.decode(t)}},n.compressions=t("./compressions"),e.exports=n},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(t,e){"use strict";var n=t("./base64"),i=t("./zipEntries");e.exports=function(t,e){var r,o,a,s;for((e=e||{}).base64&&(t=n.decode(t)),r=(o=new i(t,e)).files,a=0;a<r.length;a++)s=r[a],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:e.createFolders});return o.zipComment.length&&(this.comment=o.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(t,e){(function(t){"use strict";e.exports=function(e,n){return new t(e,n)},e.exports.test=function(e){return t.isBuffer(e)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(t,e){"use strict";function n(t){this.data=t,this.length=this.data.length,this.index=0}var i=t("./uint8ArrayReader");n.prototype=new i,n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.index,this.index+t);return this.index+=t,e},e.exports=n},{"./uint8ArrayReader":18}],13:[function(t,e){"use strict";var n=t("./support"),i=t("./utils"),r=t("./crc32"),o=t("./signature"),a=t("./defaults"),s=t("./base64"),l=t("./compressions"),c=t("./compressedObject"),d=t("./nodeBuffer"),u=t("./utf8"),f=t("./stringWriter"),$=t("./uint8ArrayWriter"),h=function(t){if(t._data instanceof c&&(t._data=t._data.getContent(),t.options.binary=!0,t.options.base64=!1,"uint8array"===i.getTypeOf(t._data))){var e=t._data;t._data=new Uint8Array(e.length),0!==e.length&&t._data.set(e,0)}return t._data},_=function(t){var e=h(t);return"string"===i.getTypeOf(e)?!t.options.binary&&n.nodebuffer?d(e,"utf-8"):t.asBinary():e},p=function(t){var e=h(this);return null==e?"":(this.options.base64&&(e=s.decode(e)),e=t&&this.options.binary?O.utf8decode(e):i.transformTo("string",e),t||this.options.binary||(e=i.transformTo("string",O.utf8encode(e))),e)},g=function(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this._data=e,this.options=n,this._initialMetadata={dir:n.dir,date:n.date}};g.prototype={asText:function(){return p.call(this,!0)},asBinary:function(){return p.call(this,!1)},asNodeBuffer:function(){var t=_(this);return i.transformTo("nodebuffer",t)},asUint8Array:function(){var t=_(this);return i.transformTo("uint8array",t)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var v=function(t,e){var n,i="";for(n=0;e>n;n++)i+=String.fromCharCode(255&t),t>>>=8;return i},S=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===n[e]&&(n[e]=arguments[t][e]);return n},m=function(t){return!0!==(t=t||{}).base64||null!==t.binary&&void 0!==t.binary||(t.binary=!0),(t=S(t,a)).date=t.date||new Date,null!==t.compression&&(t.compression=t.compression.toUpperCase()),t},E=function(t,e,n){var r,o=i.getTypeOf(e);if((n=m(n)).createFolders&&(r=T(t))&&b.call(this,r,!0),n.dir||null==e)n.base64=!1,n.binary=!1,e=null;else if("string"===o)n.binary&&!n.base64&&!0!==n.optimizedBinaryString&&(e=i.string2binary(e));else{if(n.base64=!1,n.binary=!0,!(o||e instanceof c))throw Error("The data of '"+t+"' is in an unsupported format !");"arraybuffer"===o&&(e=i.transformTo("uint8array",e))}var a=new g(t,e,n);return this.files[t]=a,a},T=function(t){"/"==t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},b=function(t,e){return"/"!=t.slice(-1)&&(t+="/"),e=void 0!==e&&e,this.files[t]||E.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]},C=function(t,e){var n,o=new c;return t._data instanceof c?(o.uncompressedSize=t._data.uncompressedSize,o.crc32=t._data.crc32,0===o.uncompressedSize||t.dir?(e=l.STORE,o.compressedContent="",o.crc32=0):t._data.compressionMethod===e.magic?o.compressedContent=t._data.getCompressedContent():(n=t._data.getContent(),o.compressedContent=e.compress(i.transformTo(e.compressInputType,n)))):((n=_(t))&&0!==n.length&&!t.dir||(e=l.STORE,n=""),o.uncompressedSize=n.length,o.crc32=r(n),o.compressedContent=e.compress(i.transformTo(e.compressInputType,n))),o.compressedSize=o.compressedContent.length,o.compressionMethod=e.magic,o},A=function(t,e,n,a){var s,l,c,d,f=(n.compressedContent,i.transformTo("string",u.utf8encode(e.name))),$=e.comment||"",h=i.transformTo("string",u.utf8encode($)),_=f.length!==e.name.length,p=h.length!==$.length,g=e.options,S="",m="",E="";c=e._initialMetadata.dir!==e.dir?e.dir:g.dir,s=(d=e._initialMetadata.date!==e.date?e.date:g.date).getHours(),s<<=6,s|=d.getMinutes(),s<<=5,s|=d.getSeconds()/2,l=d.getFullYear()-1980,l<<=4,l|=d.getMonth()+1,l<<=5,l|=d.getDate(),_&&(m=v(1,1)+v(r(f),4)+f,S+="up"+v(m.length,2)+m),p&&(E=v(1,1)+v(this.crc32(h),4)+h,S+="uc"+v(E.length,2)+E);var T="";return T+="\n\0",T+=_||p?"\0\b":"\0\0",T+=n.compressionMethod,T+=v(s,2),T+=v(l,2),T+=v(n.crc32,4),T+=v(n.compressedSize,4),T+=v(n.uncompressedSize,4),T+=v(f.length,2),T+=v(S.length,2),{fileRecord:o.LOCAL_FILE_HEADER+T+f+S,dirRecord:o.CENTRAL_FILE_HEADER+"\x14\0"+T+v(h.length,2)+"\0\0\0\0"+(!0===c?"\x10\0\0\0":"\0\0\0\0")+v(a,4)+f+S+h,compressedObject:n}},O={load:function(){throw Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(t){var e,n,i,r,o=[];for(e in this.files)this.files.hasOwnProperty(e)&&(i=this.files[e],r=new g(i.name,i._data,S(i.options)),n=e.slice(this.root.length,e.length),e.slice(0,this.root.length)===this.root&&t(n,r)&&o.push(r));return o},file:function(t,e,n){if(1===arguments.length){if(i.isRegExp(t)){var r=t;return this.filter(function(t,e){return!e.dir&&r.test(t)})}return this.filter(function(e,n){return!n.dir&&e===t})[0]||null}return t=this.root+t,E.call(this,t,e,n),this},folder:function(t){if(!t)return this;if(i.isRegExp(t))return this.filter(function(e,n){return n.dir&&t.test(e)});var e=this.root+t,n=b.call(this,e),r=this.clone();return r.root=n.name,r},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!=t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter(function(e,n){return n.name.slice(0,t.length)===t}),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(t){t=S(t||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),i.checkSupport(t.type);var e,n,r=[],a=0,c=0,d=i.transformTo("string",this.utf8encode(t.comment||this.comment||""));for(var u in this.files)if(this.files.hasOwnProperty(u)){var h=this.files[u],_=h.options.compression||t.compression.toUpperCase(),p=l[_];if(!p)throw Error(_+" is not a valid compression method !");var g=C.call(this,h,p),m=A.call(this,u,h,g,a);a+=m.fileRecord.length+g.compressedSize,c+=m.dirRecord.length,r.push(m)}var E="";E=o.CENTRAL_DIRECTORY_END+"\0\0\0\0"+v(r.length,2)+v(r.length,2)+v(c,4)+v(a,4)+v(d.length,2)+d;var T=t.type.toLowerCase();for(e="uint8array"===T||"arraybuffer"===T||"blob"===T||"nodebuffer"===T?new $(a+c+E.length):new f(a+c+E.length),n=0;n<r.length;n++)e.append(r[n].fileRecord),e.append(r[n].compressedObject.compressedContent);for(n=0;n<r.length;n++)e.append(r[n].dirRecord);e.append(E);var b=e.finalize();switch(t.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return i.transformTo(t.type.toLowerCase(),b);case"blob":return i.arrayBuffer2Blob(i.transformTo("arraybuffer",b));case"base64":return t.base64?s.encode(b):b;default:return b}},crc32:function(t,e){return r(t,e)},utf8encode:function(t){return i.transformTo("string",u.utf8encode(t))},utf8decode:function(t){return u.utf8decode(t)}};e.exports=O},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(t,e,n){"use strict";n.LOCAL_FILE_HEADER="PK\x03\x04",n.CENTRAL_FILE_HEADER="PK\x01\x02",n.CENTRAL_DIRECTORY_END="PK\x05\x06",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",n.DATA_DESCRIPTOR="PK\x07\b"},{}],15:[function(t,e){"use strict";function n(t,e){this.data=t,e||(this.data=r.string2binary(this.data)),this.length=this.data.length,this.index=0}var i=t("./dataReader"),r=t("./utils");n.prototype=new i,n.prototype.byteAt=function(t){return this.data.charCodeAt(t)},n.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)},n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.index,this.index+t);return this.index+=t,e},e.exports=n},{"./dataReader":5,"./utils":21}],16:[function(t,e){"use strict";var n=t("./utils"),i=function(){this.data=[]};i.prototype={append:function(t){t=n.transformTo("string",t),this.data.push(t)},finalize:function(){return this.data.join("")}},e.exports=i},{"./utils":21}],17:[function(t,e,n){(function(t){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==t,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var e=new ArrayBuffer(0);try{n.blob=0===new Blob([e],{type:"application/zip"}).size}catch(i){try{var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);r.append(e),n.blob=0===r.getBlob("application/zip").size}catch(o){n.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(t,e){"use strict";function n(t){t&&(this.data=t,this.length=this.data.length,this.index=0)}var i=t("./dataReader");n.prototype=new i,n.prototype.byteAt=function(t){return this.data[t]},n.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),i=t.charCodeAt(2),r=t.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===e&&this.data[o+1]===n&&this.data[o+2]===i&&this.data[o+3]===r)return o;return -1},n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.index,this.index+t);return this.index+=t,e},e.exports=n},{"./dataReader":5}],19:[function(t,e){"use strict";var n=t("./utils"),i=function(t){this.data=new Uint8Array(t),this.index=0};i.prototype={append:function(t){0!==t.length&&(t=n.transformTo("uint8array",t),this.data.set(t,this.index),this.index+=t.length)},finalize:function(){return this.data}},e.exports=i},{"./utils":21}],20:[function(t,e,n){"use strict";for(var i=t("./utils"),r=t("./support"),o=t("./nodeBuffer"),a=Array(256),s=0;256>s;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;a[254]=a[254]=1;var l=function(t){var e,n,i,o,a,s=t.length,l=0;for(o=0;s>o;o++)55296==(64512&(n=t.charCodeAt(o)))&&s>o+1&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),l+=128>n?1:2048>n?2:65536>n?3:4;for(e=r.uint8array?new Uint8Array(l):Array(l),a=0,o=0;l>a;o++)55296==(64512&(n=t.charCodeAt(o)))&&s>o+1&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),128>n?e[a++]=n:2048>n?(e[a++]=192|n>>>6,e[a++]=128|63&n):65536>n?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},c=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return 0>n?e:0===n?e:n+a[t[n]]>e?n:e},d=function(t){var e,n,r,o,s=t.length,l=Array(2*s);for(n=0,e=0;s>e;)if(128>(r=t[e++]))l[n++]=r;else if((o=a[r])>4)l[n++]=65533,e+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&s>e;)r=r<<6|63&t[e++],o--;o>1?l[n++]=65533:65536>r?l[n++]=r:(r-=65536,l[n++]=55296|r>>10&1023,l[n++]=56320|1023&r)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)};n.utf8encode=function(t){return r.nodebuffer?o(t,"utf-8"):l(t)},n.utf8decode=function(t){if(r.nodebuffer)return i.transformTo("nodebuffer",t).toString("utf-8");t=i.transformTo(r.uint8array?"uint8array":"array",t);for(var e=[],n=0,o=t.length;o>n;){var a=c(t,Math.min(n+65536,o));e.push(d(r.uint8array?t.subarray(n,a):t.slice(n,a))),n=a}return e.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(t,e,n){"use strict";function i(t){return t}function r(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}function o(t){var e=65536,i=[],r=t.length,o=n.getTypeOf(t),a=0,s=!0;try{switch(o){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,c(0))}}catch(l){s=!1}if(!s){for(var d="",u=0;u<t.length;u++)d+=String.fromCharCode(t[u]);return d}for(;r>a&&e>1;)try{i.push("array"===o||"nodebuffer"===o?String.fromCharCode.apply(null,t.slice(a,Math.min(a+e,r))):String.fromCharCode.apply(null,t.subarray(a,Math.min(a+e,r)))),a+=e}catch(f){e=Math.floor(e/2)}return i.join("")}function a(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}var s=t("./support"),l=t("./compressions"),c=t("./nodeBuffer");n.string2binary=function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(255&t.charCodeAt(n));return e},n.arrayBuffer2Blob=function(t){n.checkSupport("blob");try{return new Blob([t],{type:"application/zip"})}catch(e){try{var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return i.append(t),i.getBlob("application/zip")}catch(r){throw Error("Bug : can't construct the Blob.")}}},n.applyFromCharCode=o;var d={};d.string={string:i,array:function(t){return r(t,Array(t.length))},arraybuffer:function(t){return d.string.uint8array(t).buffer},uint8array:function(t){return r(t,new Uint8Array(t.length))},nodebuffer:function(t){return r(t,c(t.length))}},d.array={string:o,array:i,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return c(t)}},d.arraybuffer={string:function(t){return o(new Uint8Array(t))},array:function(t){return a(new Uint8Array(t),Array(t.byteLength))},arraybuffer:i,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return c(new Uint8Array(t))}},d.uint8array={string:o,array:function(t){return a(t,Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:i,nodebuffer:function(t){return c(t)}},d.nodebuffer={string:o,array:function(t){return a(t,Array(t.length))},arraybuffer:function(t){return d.nodebuffer.uint8array(t).buffer},uint8array:function(t){return a(t,new Uint8Array(t.length))},nodebuffer:i},n.transformTo=function(t,e){return(e||(e=""),t)?(n.checkSupport(t),d[n.getTypeOf(e)][t](e)):e},n.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":s.nodebuffer&&c.test(t)?"nodebuffer":s.uint8array&&t instanceof Uint8Array?"uint8array":s.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(t){if(!s[t.toLowerCase()])throw Error(t+" is not supported by this browser")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(t){var e,n,i="";for(n=0;n<(t||"").length;n++)i+="\\x"+(16>(e=t.charCodeAt(n))?"0":"")+e.toString(16).toUpperCase();return i},n.findCompression=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null},n.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(t,e){"use strict";function n(t,e){this.files=[],this.loadOptions=e,t&&this.load(t)}var i=t("./stringReader"),r=t("./nodeBufferReader"),o=t("./uint8ArrayReader"),a=t("./utils"),s=t("./signature"),l=t("./zipEntry"),c=t("./support"),d=t("./object");n.prototype={checkSignature:function(t){var e=this.reader.readString(4);if(e!==t)throw Error("Corrupted zip or bug : unexpected signature ("+a.pretty(e)+", expected "+a.pretty(t)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=d.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,i=this.zip64EndOfCentralSize-44;i>0;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readString(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===s.CENTRAL_FILE_HEADER;)(t=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(-1===t)throw Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(t),this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(t=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(t),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(t){var e=a.getTypeOf(t);this.reader="string"!==e||c.uint8array?"nodebuffer"===e?new r(t):new o(a.transformTo("uint8array",t)):new i(t,this.loadOptions.optimizedBinaryString)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=n},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(t,e){"use strict";function n(t,e){this.options=t,this.loadOptions=e}var i=t("./stringReader"),r=t("./utils"),o=t("./compressedObject"),a=t("./object");n.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(t,e,n){return function(){var i=t.index;t.setIndex(e);var r=t.readData(n);return t.setIndex(i),r}},prepareContent:function(t,e,n,i,o){return function(){var t=r.transformTo(i.uncompressInputType,this.getCompressedContent()),e=i.uncompress(t);if(e.length!==o)throw Error("Bug : uncompressed data size mismatch");return e}},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readString(this.fileNameLength),t.skip(n),-1==this.compressedSize||-1==this.uncompressedSize)throw Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(e=r.findCompression(this.compressionMethod)))throw Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new o,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(t,t.index,this.compressedSize,e),this.decompressed.getContent=this.prepareContent(t,t.index,this.compressedSize,e,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=r.transformTo("string",this.decompressed.getContent()),a.crc32(this.decompressed)!==this.crc32))throw Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(t){if(this.versionMadeBy=t.readString(2),this.versionNeeded=t.readInt(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4),this.fileNameLength=t.readInt(2),this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw Error("Encrypted zip are not supported");this.fileName=t.readString(this.fileNameLength),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var t=new i(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(t){var e,n,i,r=t.index;for(this.extraFields=this.extraFields||{};t.index<r+this.extraFieldsLength;)e=t.readInt(2),n=t.readInt(2),i=t.readString(n),this.extraFields[e]={id:e,length:n,value:i}},handleUTF8:function(){if(this.useUTF8())this.fileName=a.utf8decode(this.fileName),this.fileComment=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();null!==t&&(this.fileName=t);var e=this.findExtraFieldUnicodeComment();null!==e&&(this.fileComment=e)}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=new i(t.value);return 1!==e.readInt(1)?null:a.crc32(this.fileName)!==e.readInt(4)?null:a.utf8decode(e.readString(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=new i(t.value);return 1!==e.readInt(1)?null:a.crc32(this.fileComment)!==e.readInt(4)?null:a.utf8decode(e.readString(t.length-5))}return null}},e.exports=n},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(t,e){"use strict";var n=t("./lib/utils/common").assign,i=t("./lib/deflate"),r=t("./lib/inflate"),o=t("./lib/zlib/constants"),a={};n(a,i,r,o),e.exports=a},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(t,e,n){"use strict";function i(t,e){var n=new u(e);if(n.push(t,!0),n.err)throw n.msg;return n.result}function r(t,e){return(e=e||{}).raw=!0,i(t,e)}function o(t,e){return(e=e||{}).gzip=!0,i(t,e)}var a=t("./zlib/deflate.js"),s=t("./utils/common"),l=t("./utils/strings"),c=t("./zlib/messages"),d=t("./zlib/zstream"),u=function(t){this.options=s.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==n)throw Error(c[n]);e.header&&a.deflateSetHeader(this.strm,e.header)};u.prototype.push=function(t,e){var n,i,r=this.strm,o=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:!0===e?4:0,r.input="string"==typeof t?l.string2buf(t):t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new s.Buf8(o),r.next_out=0,r.avail_out=o),1!==(n=a.deflate(r,i))&&0!==n)return this.onEnd(n),this.ended=!0,!1;(0===r.avail_out||0===r.avail_in&&4===i)&&this.onData("string"===this.options.to?l.buf2binstring(s.shrinkBuf(r.output,r.next_out)):s.shrinkBuf(r.output,r.next_out))}while((r.avail_in>0||0===r.avail_out)&&1!==n);return 4!==i||(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n)},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){0===t&&(this.result="string"===this.options.to?this.chunks.join(""):s.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=u,n.deflate=i,n.deflateRaw=r,n.gzip=o},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(t,e,n){"use strict";function i(t,e){var n=new f(e);if(n.push(t,!0),n.err)throw n.msg;return n.result}function r(t,e){return(e=e||{}).raw=!0,i(t,e)}var o=t("./zlib/inflate.js"),a=t("./utils/common"),s=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),d=t("./zlib/zstream"),u=t("./zlib/gzheader"),f=function(t){this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var n=o.inflateInit2(this.strm,e.windowBits);if(n!==l.Z_OK)throw Error(c[n]);this.header=new u,o.inflateGetHeader(this.strm,this.header)};f.prototype.push=function(t,e){var n,i,r,c,d,u=this.strm,f=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:!0===e?l.Z_FINISH:l.Z_NO_FLUSH,u.input="string"==typeof t?s.binstring2buf(t):t,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new a.Buf8(f),u.next_out=0,u.avail_out=f),(n=o.inflate(u,l.Z_NO_FLUSH))!==l.Z_STREAM_END&&n!==l.Z_OK)return this.onEnd(n),this.ended=!0,!1;u.next_out&&(0===u.avail_out||n===l.Z_STREAM_END||0===u.avail_in&&i===l.Z_FINISH)&&("string"===this.options.to?(r=s.utf8border(u.output,u.next_out),c=u.next_out-r,d=s.buf2string(u.output,r),u.next_out=c,u.avail_out=f-c,c&&a.arraySet(u.output,u.output,r,c,0),this.onData(d)):this.onData(a.shrinkBuf(u.output,u.next_out)))}while(u.avail_in>0&&n!==l.Z_STREAM_END);return n===l.Z_STREAM_END&&(i=l.Z_FINISH),i!==l.Z_FINISH||(n=o.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l.Z_OK)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===l.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=f,n.inflate=i,n.inflateRaw=r,n.ungzip=i},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,n,i,r){if(e.subarray&&t.subarray)return void t.set(e.subarray(n,n+i),r);for(var o=0;i>o;o++)t[r+o]=e[n+o]},flattenChunks:function(t){var e,n,i,r,o,a;for(i=0,e=0,n=t.length;n>e;e++)i+=t[e].length;for(a=new Uint8Array(i),r=0,e=0,n=t.length;n>e;e++)o=t[e],a.set(o,r),r+=o.length;return a}},o={arraySet:function(t,e,n,i,r){for(var o=0;i>o;o++)t[r+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],28:[function(t,e,n){"use strict";function i(t,e){if(65537>e&&(t.subarray&&a||!t.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",i=0;e>i;i++)n+=String.fromCharCode(t[i]);return n}var r=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(s){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){a=!1}for(var c=new r.Buf8(256),d=0;256>d;d++)c[d]=d>=252?6:d>=248?5:d>=240?4:d>=224?3:d>=192?2:1;c[254]=c[254]=1,n.string2buf=function(t){var e,n,i,o,a,s=t.length,l=0;for(o=0;s>o;o++)55296==(64512&(n=t.charCodeAt(o)))&&s>o+1&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),l+=128>n?1:2048>n?2:65536>n?3:4;for(e=new r.Buf8(l),a=0,o=0;l>a;o++)55296==(64512&(n=t.charCodeAt(o)))&&s>o+1&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),128>n?e[a++]=n:2048>n?(e[a++]=192|n>>>6,e[a++]=128|63&n):65536>n?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},n.buf2binstring=function(t){return i(t,t.length)},n.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;i>n;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,r,o,a,s=e||t.length,l=Array(2*s);for(r=0,n=0;s>n;)if(128>(o=t[n++]))l[r++]=o;else if((a=c[o])>4)l[r++]=65533,n+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&s>n;)o=o<<6|63&t[n++],a--;a>1?l[r++]=65533:65536>o?l[r++]=o:(o-=65536,l[r++]=55296|o>>10&1023,l[r++]=56320|1023&o)}return i(l,r)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return 0>n?e:0===n?e:n+c[t[n]]>e?n:e}},{"./common":27}],29:[function(t,e){"use strict";function n(t,e,n,i){for(var r=65535&t|0,o=t>>>16&65535|0,a=0;0!==n;){a=n>2e3?2e3:n,n-=a;do o=o+(r=r+e[i++]|0)|0;while(--a);r%=65521,o%=65521}return r|o<<16|0}e.exports=n},{}],30:[function(t,e){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(t,e){"use strict";function n(t,e,n,r){var o=i,a=r+n;t^=-1;for(var s=r;a>s;s++)t=t>>>8^o[255&(t^e[s])];return -1^t}var i=function(){for(var t,e=[],n=0;256>n;n++){t=n;for(var i=0;8>i;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=n},{}],32:[function(t,e,n){"use strict";function i(t,e){return t.msg=D[e],e}function r(t){return(t<<1)-(t>4?9:0)}function o(t){for(var e=t.length;--e>=0;)t[e]=0}function a(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(L.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function s(t,e){R._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,a(t.strm)}function l(t,e){t.pending_buf[t.pending++]=e}function c(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function d(t,e,n,i){var r=t.avail_in;return r>i&&(r=i),0===r?0:(t.avail_in-=r,L.arraySet(e,t.input,t.next_in,r,n),1===t.state.wrap?t.adler=w(t.adler,e,r,n):2===t.state.wrap&&(t.adler=j(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)}function u(t,e){var n,i,r=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-ts?t.strstart-(t.w_size-ts):0,c=t.window,d=t.w_mask,u=t.prev,f=t.strstart+ta,$=c[o+a-1],h=c[o+a];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do if(c[(n=e)+a]===h&&c[n+a-1]===$&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do;while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&f>o);if(i=ta-(f-o),o=f-ta,i>a){if(t.match_start=e,a=i,i>=s)break;$=c[o+a-1],h=c[o+a]}}while((e=u[e&d])>l&&0!=--r);return a<=t.lookahead?a:t.lookahead}function f(t){var e,n,i,r,o,a=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=a+(a-ts)){L.arraySet(t.window,t.window,a,a,0),t.match_start-=a,t.strstart-=a,t.block_start-=a,e=n=t.hash_size;do i=t.head[--e],t.head[e]=i>=a?i-a:0;while(--n);e=n=a;do i=t.prev[--e],t.prev[e]=i>=a?i-a:0;while(--n);r+=a}if(0===t.strm.avail_in)break;if(n=d(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=to)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+to-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<to)););}while(t.lookahead<ts&&0!==t.strm.avail_in)}function $(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(f(t),0===t.lookahead&&e===x)return tp;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+n;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,s(t,!1),0===t.strm.avail_out)||t.strstart-t.block_start>=t.w_size-ts&&(s(t,!1),0===t.strm.avail_out))return tp}return t.insert=0,e===N?(s(t,!0),0===t.strm.avail_out?t0:tv):(t.strstart>t.block_start&&(s(t,!1),t.strm.avail_out),tp)}function h(t,e){for(var n,i;;){if(t.lookahead<ts){if(f(t),t.lookahead<ts&&e===x)return tp;if(0===t.lookahead)break}if(n=0,t.lookahead>=to&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+to-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-ts&&(t.match_length=u(t,n)),t.match_length>=to){if(i=R._tr_tally(t,t.strstart-t.match_start,t.match_length-to),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=to){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+to-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask}else i=R._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(s(t,!1),0===t.strm.avail_out))return tp}return t.insert=t.strstart<to-1?t.strstart:to-1,e===N?(s(t,!0),0===t.strm.avail_out?t0:tv):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?tp:tg}function _(t,e){for(var n,i,r;;){if(t.lookahead<ts){if(f(t),t.lookahead<ts&&e===x)return tp;if(0===t.lookahead)break}if(n=0,t.lookahead>=to&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+to-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=to-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-ts&&(t.match_length=u(t,n),t.match_length<=5&&(t.strategy===H||t.match_length===to&&t.strstart-t.match_start>4096)&&(t.match_length=to-1)),t.prev_length>=to&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-to,i=R._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-to),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+to-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!=--t.prev_length);if(t.match_available=0,t.match_length=to-1,t.strstart++,i&&(s(t,!1),0===t.strm.avail_out))return tp}else if(t.match_available){if((i=R._tr_tally(t,0,t.window[t.strstart-1]))&&s(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return tp}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=R._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<to-1?t.strstart:to-1,e===N?(s(t,!0),0===t.strm.avail_out?t0:tv):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?tp:tg}function p(t,e){for(var n,i,r,o,a=t.window;;){if(t.lookahead<=ta){if(f(t),t.lookahead<=ta&&e===x)return tp;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=to&&t.strstart>0&&(i=a[r=t.strstart-1])===a[++r]&&i===a[++r]&&i===a[++r]){o=t.strstart+ta;do;while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&o>r);t.match_length=ta-(o-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=to?(n=R._tr_tally(t,1,t.match_length-to),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=R._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(s(t,!1),0===t.strm.avail_out))return tp}return t.insert=0,e===N?(s(t,!0),0===t.strm.avail_out?t0:tv):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?tp:tg}function g(t,e){for(var n;;){if(0===t.lookahead&&(f(t),0===t.lookahead)){if(e===x)return tp;break}if(t.match_length=0,n=R._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(s(t,!1),0===t.strm.avail_out))return tp}return t.insert=0,e===N?(s(t,!0),0===t.strm.avail_out?t0:tv):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?tp:tg}function v(t){t.window_size=2*t.w_size,o(t.head),t.max_lazy_match=y[t.level].max_lazy,t.good_match=y[t.level].good_length,t.nice_match=y[t.level].nice_length,t.max_chain_length=y[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=to-1,t.match_available=0,t.ins_h=0}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new L.Buf16(2*ti),this.dyn_dtree=new L.Buf16(2*(2*te+1)),this.bl_tree=new L.Buf16(2*(2*tn+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new L.Buf16(tr+1),this.heap=new L.Buf16(2*tt+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new L.Buf16(2*tt+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function m(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=Y,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?tc:th,t.adler=2===e.wrap?0:1,e.last_flush=x,R._tr_init(e),F):i(t,M)}function E(t){var e=m(t);return e===F&&v(t.state),e}function T(t,e){return t&&t.state?2!==t.state.wrap?M:(t.state.gzhead=e,F):M}function b(t,e,n,r,o,a){if(!t)return M;var s=1;if(e===V&&(e=6),0>r?(s=0,r=-r):r>15&&(s=2,r-=16),1>o||o>X||n!==Z||8>r||r>15||0>e||e>9||0>a||a>J)return i(t,M);8===r&&(r=9);var l=new S;return t.state=l,l.strm=t,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+to-1)/to),l.window=new L.Buf8(2*l.w_size),l.head=new L.Buf16(l.hash_size),l.prev=new L.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new L.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=a,l.method=n,E(t)}function C(t,e){return b(t,e,Z,q,Q,W)}function A(t,e){var n,s,d,u;if(!t||!t.state||e>P||0>e)return t?i(t,M):M;if(s=t.state,!t.output||!t.input&&0!==t.avail_in||s.status===t_&&e!==N)return i(t,0===t.avail_out?K:M);if(s.strm=t,n=s.last_flush,s.last_flush=e,s.status===tc){if(2===s.wrap)t.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=G||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=j(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=td):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=G||s.level<2?4:0),l(s,t8),s.status=th);else{var f=Z+(s.w_bits-8<<4)<<8,$=-1;f|=($=s.strategy>=G||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(f|=tl),f+=31-f%31,s.status=th,c(s,f),0!==s.strstart&&(c(s,t.adler>>>16),c(s,65535&t.adler)),t.adler=1}}if(s.status===td){if(s.gzhead.extra){for(d=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>d&&(t.adler=j(t.adler,s.pending_buf,s.pending-d,d)),a(t),d=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>d&&(t.adler=j(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=tu)}else s.status=tu}if(s.status===tu){if(s.gzhead.name){d=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>d&&(t.adler=j(t.adler,s.pending_buf,s.pending-d,d)),a(t),d=s.pending,s.pending===s.pending_buf_size)){u=1;break}u=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,u)}while(0!==u);s.gzhead.hcrc&&s.pending>d&&(t.adler=j(t.adler,s.pending_buf,s.pending-d,d)),0===u&&(s.gzindex=0,s.status=tf)}else s.status=tf}if(s.status===tf){if(s.gzhead.comment){d=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>d&&(t.adler=j(t.adler,s.pending_buf,s.pending-d,d)),a(t),d=s.pending,s.pending===s.pending_buf_size)){u=1;break}u=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,u)}while(0!==u);s.gzhead.hcrc&&s.pending>d&&(t.adler=j(t.adler,s.pending_buf,s.pending-d,d)),0===u&&(s.status=t$)}else s.status=t$}if(s.status===t$&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&a(t),s.pending+2<=s.pending_buf_size&&(l(s,255&t.adler),l(s,t.adler>>8&255),t.adler=0,s.status=th)):s.status=th),0!==s.pending){if(a(t),0===t.avail_out)return s.last_flush=-1,F}else if(0===t.avail_in&&r(e)<=r(n)&&e!==N)return i(t,K);if(s.status===t_&&0!==t.avail_in)return i(t,K);if(0!==t.avail_in||0!==s.lookahead||e!==x&&s.status!==t_){var h=s.strategy===G?g(s,e):s.strategy===z?p(s,e):y[s.level].func(s,e);if((h===t0||h===tv)&&(s.status=t_),h===tp||h===t0)return 0===t.avail_out&&(s.last_flush=-1),F;if(h===tg&&(e===I?R._tr_align(s):e!==P&&(R._tr_stored_block(s,0,0,!1),e===k&&(o(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),a(t),0===t.avail_out))return s.last_flush=-1,F}return e!==N?F:s.wrap<=0?U:(2===s.wrap?(l(s,255&t.adler),l(s,t.adler>>8&255),l(s,t.adler>>16&255),l(s,t.adler>>24&255),l(s,255&t.total_in),l(s,t.total_in>>8&255),l(s,t.total_in>>16&255),l(s,t.total_in>>24&255)):(c(s,t.adler>>>16),c(s,65535&t.adler)),a(t),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?F:U)}function O(t){var e;return t&&t.state?(e=t.state.status)!==tc&&e!==td&&e!==tu&&e!==tf&&e!==t$&&e!==th&&e!==t_?i(t,M):(t.state=null,e===th?i(t,B):F):M}var y,L=t("../utils/common"),R=t("./trees"),w=t("./adler32"),j=t("./crc32"),D=t("./messages"),x=0,I=1,k=3,N=4,P=5,F=0,U=1,M=-2,B=-3,K=-5,V=-1,H=1,G=2,z=3,J=4,W=0,Y=2,Z=8,X=9,q=15,Q=8,tt=286,te=30,tn=19,ti=2*tt+1,tr=15,to=3,ta=258,ts=ta+to+1,tl=32,tc=42,td=69,tu=73,tf=91,t$=103,th=113,t_=666,tp=1,tg=2,t0=3,tv=4,t8=3,tS=function(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r};y=[new tS(0,0,0,0,$),new tS(4,4,8,4,h),new tS(4,5,16,8,h),new tS(4,6,32,32,h),new tS(4,4,16,16,_),new tS(8,16,32,32,_),new tS(8,16,128,128,_),new tS(8,32,128,256,_),new tS(32,128,258,1024,_),new tS(32,258,258,4096,_)],n.deflateInit=C,n.deflateInit2=b,n.deflateReset=E,n.deflateResetKeep=m,n.deflateSetHeader=T,n.deflate=A,n.deflateEnd=O,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(t,e){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=n},{}],34:[function(t,e){"use strict";e.exports=function(t,e){var n,i,r,o,a,s,l,c,d,u,f,$,h,_,p,g,v,S,m,E,T,b,C,A,O;n=t.state,i=t.next_in,A=t.input,r=i+(t.avail_in-5),o=t.next_out,O=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),l=n.dmax,c=n.wsize,d=n.whave,u=n.wnext,f=n.window,$=n.hold,h=n.bits,_=n.lencode,p=n.distcode,g=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;a:do{15>h&&($+=A[i++]<<h,h+=8,$+=A[i++]<<h,h+=8),S=_[$&g];b:for(;;){if($>>>=m=S>>>24,h-=m,0==(m=S>>>16&255))O[o++]=65535&S;else{if(!(16&m)){if(0==(64&m)){S=_[(65535&S)+($&(1<<m)-1)];continue b}if(32&m){n.mode=12;break a}t.msg="invalid literal/length code",n.mode=30;break a}E=65535&S,(m&=15)&&(m>h&&($+=A[i++]<<h,h+=8),E+=$&(1<<m)-1,$>>>=m,h-=m),15>h&&($+=A[i++]<<h,h+=8,$+=A[i++]<<h,h+=8),S=p[$&v];c:for(;;){if($>>>=m=S>>>24,h-=m,!(16&(m=S>>>16&255))){if(0==(64&m)){S=p[(65535&S)+($&(1<<m)-1)];continue c}t.msg="invalid distance code",n.mode=30;break a}if(T=65535&S,(m&=15)>h&&($+=A[i++]<<h,m>(h+=8)&&($+=A[i++]<<h,h+=8)),(T+=$&(1<<m)-1)>l){t.msg="invalid distance too far back",n.mode=30;break a}if($>>>=m,h-=m,T>(m=o-a)){if((m=T-m)>d&&n.sane){t.msg="invalid distance too far back",n.mode=30;break a}if(b=0,C=f,0===u){if(b+=c-m,E>m){E-=m;do O[o++]=f[b++];while(--m);b=o-T,C=O}}else if(m>u){if(b+=c+u-m,E>(m-=u)){E-=m;do O[o++]=f[b++];while(--m);if(b=0,E>u){E-=m=u;do O[o++]=f[b++];while(--m);b=o-T,C=O}}}else if(b+=u-m,E>m){E-=m;do O[o++]=f[b++];while(--m);b=o-T,C=O}for(;E>2;)O[o++]=C[b++],O[o++]=C[b++],O[o++]=C[b++],E-=3;E&&(O[o++]=C[b++],E>1&&(O[o++]=C[b++]))}else{b=o-T;do O[o++]=O[b++],O[o++]=O[b++],O[o++]=O[b++],E-=3;while(E>2);E&&(O[o++]=O[b++],E>1&&(O[o++]=O[b++]))}break}}break}}while(r>i&&s>o);i-=E=h>>3,h-=E<<3,$&=(1<<h)-1,t.next_in=i,t.next_out=o,t.avail_in=r>i?r-i+5:5-(i-r),t.avail_out=s>o?s-o+257:257-(o-s),n.hold=$,n.bits=h}},{}],35:[function(t,e,n){"use strict";function i(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new g.Buf16(320),this.work=new g.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=N,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new g.Buf32(t$),e.distcode=e.distdyn=new g.Buf32(th),e.sane=1,e.back=-1,L):j}function a(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,o(t)):j}function s(t,e){var n,i;return t&&t.state?(i=t.state,0>e?(n=0,e=-e):(n=1+(e>>4),48>e&&(e&=15)),e&&(8>e||e>15)?j:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,a(t))):j}function l(t,e){var n,i;return t?(i=new r,t.state=i,i.window=null,(n=s(t,e))!==L&&(t.state=null),n):j}function c(t){return l(t,t_)}function d(t){if(tp){var e;for(_=new g.Buf32(512),p=new g.Buf32(32),e=0;144>e;)t.lens[e++]=8;for(;256>e;)t.lens[e++]=9;for(;280>e;)t.lens[e++]=7;for(;288>e;)t.lens[e++]=8;for(E(b,t.lens,0,288,_,0,t.work,{bits:9}),e=0;32>e;)t.lens[e++]=5;E(C,t.lens,0,32,p,0,t.work,{bits:5}),tp=!1}t.lencode=_,t.lenbits=9,t.distcode=p,t.distbits=5}function u(t,e,n,i){var r,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new g.Buf8(o.wsize)),i>=o.wsize?(g.arraySet(o.window,e,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>i&&(r=i),g.arraySet(o.window,e,n-i,r,o.wnext),(i-=r)?(g.arraySet(o.window,e,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function f(t,e){var n,r,o,a,s,l,c,f,$,h,_,p,t$,th,t_,tp,tg,t0,tv,t8,tS,tm,tE,tT,tb=0,tC=new g.Buf8(4),tA=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return j;(n=t.state).mode===J&&(n.mode=W),s=t.next_out,o=t.output,c=t.avail_out,a=t.next_in,r=t.input,l=t.avail_in,f=n.hold,$=n.bits,h=l,_=c,tm=L;a:for(;;)switch(n.mode){case N:if(0===n.wrap){n.mode=W;break}for(;16>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(2&n.wrap&&35615===f){n.check=0,tC[0]=255&f,tC[1]=f>>>8&255,n.check=S(n.check,tC,2,0),f=0,$=0,n.mode=P;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){t.msg="incorrect header check",n.mode=tu;break}if((15&f)!==k){t.msg="unknown compression method",n.mode=tu;break}if(f>>>=4,$-=4,tS=8+(15&f),0===n.wbits)n.wbits=tS;else if(tS>n.wbits){t.msg="invalid window size",n.mode=tu;break}n.dmax=1<<tS,t.adler=n.check=1,n.mode=512&f?G:J,f=0,$=0;break;case P:for(;16>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(n.flags=f,(255&n.flags)!==k){t.msg="unknown compression method",n.mode=tu;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=tu;break}n.head&&(n.head.text=f>>8&1),512&n.flags&&(tC[0]=255&f,tC[1]=f>>>8&255,n.check=S(n.check,tC,2,0)),f=0,$=0,n.mode=F;case F:for(;32>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}n.head&&(n.head.time=f),512&n.flags&&(tC[0]=255&f,tC[1]=f>>>8&255,tC[2]=f>>>16&255,tC[3]=f>>>24&255,n.check=S(n.check,tC,4,0)),f=0,$=0,n.mode=U;case U:for(;16>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&n.flags&&(tC[0]=255&f,tC[1]=f>>>8&255,n.check=S(n.check,tC,2,0)),f=0,$=0,n.mode=M;case M:if(1024&n.flags){for(;16>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}n.length=f,n.head&&(n.head.extra_len=f),512&n.flags&&(tC[0]=255&f,tC[1]=f>>>8&255,n.check=S(n.check,tC,2,0)),f=0,$=0}else n.head&&(n.head.extra=null);n.mode=B;case B:if(1024&n.flags&&((p=n.length)>l&&(p=l),p&&(n.head&&(tS=n.head.extra_len-n.length,n.head.extra||(n.head.extra=Array(n.head.extra_len)),g.arraySet(n.head.extra,r,a,p,tS)),512&n.flags&&(n.check=S(n.check,r,p,a)),l-=p,a+=p,n.length-=p),n.length))break a;n.length=0,n.mode=K;case K:if(2048&n.flags){if(0===l)break a;p=0;do tS=r[a+p++],n.head&&tS&&n.length<65536&&(n.head.name+=String.fromCharCode(tS));while(tS&&l>p);if(512&n.flags&&(n.check=S(n.check,r,p,a)),l-=p,a+=p,tS)break a}else n.head&&(n.head.name=null);n.length=0,n.mode=V;case V:if(4096&n.flags){if(0===l)break a;p=0;do tS=r[a+p++],n.head&&tS&&n.length<65536&&(n.head.comment+=String.fromCharCode(tS));while(tS&&l>p);if(512&n.flags&&(n.check=S(n.check,r,p,a)),l-=p,a+=p,tS)break a}else n.head&&(n.head.comment=null);n.mode=H;case H:if(512&n.flags){for(;16>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(f!==(65535&n.check)){t.msg="header crc mismatch",n.mode=tu;break}f=0,$=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=J;break;case G:for(;32>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}t.adler=n.check=i(f),f=0,$=0,n.mode=z;case z:if(0===n.havedict)return t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=l,n.hold=f,n.bits=$,w;t.adler=n.check=1,n.mode=J;case J:if(e===O||e===y)break a;case W:if(n.last){f>>>=7&$,$-=7&$,n.mode=tl;break}for(;3>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}switch(n.last=1&f,$-=1,3&(f>>>=1)){case 0:n.mode=Y;break;case 1:if(d(n),n.mode=te,e===y){f>>>=2,$-=2;break a}break;case 2:n.mode=q;break;case 3:t.msg="invalid block type",n.mode=tu}f>>>=2,$-=2;break;case Y:for(f>>>=7&$,$-=7&$;32>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if((65535&f)!=(f>>>16^65535)){t.msg="invalid stored block lengths",n.mode=tu;break}if(n.length=65535&f,f=0,$=0,n.mode=Z,e===y)break a;case Z:n.mode=X;case X:if(p=n.length){if(p>l&&(p=l),p>c&&(p=c),0===p)break a;g.arraySet(o,r,a,p,s),l-=p,a+=p,c-=p,s+=p,n.length-=p;break}n.mode=J;break;case q:for(;14>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(n.nlen=257+(31&f),f>>>=5,$-=5,n.ndist=1+(31&f),f>>>=5,$-=5,n.ncode=4+(15&f),f>>>=4,$-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=tu;break}n.have=0,n.mode=Q;case Q:for(;n.have<n.ncode;){for(;3>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}n.lens[tA[n.have++]]=7&f,f>>>=3,$-=3}for(;n.have<19;)n.lens[tA[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,tE={bits:n.lenbits},tm=E(T,n.lens,0,19,n.lencode,0,n.work,tE),n.lenbits=tE.bits,tm){t.msg="invalid code lengths set",n.mode=tu;break}n.have=0,n.mode=tt;case tt:for(;n.have<n.nlen+n.ndist;){for(;t_=(tb=n.lencode[f&(1<<n.lenbits)-1])>>>24,tp=tb>>>16&255,tg=65535&tb,!($>=t_);){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(16>tg)f>>>=t_,$-=t_,n.lens[n.have++]=tg;else{if(16===tg){for(tT=t_+2;tT>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(f>>>=t_,$-=t_,0===n.have){t.msg="invalid bit length repeat",n.mode=tu;break}tS=n.lens[n.have-1],p=3+(3&f),f>>>=2,$-=2}else if(17===tg){for(tT=t_+3;tT>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}f>>>=t_,$-=t_,tS=0,p=3+(7&f),f>>>=3,$-=3}else{for(tT=t_+7;tT>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}f>>>=t_,$-=t_,tS=0,p=11+(127&f),f>>>=7,$-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=tu;break}for(;p--;)n.lens[n.have++]=tS}}if(n.mode===tu)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=tu;break}if(n.lenbits=9,tE={bits:n.lenbits},tm=E(b,n.lens,0,n.nlen,n.lencode,0,n.work,tE),n.lenbits=tE.bits,tm){t.msg="invalid literal/lengths set",n.mode=tu;break}if(n.distbits=6,n.distcode=n.distdyn,tE={bits:n.distbits},tm=E(C,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,tE),n.distbits=tE.bits,tm){t.msg="invalid distances set",n.mode=tu;break}if(n.mode=te,e===y)break a;case te:n.mode=tn;case tn:if(l>=6&&c>=258){t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=l,n.hold=f,n.bits=$,m(t,_),s=t.next_out,o=t.output,c=t.avail_out,a=t.next_in,r=t.input,l=t.avail_in,f=n.hold,$=n.bits,n.mode===J&&(n.back=-1);break}for(n.back=0;t_=(tb=n.lencode[f&(1<<n.lenbits)-1])>>>24,tp=tb>>>16&255,tg=65535&tb,!($>=t_);){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(tp&&0==(240&tp)){for(t0=t_,tv=tp,t8=tg;t_=(tb=n.lencode[t8+((f&(1<<t0+tv)-1)>>t0)])>>>24,tp=tb>>>16&255,tg=65535&tb,!($>=t0+t_);){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}f>>>=t0,$-=t0,n.back+=t0}if(f>>>=t_,$-=t_,n.back+=t_,n.length=tg,0===tp){n.mode=ts;break}if(32&tp){n.back=-1,n.mode=J;break}if(64&tp){t.msg="invalid literal/length code",n.mode=tu;break}n.extra=15&tp,n.mode=ti;case ti:if(n.extra){for(tT=n.extra;tT>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,$-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=tr;case tr:for(;t_=(tb=n.distcode[f&(1<<n.distbits)-1])>>>24,tp=tb>>>16&255,tg=65535&tb,!($>=t_);){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(0==(240&tp)){for(t0=t_,tv=tp,t8=tg;t_=(tb=n.distcode[t8+((f&(1<<t0+tv)-1)>>t0)])>>>24,tp=tb>>>16&255,tg=65535&tb,!($>=t0+t_);){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}f>>>=t0,$-=t0,n.back+=t0}if(f>>>=t_,$-=t_,n.back+=t_,64&tp){t.msg="invalid distance code",n.mode=tu;break}n.offset=tg,n.extra=15&tp,n.mode=to;case to:if(n.extra){for(tT=n.extra;tT>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,$-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=tu;break}n.mode=ta;case ta:if(0===c)break a;if(p=_-c,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=tu;break}p>n.wnext?(p-=n.wnext,t$=n.wsize-p):t$=n.wnext-p,p>n.length&&(p=n.length),th=n.window}else th=o,t$=s-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do o[s++]=th[t$++];while(--p);0===n.length&&(n.mode=tn);break;case ts:if(0===c)break a;o[s++]=n.length,c--,n.mode=tn;break;case tl:if(n.wrap){for(;32>$;){if(0===l)break a;l--,f|=r[a++]<<$,$+=8}if(_-=c,t.total_out+=_,n.total+=_,_&&(t.adler=n.check=n.flags?S(n.check,o,_,s-_):v(n.check,o,_,s-_)),_=c,(n.flags?f:i(f))!==n.check){t.msg="incorrect data check",n.mode=tu;break}f=0,$=0}n.mode=tc;case tc:if(n.wrap&&n.flags){for(;32>$;){if(0===l)break a;l--,f+=r[a++]<<$,$+=8}if(f!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=tu;break}f=0,$=0}n.mode=td;case td:tm=R;break a;case tu:tm=D;break a;case tf:return x;default:return j}return t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=l,n.hold=f,n.bits=$,(n.wsize||_!==t.avail_out&&n.mode<tu&&(n.mode<tl||e!==A))&&u(t,t.output,t.next_out,_-t.avail_out)?(n.mode=tf,x):(h-=t.avail_in,_-=t.avail_out,t.total_in+=h,t.total_out+=_,n.total+=_,n.wrap&&_&&(t.adler=n.check=n.flags?S(n.check,o,_,t.next_out-_):v(n.check,o,_,t.next_out-_)),t.data_type=n.bits+(n.last?64:0)+(n.mode===J?128:0)+(n.mode===te||n.mode===Z?256:0),(0===h&&0===_||e===A)&&tm===L&&(tm=I),tm)}function $(t){if(!t||!t.state)return j;var e=t.state;return e.window&&(e.window=null),t.state=null,L}function h(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?j:(n.head=e,e.done=!1,L):j}var _,p,g=t("../utils/common"),v=t("./adler32"),S=t("./crc32"),m=t("./inffast"),E=t("./inftrees"),T=0,b=1,C=2,A=4,O=5,y=6,L=0,R=1,w=2,j=-2,D=-3,x=-4,I=-5,k=8,N=1,P=2,F=3,U=4,M=5,B=6,K=7,V=8,H=9,G=10,z=11,J=12,W=13,Y=14,Z=15,X=16,q=17,Q=18,tt=19,te=20,tn=21,ti=22,tr=23,to=24,ta=25,ts=26,tl=27,tc=28,td=29,tu=30,tf=31,t$=852,th=592,t_=15,tp=!0;n.inflateReset=a,n.inflateReset2=s,n.inflateResetKeep=o,n.inflateInit=c,n.inflateInit2=l,n.inflate=f,n.inflateEnd=$,n.inflateGetHeader=h,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(t,e){"use strict";var n=t("../utils/common"),i=15,r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,l,c,d,u,f,$){var h,_,p,g,v,S,m,E,T,b=$.bits,C=0,A=0,O=0,y=0,L=0,R=0,w=0,j=0,D=0,x=0,I=null,k=0,N=new n.Buf16(16),P=new n.Buf16(16),F=null,U=0;for(C=0;i>=C;C++)N[C]=0;for(A=0;c>A;A++)N[e[l+A]]++;for(L=b,y=i;y>=1&&0===N[y];y--);if(L>y&&(L=y),0===y)return d[u++]=20971520,d[u++]=20971520,$.bits=1,0;for(O=1;y>O&&0===N[O];O++);for(O>L&&(L=O),j=1,C=1;i>=C;C++)if(j<<=1,0>(j-=N[C]))return -1;if(j>0&&(0===t||1!==y))return -1;for(P[1]=0,C=1;i>C;C++)P[C+1]=P[C]+N[C];for(A=0;c>A;A++)0!==e[l+A]&&(f[P[e[l+A]]++]=A);if(0===t?(I=F=f,S=19):1===t?(I=r,k-=257,F=o,U-=257,S=256):(I=a,F=s,S=-1),x=0,A=0,C=O,v=u,R=L,w=0,p=-1,g=(D=1<<L)-1,1===t&&D>852||2===t&&D>592)return 1;for(var M=0;;){M++,m=C-w,f[A]<S?(E=0,T=f[A]):f[A]>S?(E=F[U+f[A]],T=I[k+f[A]]):(E=96,T=0),h=1<<C-w,O=_=1<<R;do d[v+(x>>w)+(_-=h)]=m<<24|E<<16|T|0;while(0!==_);for(h=1<<C-1;x&h;)h>>=1;if(0!==h?(x&=h-1,x+=h):x=0,A++,0==--N[C]){if(C===y)break;C=e[l+f[A]]}if(C>L&&(x&g)!==p){for(0===w&&(w=L),v+=O,j=1<<(R=C-w);y>R+w&&!(0>=(j-=N[R+w]));)R++,j<<=1;if(D+=1<<R,1===t&&D>852||2===t&&D>592)return 1;d[p=x&g]=L<<24|R<<16|v-u|0}}return 0!==x&&(d[v+x]=C-w<<24|4194304),$.bits=L,0}},{"../utils/common":27}],37:[function(t,e){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(t,e,n){"use strict";function i(t){for(var e=t.length;--e>=0;)t[e]=0}function r(t){return 256>t?ti[t]:ti[256+(t>>>7)]}function o(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function a(t,e,n){t.bi_valid>G-n?(t.bi_buf|=e<<t.bi_valid&65535,o(t,t.bi_buf),t.bi_buf=e>>G-t.bi_valid,t.bi_valid+=n-G):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function s(t,e,n){a(t,n[2*e],n[2*e+1])}function l(t,e){var n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1}function c(t){16===t.bi_valid?(o(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function d(t,e){var n,i,r,o,a,s,l=e.dyn_tree,c=e.max_code,d=e.stat_desc.static_tree,u=e.stat_desc.has_stree,f=e.stat_desc.extra_bits,$=e.stat_desc.extra_base,h=e.stat_desc.max_length,_=0;for(o=0;H>=o;o++)t.bl_count[o]=0;for(l[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;V>n;n++)(o=l[2*l[2*(i=t.heap[n])+1]+1]+1)>h&&(o=h,_++),l[2*i+1]=o,i>c||(t.bl_count[o]++,a=0,i>=$&&(a=f[i-$]),s=l[2*i],t.opt_len+=s*(o+a),u&&(t.static_len+=s*(d[2*i+1]+a)));if(0!==_){do{for(o=h-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[h]--,_-=2}while(_>0);for(o=h;0!==o;o--)for(i=t.bl_count[o];0!==i;)(r=t.heap[--n])>c||(l[2*r+1]!==o&&(t.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}function u(t,e,n){var i,r,o=Array(H+1),a=0;for(i=1;H>=i;i++)o[i]=a=a+n[i-1]<<1;for(r=0;e>=r;r++){var s=t[2*r+1];0!==s&&(t[2*r]=l(o[s]++,s))}}function f(){var t,e,n,i,r,o=Array(H+1);for(n=0,i=0;F-1>i;i++)for(to[i]=n,t=0;t<1<<X[i];t++)tr[n++]=i;for(tr[n-1]=i,r=0,i=0;16>i;i++)for(ta[i]=r,t=0;t<1<<q[i];t++)ti[r++]=i;for(r>>=7;B>i;i++)for(ta[i]=r<<7,t=0;t<1<<q[i]-7;t++)ti[256+r++]=i;for(e=0;H>=e;e++)o[e]=0;for(t=0;143>=t;)te[2*t+1]=8,t++,o[8]++;for(;255>=t;)te[2*t+1]=9,t++,o[9]++;for(;279>=t;)te[2*t+1]=7,t++,o[7]++;for(;287>=t;)te[2*t+1]=8,t++,o[8]++;for(u(te,M+1,o),t=0;B>t;t++)tn[2*t+1]=5,tn[2*t]=l(t,5);ts=new td(te,X,U+1,M,H),tl=new td(tn,q,0,B,H),tc=new td([],Q,0,K,z)}function $(t){var e;for(e=0;M>e;e++)t.dyn_ltree[2*e]=0;for(e=0;B>e;e++)t.dyn_dtree[2*e]=0;for(e=0;K>e;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*J]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function h(t){t.bi_valid>8?o(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function _(t,e,n,i){h(t),i&&(o(t,n),o(t,~n)),w.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}function p(t,e,n,i){var r=2*e,o=2*n;return t[r]<t[o]||t[r]===t[o]&&i[e]<=i[n]}function g(t,e,n){for(var i=t.heap[n],r=n<<1;r<=t.heap_len&&(r<t.heap_len&&p(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!p(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i}function v(t,e,n){var i,o,l,c,d=0;if(0!==t.last_lit)do i=t.pending_buf[t.d_buf+2*d]<<8|t.pending_buf[t.d_buf+2*d+1],o=t.pending_buf[t.l_buf+d],d++,0===i?s(t,o,e):(s(t,(l=tr[o])+U+1,e),0!==(c=X[l])&&a(t,o-=to[l],c),s(t,l=r(--i),n),0!==(c=q[l])&&a(t,i-=ta[l],c));while(d<t.last_lit);s(t,J,e)}function S(t,e){var n,i,r,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,l=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=V,n=0;l>n;n++)0!==o[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(r=t.heap[++t.heap_len]=2>c?++c:0)]=1,t.depth[r]=0,t.opt_len--,s&&(t.static_len-=a[2*r+1]);for(e.max_code=c,n=t.heap_len>>1;n>=1;n--)g(t,o,n);r=l;do n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],g(t,o,1),i=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=i,o[2*r]=o[2*n]+o[2*i],t.depth[r]=(t.depth[n]>=t.depth[i]?t.depth[n]:t.depth[i])+1,o[2*n+1]=o[2*i+1]=r,t.heap[1]=r++,g(t,o,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],d(t,e),u(o,c,t.bl_count)}function m(t,e,n){var i,r,o=-1,a=e[1],s=0,l=7,c=4;for(0===a&&(l=138,c=3),e[2*(n+1)+1]=65535,i=0;n>=i;i++)r=a,a=e[2*(i+1)+1],++s<l&&r===a||(c>s?t.bl_tree[2*r]+=s:0!==r?(r!==o&&t.bl_tree[2*r]++,t.bl_tree[2*W]++):10>=s?t.bl_tree[2*Y]++:t.bl_tree[2*Z]++,s=0,o=r,0===a?(l=138,c=3):r===a?(l=6,c=3):(l=7,c=4))}function E(t,e,n){var i,r,o=-1,l=e[1],c=0,d=7,u=4;for(0===l&&(d=138,u=3),i=0;n>=i;i++)if(r=l,l=e[2*(i+1)+1],!(++c<d&&r===l)){if(u>c)do s(t,r,t.bl_tree);while(0!=--c);else 0!==r?(r!==o&&(s(t,r,t.bl_tree),c--),s(t,W,t.bl_tree),a(t,c-3,2)):10>=c?(s(t,Y,t.bl_tree),a(t,c-3,3)):(s(t,Z,t.bl_tree),a(t,c-11,7));c=0,o=r,0===l?(d=138,u=3):r===l?(d=6,u=3):(d=7,u=4)}}function T(t){var e;for(m(t,t.dyn_ltree,t.l_desc.max_code),m(t,t.dyn_dtree,t.d_desc.max_code),S(t,t.bl_desc),e=K-1;e>=3&&0===t.bl_tree[2*tt[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function b(t,e,n,i){var r;for(a(t,e-257,5),a(t,n-1,5),a(t,i-4,4),r=0;i>r;r++)a(t,t.bl_tree[2*tt[r]+1],3);E(t,t.dyn_ltree,e-1),E(t,t.dyn_dtree,n-1)}function C(t){var e,n=4093624447;for(e=0;31>=e;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return D;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return x;for(e=32;U>e;e++)if(0!==t.dyn_ltree[2*e])return x;return D}function A(t){tf||(f(),tf=!0),t.l_desc=new tu(t.dyn_ltree,ts),t.d_desc=new tu(t.dyn_dtree,tl),t.bl_desc=new tu(t.bl_tree,tc),t.bi_buf=0,t.bi_valid=0,$(t)}function O(t,e,n,i){a(t,(k<<1)+(i?1:0),3),_(t,e,n,!0)}function y(t){a(t,N<<1,3),s(t,J,te),c(t)}function L(t,e,n,i){var r,o,s=0;t.level>0?(t.strm.data_type===I&&(t.strm.data_type=C(t)),S(t,t.l_desc),S(t,t.d_desc),s=T(t),(r=t.opt_len+3+7>>>3)>=(o=t.static_len+3+7>>>3)&&(r=o)):r=o=n+5,r>=n+4&&-1!==e?O(t,e,n,i):t.strategy===j||o===r?(a(t,(N<<1)+(i?1:0),3),v(t,te,tn)):(a(t,(P<<1)+(i?1:0),3),b(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),v(t,t.dyn_ltree,t.dyn_dtree)),$(t),i&&h(t)}function R(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(tr[n]+U+1)]++,t.dyn_dtree[2*r(e)]++),t.last_lit===t.lit_bufsize-1}var w=t("../utils/common"),j=4,D=0,x=1,I=2,k=0,N=1,P=2,F=29,U=256,M=U+1+F,B=30,K=19,V=2*M+1,H=15,G=16,z=7,J=256,W=16,Y=17,Z=18,X=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],tt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],te=Array(2*(M+2));i(te);var tn=Array(2*B);i(tn);var ti=Array(512);i(ti);var tr=Array(256);i(tr);var to=Array(F);i(to);var ta=Array(B);i(ta);var ts,tl,tc,td=function(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length},tu=function(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e},tf=!1;n._tr_init=A,n._tr_stored_block=O,n._tr_flush_block=L,n._tr_tally=R,n._tr_align=y},{"../utils/common":27}],39:[function(t,e){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=n},{}]},{},[9])(9)}),jt.EmbeddedFiles={get:function(t){var e=this.compressedContent[t];if(void 0!==e)return{name:t,content:jt.Util.uncompressStringBase64ToInt8BitArray(e)};var n=this.diffsContent[t];if(void 0!==n){var i=this.get(n.based);if(void 0!==i){var r=i.content;for(var o in n.diffs)for(var a=n.diffs[o],s=0;s<a.length;++s)r[(0|o)+s]=a[s];return{name:t,content:r}}}},embedFileCompressedContent:function(t,e){this.compressedContent[t]=e},embedFileDiff:function(t,e){this.diffsContent[t]=e},compressedContent:{},diffsContent:{}},jt.MultiDownloader=function(t,e,n,i){"use strict";function r(t){if(t){var e=t.url.trim().split(/\s*\|\s*/);t.filesToLoad=e.length,t.filesContent=Array(t.filesToLoad);for(var n=0;n<e.length;++n){var i=e[n];"@"===i[0]?o(t,n,i):a(t,n,i)}}}function o(t,e,n){jt.Util.log("Reading Embedded file: "+n);var i=jt.EmbeddedFiles.get(n.substr(1));void 0!==i?s(t,e,i.content):l(t,"Embedded file not found!")}function a(t,e,n,r){var o=d(n)?u(n):n,a=new XMLHttpRequest;a.open("GET",o,!0),a.responseType="arraybuffer",a.timeout=void 0!==i?i:v,a.onload=function(){(200===a.status||0===a.status)&&a.response?s(t,e,new Uint8Array(a.response)):a.onerror()},a.onerror=a.ontimeout=function(){l(t,a.status+" "+a.statusText)},jt.Util.log("Reading file from: "+n),a.send()}function s(t,e,n){t.filesContent[e]=n,--t.filesToLoad>0||(t.success=!0,t.content=jt.Util.arraysConcatAll(t.filesContent),t.onSuccess&&t.onSuccess(t),c())}function l(t,e){t.success=!1,t.error=e;var i="Could not load file: "+t.url+"\nError: "+e;t.onError?(jt.Util.error(i),t.onError(t)):n||jt.Util.message(i),c()}function c(){if(!p){for(var i=0;i<t.length;i++)if(t[i]&&void 0===t[i].success)return;for(p=!0,$(),i=0;i<t.length;i++)if(t[i]&&!t[i].success)return void(n&&n(t));e&&e(t)}}function d(t){return t&&(0===t.indexOf("http:")||0===t.indexOf("https:"))}function u(t){return Javatari.PROXY_SERVER_ADDRESS?"https://"+Javatari.PROXY_SERVER_ADDRESS+"/proxy-remote-download?url="+t:t}function f(){Javatari.room.isLoading||(_=window.setTimeout(function(){_=null,h=!0,Javatari.room.setLoading(!0)},g))}function $(){_&&(window.clearTimeout(_),_=null),h&&(h=!1,Javatari.room.setLoading(!1))}this.start=function(){if(t&&0!==t.length){f();for(var e=0;e<t.length;e++)r(t[e])}c()};var h=!1,_=null,p=!1,g=1e3,v=15e3},jt.MultiFileReader=function(t,e,n,i){"use strict";function r(t){if(t){jt.Util.log("Reading file: "+t.name);var e=new FileReader;e.onload=function(e){t.success=!0,t.content=new Uint8Array(e.target.result),o()},e.onerror=function(e){t.success=!1,t.error=e.target.error.name,o()},e.readAsArrayBuffer(t)}}function o(){if(!a){for(var i=0;i<t.length;i++)if(t[i]&&void 0===t[i].success)return;for(a=!0,i=0;i<t.length;i++)if(t[i]&&!t[i].success)return n&&n(t,t[i].error),t;e&&e(t)}}this.start=function(){if(t&&0!==t.length){i||(i=s);for(var a=0,l=0;l<t.length;l++)a+=t[l].size;if(a>i){var c="Maximum total size limit exceeded: "+(i/1024|0)+"KB";return void(n&&n(t,c,!0))}for(l=0;l<t.length;l++)r(t[l]);o()}else e(t)};var a=!1,s=5898240},jt.VideoStandard={NTSC:{name:"NTSC",desc:"NTSC 60Hz",totalWidth:228,totalHeight:262,defaultOriginYPct:10.8,defaultHeightPct:85.2,targetFPS:60,pulldowns:{60:{standard:"NTSC",frequency:60,divider:1,cadence:[1],steps:1},120:{standard:"NTSC",frequency:120,divider:2,cadence:[1],steps:1},"120s":{standard:"NTSC",frequency:120,divider:1,cadence:[0,1],steps:2},50:{standard:"NTSC",frequency:50,divider:1,cadence:[1,1,1,1,2],steps:5},100:{standard:"NTSC",frequency:100,divider:2,cadence:[1,1,1,1,2],steps:5},"100s":{standard:"NTSC",frequency:100,divider:1,cadence:[0,1,0,1,1,0,1,0,1,1],steps:10},TIMER:{standard:"NTSC",frequency:62.5,divider:1,cadence:[1],steps:1}}},PAL:{name:"PAL",desc:"PAL 50Hz",totalWidth:228,totalHeight:312,defaultOriginYPct:13.5,defaultHeightPct:77.3,targetFPS:50,pulldowns:{50:{standard:"PAL",frequency:50,divider:1,cadence:[1],steps:1},100:{standard:"PAL",frequency:100,divider:2,cadence:[1],steps:1},"100s":{standard:"PAL",frequency:100,divider:1,cadence:[0,1],steps:2},60:{standard:"PAL",frequency:60,divider:1,cadence:[0,1,1,1,1,1],steps:6},120:{standard:"PAL",frequency:120,divider:2,cadence:[0,1,1,1,1,1],steps:6},"120s":{standard:"PAL",frequency:120,divider:1,cadence:[0,0,1,0,1,0,0,1,0,1,0,1],steps:12},TIMER:{standard:"PAL",frequency:50,divider:1,cadence:[1],steps:1}}}},jt.VideoSignal=function(){"use strict";this.connectMonitor=function(t){this.monitor=t},this.setVideoStandard=function(t){this.monitor&&this.monitor.setVideoStandard(t)},this.nextLine=function(t,e){return this.monitor.nextLine(t,e)},this.finishFrame=function(){this.monitor.refresh()},this.signalOff=function(){this.monitor&&this.monitor.videoSignalOff()},this.showOSD=function(t,e,n){this.monitor&&this.monitor.showOSD(t,e,n)},this.toggleShowInfo=function(){this.monitor.toggleShowInfo()},this.monitor=null},jt.AudioSignal=function(t,e,n,i){"use strict";function r(){if($>0){if(_<=0)return void($=0);a(),--$,--_}}function o(){var t=v*Javatari.AUDIO_SIGNAL_BUFFER_RATIO+d*Javatari.AUDIO_SIGNAL_ADD_FRAMES|0;g.length=t,t>h&&jt.Util.arrayFill(g,0,h,t),h=t,S.bufferSize=h,p=h-2,c.flush()}function a(){g[u]=e.nextSample()*("undefined"!=typeof CTRLV?CTRLV:i),++u>=h&&(u=0)}function s(){g[u]=0,++u>=h&&(u=0)}function l(t,e){if(e)for(var n=t;n>0;n-=1)s();else for(var i=t;i>0;i-=1)a();_-=t}var c=this;this.flush=function(){u=0,f=0,_=p},this.setFps=function(t){d=n/t|0,o()},this.audioFinishFrame=function(){if($>0)for(;$>0;)r();$=d},this.retrieveSamples=function(t,e){var n=p-_,i=t-n;i>0&&(i>_&&(i=_),l(i,e)),S.start=f;var r=n+i;return _+=r,(f+=r)>=h&&(f-=h),S},this.audioClockPulse=r,this.getSampleRate=function(){return n},this.toString=function(){return"AudioSignal "+t},this.setAudioMonitorBufferSize=function(t){v=t,o()},this.name=t;var d,u=0,f=0,$=0,h=0,_=0,p=0,g=jt.Util.arrayFill(Array(h),0),v=0,S={buffer:g,bufferSize:h,start:0}},jt.M6502=function(){"use strict";function t(){return[t0,function(){tG("KIL/HLT/JAM")},function(){Y--}]}function e(t){return t(function(){tG("NOP/DOP")})}function n(t){return t(function(){if(G){var t=X,e=(15&M)+(15&t)+W;e>9&&(e+=6);var n=(M>>4)+(t>>4)+(e>15)<<4;tF(M+t+W&255),t5(n),tU((M^n)&~(M^t)&128),n>159&&(n+=96),tM(n>255),M=255&(n|15&e)}else{var i=M+X+W;tM(i>255),tU((M^i)&(X^i)&128),tF(M=255&i),t5(M)}})}function i(t){return t(function(){tF(M&=X),t5(M)})}function r(t){return t(function(){var t=X;tF(M&t),tU(64&t),t5(t)})}function o(t){return t(function(){var t=M-X&255;tM(M>=X),tF(t),t5(t)})}function a(t){return t(function(){var t=B-X&255;tM(B>=X),tF(t),t5(t)})}function s(t){return t(function(){var t=K-X&255;tM(K>=X),tF(t),t5(t)})}function l(t){return t(function(){tF(M^=X),t5(M)})}function c(t){return t(function(){M=X,tF(M),t5(M)})}function d(t){return t(function(){B=X,tF(B),t5(B)})}function u(t){return t(function(){K=X,tF(K),t5(K)})}function f(t){return t(function(){tF(M|=X),t5(M)})}function $(t){return t(function(){if(G){var t=X,e=(15&M)-(15&t)-(1-W),n=(M>>4)-(t>>4)-(e<0);e<0&&(e-=6),n<0&&(n-=6);var i=M-t-(1-W);tM(256&~i),tU((M^t)&(M^i)&128),tF(255&i),t5(i),M=255&(n<<4|15&e)}else i=M+(t=255&~X)+W,tM(i>255),tU((M^i)&(t^i)&128),tF(M=255&i),t5(M)})}function h(t){return t(function(){tG("ANC"),tF(M&=X),V=W=128&M?1:0})}function _(t){return t(function(){tG("LAX");var t=X;M=t,B=t,tF(t),t5(t)})}function p(t){return t(function(){X=M})}function g(t){return t(function(){X=B})}function v(t){return t(function(){X=K})}function S(t){return t(function(){tG("SAX"),X=M&B})}function m(t){return t(function(){tG("SHA"),X=M&B&1+(Q>>>8)&255})}function E(t){return t(function(){tM(X>127);var t=X<<1&255;X=t,tF(t),t5(t)})}function T(t){return t(function(){var t=X-1&255;X=t,tF(t),t5(t)})}function b(t){return t(function(){var t=X+1&255;X=t,tF(t),t5(t)})}function C(t){return t(function(){W=1&X,tF(X>>>=1),V=0})}function A(t){return t(function(){var t=X>127,e=255&(X<<1|W);X=e,tM(t),tF(e),t5(e)})}function O(t){return t(function(){var t=1&X,e=X>>>1|W<<7;X=e,tM(t),tF(e),t5(e)})}function y(t){return t(function(){tG("DCP");var t=X-1&255;X=t,tM((t=M-t)>=0),tF(t),t5(t)})}function L(t){return t(function(){if(tG("ISB"),X=X+1&255,G){var t=X,e=(15&M)-(15&t)-(1-W),n=(M>>4)-(t>>4)-(e<0);e<0&&(e-=6),n<0&&(n-=6);var i=M-t-(1-W);tM(256&~i),tU((M^t)&(M^i)&128),tF(255&i),t5(i),M=255&(n<<4|15&e)}else i=M+(t=255&~X)+W,tM(i>255),tU((M^i)&(t^i)&128),tF(M=255&i),t5(M)})}function R(t){return t(function(){tG("RLA");var t=X,e=W;tM(128&t),X=t=255&(t<<1|e),M&=t,tF(t),t5(t)})}function w(t){return t(function(){tG("RRA");var t=X,e=W?128:0;if(tM(1&t),X=t=t>>>1|e,G){var n=X,i=(15&M)+(15&n)+W;i>9&&(i+=6);var r=(M>>4)+(n>>4)+(i>15)<<4;tF(M+n+W&255),t5(r),tU((M^r)&~(M^n)&128),r>159&&(r+=96),tM(r>255),M=255&(r|15&i)}else{var o=M+X+W;tM(o>255),tU((M^o)&(X^o)&128),tF(M=255&o),t5(M)}})}function j(t){return t(function(){tG("SLO");var t=X;tM(128&t),X=t=t<<1&255,t|=M,M=t,tF(t),t5(t)})}function D(t){return t(function(){tG("SRE");var t=X;tM(1&t),t>>>=1,X=t,M=t=255&(M^t),tF(t),t5(t)})}function x(t,e){var n;return n=t===ts?function(){return J===e}:t===ta?function(){return V===e}:t===tl?function(){return W===e}:function(){return H===e},[t0,tm,function(){n()?(tS(),tN()):tv()},function(){ti?(tS(),tP()):tv()},tv]}var I=this;this.powerOn=function(){this.reset()},this.powerOff=function(){},this.clockPulse=function(){P&&N[++Y]()},this.connectBus=function(t){k=t},this.setRDY=function(t){P=t},this.reset=function(){z=1,Y=-1,Z=-1,N=t8,F=k.read(tr)|k.read(tr+1)<<8,this.setRDY(!0)};var k,N,P=!1,F=0,U=0,M=0,B=0,K=0,V=0,H=0,G=0,z=0,J=0,W=0,Y=-1,Z=-1,X=0,q=0,Q=0,tt=!1,te=0,tn=0,ti=0,tr=65532,to=65534,ta=7,ts=1,tl=0;this.debug=!1,this.trace=!1;var tc,td,tu,tf,t$,th,t_,tp,tg,t0=function(){N=ef[Z=k.read(F)],Y=0,F++},tv=t0,t8=[t0],tS=function(){k.read(F)},tm=function(){tn=k.read(F),F++},tE=function(){q=k.read(F),F++},tT=function(){q|=k.read(F)<<8,F++},tb=function(){q=k.read(Q)},tC=function(){q|=k.read(Q)<<8},tA=function(){Q=k.read(F),F++},tO=function(){Q|=k.read(F)<<8,F++},t3=function(){Q=k.read(te)},t4=function(){Q|=k.read(te)<<8},t2=function(){var t=(255&Q)+B;tt=t>255,Q=65280&Q|255&t},ty=function(){var t=(255&Q)+K;tt=t>255,Q=65280&Q|255&t},t6=function(){var t=1+(255&Q);tt=t>255,Q=65280&Q|255&t},t1=function(){tt&&(Q=Q+256&65535)},tL=function(){te=k.read(F),F++},tR=function(){te|=k.read(F)<<8,F++},tw=function(){te=65280&te|255&1+(255&te)},tj=function(){X=k.read(F),F++},tD=function(){X=k.read(q)},tx=function(){X=k.read(Q)},tI=function(){k.write(q,X)},tk=function(){k.write(Q,X)},tN=function(){var t=255&F,e=t+tn&255;ti=tn>127?e>t?-256:0:e<t?256:0,F=65280&F|e},tP=function(){F=F+ti&65535},tF=function(t){J=0===t?1:0},t5=function(t){V=128&t?1:0},tU=function(t){H=t?1:0},tM=function(t){W=t?1:0},t7=function(){return U=U+1&255,k.read(256+U)},tB=function(){return k.read(256+U)},tK=function(t){k.write(256+U,t),U=U-1&255},tV=function(){return V<<7|H<<6|48|G<<3|z<<2|J<<1|W},tH=function(t){V=t>>>7,H=t>>>6&1,G=t>>>3&1,z=t>>>2&1,J=t>>>1&1,W=1&t},tG=function(t){I.debug&&I.breakpoint("Illegal Opcode: "+t)},tz=function(t){return[t0,tS,function(){t(),tv()}]},tJ=function(t){return[t0,tj,function(){t(),tv()}]},tW=function(t){return[t0,tE,tD,function(){t(),tv()}]},tY=function(t){return[t0,tE,tT,tD,function(){t(),tv()}]},tZ=function(t){return[t0,tA,tx,function(){t2(),tb()},function(){t6(),tC()},tD,function(){t(),tv()}]},t9=function(t){var e=0===t?t2:ty;return function(t){return[t0,tA,tO,function(){e(),tx(),t1()},function(){tt?tx():(t(),tv())},function(){t(),tv()}]}},tX=function(t){var e=0===t?t2:ty;return function(t){return[t0,tA,tx,function(){e(),tx()},function(){t(),tv()}]}},tq=function(t){return[t0,tL,t3,function(){tw(),t4()},function(){ty(),tx(),t1()},function(){tt?tx():(t(),tv())},function(){t(),tv()}]},tQ=function(t){return[t0,tE,function(){t(),tI()},tv]},et=function(t){return[t0,tE,tT,function(){t(),tI()},tv]},ee=function(t){return[t0,tA,tx,function(){t2(),tb()},function(){t6(),tC()},function(){t(),tI()},tv]},en=function(t){var e=0===t?t2:ty;return function(t){return[t0,tA,tO,function(){e(),tx(),t1()},function(){t(),tk()},tv]}},ei=function(t){var e=0===t?t2:ty;return function(t){return[t0,tA,tx,function(){e(),t(),tk()},tv]}},er=function(t){return[t0,tL,t3,function(){tw(),t4()},function(){ty(),tx(),t1()},function(){t(),tk()},tv]},eo=function(t){return[t0,tE,tD,tI,function(){t(),tI()},tv]},ea=function(t){return[t0,tE,tT,tD,tI,function(){t(),tI()},tv]},es=function(t){var e=0===t?t2:ty;return function(t){return[t0,tA,tx,function(){e(),tx()},tk,function(){t(),tk()},tv]}},el=function(t){var e=0===t?t2:ty;return function(t){return[t0,tA,tO,function(){e(),tx(),t1()},tx,tk,function(){t(),tk()},tv]}},ec=function(t){return[t0,tA,tx,function(){t2(),tb()},function(){t6(),tC()},tD,tI,function(){t(),tI()},tv]},ed=function(t){return[t0,tL,t3,function(){tw(),t4()},function(){ty(),tx(),t1()},tx,tk,function(){t(),tk()},tv]},eu=Array(256),ef=Array(256);eu[0]="BRK",ef[0]=[t0,tj,function(){I.debug&&I.breakpoint("BRK "+X),tK(F>>>8&255)},function(){tK(255&F)},function(){tK(tV())},function(){q=k.read(to)},function(){q|=k.read(to+1)<<8},function(){F=q,tv()}],eu[1]="ORA",ef[1]=f(tZ),eu[2]="uKIL",ef[2]=t(),eu[3]="uSLO",ef[3]=j(ec),eu[4]="uNOP",ef[4]=e(tW),eu[5]="ORA",ef[5]=f(tW),eu[6]="ASL",ef[6]=E(eo),eu[7]="uSLO",ef[7]=j(eo),eu[8]="PHP",ef[8]=[t0,tS,function(){tK(tV())},tv],eu[9]="ORA",ef[9]=f(tJ),eu[10]="ASL",ef[10]=tz(function(){tM(M>127),tF(M=M<<1&255),t5(M)}),eu[11]="uANC",ef[11]=h(tJ),eu[12]="uNOP",ef[12]=e(tY),eu[13]="ORA",ef[13]=f(tY),eu[14]="ASL",ef[14]=E(ea),eu[15]="uSLO",ef[15]=j(ea),eu[16]="BPL",ef[16]=x(ta,0),eu[17]="ORA",ef[17]=f(tq),eu[18]="uKIL",ef[18]=t(),eu[19]="uSLO",ef[19]=j(ed),eu[20]="uNOP",ef[20]=e(tX(0)),eu[21]="ORA",ef[21]=f(tX(0)),eu[22]="ASL",ef[22]=E(es(0)),eu[23]="uSLO",ef[23]=j(es(0)),eu[24]="CLC",ef[24]=tz(function(){W=0}),eu[25]="ORA",ef[25]=f(t9(1)),eu[26]="uNOP",ef[26]=e(tz),eu[27]="uSLO",ef[27]=j(el(1)),eu[28]="uNOP",ef[28]=e(t9(0)),eu[29]="ORA",ef[29]=f(t9(0)),eu[30]="ASL",ef[30]=E(el(0)),eu[31]="uSLO",ef[31]=j(el(0)),eu[32]="JSR",ef[32]=[t0,tE,tB,function(){tK(F>>>8&255)},function(){tK(255&F)},tT,function(){F=q,tv()}],eu[33]="AND",ef[33]=i(tZ),eu[34]="uKIL",ef[34]=t(),eu[35]="uRLA",ef[35]=R(ec),eu[36]="BIT",ef[36]=r(tW),eu[37]="AND",ef[37]=i(tW),eu[38]="ROL",ef[38]=A(eo),eu[39]="uRLA",ef[39]=R(eo),eu[40]="PLP",ef[40]=[t0,tS,tB,function(){tH(t7())},tv],eu[41]="AND",ef[41]=i(tJ),eu[42]="ROL",ef[42]=tz(function(){var t=M>127;M=255&(M<<1|W),tM(t),tF(M),t5(M)}),eu[43]="uANC",ef[43]=h(tJ),eu[44]="BIT",ef[44]=r(tY),eu[45]="AND",ef[45]=i(tY),eu[46]="ROL",ef[46]=A(ea),eu[47]="uRLA",ef[47]=R(ea),eu[48]="BMI",ef[48]=x(ta,1),eu[49]="AND",ef[49]=i(tq),eu[50]="uKIL",ef[50]=t(),eu[51]="uRLA",ef[51]=R(ed),eu[52]="uNOP",ef[52]=e(tX(0)),eu[53]="AND",ef[53]=i(tX(0)),eu[54]="ROL",ef[54]=A(es(0)),eu[55]="uRLA",ef[55]=R(es(0)),eu[56]="SEC",ef[56]=tz(function(){W=1}),eu[57]="AND",ef[57]=i(t9(1)),eu[58]="uNOP",ef[58]=e(tz),eu[59]="uRLA",ef[59]=R(el(1)),eu[60]="uNOP",ef[60]=e(t9(0)),eu[61]="AND",ef[61]=i(t9(0)),eu[62]="ROL",ef[62]=A(el(0)),eu[63]="uRLA",ef[63]=R(el(0)),eu[64]="RTI",ef[64]=[t0,tS,tB,function(){tH(t7())},function(){q=t7()},function(){q|=t7()<<8},function(){F=q,tv()}],eu[65]="EOR",ef[65]=l(tZ),eu[66]="uKIL",ef[66]=t(),eu[67]="uSRE",ef[67]=D(ec),eu[68]="uNOP",ef[68]=e(tW),eu[69]="EOR",ef[69]=l(tW),eu[70]="LSR",ef[70]=C(eo),eu[71]="uSRE",ef[71]=D(eo),eu[72]="PHA",ef[72]=[t0,tS,function(){tK(M)},tv],eu[73]="EOR",ef[73]=l(tJ),eu[74]="LSR",ef[74]=tz(function(){W=1&M,tF(M>>>=1),V=0}),eu[75]="uASR",ef[75]=(tc=tJ)(function(){tG("ASR");var t=M&X;W=1&t,t>>>=1,M=t,tF(t),V=0}),eu[76]="JMP",ef[76]=[t0,tE,tT,function(){F=q,tv()}],eu[77]="EOR",ef[77]=l(tY),eu[78]="LSR",ef[78]=C(ea),eu[79]="uSRE",ef[79]=D(ea),eu[80]="BVC",ef[80]=x(6,0),eu[81]="EOR",ef[81]=l(tq),eu[82]="uKIL",ef[82]=t(),eu[83]="uSRE",ef[83]=D(ed),eu[84]="uNOP",ef[84]=e(tX(0)),eu[85]="EOR",ef[85]=l(tX(0)),eu[86]="LSR",ef[86]=C(es(0)),eu[87]="uSRE",ef[87]=D(es(0)),eu[88]="CLI",ef[88]=tz(function(){z=0}),eu[89]="EOR",ef[89]=l(t9(1)),eu[90]="uNOP",ef[90]=e(tz),eu[91]="uSRE",ef[91]=D(el(1)),eu[92]="uNOP",ef[92]=e(t9(0)),eu[93]="EOR",ef[93]=l(t9(0)),eu[94]="LSR",ef[94]=C(el(0)),eu[95]="uSRE",ef[95]=D(el(0)),eu[96]="RTS",ef[96]=[t0,tS,tB,function(){q=t7()},function(){q|=t7()<<8},function(){F=q,tj()},tv],eu[97]="ADC",ef[97]=n(tZ),eu[98]="uKIL",ef[98]=t(),eu[99]="uRRA",ef[99]=w(ec),eu[100]="uNOP",ef[100]=e(tW),eu[101]="ADC",ef[101]=n(tW),eu[102]="ROR",ef[102]=O(eo),eu[103]="uRRA",ef[103]=w(eo),eu[104]="PLA",ef[104]=[t0,tS,tB,function(){tF(M=t7()),t5(M)},tv],eu[105]="ADC",ef[105]=n(tJ),eu[106]="ROR",ef[106]=tz(function(){var t=1&M;M=M>>>1|W<<7,tM(t),tF(M),t5(M)}),eu[107]="uARR",ef[107]=(td=tJ)(function(){tG("ARR");var t=M&X;M=t=t>>>1|(W?128:0),tF(t),t5(t);var e=96&M;96==e?(W=1,H=0):0==e?(W=0,H=0):32==e?(W=0,H=1):64==e&&(W=1,H=1)}),eu[108]="JMP",ef[108]=[t0,tL,tR,t3,function(){tw(),t4()},function(){F=Q,tv()}],eu[109]="ADC",ef[109]=n(tY),eu[110]="ROR",ef[110]=O(ea),eu[111]="uRRA",ef[111]=w(ea),eu[112]="BVS",ef[112]=x(6,1),eu[113]="ADC",ef[113]=n(tq),eu[114]="uKIL",ef[114]=t(),eu[115]="uRRA",ef[115]=w(ed),eu[116]="uNOP",ef[116]=e(tX(0)),eu[117]="ADC",ef[117]=n(tX(0)),eu[118]="ROR",ef[118]=O(es(0)),eu[119]="uRRA",ef[119]=w(es(0)),eu[120]="SEI",ef[120]=tz(function(){z=1}),eu[121]="ADC",ef[121]=n(t9(1)),eu[122]="uNOP",ef[122]=e(tz),eu[123]="uRRA",ef[123]=w(el(1)),eu[124]="uNOP",ef[124]=e(t9(0)),eu[125]="ADC",ef[125]=n(t9(0)),eu[126]="ROR",ef[126]=O(el(0)),eu[127]="uRRA",ef[127]=w(el(0)),eu[128]="uNOP",ef[128]=e(tJ),eu[129]="STA",ef[129]=p(ee),eu[130]="uNOP",ef[130]=e(tJ),eu[131]="uSAX",ef[131]=S(ee),eu[132]="STY",ef[132]=v(tQ),eu[133]="STA",ef[133]=p(tQ),eu[134]="STX",ef[134]=g(tQ),eu[135]="uSAX",ef[135]=S(tQ),eu[136]="DEY",ef[136]=tz(function(){tF(K=K-1&255),t5(K)}),eu[137]="uNOP",ef[137]=e(tJ),eu[138]="TXA",ef[138]=tz(function(){tF(M=B),t5(M)}),eu[139]="uANE",ef[139]=(tu=tJ)(function(){tG("ANE")}),eu[140]="STY",ef[140]=v(et),eu[141]="STA",ef[141]=p(et),eu[142]="STX",ef[142]=g(et),eu[143]="uSAX",ef[143]=S(et),eu[144]="BCC",ef[144]=x(tl,0),eu[145]="STA",ef[145]=p(er),eu[146]="uKIL",ef[146]=t(),eu[147]="uSHA",ef[147]=m(er),eu[148]="STY",ef[148]=v(ei(0)),eu[149]="STA",ef[149]=p(ei(0)),eu[150]="STX",ef[150]=g(ei(1)),eu[151]="uSAX",ef[151]=S(ei(1)),eu[152]="TYA",ef[152]=tz(function(){tF(M=K),t5(M)}),eu[153]="STA",ef[153]=p(en(1)),eu[154]="TXS",ef[154]=tz(function(){U=B}),eu[155]="uSHS",ef[155]=(tf=en(1))(function(){tG("SHS");var t=M&B;U=t,X=t&1+(Q>>>8)&255}),eu[156]="uSHY",ef[156]=(t$=en(0))(function(){tG("SHY"),X=K&1+(Q>>>8)&255}),eu[157]="STA",ef[157]=p(en(0)),eu[158]="uSHX",ef[158]=(th=en(1))(function(){tG("SHX"),X=B&1+(Q>>>8)&255}),eu[159]="uSHA",ef[159]=m(en(1)),eu[160]="LDY",ef[160]=u(tJ),eu[161]="LDA",ef[161]=c(tZ),eu[162]="LDX",ef[162]=d(tJ),eu[163]="uLAX",ef[163]=_(tZ),eu[164]="LDY",ef[164]=u(tW),eu[165]="LDA",ef[165]=c(tW),eu[166]="LDX",ef[166]=d(tW),eu[167]="uLAX",ef[167]=_(tW),eu[168]="TAY",ef[168]=tz(function(){tF(K=M),t5(K)}),eu[169]="LDA",ef[169]=c(tJ),eu[170]="TAX",ef[170]=tz(function(){tF(B=M),t5(B)}),eu[171]="uLXA",ef[171]=(t_=tJ)(function(){tG("LXA");var t=M&X;M=t,B=t,tF(t),t5(t)}),eu[172]="LDY",ef[172]=u(tY),eu[173]="LDA",ef[173]=c(tY),eu[174]="LDX",ef[174]=d(tY),eu[175]="uLAX",ef[175]=_(tY),eu[176]="BCS",ef[176]=x(tl,1),eu[177]="LDA",ef[177]=c(tq),eu[178]="uKIL",ef[178]=t(),eu[179]="uLAX",ef[179]=_(tq),eu[180]="LDY",ef[180]=u(tX(0)),eu[181]="LDA",ef[181]=c(tX(0)),eu[182]="LDX",ef[182]=d(tX(1)),eu[183]="uLAX",ef[183]=_(tX(1)),eu[184]="CLV",ef[184]=tz(function(){H=0}),eu[185]="LDA",ef[185]=c(t9(1)),eu[186]="TSX",ef[186]=tz(function(){tF(B=U),t5(B)}),eu[187]="uLAS",ef[187]=(tp=t9(1))(function(){tG("LAS");var t=U&X;M=t,B=t,U=t,tF(t),t5(t)}),eu[188]="LDY",ef[188]=u(t9(0)),eu[189]="LDA",ef[189]=c(t9(0)),eu[190]="LDX",ef[190]=d(t9(1)),eu[191]="uLAX",ef[191]=_(t9(1)),eu[192]="CPY",ef[192]=s(tJ),eu[193]="CMP",ef[193]=o(tZ),eu[194]="uNOP",ef[194]=e(tJ),eu[195]="uDCP",ef[195]=y(ec),eu[196]="CPY",ef[196]=s(tW),eu[197]="CMP",ef[197]=o(tW),eu[198]="DEC",ef[198]=T(eo),eu[199]="uDCP",ef[199]=y(eo),eu[200]="INY",ef[200]=tz(function(){tF(K=K+1&255),t5(K)}),eu[201]="CMP",ef[201]=o(tJ),eu[202]="DEX",ef[202]=tz(function(){tF(B=B-1&255),t5(B)}),eu[203]="uSBX",ef[203]=(tg=tJ)(function(){tG("SBX");var t=M&B,e=X,n=t-e&255;B=n,tM(t>=e),tF(n),t5(n)}),eu[204]="CPY",ef[204]=s(tY),eu[205]="CMP",ef[205]=o(tY),eu[206]="DEC",ef[206]=T(ea),eu[207]="uDCP",ef[207]=y(ea),eu[208]="BNE",ef[208]=x(ts,0),eu[209]="CMP",ef[209]=o(tq),eu[210]="uKIL",ef[210]=t(),eu[211]="uDCP",ef[211]=y(ed),eu[212]="uNOP",ef[212]=e(tX(0)),eu[213]="CMP",ef[213]=o(tX(0)),eu[214]="DEC",ef[214]=T(es(0)),eu[215]="uDCP",ef[215]=y(es(0)),eu[216]="CLD",ef[216]=tz(function(){G=0}),eu[217]="CMP",ef[217]=o(t9(1)),eu[218]="uNOP",ef[218]=e(tz),eu[219]="uDCP",ef[219]=y(el(1)),eu[220]="uNOP",ef[220]=e(t9(0)),eu[221]="CMP",ef[221]=o(t9(0)),eu[222]="DEC",ef[222]=T(el(0)),eu[223]="uDCP",ef[223]=y(el(0)),eu[224]="CPX",ef[224]=a(tJ),eu[225]="SBC",ef[225]=$(tZ),eu[226]="uNOP",ef[226]=e(tJ),eu[227]="uISB",ef[227]=L(ec),eu[228]="CPX",ef[228]=a(tW),eu[229]="SBC",ef[229]=$(tW),eu[230]="INC",ef[230]=b(eo),eu[231]="uISB",ef[231]=L(eo),eu[232]="newINX",ef[232]=tz(function(){tF(B=B+1&255),t5(B)}),eu[233]="SBC",ef[233]=$(tJ),eu[234]="NOP",ef[234]=tz(function(){}),eu[235]="SBC",ef[235]=$(tJ),eu[236]="CPX",ef[236]=a(tY),eu[237]="SBC",ef[237]=$(tY),eu[238]="INC",ef[238]=b(ea),eu[239]="uISB",ef[239]=L(ea),eu[240]="BEQ",ef[240]=x(ts,1),eu[241]="SBC",ef[241]=$(tq),eu[242]="uKIL",ef[242]=t(),eu[243]="uISB",ef[243]=L(ed),eu[244]="uNOP",ef[244]=e(tX(0)),eu[245]="SBC",ef[245]=$(tX(0)),eu[246]="INC",ef[246]=b(es(0)),eu[247]="uISB",ef[247]=L(es(0)),eu[248]="SED",ef[248]=tz(function(){G=1}),eu[249]="SBC",ef[249]=$(t9(1)),eu[250]="uNOP",ef[250]=e(tz),eu[251]="uISB",ef[251]=L(el(1)),eu[252]="uNOP",ef[252]=e(t9(0)),eu[253]="SBC",ef[253]=$(t9(0)),eu[254]="INC",ef[254]=b(el(0)),eu[255]="uISB",ef[255]=L(el(0)),this.saveState=function(){return{PC:F,A:M,X:B,Y:K,SP:U,N:V,V:H,D:G,I:z,Z:J,C:W,T:Y,o:Z,R:0|P,d:X,AD:q,BA:Q,BC:0|tt,IA:te,bo:tn,boa:ti}},this.loadState=function(t){F=t.PC,M=t.A,B=t.X,K=t.Y,U=t.SP,V=t.N,H=t.V,G=t.D,z=t.I,J=t.Z,W=t.C,Y=t.T,Z=t.o,P=!!t.R,X=t.d,q=t.AD,Q=t.BA,tt=!!t.BC,te=t.IA,tn=t.bo,ti=t.boa,N=-1===Z?t8:ef[Z]},this.toString=function(){return"CPU  PC: "+F.toString(16)+"  op: "+Z.toString()+"  T: "+Y+"  data: "+X+"\n A: "+M.toString(16)+"  X: "+B.toString(16)+"  Y: "+K.toString(16)+"  SP: "+U.toString(16)+"     N"+V+"  V"+H+"  D"+G+"  I"+z+"  Z"+J+"  C"+W+"  "},this.breakpoint=function(t){if(jt.Util.log(t),this.trace){var e="CPU Breakpoint!  "+(t?"("+t+")":"")+"\n\n"+this.toString();jt.Util.message(e)}},this.runCycles=function(t){for(var e=performance.now(),n=0;n<t;n++)this.clockPulse();var i=performance.now();jt.Util.message("Done running "+t+" cycles in "+(i-e)+" ms.")}},jt.Ram=function(){"use strict";this.powerOn=function(){},this.powerOff=function(){},this.read=function(n){return t[n&e]},this.write=function(n,i){t[n&e]=i},this.powerFry=function(){for(var e=1-r+2*Math.random()*r,o=e*n,a=0;a<o;a++)t[128*Math.random()|0]&=256*Math.random()|0;var s=e*i;for(a=0;a<s;a++)t[128*Math.random()|0]|=1<<(8*Math.random()|0)},this.saveState=function(){return{b:jt.Util.storeInt8BitArrayToStringBase64(t)}},this.loadState=function(e){t=jt.Util.restoreStringBase64ToInt8BitArray(e.b,t)};var t=Array(128),e=127,n=120,i=25,r=.3;!function(){for(var e=t.length-1;e>=0;e--)t[e]=256*Math.random()|0}()},jt.Pia=function(){"use strict";this.powerOn=function(){},this.powerOff=function(){},this.clockPulse=function(){--s<=0&&t()},this.connectBus=function(t){a=t},this.read=function(t){var e=t&m;return 4===e||6===e?(n(),h):0===e?d:2===e?f:1===e?u:3===e?$:5===e||7===e?_:0},this.write=function(t,n){var o=t&m;return 4===o?(p=n,void e(n,1)):5===o?(g=n,void e(n,8)):6===o?(v=n,void e(n,64)):7===o?(S=n,void e(n,1024)):2===o?void i(n):3===o?($=n,void r(">>>> Ineffective Write to PIA SWBCNT: "+n)):0===o?void r(">>>> Unsupported Write to PIA SWCHA: "+n):1===o?void r(">>>> Unsupported Write to PIA SWACNT "+n):0};var t=function(){--h<0?(_|=192,h=255,s=l=1):s=l},e=function(e,n){h=e,_&=63,s=l=c=n,t()},n=function(){_&=191,1===l&&(s=l=c)},i=function(t){f=203&f|34&t},r=function(t){self.debug&&jt.Util.log(t)},o=jt.ConsoleControls;this.controlStateChanged=function(t,e){switch(t){case o.JOY0_UP:return void(e?d&=239:d|=16);case o.JOY0_DOWN:return void(e?d&=223:d|=32);case o.PADDLE1_BUTTON:case o.JOY0_LEFT:return void(e?d&=191:d|=64);case o.PADDLE0_BUTTON:case o.JOY0_RIGHT:return void(e?d&=127:d|=128);case o.JOY1_UP:return void(e?d&=254:d|=1);case o.JOY1_DOWN:return void(e?d&=253:d|=2);case o.JOY1_LEFT:return void(e?d&=251:d|=4);case o.JOY1_RIGHT:return void(e?d&=247:d|=8);case o.RESET:return void(e?f&=254:f|=1);case o.SELECT:return void(e?f&=253:f|=2)}if(e)switch(t){case o.BLACK_WHITE:return 0==(8&f)?f|=8:f&=247,void a.getTia().getVideoOutput().showOSD(0!=(8&f)?"COLOR":"B/W",!0);case o.DIFFICULTY0:return 0==(64&f)?f|=64:f&=191,void a.getTia().getVideoOutput().showOSD(0!=(64&f)?"P1 Expert":"P1 Novice",!0);case o.DIFFICULTY1:return 0==(128&f)?f|=128:f&=127,void a.getTia().getVideoOutput().showOSD(0!=(128&f)?"P2 Expert":"P2 Novice",!0)}},this.controlsStateReport=function(t){t[o.BLACK_WHITE]=0==(8&f),t[o.DIFFICULTY0]=0!=(64&f),t[o.DIFFICULTY1]=0!=(128&f),t[o.SELECT]=0==(2&f),t[o.RESET]=0==(1&f)},this.saveState=function(){return{t:s,c:l,l:c,SA:d,SAC:u,SB:f,SBC:$,IT:h,IS:_,T1:p,T8:g,T6:v,T2:S}},this.loadState=function(t){s=t.t,l=t.c,c=t.l,u=t.SAC,f=t.SB,$=t.SBC,h=t.IT,_=t.IS,p=t.T1,g=t.T8,v=t.T6,S=t.T2},this.debug=!1;var a,s=1024,l=1024,c=1024,d=255,u=0,f=11,$=0,h=256*Math.random()|0,_=0,p=0,g=0,v=0,S=0,m=7},function(){"use strict";for(var t=[0,4210752,7105644,9474192,11579568,13158600,14474460,16053492,17476,1074276,2393220,3448992,4241592,5296336,6088936,6880508,10352,1328260,2645144,3963052,5016764,6070476,6862044,7915756,6276,1586328,3166380,4745408,6062288,7378144,8431852,9747708,136,2105500,3947696,5789888,7368912,8947936,10526956,11842812,6029432,7610508,8928416,10246320,11563200,12616912,13671644,14725356,7864392,9445472,10763384,12081292,13398176,14451892,15506628,16560340,8650772,9969712,11287628,12605544,13660284,14715028,15507624,16561340,8912896,10231836,11550776,12606544,13661288,14716028,15508624,16562340,8132608,9451548,11031608,12349520,13404264,14457980,15512720,16566436,6040576,7883804,9463864,11306064,12622952,13939836,15256720,16572580,2898944,4742172,6585400,8428624,9745512,11325564,12641424,13958308,15360,2120736,4226112,6069340,7648372,9228428,10806436,12123320,14356,1858612,3701840,5281900,6861956,8178844,9495732,10812616,12332,1855564,3436648,5016708,6596764,7913652,8967372,10284256,10308,1591396,3172484,4490400,5807288,7124176,8178920,9232636],e=[0,2631720,5263440,7631988,9737364,11842740,13684944,15856113,0,2631720,5263440,7631988,9737364,11842740,13684944,15856113,22656,2125972,3966120,5807292,7384268,8700124,10277100,11591932,23620,2127964,3969140,5811340,7389344,8705200,10283204,11599060,13424,2117768,3958944,5801140,7379144,8695004,10273004,11588860,1336320,3440672,5281852,7123032,8701040,10279044,11856028,13171888,1310832,3416200,5258400,7100596,8679624,10257628,11836652,13152508,6052864,7631904,9210940,10789976,12105840,13158532,14474396,15527088,6029424,7610500,8928404,10246312,11563188,12616900,13671632,14725344,7355392,8935452,10515512,11832400,13149288,14465148,15518864,16572580,7340120,8921196,10501248,11819156,13136036,14451892,15506628,16560340,7348224,8928284,10508344,11826256,13142120,14459004,15512720,16566436,8388668,9707604,11025516,12343424,13398164,14451880,15506616,16560328,8912896,10231840,11549756,12605528,13660272,14713988,15506588,16560304,0,2631720,5263440,7631988,9737364,11842740,13684944,15856113,0,2631720,5263440,7631988,9737364,11842740,13684944,15856113],n=new Uint32Array(256),i=new Uint32Array(256),r=0,o=t.length;r<o;r++)n[2*r]=n[2*r+1]=t[r]+4278190080,i[2*r]=i[2*r+1]=e[r]+4278190080;t=e=void 0,jt.TiaPalettes={NTSC:n,PAL:i}}(),jt.TiaAudio=function(){"use strict";function t(){r||(r=new jt.AudioSignal("TiaAudio",n,d,c)),i.connectAudioSignal(r)}function e(){r&&i.disconnectAudioSignal(r)}var n=this;this.connectAudioSocket=function(t){i=t},this.cartridgeInserted=function(t){o=t&&t.needsAudioClock()?t:null},this.audioClockPulse=function(){i.audioClockPulse()},this.getChannel0=function(){return s},this.getChannel1=function(){return l},this.powerOn=function(){this.reset(),t()},this.powerOff=function(){e()},this.reset=function(){s.setVolume(0),l.setVolume(0),a=0},this.nextSample=function(){o&&o.audioClockPulse();var t=s.nextSample()-l.nextSample();return t!==a&&(a=t=(9*t+a)/10),t};var i,r,o,a=0,s=new jt.TiaAudioChannel,l=new jt.TiaAudioChannel,c=.4,d=31440},jt.TiaAudioChannel=function(){"use strict";this.nextSample=function(){return--v<=0&&(v+=g,S=h()),1===S?_:0},this.setVolume=function(t){_=t/w},this.setDivider=function(t){g!==t&&(v=v/g*t,g=t)},this.setControl=function(e){p!==e&&(p=e,h=0===e||11===e?t:1===e?n:2===e?d:3===e?u:4===e||5===e?o:6===e||10===e?c:7===e||9===e?i:8===e?r:12===e||13===e?s:14===e?f:15===e?$:t)};var t=function(){return 1},e=function(){return A[C]},n=function(){return 15==++C&&(C=0),A[C]},i=function(){return 31==++O&&(O=0),y[O]},r=function(){var t=1&b,e=1&(b>>4^t);return b>>>=1,0===e?b&=255:b|=256,t},o=function(){return 1===g?1:m=m?0:1},a=function(){return E},s=function(){return 0==--T&&(T=3,E=E?0:1),E},l=function(){return R[L]},c=function(){return 31==++L&&(L=0),R[L]},d=function(){return l()!==c()?n():e()},u=function(){return i()?n():e()},f=function(){return l()!=c()?s():a()},$=function(){return i()?s():a()},h=t,_=0,p=0,g=1,v=1,S=0,m=1,E=1,T=3,b=511,C=14,A=[1,1,1,1,0,0,0,1,0,0,1,1,0,1,0],O=30,y=[1,1,1,1,1,0,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,0,1,0,0,1,0,1,1,0,0],L=30,R=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],w=15},jt.Tia=function(pCpu,pPia,audioSocket){"use strict";function init(){generateObjectsLineSprites(),generateObjectsCopiesOffsets()}function renderLineTo(t){var e,n=t>LINE_WIDTH?LINE_WIDTH:t;if(vBlankOn)for(var i=renderClock;i<n;++i)linePixels[i]=vBlankColor;else{for(var r=collisions,o=renderClock-HBLANK_DURATION,a=n-HBLANK_DURATION;o<a;++o){var s=0,l=collisionsPossible;playfieldPriority&&(playfieldEnabled&&(1&(o<80?playfieldPatternL>>(o>>2):playfieldPatternR>>(o-80>>2))?s=playfieldColor:l&=PFC),ballEnabled&&((e=o-ballPixel)<0&&(e+=160),missileBallLineSprites[ballLineSpritePointer+(e>>3)]>>(7&e)&1?s||(s=ballColor):l&=BLC)),player0Enabled&&((e=o-player0Pixel)<0&&(e+=160),playerLineSprites[player0LineSpritePointer+(e>>3)]>>(7&e)&1?s||(s=player0Color):l&=P0C),missile0Enabled&&((e=o-missile0Pixel)<0&&(e+=160),missileBallLineSprites[missile0LineSpritePointer+(e>>3)]>>(7&e)&1?s||(s=missile0Color):l&=M0C),player1Enabled&&((e=o-player1Pixel)<0&&(e+=160),playerLineSprites[player1LineSpritePointer+(e>>3)]>>(7&e)&1?s||(s=player1Color):l&=P1C),missile1Enabled&&((e=o-missile1Pixel)<0&&(e+=160),missileBallLineSprites[missile1LineSpritePointer+(e>>3)]>>(7&e)&1?s||(s=missile1Color):l&=M1C),playfieldPriority||(playfieldEnabled&&(o<80?playfieldPatternL>>(o>>2)&1?s||(s=playfieldLeftColor):l&=PFC:playfieldPatternR>>(o-80>>2)&1?s||(s=playfieldRightColor):l&=PFC),ballEnabled&&((e=o-ballPixel)<0&&(e+=160),missileBallLineSprites[ballLineSpritePointer+(e>>3)]>>(7&e)&1?s||(s=ballColor):l&=BLC)),linePixels[o+HBLANK_DURATION]=s||playfieldBackground,r|=l}debugNoCollisions||(collisions=r)}}function changeAt(t){vBlankOn||(t>renderClock&&((changeClock>=0||changeClockPrevLine>=0)&&renderLineTo(t),renderClock=t),changeClock=renderClock)}function changeAtClock(){changeAt(clock)}function changeAtClockPlus(t){changeAt(clock+t)}function changePlayfieldAtClock(){if(debug&&debugPixel(DEBUG_PF_GR_COLOR),clock<renderClock-1)return changeAtClock();var t=3&clock;changeAtClockPlus(t<3?4-t:5)}function changeVBlankAtClockPlus1(){var t=clock+1;t>renderClock&&((changeClock>=0||changeClockPrevLine>=0)&&renderLineTo(t),renderClock=t),changeClock=renderClock}function updateToClock(){vBlankOn||clock>renderClock&&((changeClock>=0||changeClockPrevLine>=0)&&renderLineTo(clock),renderClock=clock)}function augmentCollisionsPossible(){collisionsPossible=65534,player0Enabled||(collisionsPossible&=P0C),player1Enabled||(collisionsPossible&=P1C),missile0Enabled||(collisionsPossible&=M0C),missile1Enabled||(collisionsPossible&=M1C),playfieldEnabled||(collisionsPossible&=PFC),ballEnabled||(collisionsPossible&=BLC)}function playfieldUpdateSprite(){playfieldPatternL=PF2<<12|jt.Util.reverseInt8(PF1)<<4|(240&PF0)>>4,playfieldUpdateSpriteR()}function playfieldUpdateSpriteR(){playfieldPatternR=playfieldReflected?jt.Util.reverseInt8(PF0)<<16|PF1<<8|jt.Util.reverseInt8(PF2):playfieldPatternL,0!==playfieldPatternL||0!==playfieldPatternR?(playfieldEnabled=!0,augmentCollisionsPossible()):(playfieldEnabled=!1,collisionsPossible&=PFC)}function ballSetEnabled(t){t?(ballEnabled=!0,augmentCollisionsPossible()):(ballEnabled=!1,collisionsPossible&=BLC)}function player0SetShape(t){if(NUSIZ0!==t){var e=NUSIZ0^t,n=NUSIZ0;NUSIZ0=t;var i=7&t,r=clock<HBLANK_DURATION?2:clock-HBLANK_DURATION+2;if(7&e){if(!player0Alt){var o=r-player0Pixel;o<0?o+=160:o>=160&&(o-=160);var a=playerScanOffsetsShape[160*(7&n)+o],s=playerScanOffsetsShape[160*i+o];if(s!==a){if(player0Enabled&&changeAtClockPlus(2),player0Alt=player0Pixel>=80?1:2,player0LineSpritePointer+=20,player0AltFrom=o,player0AltLength=playerCopyLengthPerShape[i],192&a)player0AltCopyOffset=191&a;else if(clock<HBLANK_DURATION&&hMoveHitBlank)player0AltCopyOffset=128;else{var l=playerPixelSizePerShape[i];player0AltCopyOffset=playerScanStartPerShape[i]+a*l+(1&o),player0AltLength-=(192&s?0:s)*l}}}player0UpdateSprite(2)}if(55&e){if(!missile0Alt&&((o=r-missile0Pixel)<0?o+=160:o>=160&&(o-=160),a=missileScanOffsetsShape[160*((48&n)>>1|7&n)+o],(s=missileScanOffsetsShape[160*((48&t)>>1|i)+o])!==a)){missile0Enabled&&changeAtClockPlus(2),missile0Alt=missile0Pixel>=80?1:2,missile0LineSpritePointer+=20,missile0AltFrom=o;var c=(48&t)>>4;missile0AltLength=4+(1<<c),192&a?missile0AltCopyOffset=191&a:clock<HBLANK_DURATION&&hMoveHitBlank?missile0AltCopyOffset=128:(missile0AltCopyOffset=4+(a<<c)+(1&o),missile0AltLength-=(192&s?0:s)<<c)}missile0UpdateSprite(2)}}}function player0SetSprite(t){debug&&debugPixel(DEBUG_P0_GR_COLOR),GRP0d!==t&&(GRP0d=t,VDELP0||player0UpdateSprite(1)),GRP1!==GRP1d&&(GRP1=GRP1d,VDELP1&&player1UpdateSprite(1))}function player0UpdateSprite(t){var e=VDELP0?GRP0:GRP0d;if(e){var n=((REFP0<<11|e<<3|7&NUSIZ0)<<6)+(player0Alt?20:0);player0Enabled&&player0LineSpritePointer===n||(changeAtClockPlus(t),player0LineSpritePointer=n,player0Alt&&player0DefineAlt()),player0Enabled||(player0Enabled=!0,augmentCollisionsPossible())}else player0Enabled&&(changeAtClockPlus(t),player0Enabled=!1,collisionsPossible&=P0C)}function player1SetShape(t){if(NUSIZ1!==t){var e=NUSIZ1^t,n=NUSIZ1;NUSIZ1=t;var i=7&t,r=clock<HBLANK_DURATION?2:clock-HBLANK_DURATION+2;if(7&e){if(!player1Alt){var o=r-player1Pixel;o<0?o+=160:o>=160&&(o-=160);var a=playerScanOffsetsShape[160*(7&n)+o],s=playerScanOffsetsShape[160*i+o];s!==a&&(player1Enabled&&changeAtClockPlus(2),player1Alt=player1Pixel>=80?1:2,player1LineSpritePointer+=40,player1AltFrom=o,player1AltLength=playerCopyLengthPerShape[i],192&a?player1AltCopyOffset=191&a:clock<HBLANK_DURATION&&hMoveHitBlank?player1AltCopyOffset=128:(player1AltCopyOffset=playerScanStartPerShape[i]+a*playerPixelSizePerShape[i]+(1&o),player1AltLength-=(192&s?0:s)*playerPixelSizePerShape[i]))}player1UpdateSprite(2)}if(55&e){if(!missile1Alt&&((o=r-missile1Pixel)<0?o+=160:o>=160&&(o-=160),a=missileScanOffsetsShape[160*((48&n)>>1|7&n)+o],(s=missileScanOffsetsShape[160*((48&t)>>1|i)+o])!==a)){missile1Enabled&&changeAtClockPlus(2),missile1Alt=missile1Pixel>=80?1:2,missile1LineSpritePointer+=40,missile1AltFrom=o;var l=(48&t)>>4;missile1AltLength=4+(1<<l),192&a?missile1AltCopyOffset=191&a:clock<HBLANK_DURATION&&hMoveHitBlank?missile1AltCopyOffset=128:(missile1AltCopyOffset=4+(a<<l)+(1&o),missile1AltLength-=(192&s?0:s)<<l)}missile1UpdateSprite(2)}}}function player1SetSprite(t){debug&&debugPixel(DEBUG_P1_GR_COLOR),GRP1d!==t&&(GRP1d=t,VDELP1||player1UpdateSprite(1)),GRP0!==GRP0d&&(GRP0=GRP0d,VDELP0&&player0UpdateSprite(1)),ENABL!==ENABLd&&(ENABL=ENABLd,VDELBL&&changeAtClockPlus(1),ballSetEnabled(ENABL))}function player1UpdateSprite(t){var e=VDELP1?GRP1:GRP1d;if(e){var n=((REFP1<<11|e<<3|7&NUSIZ1)<<6)+(player1Alt?40:0);player1Enabled&&player1LineSpritePointer===n||(changeAtClockPlus(t),player1LineSpritePointer=n,player1Alt&&player1DefineAlt()),player1Enabled||(player1Enabled=!0,augmentCollisionsPossible())}else player1Enabled&&(changeAtClockPlus(t),player1Enabled=!1,collisionsPossible&=P1C)}function missile0UpdateSprite(t){var e=(((48&NUSIZ0)>>1|7&NUSIZ0)<<6)+(missile0Alt?20:0);missile0LineSpritePointer!==e&&(missile0Enabled?(changeAtClockPlus(t),missile0LineSpritePointer=e,missile0Alt&&missile0DefineAlt()):missile0LineSpritePointer=e)}function missile0SetEnabled(t){t?(missile0Enabled=!0,augmentCollisionsPossible(),missile0Alt&&missile0DefineAlt()):(missile0Enabled=!1,collisionsPossible&=M0C)}function missile0SetResetToPlayer(t){RESMP0!==(2&t)&&(ENAM0?(changeAtClock(),missile0SetEnabled(!(RESMP0=2&t))):RESMP0=2&t,RESMP0||(missile0Pixel=player0Pixel+missileCenterOffsetsPerPlayerSize[7&NUSIZ0])>=160&&(missile0Pixel-=160))}function missile1UpdateSprite(t){var e=(((48&NUSIZ1)>>1|7&NUSIZ1)<<6)+(missile1Alt?40:0);missile1LineSpritePointer!==e&&(missile1Enabled?(changeAtClockPlus(t),missile1LineSpritePointer=e,missile1Alt&&missile1DefineAlt()):missile1LineSpritePointer=e)}function missile1SetEnabled(t){t?(missile1Enabled=!0,augmentCollisionsPossible(),missile1Alt&&missile1DefineAlt()):(missile1Enabled=!1,collisionsPossible&=M1C)}function missile1SetResetToPlayer(t){RESMP1!==(2&t)&&(ENAM1?(changeAtClock(),missile1SetEnabled(!(RESMP1=2&t))):RESMP1=2&t,RESMP1||(missile1Pixel=player1Pixel+missileCenterOffsetsPerPlayerSize[7&NUSIZ1])>=160&&(missile1Pixel-=160))}function player0DefineAlt(){var t=player0AltFrom<<16|player0AltLength<<8|player0AltCopyOffset,e=player0LineSpritePointer-20>>6;if(player0AltControl[e]!==t){for(var n=player0LineSpritePointer-20,i=0;i<20;++i)playerLineSprites[player0LineSpritePointer+i]=playerLineSprites[n+i];var r=player0AltFrom;if(128&player0AltCopyOffset)for(var o=0;o<player0AltLength;++o)playerLineSprites[player0LineSpritePointer+(r>>3)]&=~(1<<(7&r)),++r>=160&&(r-=160);else{n-=objectsLineSpritePointerDeltaToSingleCopy[7&NUSIZ0];for(var a=player0AltCopyOffset,s=player0AltCopyOffset+player0AltLength;a<s;++a)playerLineSprites[n+(a>>3)]>>(7&a)&1?playerLineSprites[player0LineSpritePointer+(r>>3)]|=1<<(7&r):playerLineSprites[player0LineSpritePointer+(r>>3)]&=~(1<<(7&r)),++r>=160&&(r-=160)}player0AltControl[e]=t}}function player1DefineAlt(){var t=player1AltFrom<<16|player1AltLength<<8|player1AltCopyOffset,e=player1LineSpritePointer-40>>6;if(player1AltControl[e]!==t){for(var n=player1LineSpritePointer-40,i=0;i<20;++i)playerLineSprites[player1LineSpritePointer+i]=playerLineSprites[n+i];var r=player1AltFrom;if(128&player1AltCopyOffset)for(var o=0;o<player1AltLength;++o)playerLineSprites[player1LineSpritePointer+(r>>3)]&=~(1<<(7&r)),++r>=160&&(r-=160);else{n-=objectsLineSpritePointerDeltaToSingleCopy[7&NUSIZ1];for(var a=player1AltCopyOffset,s=player1AltCopyOffset+player1AltLength;a<s;++a)playerLineSprites[n+(a>>3)]>>(7&a)&1?playerLineSprites[player1LineSpritePointer+(r>>3)]|=1<<(7&r):playerLineSprites[player1LineSpritePointer+(r>>3)]&=~(1<<(7&r)),++r>=160&&(r-=160)}player1AltControl[e]=t}}function missile0DefineAlt(){var t=missile0AltFrom<<16|missile0AltLength<<8|missile0AltCopyOffset,e=missile0LineSpritePointer-20>>6;if(missile0AltControl[e]!==t){for(var n=missile0LineSpritePointer-20,i=0;i<20;++i)missileBallLineSprites[missile0LineSpritePointer+i]=missileBallLineSprites[n+i];var r=missile0AltFrom;if(128&missile0AltCopyOffset)for(var o=0;o<missile0AltLength;++o)missileBallLineSprites[missile0LineSpritePointer+(r>>3)]&=~(1<<(7&r)),++r>=160&&(r-=160);else{n-=objectsLineSpritePointerDeltaToSingleCopy[7&NUSIZ0];for(var a=missile0AltCopyOffset,s=missile0AltCopyOffset+missile0AltLength;a<s;++a)missileBallLineSprites[n+(a>>3)]>>(7&a)&1?missileBallLineSprites[missile0LineSpritePointer+(r>>3)]|=1<<(7&r):missileBallLineSprites[missile0LineSpritePointer+(r>>3)]&=~(1<<(7&r)),++r>=160&&(r-=160)}missile0AltControl[e]=t}}function missile1DefineAlt(){var t=missile1AltFrom<<16|missile1AltLength<<8|missile1AltCopyOffset,e=missile1LineSpritePointer-40>>6;if(missile1AltControl[e]!==t){for(var n=missile1LineSpritePointer-40,i=0;i<20;++i)missileBallLineSprites[missile1LineSpritePointer+i]=missileBallLineSprites[n+i];var r=missile1AltFrom;if(128&missile1AltCopyOffset)for(var o=0;o<missile1AltLength;++o)missileBallLineSprites[missile1LineSpritePointer+(r>>3)]&=~(1<<(7&r)),++r>=160&&(r-=160);else{n-=objectsLineSpritePointerDeltaToSingleCopy[7&NUSIZ1];for(var a=missile1AltCopyOffset,s=missile1AltCopyOffset+missile1AltLength;a<s;++a)missileBallLineSprites[n+(a>>3)]>>(7&a)&1?missileBallLineSprites[missile1LineSpritePointer+(r>>3)]|=1<<(7&r):missileBallLineSprites[missile1LineSpritePointer+(r>>3)]&=~(1<<(7&r)),++r>=160&&(r-=160)}missile1AltControl[e]=t}}function getRESxPixel(){if(clock>=HBLANK_DURATION+(hMoveHitBlank?7:0))return clock-HBLANK_DURATION;if(hMoveHitBlank){if(clock>=HBLANK_DURATION)return -6;var t=clock-hMoveHitClock-4>>2;return t>8?-6:t>1?-(t-2):-(158+t)}return -158}function checkLateHMOVE(){hMoveLateHit?(hMoveLateHit=!1,hMoveHitBlank=hMoveLateHitBlank,performHMOVE()):hMoveHitBlank=!1}function updateExtendedHBLANK(){hMoveHitBlank!==(linePixels[HBLANK_DURATION]===hBlankColor)&&(hMoveHitBlank?linePixels[HBLANK_DURATION]=linePixels[HBLANK_DURATION+1]=linePixels[HBLANK_DURATION+2]=linePixels[HBLANK_DURATION+3]=linePixels[HBLANK_DURATION+4]=linePixels[HBLANK_DURATION+5]=linePixels[HBLANK_DURATION+6]=linePixels[HBLANK_DURATION+7]=hBlankColor:changeClock=HBLANK_DURATION),hMoveHitBlank&&(renderClock=HBLANK_DURATION+8)}function endObjectsAltStatusMidLine(){1===player0Alt&&(player0Enabled&&changeAtClock(),player0Alt=0,player0LineSpritePointer-=20),1===player1Alt&&(player1Enabled&&changeAtClock(),player1Alt=0,player1LineSpritePointer-=40),1===missile0Alt&&(missile0Enabled&&changeAtClock(),missile0Alt=0,missile0LineSpritePointer-=20),1===missile1Alt&&(missile1Enabled&&changeAtClock(),missile1Alt=0,missile1LineSpritePointer-=40)}function endObjectsAltStatusEndOfLine(){2===player0Alt&&(player0Alt=0,player0LineSpritePointer-=20),2===player1Alt&&(player1Alt=0,player1LineSpritePointer-=40),2===missile0Alt&&(missile0Alt=0,missile0LineSpritePointer-=20),2===missile1Alt&&(missile1Alt=0,missile1LineSpritePointer-=40)}function vSyncSet(t){debug?(debugPixel(VSYNC_COLOR),changeAtClock(),vBlankColor=(vSyncOn=0!=(2&t))?VSYNC_COLOR:DEBUG_VBLANK_COLOR):vSyncOn=0!=(2&t)}function generateObjectsLineSprites(){function t(t,e,n){for(var i=0;i<8;++i)t[n+i]=e>>i&1}function e(t,e,n){for(var i=0;i<8;++i)t[n+4*i]=t[n+4*i+1]=t[n+4*i+2]=t[n+4*i+3]=e>>i&1}function n(t,e,n,i,r){for(var o=((t<<11|e<<3|n)<<6)+20*i,a=0;a<20;++a)for(var s=0;s<8;++s)r[8*a+s]&&(playerLineSprites[o+a]|=1<<s)}function i(t,e,n,i){for(var r=((t<<3|e)<<6)+20*n,o=0;o<20;++o)for(var a=0;a<8;++a)i[8*o+a]&&(missileBallLineSprites[r+o]|=1<<a)}for(var r=new Uint8Array(160),o=0;o<=1;++o)for(var a=0;a<256;++a){var s=o?a:jt.Util.reverseInt8(a);t(r,s,5),n(o,a,0,0,r),t(r,s,21),n(o,a,1,0,r),t(r,s,37),n(o,a,3,0,r),t(r,0,21),n(o,a,2,0,r),t(r,s,69),n(o,a,6,0,r),t(r,0,37),n(o,a,4,0,r),t(r,0,69),r[5]=0,function(t,e,n){for(var i=0;i<8;++i)t[n+2*i]=t[n+2*i+1]=e>>i&1}(r,s,6),n(o,a,5,0,r),e(r,s,6),n(o,a,7,0,r),e(r,0,6)}jt.Util.arrayFill(r,0);for(var l=0;l<4;++l)t(r,s=(1<<(1<<l))-1,4),i(l,0,0,r),i(l,5,0,r),i(l,7,0,r),t(r,s,20),i(l,1,0,r),t(r,s,36),i(l,3,0,r),t(r,0,20),i(l,2,0,r),t(r,s,68),i(l,6,0,r),t(r,0,36),i(l,4,0,r),t(r,0,4),t(r,0,68)}function generateObjectsCopiesOffsets(){var t=new Uint8Array(40);t[0]=0,t[1]=1,t[2]=2,t[3]=3,jt.Util.arrayFill(playerCopyOffsetsReset,128),jt.Util.arrayFill(playerScanOffsetsShape,128);for(var e=0;e<13;++e){var n=e-t[e];playerCopyOffsetsReset[0+e]=n,playerCopyOffsetsReset[160+e]=n,playerCopyOffsetsReset[160+e+16]=n,playerCopyOffsetsReset[320+e]=n,playerCopyOffsetsReset[320+e+32]=n,playerCopyOffsetsReset[480+e]=n,playerCopyOffsetsReset[480+e+16]=n,playerCopyOffsetsReset[480+e+32]=n,playerCopyOffsetsReset[640+e]=n,playerCopyOffsetsReset[640+e+64]=n,playerCopyOffsetsReset[960+e]=n,playerCopyOffsetsReset[960+e+32]=n,playerCopyOffsetsReset[960+e+64]=n,n=e<5?64|e:e-5,playerScanOffsetsShape[0+e]=n,playerScanOffsetsShape[160+e]=n,playerScanOffsetsShape[160+e+16]=n,playerScanOffsetsShape[320+e]=n,playerScanOffsetsShape[320+e+32]=n,playerScanOffsetsShape[480+e]=n,playerScanOffsetsShape[480+e+16]=n,playerScanOffsetsShape[480+e+32]=n,playerScanOffsetsShape[640+e]=n,playerScanOffsetsShape[640+e+64]=n,playerScanOffsetsShape[960+e]=n,playerScanOffsetsShape[960+e+32]=n,playerScanOffsetsShape[960+e+64]=n}for(e=0;e<22;e++)n=e-t[e],playerCopyOffsetsReset[800+e]=n,n=e<6?64|e:e-6>>1,playerScanOffsetsShape[800+e]=n;for(e=0;e<38;e++)n=e-t[e],playerCopyOffsetsReset[1120+e]=n,n=e<6?64|e:e-6>>2,playerScanOffsetsShape[1120+e]=n;jt.Util.arrayFill(missileCopyOffsetsReset,128),jt.Util.arrayFill(missileScanOffsetsShape,128);for(var i=0;i<=3;++i){var r=4+(1<<i);for(e=0;e<r;++e)n=e-t[e],missileCopyOffsetsReset[8*i*160+0+e]=n,missileCopyOffsetsReset[8*i*160+160+e]=n,missileCopyOffsetsReset[8*i+160+e+16]=n,missileCopyOffsetsReset[8*i*160+320+e]=n,missileCopyOffsetsReset[8*i+320+e+32]=n,missileCopyOffsetsReset[8*i*160+480+e]=n,missileCopyOffsetsReset[8*i+480+e+16]=n,missileCopyOffsetsReset[8*i*160+480+e+32]=n,missileCopyOffsetsReset[8*i*160+640+e]=n,missileCopyOffsetsReset[8*i+640+e+64]=n,missileCopyOffsetsReset[8*i*160+800+e]=n,missileCopyOffsetsReset[8*i*160+960+e]=n,missileCopyOffsetsReset[8*i+960+e+32]=n,missileCopyOffsetsReset[8*i*160+960+e+64]=n,missileCopyOffsetsReset[8*i*160+1120+e]=n,n=e<4?64|e:e-4>>i,missileScanOffsetsShape[8*i*160+0+e]=n,missileScanOffsetsShape[8*i*160+160+e]=n,missileScanOffsetsShape[8*i+160+e+16]=n,missileScanOffsetsShape[8*i*160+320+e]=n,missileScanOffsetsShape[8*i+320+e+32]=n,missileScanOffsetsShape[8*i*160+480+e]=n,missileScanOffsetsShape[8*i+480+e+16]=n,missileScanOffsetsShape[8*i*160+480+e+32]=n,missileScanOffsetsShape[8*i*160+640+e]=n,missileScanOffsetsShape[8*i+640+e+64]=n,missileScanOffsetsShape[8*i*160+800+e]=n,missileScanOffsetsShape[8*i*160+960+e]=n,missileScanOffsetsShape[8*i+960+e+32]=n,missileScanOffsetsShape[8*i*160+960+e+64]=n,missileScanOffsetsShape[8*i*160+1120+e]=n}}var self=this;this.powerOn=function(){jt.Util.arrayFill(linePixels,VBLANK_COLOR),jt.Util.arrayFill(debugPixels,0),audioSignal.getChannel0().setVolume(0),audioSignal.getChannel1().setVolume(0),initLatchesAtPowerOn(),hMoveLateHit=!1,changeClock=changeClockPrevLine=-1,audioSignal.powerOn(),powerOn=!0},this.powerOff=function(){powerOn=!1,videoSignal.signalOff(),audioSignal.powerOff()},this.frame=function(){do{clock=0,changeClock=-1,renderClock=HBLANK_DURATION,debug&&(debugLevel>=4?jt.Util.arrayFill(linePixels,4278190080):debugLevel>=2&&debugLevel<4&&(changeClock=0)),checkLateHMOVE(),bus.clockPulse(),cpu.setRDY(!0);for(var t=0;t<22;++t)clock+=3,bus.clockPulse();updateExtendedHBLANK();for(var e=0;e<27;++e)clock+=3,bus.clockPulse();audioSignal.audioClockPulse(),endObjectsAltStatusMidLine();for(var n=0;n<26;++n)clock+=3,bus.clockPulse();audioSignal.audioClockPulse(),finishLine()}while(!videoSignal.nextLine(linePixels,vSyncOn));videoSignal.finishFrame()},this.connectBus=function(t){bus=t},this.getVideoOutput=function(){return videoSignal},this.getAudioOutput=function(){return audioSignal},this.setVideoStandard=function(t){videoSignal.setVideoStandard(t),palette=jt.TiaPalettes[t.name]},this.debug=function(t){debug=0!==(debugLevel=t>4?0:t),pia.debug=debug,debug?debugSetColors():debugRestoreColors()},this.showDebugMessage=function(){videoSignal.showOSD(debug?"Debug Level "+debugLevel:"Debug OFF",!0)},this.debugNoCollisions=function(t){debugNoCollisions=!!t},this.getDebugNoCollisions=function(){return debugNoCollisions},this.read=function(t){switch(t&READ_ADDRESS_MASK){case 0:return updateToClock(),(1024&collisions)>>3|(16384&collisions)>>8;case 1:return updateToClock(),(8192&collisions)>>6|(512&collisions)>>3;case 2:return updateToClock(),(4096&collisions)>>5|(2048&collisions)>>5;case 3:return updateToClock(),(256&collisions)>>1|(128&collisions)>>1;case 4:return updateToClock(),(32&collisions)<<2|(16&collisions)<<2;case 5:return updateToClock(),(8&collisions)<<4|(4&collisions)<<4;case 6:return updateToClock(),(2&collisions)<<6;case 7:return updateToClock(),(32768&collisions)>>8|64&collisions;case 8:return INPT0;case 9:return INPT1;case 10:return INPT2;case 11:return INPT3;case 12:return INPT4;case 13:return INPT5;default:return 0}},this.write=function(t,e){switch(t&WRITE_ADDRESS_MASK){case 0:return void vSyncSet(e);case 1:return void vBlankSet(e);case 2:return cpu.setRDY(!1),void(debug&&debugPixel(DEBUG_WSYNC_COLOR));case 9:return void(COLUBK===e||debug||(changeAtClock(),COLUBK=e,playfieldBackground=palette[e]));case 13:return void(PF0!==(240&e)&&(changePlayfieldAtClock(),PF0=240&e,playfieldUpdateSprite()));case 14:return void(PF1!==e&&(changePlayfieldAtClock(),PF1=e,playfieldUpdateSprite()));case 15:return void(PF2!==e&&(changePlayfieldAtClock(),PF2=e,playfieldUpdateSprite()));case 8:return void(COLUPF===e||debug||((playfieldEnabled&&!playfieldScoreMode||ballEnabled)&&changeAtClock(),COLUPF=e,ballColor=palette[e],playfieldScoreMode||(playfieldColor=playfieldLeftColor=playfieldRightColor=ballColor)));case 10:return void(CTRLPF!==e&&playfieldSetShape(e));case 20:return void hitRESBL();case 31:return void(ENABLd!==(2&e)&&(ENABLd=2&e,VDELBL||(changeAtClock(),ballSetEnabled(ENABLd))));case 39:return void(VDELBL!==(1&e)&&(VDELBL=1&e,ENABL!==ENABLd&&(changeAtClock(),ballSetEnabled(VDELBL?ENABL:ENABLd))));case 4:return void player0SetShape(e);case 6:return void(COLUP0===e||debug||(COLUP0=e,(player0Enabled||missile0Enabled||playfieldEnabled&&playfieldScoreMode)&&changeAtClock(),player0Color=missile0Color=palette[e],playfieldScoreMode&&(playfieldLeftColor=player0Color)));case 11:return void(REFP0!==(e>>3&1)&&(REFP0=e>>3&1,player0UpdateSprite(0)));case 16:return void hitRESP0();case 27:return void player0SetSprite(e);case 37:return void(VDELP0!==(1&e)&&(VDELP0=1&e,GRP0!==GRP0d&&player0UpdateSprite(0)));case 5:return void player1SetShape(e);case 7:return void(COLUP1===e||debug||(COLUP1=e,(player1Enabled||missile1Enabled||playfieldEnabled&&playfieldScoreMode)&&changeAtClock(),player1Color=missile1Color=palette[e],playfieldScoreMode&&(playfieldRightColor=player1Color)));case 12:return void(REFP1!==(e>>3&1)&&(REFP1=e>>3&1,player1UpdateSprite(0)));case 17:return void hitRESP1();case 28:return void player1SetSprite(e);case 38:return void(VDELP1!==(1&e)&&(VDELP1=1&e,GRP1!==GRP1d&&player1UpdateSprite(0)));case 18:return void hitRESM0();case 29:return void(ENAM0!==(2&e)&&(ENAM0=2&e,RESMP0||(changeAtClock(),missile0SetEnabled(ENAM0))));case 40:return void missile0SetResetToPlayer(e);case 19:return void hitRESM1();case 30:return void(ENAM1!==(2&e)&&(ENAM1=2&e,RESMP1||(changeAtClock(),missile1SetEnabled(ENAM1))));case 41:return void missile1SetResetToPlayer(e);case 32:return void(HMP0=(e>127?-16:0)+(e>>4));case 33:return void(HMP1=(e>127?-16:0)+(e>>4));case 34:return void(HMM0=(e>127?-16:0)+(e>>4));case 35:return void(HMM1=(e>127?-16:0)+(e>>4));case 36:return void(HMBL=(e>127?-16:0)+(e>>4));case 42:return void hitHMOVE();case 43:return void(HMP0=HMP1=HMM0=HMM1=HMBL=0);case 44:return changeAtClock(),void(collisions=0);case 21:return void(AUDC0!==e&&(AUDC0=e,audioSignal.getChannel0().setControl(15&e)));case 22:return void(AUDC1!==e&&(AUDC1=e,audioSignal.getChannel1().setControl(15&e)));case 23:return void(AUDF0!==e&&(AUDF0=e,audioSignal.getChannel0().setDivider(1+(31&e))));case 24:return void(AUDF1!==e&&(AUDF1=e,audioSignal.getChannel1().setDivider(1+(31&e))));case 25:return void(AUDV0!==e&&(AUDV0=e,audioSignal.getChannel0().setVolume(15&e)));case 26:return void(AUDV1!==e&&(AUDV1=e,audioSignal.getChannel1().setVolume(15&e)))}};var finishLine=function(){changeClock>=0?(renderLineTo(LINE_WIDTH),changeClockPrevLine=changeClock):changeClockPrevLine>=0&&(renderLineTo(changeClockPrevLine),changeClockPrevLine=-1),endObjectsAltStatusEndOfLine(),paddle0Position>=0&&!paddleCapacitorsGrounded&&(INPT0<128&&++paddle0CapacitorCharge>=paddle0Position&&(INPT0|=128),INPT1<128&&++paddle1CapacitorCharge>=paddle1Position&&(INPT1|=128)),debugLevel>=1&&processDebugPixelsInLine()},playfieldSetShape=function(t){if(CTRLPF!==t){var e=7&t;e!==(7&CTRLPF)&&(playfieldEnabled&&changeAtClock(),playfieldReflected!==(e=0!=(1&t))&&(playfieldReflected=e,playfieldUpdateSpriteR()),playfieldScoreMode!==(e=0!=(2&t))&&(playfieldScoreMode=e,debug||(e?(playfieldLeftColor=player0Color,playfieldRightColor=player1Color):playfieldColor=playfieldLeftColor=playfieldRightColor=ballColor)),playfieldPriority=0!=(4&t)),(e=48&t)!=(48&CTRLPF)&&(ballEnabled&&changeAtClock(),ballLineSpritePointer=e>>1<<6),CTRLPF=t}},hitRESP0=function(){debug&&debugPixel(DEBUG_P0_RES_COLOR);var t=getRESxPixel(),e=t>=0?t:-t;if(player0Pixel!==e){player0Enabled&&changeAtClock();var n=t>=0?e:0,i=n-player0Pixel;i<0&&(i+=160),player0Pixel=e;var r=7&NUSIZ0;if(player0Alt){if(i<=playerCopyLengthPerShape[r])return}else player0LineSpritePointer+=20;var o=n-e;o<-100&&(o+=160),player0Alt=e>=80?1:2,player0AltFrom=o>=0?o:160+o,player0AltLength=playerCopyLengthPerShape[r]-o,player0AltCopyOffset=playerCopyOffsetsReset[160*r+i],player0Enabled&&player0DefineAlt()}},hitRESP1=function(){debug&&debugPixel(DEBUG_P1_RES_COLOR);var t=getRESxPixel(),e=t>=0?t:-t;if(player1Pixel!==e){player1Enabled&&changeAtClock();var n=t>=0?e:0,i=n-player1Pixel;i<0&&(i+=160),player1Pixel=e;var r=7&NUSIZ1;if(player1Alt){if(i<=playerCopyLengthPerShape[r])return}else player1LineSpritePointer+=40;var o=n-e;o<-100&&(o+=160),player1Alt=e>=80?1:2,player1AltFrom=o>=0?o:160+o,player1AltLength=playerCopyLengthPerShape[r]-o,player1AltCopyOffset=playerCopyOffsetsReset[160*r+i],player1Enabled&&player1DefineAlt()}},hitRESM0=function(){debug&&debugPixel(DEBUG_M0_COLOR);var t=getRESxPixel(),e=t>=0?t:-t;if(missile0Pixel!==e){missile0Enabled&&changeAtClock();var n=t>=0?e:0,i=n-missile0Pixel;if(i<0&&(i+=160),missile0Pixel=e,missile0Alt){if(i<=4+(1<<((48&NUSIZ0)>>4)))return}else missile0LineSpritePointer+=20;var r=n-e;r<-100&&(r+=160),missile0Alt=e>=80?1:2,missile0AltFrom=r>=0?r:160+r,missile0AltLength=4+(1<<((48&NUSIZ0)>>4))-r,missile0AltCopyOffset=missileCopyOffsetsReset[160*((48&NUSIZ0)>>1|7&NUSIZ0)+i],missile0Enabled&&missile0DefineAlt()}},hitRESM1=function(){debug&&debugPixel(DEBUG_M1_COLOR);var t=getRESxPixel(),e=t>=1?t:-t;if(missile1Pixel!==e){missile1Enabled&&changeAtClock();var n=t>=0?e:0,i=n-missile1Pixel;if(i<0&&(i+=160),missile1Pixel=e,missile1Alt){if(i<=4+(1<<((48&NUSIZ1)>>4)))return}else missile1LineSpritePointer+=40;var r=n-e;r<-100&&(r+=160),missile1Alt=e>=80?1:2,missile1AltFrom=r>=0?r:160+r,missile1AltLength=4+(1<<((48&NUSIZ1)>>4))-r,missile1AltCopyOffset=missileCopyOffsetsReset[160*((48&NUSIZ1)>>1|7&NUSIZ1)+i],missile1Enabled&&missile1DefineAlt()}},hitRESBL=function(){debug&&debugPixel(DEBUG_BL_COLOR);var t=getRESxPixel(),e=t>=0?t:-t;ballPixel!==e&&(ballEnabled&&changeAtClock(),ballPixel=e)},hitHMOVE=function(){if(debug&&debugPixel(DEBUG_HMOVE_COLOR),clock<HBLANK_DURATION)return hMoveHitClock=clock,hMoveHitBlank=!0,void performHMOVE();clock<219||(hMoveHitClock=160-clock,hMoveLateHit=!0,hMoveLateHitBlank=clock>=225)},performHMOVE=function(){var t,e=!1;0!==(t=hMoveHitBlank?HMP0:HMP0+8)&&((player0Pixel-=t)>=160?player0Pixel-=160:player0Pixel<0&&(player0Pixel+=160),player0Enabled&&(e=!0)),0!==(t=hMoveHitBlank?HMP1:HMP1+8)&&((player1Pixel-=t)>=160?player1Pixel-=160:player1Pixel<0&&(player1Pixel+=160),player1Enabled&&(e=!0)),0!==(t=hMoveHitBlank?HMM0:HMM0+8)&&((missile0Pixel-=t)>=160?missile0Pixel-=160:missile0Pixel<0&&(missile0Pixel+=160),missile0Enabled&&(e=!0)),0!==(t=hMoveHitBlank?HMM1:HMM1+8)&&((missile1Pixel-=t)>=160?missile1Pixel-=160:missile1Pixel<0&&(missile1Pixel+=160),missile1Enabled&&(e=!0)),0!==(t=hMoveHitBlank?HMBL:HMBL+8)&&((ballPixel-=t)>=160?ballPixel-=160:ballPixel<0&&(ballPixel+=160),ballEnabled&&(e=!0)),e&&(changeClock=hMoveHitBlank?HBLANK_DURATION+8:HBLANK_DURATION)},vBlankSet=function(t){var e=0!=(2&t);vBlankOn!==e&&(changeVBlankAtClockPlus1(),vBlankOn=e),0!=(64&t)?controlsButtonsLatched=!0:(controlsButtonsLatched=!1,controlsJOY0ButtonPressed?INPT4&=127:INPT4|=128,controlsJOY1ButtonPressed?INPT5&=127:INPT5|=128),0!=(128&t)?(paddleCapacitorsGrounded=!0,paddle0CapacitorCharge=paddle1CapacitorCharge=0,INPT0&=127,INPT1&=127,INPT2&=127,INPT3&=127):paddleCapacitorsGrounded=!1},initLatchesAtPowerOn=function(){collisions=0,INPT0=INPT1=INPT2=INPT3=0,INPT4=INPT5=128},debugPixel=function(t){debugPixels[clock]=t},processDebugPixelsInLine=function(){if(jt.Util.arrayFillSegment(linePixels,0,HBLANK_DURATION+(hMoveHitBlank?8:0),hBlankColor),debugLevel>=3&&videoSignal.monitor.currentLine()%10==0)for(var t=0;t<LINE_WIDTH;t++)debugPixels[t]||(t<HBLANK_DURATION?t%6!=0&&66!=t&&63!=t||(debugPixels[t]=DEBUG_MARKS_COLOR):(t-HBLANK_DURATION-1)%6==0&&(debugPixels[t]=DEBUG_MARKS_COLOR));if(debugLevel>=2)for(t=0;t<LINE_WIDTH;t++)debugPixels[t]&&(linePixels[t]=debugPixels[t],debugPixels[t]=0)},debugSetColors=function(){player0Color=DEBUG_P0_COLOR,player1Color=DEBUG_P1_COLOR,missile0Color=DEBUG_M0_COLOR,missile1Color=DEBUG_M1_COLOR,ballColor=DEBUG_BL_COLOR,playfieldColor=playfieldLeftColor=playfieldRightColor=DEBUG_PF_COLOR,playfieldBackground=DEBUG_BK_COLOR,hBlankColor=debugLevel>=1?DEBUG_HBLANK_COLOR:HBLANK_COLOR,vBlankColor=debugLevel>=1?DEBUG_VBLANK_COLOR:VBLANK_COLOR},debugRestoreColors=function(){hBlankColor=HBLANK_COLOR,vBlankColor=VBLANK_COLOR,playfieldBackground=palette[0],jt.Util.arrayFill(linePixels,hBlankColor),changeAtClock()},info=function(t){console.error("Line: "+videoSignal.monitor.currentLine()+", Pixel: "+clock+". "+t)},debugInfo=function(t){debug&&console.error("Line: "+videoSignal.monitor.currentLine()+", Pixel: "+clock+". "+t)},controls=jt.ConsoleControls;this.controlStateChanged=function(t,e){switch(t){case controls.JOY0_BUTTON:return void(e?(controlsJOY0ButtonPressed=!0,INPT4&=127):(controlsJOY0ButtonPressed=!1,controlsButtonsLatched||(INPT4|=128)));case controls.JOY1_BUTTON:return void(e?(controlsJOY1ButtonPressed=!0,INPT5&=127):(controlsJOY1ButtonPressed=!1,controlsButtonsLatched||(INPT5|=128)))}if(e)switch(t){case controls.DEBUG:return self.debug(debugLevel+1),void self.showDebugMessage();case controls.SHOW_INFO:return void videoSignal.toggleShowInfo();case controls.NO_COLLISIONS:self.debugNoCollisions(!debugNoCollisions),videoSignal.showOSD(debugNoCollisions?"No Collisions: ON":"No Collisions: OFF",!0)}},this.controlValueChanged=function(t,e){switch(t){case controls.PADDLE0_POSITION:return void(paddle0Position=e);case controls.PADDLE1_POSITION:return void(paddle1Position=e)}},this.saveState=function(t){var e={ccp:changeClockPrevLine,lpx:jt.Util.storeInt32BitArrayToStringBase64(linePixels),vs:vSyncOn,vb:vBlankOn,pfe:playfieldEnabled,pfl:playfieldPatternL,pfr:playfieldPatternR,pfc:playfieldColor,pflc:playfieldLeftColor,pfrc:playfieldRightColor,pfb:playfieldBackground,pfrl:playfieldReflected,pfsc:playfieldScoreMode,pfp:playfieldPriority,be:ballEnabled,bx:ballPixel,blp:ballLineSpritePointer,bc:ballColor,p0e:player0Enabled,p0x:player0Pixel,p0lp:player0LineSpritePointer,p0a:player0Alt,p0af:player0AltFrom,p0al:player0AltLength,p0ao:player0AltCopyOffset,p0c:player0Color,p1e:player1Enabled,p1x:player1Pixel,p1lp:player1LineSpritePointer,p1a:player1Alt,p1af:player1AltFrom,p1al:player1AltLength,p1ao:player1AltCopyOffset,p1c:player1Color,m0e:missile0Enabled,m0x:missile0Pixel,m0lp:missile0LineSpritePointer,m0a:missile0Alt,m0af:missile0AltFrom,m0al:missile0AltLength,m0ao:missile0AltCopyOffset,m0c:missile0Color,m1e:missile1Enabled,m1x:missile1Pixel,m1lp:missile1LineSpritePointer,m1a:missile1Alt,m1af:missile1AltFrom,m1al:missile1AltLength,m1ao:missile1AltCopyOffset,m1c:missile1Color,hmh:hMoveHitBlank,hmc:hMoveHitClock,hmlh:hMoveLateHit,hmlb:hMoveLateHitBlank,co:collisions,cop:collisionsPossible,cod:debugNoCollisions,cbl:controlsButtonsLatched,j0p:controlsJOY0ButtonPressed,j1p:controlsJOY1ButtonPressed,pcg:paddleCapacitorsGrounded,pd0:paddle0Position,pd0c:paddle0CapacitorCharge,pd1:paddle1Position,pd1c:paddle1CapacitorCharge,CTRLPF:CTRLPF,COLUPF:COLUPF,COLUBK:COLUBK,PF0:PF0,PF1:PF1,PF2:PF2,ENABL:ENABL,ENABLd:ENABLd,VDELBL:VDELBL,NUSIZ0:NUSIZ0,COLUP0:COLUP0,REFP0:REFP0,GRP0:GRP0,GRP0d:GRP0d,VDELP0:VDELP0,NUSIZ1:NUSIZ1,COLUP1:COLUP1,REFP1:REFP1,GRP1:GRP1,GRP1d:GRP1d,VDELP1:VDELP1,ENAM0:ENAM0,RESMP0:RESMP0,ENAM1:ENAM1,RESMP1:RESMP1,HMP0:HMP0,HMP1:HMP1,HMM0:HMM0,HMM1:HMM1,HMBL:HMBL,AUDC0:AUDC0,AUDC1:AUDC1,AUDF0:AUDF0,AUDF1:AUDF1,AUDV0:AUDV0,AUDV1:AUDV1};return t&&(e.dl=debugLevel),e},this.loadState=function(t){changeClockPrevLine=t.ccp,jt.Util.restoreStringBase64ToInt32BitArray(t.lpx,linePixels),vSyncOn=t.vs,vBlankOn=t.vb,playfieldEnabled=t.pfe,playfieldPatternL=0|t.pfl,playfieldPatternR=0|t.pfr,playfieldColor=0|t.pfc,playfieldLeftColor=0|t.pflc,playfieldRightColor=0|t.pfrc,playfieldBackground=0|t.pfb,playfieldReflected=t.pfrl,playfieldScoreMode=t.pfsc,playfieldPriority=t.pfp,ballEnabled=t.be,ballPixel=0|t.bx,ballLineSpritePointer=0|t.blp,ballColor=0|t.bc,player0Enabled=t.p0e,player0Pixel=0|t.p0x,player0LineSpritePointer=0|t.p0lp,player0Alt=0|t.p0a,player0AltFrom=0|t.p0af,player0AltLength=0|t.p0al,player0AltCopyOffset=0|t.p0ao,jt.Util.arrayFill(player0AltControl,0),player0Color=0|t.p0c,player1Enabled=t.p1e,player1Pixel=0|t.p1x,player1LineSpritePointer=0|t.p1lp,player1Alt=0|t.p1a,player1AltFrom=0|t.p1af,player1AltLength=0|t.p1al,player1AltCopyOffset=0|t.p1ao,jt.Util.arrayFill(player1AltControl,0),player1Color=0|t.p1c,missile0Enabled=t.m0e,missile0Pixel=0|t.m0x,missile0LineSpritePointer=0|t.m0lp,missile0Alt=0|t.m0a,missile0AltFrom=0|t.m0af,missile0AltLength=0|t.m0al,missile0AltCopyOffset=0|t.m0ao,jt.Util.arrayFill(missile0AltControl,0),missile0Color=0|t.m0c,missile1Enabled=t.m1e,missile1Pixel=0|t.m1x,missile1LineSpritePointer=0|t.m1lp,missile1Alt=0|t.m1a,missile1AltFrom=0|t.m1af,missile1AltLength=0|t.m1al,missile1AltCopyOffset=0|t.m1ao,jt.Util.arrayFill(missile1AltControl,0),missile1Color=0|t.m1c,hMoveHitBlank=t.hmh,hMoveHitClock=0|t.hmc,hMoveLateHit=t.hmlh,hMoveLateHitBlank=t.hmlb,collisions=0|t.co,collisionsPossible=0|t.cop,void 0!==t.cod&&(debugNoCollisions=t.cod),void 0!==t.cbl&&(controlsButtonsLatched=t.cbl,controlsJOY0ButtonPressed=t.j0p,controlsJOY1ButtonPressed=t.j1p,paddleCapacitorsGrounded=t.pcg,paddle0Position=t.pd0,paddle0CapacitorCharge=t.pd0c,paddle1Position=t.pd1,paddle1CapacitorCharge=t.pd1c),CTRLPF=0|t.CTRLPF,COLUPF=0|t.COLUPF,COLUBK=0|t.COLUBK,PF0=0|t.PF0,PF1=0|t.PF1,PF2=0|t.PF2,ENABL=0|t.ENABL,ENABLd=0|t.ENABLd,VDELBL=0|t.VDELBL,NUSIZ0=0|t.NUSIZ0,COLUP0=0|t.COLUP0,REFP0=0|t.REFP0,GRP0=0|t.GRP0,GRP0d=0|t.GRP0d,VDELP0=0|t.VDELP0,NUSIZ1=0|t.NUSIZ1,COLUP1=0|t.COLUP1,REFP1=0|t.REFP1,GRP1=0|t.GRP1,GRP1d=0|t.GRP1d,VDELP1=0|t.VDELP1,ENAM0=0|t.ENAM0,RESMP0=0|t.RESMP0,ENAM1=0|t.ENAM1,RESMP1=0|t.RESMP1,HMP0=0|t.HMP0,HMP1=0|t.HMP1,HMM0=0|t.HMM0,HMM1=0|t.HMM1,HMBL=0|t.HMBL,AUDC0=0|t.AUDC0,audioSignal.getChannel0().setControl(15&AUDC0),AUDC1=0|t.AUDC1,audioSignal.getChannel1().setControl(15&AUDC1),AUDF0=0|t.AUDF0,audioSignal.getChannel0().setDivider(1+(31&AUDF0)),AUDF1=0|t.AUDF1,audioSignal.getChannel1().setDivider(1+(31&AUDF1)),AUDV0=0|t.AUDV0,audioSignal.getChannel0().setVolume(15&AUDV0),AUDV1=0|t.AUDV1,audioSignal.getChannel1().setVolume(15&AUDV1),void 0!==t.dl?this.debug(t.dl):debug&&debugSetColors()};var bus,clock,changeClock,changeClockPrevLine,renderClock,palette,HBLANK_DURATION=68,LINE_WIDTH=228,VBLANK_COLOR=4278190080,HBLANK_COLOR=4261412864,VSYNC_COLOR=4292730333,DEBUG_P0_COLOR=4278190335,DEBUG_P0_RES_COLOR=4280427195,DEBUG_P0_GR_COLOR=4279308663,DEBUG_P1_COLOR=4294901760,DEBUG_P1_RES_COLOR=4290454050,DEBUG_P1_GR_COLOR=4285993233,DEBUG_M0_COLOR=4284901119,DEBUG_M1_COLOR=4294927974,DEBUG_PF_COLOR=4282681412,DEBUG_PF_GR_COLOR=4281589043,DEBUG_BK_COLOR=4281549875,DEBUG_BL_COLOR=4278255615,DEBUG_MARKS_COLOR=4280295456,DEBUG_HBLANK_COLOR=4282664004,DEBUG_VBLANK_COLOR=4280953386,DEBUG_WSYNC_COLOR=4287103112,DEBUG_HMOVE_COLOR=4294967295,DEBUG_ALT_COLOR=4289374720,READ_ADDRESS_MASK=15,WRITE_ADDRESS_MASK=63,P0C=-63489,P1C=-34689,M0C=-17521,M1C=-8781,PFC=-4395,BLC=-2199,cpu=pCpu,pia=pPia,powerOn=!1,linePixels=new Uint32Array(LINE_WIDTH),vSyncOn=!1,vBlankOn=!1,vBlankColor=VBLANK_COLOR,hBlankColor=HBLANK_COLOR,playfieldEnabled=!1,playfieldPatternL=0,playfieldPatternR=0,playfieldColor=4278190080,playfieldLeftColor=4278190080,playfieldRightColor=4278190080,playfieldBackground=4278190080,playfieldReflected=!1,playfieldScoreMode=!1,playfieldPriority=!1,ballEnabled=!1,ballPixel=0,ballLineSpritePointer=0,ballColor=4278190080,player0Enabled=!1,player0Pixel=0,player0LineSpritePointer=0,player0Alt=0,player0AltFrom=0,player0AltLength=0,player0AltCopyOffset=0,player0AltControl=new Uint32Array(4096),player0Color=4278190080,player1Enabled=!1,player1Pixel=0,player1LineSpritePointer=0,player1Alt=0,player1AltFrom=0,player1AltLength=0,player1AltCopyOffset=0,player1AltControl=new Uint32Array(4096),player1Color=4278190080,missile0Enabled=!1,missile0Pixel=0,missile0LineSpritePointer=0,missile0Alt=0,missile0AltFrom=0,missile0AltLength=0,missile0AltCopyOffset=0,missile0AltControl=new Uint32Array(32),missile0Color=4278190080,missile1Enabled=!1,missile1Pixel=0,missile1LineSpritePointer=0,missile1Alt=0,missile1AltFrom=0,missile1AltLength=0,missile1AltCopyOffset=0,missile1AltControl=new Uint32Array(32),missile1Color=4278190080,hMoveHitBlank=!1,hMoveHitClock=0,hMoveLateHit=!1,hMoveLateHitBlank=!1,collisions=0,collisionsPossible=0,controlsButtonsLatched=!1,controlsJOY0ButtonPressed=!1,controlsJOY1ButtonPressed=!1,paddleCapacitorsGrounded=!1,paddle0Position=-1,paddle0CapacitorCharge=0,paddle1Position=-1,paddle1CapacitorCharge=0,debug=!1,debugLevel=0,debugNoCollisions=!1,debugPixels=new Uint32Array(LINE_WIDTH),playerLineSprites=new Uint8Array(262144),missileBallLineSprites=new Uint8Array(2048),playerCopyLengthPerShape=new Uint8Array([13,13,13,13,13,22,13,38]),playerScanStartPerShape=new Uint8Array([5,5,5,5,5,6,5,6]),playerPixelSizePerShape=new Uint8Array([1,1,1,1,1,2,1,4]),playerCopyOffsetsReset=new Uint8Array(1280),playerScanOffsetsShape=new Uint8Array(1280),missileCopyOffsetsReset=new Uint8Array(5120),missileScanOffsetsShape=new Uint8Array(5120),objectsLineSpritePointerDeltaToSingleCopy=new Uint16Array([0,64,128,192,256,0,384,0]),missileCenterOffsetsPerPlayerSize=new Uint8Array([5,5,5,5,5,10,5,18]),videoSignal=new jt.VideoSignal,audioSignal=new jt.TiaAudio(audioSocket),INPT0=0,INPT1=0,INPT2=0,INPT3=0,INPT4=0,INPT5=0,CTRLPF=0,COLUPF=0,COLUBK=0,PF0=0,PF1=0,PF2=0,ENABL=0,ENABLd=0,VDELBL=0,NUSIZ0=0,COLUP0=0,REFP0=0,GRP0=0,GRP0d=0,VDELP0=0,NUSIZ1=0,COLUP1=0,REFP1=0,GRP1=0,GRP1d=0,VDELP1=0,ENAM0=0,RESMP0=0,ENAM1=0,RESMP1=0,HMP0=0,HMP1=0,HMM0=0,HMM1=0,HMBL=0,AUDC0=0,AUDC1=0,AUDF0=0,AUDF1=0,AUDV0=0,AUDV1=0;init(),self.eval=function(code){return eval(code)}},jt.Bus=function(t,e,n,i){"use strict";this.powerOn=function(){null!=l&&l.powerOn(),s.powerOn(),a.powerOn(),r.powerOn(),o.powerOn()},this.powerOff=function(){o.powerOff(),r.powerOff(),a.powerOff(),s.powerOff()},this.setCartridge=function(t){(l=t)&&(u=0,l.connectBus(this)),d=l&&l.needsBusMonitoring()},this.getCartridge=function(){return l},this.getTia=function(){return o},this.clockPulse=function(){a.clockPulse(),r.clockPulse()},this.read=function(t){return d&&l.monitorBusBeforeRead(t),(t&f)===$?l?u=l.read(t):u:u=(t&h)===_?s.read(t):(t&v)===S?a.read(t):63&u|o.read(t)},this.write=function(t,e){d&&l.monitorBusBeforeWrite(t,e),u=e,(t&p)===g?o.write(t,e):(t&h)===_?s.write(t,e):(t&v)===S?a.write(t,e):l&&l.write(t,e)},this.saveState=function(){return{d:u}},this.loadState=function(t){u=t.d};var r,o,a,s,l,c,d=!1,u=256*Math.random()|0,f=4096,$=4096,h=4736,_=128,p=4224,g=0,v=4736,S=640;c=this,r=t,o=e,a=n,s=i,r.connectBus(c),o.connectBus(c),a.connectBus(c)},jt.AtariConsole=function(mainVideoClock){"use strict";function init(){mainComponentsCreate(),socketsCreate()}function videoFrame(){userPaused&&userPauseMoreFrames--<=0||(videoStandardAutoDetectionInProgress&&videoStandardAutoDetectionTry(),tia.frame())}function vSynchToggleMode(){if(-1===vSynchMode)return void self.showOSD("V-Synch is DISABLED / UNSUPPORTED",!0,!0);vSynchMode=vSynchMode?0:1,updateVideoSynchronization(),self.showOSD("V-Synch: "+(vSynchMode?"ON":"OFF"),!0),Javatari.userPreferences.current.vSynch=vSynchMode,Javatari.userPreferences.setDirty(),Javatari.userPreferences.save()}function showVideoStandardMessage(){self.showOSD((videoStandardIsAuto?"AUTO: ":"")+videoStandard.name,!0)}function updateVideoSynchronization(){videoPulldown=1===vSynchMode&&videoStandard.pulldowns[videoClockSocket.getVSynchNativeFrequency()]||videoStandard.pulldowns.TIMER,videoPulldownStep=0,videoClockUpdateSpeed()}function setDefaults(){setVideoStandardAuto(!0),speedControl=1,alternateSpeed=null,videoClockUpdateSpeed(),tia.debug(0),tia.debugNoCollisions(!1)}function videoClockUpdateSpeed(){videoClockSocket.setVSynch(1===vSynchMode);var t=videoPulldown.frequency*(alternateSpeed||speedControl)|0;videoClockSocket.setFrequency(t,videoPulldown.divider),audioSocket.setFps(t/videoPulldown.divider)}function VideoClockSocket(){var t;this.connectClock=function(e){t=e},this.getVSynchNativeFrequency=function(){return t.getVSynchNativeFrequency()},this.setVSynch=function(e){t.setVSynch(e)},this.setFrequency=function(e,n){t.setFrequency(e,n)}}function CartridgeSocket(){this.insert=function(t,e){e&&self.powerIsOn&&self.powerOff(),setCartridge(t),e&&!self.powerIsOn&&self.powerOn(),saveStateSocket.externalStateChange()},this.inserted=function(){return getCartridge()},this.cartridgeInserted=function(t,e){tia.getAudioOutput().cartridgeInserted(t,e),consoleControlsSocket.cartridgeInserted(t,e),saveStateSocket.cartridgeInserted(t,e),tia.getVideoOutput().monitor.cartridgeInserted(t,e)},this.loadCartridgeData=function(t,e,n){},this.saveCartridgeDataFile=function(t){}}function ConsoleControlsSocket(){var t;this.connectControls=function(e){t=e},this.cartridgeInserted=function(e,n){t&&t.cartridgeInserted(e,n)},this.controlStateChanged=function(t,e){self.controlStateChanged(t,e),pia.controlStateChanged(t,e),tia.controlStateChanged(t,e),tia.getVideoOutput().monitor.controlStateChanged(t,e)},this.controlValueChanged=function(t,e){tia.controlValueChanged(t,e)},this.controlsStateReport=function(t){self.controlsStateReport(t),pia.controlsStateReport(t)},this.controlsStatesRedefined=function(){tia.getVideoOutput().monitor.controlsStatesRedefined()},this.firePowerAndUserPauseStateUpdate=function(){t.consolePowerAndUserPauseStateUpdate(self.powerIsOn,userPaused),tia.getVideoOutput().monitor.consolePowerAndUserPauseStateUpdate(self.powerIsOn,userPaused)},this.releaseControllers=function(){t.releaseControllers()},this.controlsClockPulse=function(){t.controlsClockPulse()},this.getControlReport=function(t){switch(t){case jt.ConsoleControls.VIDEO_STANDARD:return{label:videoStandardIsAuto?"Auto":videoStandard.name,active:!videoStandardIsAuto};case jt.ConsoleControls.VSYNCH:return{label:-1===vSynchMode?"DISABL":vSynchMode?"ON":"OFF",active:1===vSynchMode};case jt.ConsoleControls.NO_COLLISIONS:return{label:tia.getDebugNoCollisions()?"ON":"OFF",active:tia.getDebugNoCollisions()};default:return{label:"Unknown",active:!1}}}}function SaveStateSocket(){this.connectMedia=function(e){t=e},this.getMedia=function(){return t},this.cartridgeInserted=function(t){t&&t.connectSaveStateSocket(this)},this.externalStateChange=function(){t.externalStateChange()},this.saveState=function(n){if(self.powerIsOn){var i=saveState();i.v=e,t.saveState(n,i)?self.showOSD("State "+n+" saved",!0):self.showOSD("State "+n+" save failed",!0)}},this.loadState=function(n){var i=t.loadState(n);return i?i.v!==e?void self.showOSD("State "+n+" load failed, wrong version",!0):(self.powerIsOn||self.powerOn(!0),loadState(i),void self.showOSD("State "+n+" loaded",!0)):void self.showOSD("State "+n+" not found",!0)},this.saveStateFile=function(){if(self.powerIsOn){var n=cartridgeSocket.inserted()&&cartridgeSocket.inserted().rom.info.l,i=saveState();i.v=e,t.saveStateFile(n,i)?self.showOSD("State Cartridge saved",!0):self.showOSD("State file save failed",!0)}},this.loadStateFile=function(n){var i=t.loadStateFile(n);if(i)return i.v!==e?(self.showOSD("State file load failed, wrong version",!0),!0):(self.powerIsOn||self.powerOn(),loadState(i),self.showOSD("State file loaded",!0),!0)};var t,e=2}function AudioSocket(){this.connectMonitor=function(e){t=e;for(var i=n.length-1;i>=0;i--)t.connectAudioSignal(n[i])},this.connectAudioSignal=function(i){n.indexOf(i)>=0||(jt.Util.arrayAdd(n,i),this.flushAllSignals(),i.setFps(e),t&&t.connectAudioSignal(i))},this.disconnectAudioSignal=function(e){jt.Util.arrayRemoveAllElement(n,e),t&&t.disconnectAudioSignal(e)},this.audioClockPulse=function(){for(var t=n.length-1;t>=0;--t)n[t].audioClockPulse()},this.audioFinishFrame=function(){for(var t=n.length-1;t>=0;--t)n[t].audioFinishFrame()},this.muteAudio=function(){t&&t.mute()},this.unMuteAudio=function(){t&&t.unMute()},this.setFps=function(t){e=t;for(var i=n.length-1;i>=0;--i)n[i].setFps(e)},this.pauseAudio=function(){t&&t.pause()},this.unpauseAudio=function(){t&&t.unpause()},this.flushAllSignals=function(){for(var t=n.length-1;t>=0;--t)n[t].flush()};var t,e,n=[]}var self=this;this.socketsConnected=function(){setDefaults()},this.powerOn=function(t){this.powerIsOn&&this.powerOff(),bus.powerOn(),this.powerIsOn=!0,consoleControlsSocket.controlsStatesRedefined(),updateVideoSynchronization(),videoStandardAutoDetectionStart(),t||consoleControlsSocket.firePowerAndUserPauseStateUpdate()},this.powerOff=function(){bus.powerOff(),this.powerIsOn=!1,consoleControlsSocket.controlsStatesRedefined(),userPaused?this.userPause(!1):consoleControlsSocket.firePowerAndUserPauseStateUpdate()},this.userPowerOn=function(){isLoading||(this.powerOn(),bus.getCartridge()||this.showOSD("NO CARTRIDGE INSERTED!",!1,!0))},this.setLoading=function(t){isLoading=t},this.userPause=function(t,e){var n=userPaused;return userPaused!==t&&(userPauseMoreFrames=-1,(userPaused=!!t)&&!e?audioSocket.muteAudio():audioSocket.unMuteAudio(),consoleControlsSocket.firePowerAndUserPauseStateUpdate()),n},this.systemPause=function(t){var e=systemPaused;return systemPaused!==t&&((systemPaused=!!t)?audioSocket.pauseAudio():audioSocket.unpauseAudio()),e},this.isSystemPaused=function(){return systemPaused},this.videoClockPulse=function(){this.videoClockPulseApplyPulldowns(self.videoClockPulseGetNextPulldowns())},this.videoClockPulseApplyPulldowns=function(t){if(self.powerIsOn){for(;t-- >0;)videoFrame();userPaused||audioSocket.audioFinishFrame()}},this.videoClockPulseGetNextPulldowns=function(){return 1===videoPulldown.steps?1:(--videoPulldownStep<0&&(videoPulldownStep=videoPulldown.steps-1),videoPulldown.cadence[videoPulldownStep])},this.getCartridgeSocket=function(){return cartridgeSocket},this.getConsoleControlsSocket=function(){return consoleControlsSocket},this.getVideoOutput=function(){return tia.getVideoOutput()},this.getAudioOutput=function(){return tia.getAudioOutput()},this.getSavestateSocket=function(){return saveStateSocket},this.getVideoClockSocket=function(){return videoClockSocket},this.getAudioSocket=function(){return audioSocket},this.showOSD=function(t,e,n){this.getVideoOutput().showOSD(t,e,n)},this.vSynchSetSupported=function(t){var e=Javatari.userPreferences.current.vSynch;vSynchMode=-1!==Javatari.SCREEN_VSYNCH_MODE&&t?Javatari.SCREEN_VSYNCH_MODE>=0?Javatari.SCREEN_VSYNCH_MODE:null!==e&&e>=0?e:1:-1};var setCartridge=function(t){Javatari.cartridge=t;var e=getCartridge();bus.setCartridge(t),cartridgeSocket.cartridgeInserted(t,e)},getCartridge=function(){return bus.getCartridge()},setVideoStandard=function(t){videoStandard!==t&&(videoStandard=t,tia.setVideoStandard(videoStandard),updateVideoSynchronization())},setVideoStandardAuto=function(t){videoStandardIsAuto=t,t&&(self.powerIsOn?videoStandardAutoDetectionStart():setVideoStandard(jt.VideoStandard.NTSC))},videoStandardAutoDetectionStart=function(){if(videoStandardIsAuto&&!videoStandardAutoDetectionInProgress)return bus.getCartridge()?void(tia.getVideoOutput().monitor&&(videoStandardAutoDetectionInProgress=!0,videoStandardAutoDetectionTries=0,tia.getVideoOutput().monitor.videoStandardDetectionStart())):void setVideoStandard(jt.VideoStandard.NTSC)},videoStandardAutoDetectionTry=function(){videoStandardAutoDetectionTries++;var t=tia.getVideoOutput().monitor.getVideoStandardDetected();!t&&videoStandardAutoDetectionTries<VIDEO_STANDARD_AUTO_DETECTION_FRAMES||(t?t!==videoStandard&&(setVideoStandard(t),showVideoStandardMessage()):self.showOSD("AUTO: FAILED",!0,!0),videoStandardAutoDetectionInProgress=!1)},setVideoStandardForced=function(t){videoStandardIsAuto=!1,setVideoStandard(t)},powerFry=function(){ram.powerFry(),saveStateSocket.externalStateChange()},cycleCartridgeFormat=function(){},saveState=function(t){var e={t:tia.saveState(t),p:pia.saveState(),r:ram.saveState(),b:bus.saveState(),c:cpu.saveState(),ca:getCartridge()&&getCartridge().saveState(),vsa:videoStandardIsAuto,vs:videoStandard.name};return t&&(e.pw=self.powerIsOn,e.up=userPaused,e.upf=userPauseMoreFrames),e};this.saveState=saveState;var loadState=function(t){void 0!==t.pw&&self.powerIsOn!==t.pw&&(t.pw?self.powerOn():self.powerOff()),void 0!==t.up&&self.userPause(t.up),void 0!==t.upf&&(userPauseMoreFrames=t.upf),videoClockUpdateSpeed(),tia.loadState(t.t),pia.loadState(t.p),ram.loadState(t.r),t.b&&bus.loadState(t.b),cpu.loadState(t.c),setCartridge(t.ca&&jt.CartridgeCreator.recreateCartridgeFromSaveState(t.ca,getCartridge())),void 0!==t.vsa&&setVideoStandardAuto(t.vsa),setVideoStandard(jt.VideoStandard[t.vs]),consoleControlsSocket.firePowerAndUserPauseStateUpdate(),consoleControlsSocket.controlsStatesRedefined(),saveStateSocket.externalStateChange()};this.loadState=loadState;var mainComponentsCreate=function(){cpu=new jt.M6502,pia=new jt.Pia,tia=new jt.Tia(cpu,pia),self.tia=tia,ram=new jt.Ram,bus=new jt.Bus(cpu,tia,pia,ram)},socketsCreate=function(){videoClockSocket=new VideoClockSocket,consoleControlsSocket=new ConsoleControlsSocket,cartridgeSocket=new CartridgeSocket,saveStateSocket=new SaveStateSocket,audioSocket=new AudioSocket,tia.getAudioOutput().connectAudioSocket(audioSocket)};this.powerIsOn=!1;var cpu,pia,tia,ram,bus,videoStandard,videoPulldown,videoPulldownStep,videoClockSocket,consoleControlsSocket,cartridgeSocket,saveStateSocket,audioSocket,isLoading=!1,userPaused=!1,userPauseMoreFrames=0,systemPaused=!1,speedControl=1,alternateSpeed=!1,videoStandardIsAuto=!1,videoStandardAutoDetectionInProgress=!1,videoStandardAutoDetectionTries=0,vSynchMode=-1,VIDEO_STANDARD_AUTO_DETECTION_FRAMES=90,SPEEDS=[.05,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.25,1.5,2,3,5,10],SPEED_FAST=10,SPEED_SLOW=.3,controls=jt.ConsoleControls;this.controlStateChanged=function(t,e){if(t===controls.FAST_SPEED)return void(e&&alternateSpeed!==SPEED_FAST?(alternateSpeed=SPEED_FAST,videoClockUpdateSpeed(),self.showOSD("FAST FORWARD",!0)):e||alternateSpeed!==SPEED_FAST||(alternateSpeed=null,videoClockUpdateSpeed(),self.showOSD(null,!0)));if(t===controls.SLOW_SPEED)return void(e&&alternateSpeed!==SPEED_SLOW?(alternateSpeed=SPEED_SLOW,videoClockUpdateSpeed(),self.showOSD("SLOW MOTION",!0)):e||alternateSpeed!==SPEED_SLOW||(alternateSpeed=null,videoClockUpdateSpeed(),self.showOSD(null,!0)));if(e)switch(t){case controls.POWER:self.powerIsOn?self.powerOff():self.userPowerOn();break;case controls.POWER_OFF:self.powerIsOn&&self.powerOff();break;case controls.POWER_FRY:powerFry();break;case controls.PAUSE:return self.userPause(!userPaused,!1),void self.getVideoOutput().showOSD(userPaused?"PAUSE":"RESUME",!0);case controls.PAUSE_AUDIO_ON:return self.userPause(!userPaused,!0),void self.getVideoOutput().showOSD(userPaused?"PAUSE with AUDIO ON":"RESUME",!0);case controls.FRAME:return void(userPaused&&(userPauseMoreFrames=1));case controls.INC_SPEED:case controls.DEC_SPEED:case controls.NORMAL_SPEED:case controls.MIN_SPEED:var n=SPEEDS.indexOf(speedControl);t===controls.INC_SPEED&&n<SPEEDS.length-1?++n:t===controls.DEC_SPEED&&n>0?--n:t===controls.MIN_SPEED?n=0:t===controls.NORMAL_SPEED&&(n=SPEEDS.indexOf(1)),speedControl=SPEEDS[n],self.showOSD("Speed: "+(100*speedControl|0)+"%",!0),videoClockUpdateSpeed();break;case controls.SAVE_STATE_0:case controls.SAVE_STATE_1:case controls.SAVE_STATE_2:case controls.SAVE_STATE_3:case controls.SAVE_STATE_4:case controls.SAVE_STATE_5:case controls.SAVE_STATE_6:case controls.SAVE_STATE_7:case controls.SAVE_STATE_8:case controls.SAVE_STATE_9:case controls.SAVE_STATE_10:case controls.SAVE_STATE_11:case controls.SAVE_STATE_12:var i=self.systemPause(!0);saveStateSocket.saveState(255&t),i||self.systemPause(!1);break;case controls.SAVE_STATE_FILE:i=self.systemPause(!0),saveStateSocket.saveStateFile(),i||self.systemPause(!1);break;case controls.LOAD_STATE_0:case controls.LOAD_STATE_1:case controls.LOAD_STATE_2:case controls.LOAD_STATE_3:case controls.LOAD_STATE_4:case controls.LOAD_STATE_5:case controls.LOAD_STATE_6:case controls.LOAD_STATE_7:case controls.LOAD_STATE_8:case controls.LOAD_STATE_9:case controls.LOAD_STATE_10:case controls.LOAD_STATE_11:case controls.LOAD_STATE_12:i=self.systemPause(!0),saveStateSocket.loadState(255&t),i||self.systemPause(!1);break;case controls.VIDEO_STANDARD:videoStandardIsAuto?setVideoStandardForced(jt.VideoStandard.NTSC):videoStandard==jt.VideoStandard.NTSC?setVideoStandardForced(jt.VideoStandard.PAL):setVideoStandardAuto(!0),showVideoStandardMessage();break;case controls.VSYNCH:vSynchToggleMode();break;case controls.CARTRIDGE_FORMAT:cycleCartridgeFormat();break;case controls.DEFAULTS:setDefaults(),self.showOSD("Default Settings",!0)}},this.controlsStateReport=function(t){t[controls.POWER]=self.powerIsOn},this.eval=function(str){return eval(str)},init()},jt.JoystickButtons={J_UP:{button:"J_UP",mask:1,n:"UP"},J_DOWN:{button:"J_DOWN",mask:2,n:"DOWN"},J_LEFT:{button:"J_LEFT",mask:4,n:"LEFT"},J_RIGHT:{button:"J_RIGHT",mask:8,n:"RIGHT"},J_A:{button:"J_A",mask:16,n:"A"},J_B:{button:"J_B",mask:32,n:"B"},J_AB:{button:"J_AB",mask:48,n:"AB"},J_X:{button:"J_X",n:"X"},J_Y:{button:"J_Y",n:"Y"},J_L:{button:"J_L",n:"L"},J_R:{button:"J_R",n:"R"},J_BACK:{button:"J_BACK",n:"BACK"},J_START:{button:"J_START",n:"START"}},jt.ConsoleControls={JOY0_UP:11,JOY0_DOWN:12,JOY0_LEFT:13,JOY0_RIGHT:14,JOY0_BUTTON:15,JOY1_UP:21,JOY1_DOWN:22,JOY1_LEFT:23,JOY1_RIGHT:24,JOY1_BUTTON:25,PADDLE0_BUTTON:41,PADDLE1_BUTTON:42,PADDLE0_POSITION:16384,PADDLE1_POSITION:16896,POWER:51,BLACK_WHITE:52,SELECT:53,RESET:54,DIFFICULTY0:55,DIFFICULTY1:56,POWER_OFF:57,POWER_FRY:58,CARTRIDGE_FORMAT:91,DEBUG:101,TRACE:102,SHOW_INFO:103,NO_COLLISIONS:104,PAUSE:105,PAUSE_AUDIO_ON:106,FRAME:107,FAST_SPEED:111,SLOW_SPEED:112,INC_SPEED:113,DEC_SPEED:114,NORMAL_SPEED:115,MIN_SPEED:116,VIDEO_STANDARD:123,VSYNCH:124,DEFAULTS:130,SAVE_STATE_0:256,SAVE_STATE_1:257,SAVE_STATE_2:258,SAVE_STATE_3:259,SAVE_STATE_4:260,SAVE_STATE_5:261,SAVE_STATE_6:262,SAVE_STATE_7:263,SAVE_STATE_8:264,SAVE_STATE_9:265,SAVE_STATE_10:266,SAVE_STATE_11:267,SAVE_STATE_12:268,LOAD_STATE_0:512,LOAD_STATE_1:513,LOAD_STATE_2:514,LOAD_STATE_3:515,LOAD_STATE_4:516,LOAD_STATE_5:517,LOAD_STATE_6:518,LOAD_STATE_7:519,LOAD_STATE_8:520,LOAD_STATE_9:521,LOAD_STATE_10:522,LOAD_STATE_11:523,LOAD_STATE_12:524,SAVE_STATE_FILE:201},jt.ROM=function(t,e,n,i){"use strict";this.source=t,this.content=e,this.info=n||jt.CartridgeCreator.produceInfo(this,i),this.saveState=function(t){return{s:this.source,i:this.info,c:t?jt.Util.compressInt8BitArrayToStringBase64(this.content):null}}},jt.ROM.loadState=function(t){"use strict";var e=t.c?jt.Util.uncompressStringBase64ToInt8BitArray(t.c):null;return new jt.ROM(t.s,e,t.i)},jt.CartridgeDatabase={uncompress:function(){jt.CartridgeDatabase=JSON.parse(jt.Util.uncompressStringBase64ToString(this.data))},data:"q1YqSy0qzszPU7IyMjA0NzA2NKgFAA=="},jt.Cartridge=function(){"use strict";this.powerOn=function(){},this.powerOff=function(){},this.connectBus=function(t){},this.connectSaveStateSocket=function(t){},this.read=function(t){},this.write=function(t,e){},this.getDataDesc=function(){return null},this.needsBusMonitoring=function(){return!1},this.monitorBusBeforeRead=function(t){},this.monitorBusBeforeWrite=function(t,e){},this.needsAudioClock=function(){return!1},this.audioClockPulse=function(){},this.reinsertROMContent=function(){this.rom.content||(this.rom.content=this.bytes||[])},this.format=null,this.rom=null,this.bytes=null,this.saveState=function(){},this.loadState=function(t){}},jt.Cartridge.base=new jt.Cartridge,jt.Cartridge4K=function(t,e){"use strict";this.read=function(t){return n[t&i]},this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(n)}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),n=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,n),this.bytes=n};var n,i=4095;t&&function(i){i.rom=t,i.format=e,n=Array(4096),i.bytes=n;for(var r=t.content.length,o=0;o<n.length;o+=r)jt.Util.arrayCopy(t.content,0,n,o,r)}(this)},jt.Cartridge4K.prototype=jt.Cartridge.base,jt.Cartridge4K.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge4K;return n.loadState(t),n},jt.Cartridge2K_CV=function(t,e){"use strict";this.read=function(t){var e=n(t);return e<1024?r[e]:i[e]},this.write=function(t,e){var i=n(t);i>=1024&&i<=2047&&(r[i-1024]=e)};var n=function(t){return t&o};this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(i),ra:jt.Util.compressInt8BitArrayToStringBase64(r)}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),i=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,i),this.bytes=i,r=jt.Util.uncompressStringBase64ToInt8BitArray(t.ra,r)};var i,r=jt.Util.arrayFill(Array(1024),0),o=4095;t&&function(n){n.rom=t,n.format=e,i=Array(4096),n.bytes=i;for(var r=t.content.length,o=0;o<i.length;o+=r)jt.Util.arrayCopy(t.content,0,i,o,r)}(this)},jt.Cartridge2K_CV.prototype=jt.Cartridge.base,jt.Cartridge2K_CV.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge2K_CV;return n.loadState(t),n},jt.CartridgeBankedByMaskedRange=function(t,e,n,i,r){"use strict";this.read=function(t){var e=o(t);return _&&e>=d&&e<2*d?u[e-d]:a[h+e]},this.write=function(t,e){var n=o(t);n<d&&(_||c)&&(_||(_=!0),u[n]=e)};var o=function(t){var e=t&p;return e>=s&&e<=l&&(h=g*(e-s)),e};this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(a),bo:h,bb:s,es:d,tb:l,s:0|_,sa:0|c,e:u&&jt.Util.compressInt8BitArrayToStringBase64(u)}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),a=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,a),this.bytes=a,h=t.bo,s=t.bb,d=t.es,l=t.tb,_=!!t.s,c=!!t.sa,u=t.e&&jt.Util.uncompressStringBase64ToInt8BitArray(t.e,u)};var a,s,l,c,d,u,f,$,h=0,_=!1,p=4095,g=4096;t&&(f=this,f.rom=t,f.format=e,a=t.content,f.bytes=a,$=a.length/g,l=(s=n)+$-1,d=r,null==i||void 0==i?(_=!1,c=!0):(_=!!i,c=!1),u=!1!==i?jt.Util.arrayFill(Array(d),0):null)},jt.CartridgeBankedByMaskedRange.prototype=jt.Cartridge.base,jt.CartridgeBankedByMaskedRange.recreateFromSaveState=function(t,e){var n=e||new jt.CartridgeBankedByMaskedRange;return n.loadState(t),n},jt.Cartridge8K_E0=function(t,e){"use strict";this.read=function(t){var e=n(t);return e<1024?i[o+e]:e<2048?i[a+e-1024]:e<3072?i[s+e-2048]:i[4096+e]},this.write=function(t,e){n(t)};var n=function(t){var e=t&l;return e>=4064&&e<=4087&&(e<=4071?o=1024*(e-4064):e<=4079?a=1024*(e-4072):e<=4087&&(s=1024*(e-4080))),e};this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(i),s0:o,s1:a,s2:s}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),i=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,i),this.bytes=i,o=t.s0,a=t.s1,s=t.s2};var i,r,o=0,a=0,s=0,l=4095;t&&(r=this,r.rom=t,r.format=e,i=t.content,r.bytes=i)},jt.Cartridge8K_E0.prototype=jt.Cartridge.base,jt.Cartridge8K_E0.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge8K_E0;return n.loadState(t),n},jt.Cartridge64K_F0=function(t,e){"use strict";this.read=function(t){var e=n(t);return i[o+e]},this.write=function(t,e){n(t)};var n=function(t){var e=t&a;return e==c&&(o+=l)>=s&&(o=0),e};this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(i),bo:o}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),i=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,i),this.bytes=i,o=t.bo};var i,r,o=0,a=4095,s=65536,l=4096,c=4080;t&&(r=this,r.rom=t,r.format=e,i=t.content,r.bytes=i)},jt.Cartridge64K_F0.prototype=jt.Cartridge.base,jt.Cartridge64K_F0.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge64K_F0;return n.loadState(t),n},jt.Cartridge8K_FE=function(t,e){"use strict";this.read=function(t){var e=n(t);return i[o+e]},this.write=function(t,e){n(t)};var n=function(t){return 0!=(8192&t)?0!==o&&(o=0):o!=s&&(o=s),t&a};this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(i),bo:o}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),i=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,i),this.bytes=i,o=t.bo};var i,r,o=0,a=4095,s=4096;t&&(r=this,r.rom=t,r.format=e,i=t.content,r.bytes=i)},jt.Cartridge8K_FE.prototype=jt.Cartridge.base,jt.Cartridge8K_FE.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge8K_FE;return n.loadState(t),n},jt.Cartridge16K_E7=function(t,e){"use strict";this.read=function(t){var e=n(t);return e>=2304&&e<=2559?s[c+e-2304]:l&&e>=1024&&e<=2047?s[e-1024]:e<f?i[o+e]:i[$+e]},this.write=function(t,e){var i=n(t);i>=2048&&i<=2303?s[c+i-2048]=e:l&&i<=1023&&(s[i]=e)};var n=function(t){var e=t&d;return e>=4064&&e<=4075&&(e<=4070?o=u*(e-4064):4071==e?l=!0:e<=4075&&(c=a+h*(e-4072))),e};this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(i),bo:o,rs:l,ro:c,ra:jt.Util.compressInt8BitArrayToStringBase64(s)}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),i=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,i),this.bytes=i,o=t.bo,l=t.rs,c=t.ro,s=jt.Util.uncompressStringBase64ToInt8BitArray(t.ra,s)};var i,r,o=0,a=1024,s=jt.Util.arrayFill(Array(2048),0),l=!1,c=a,d=4095,u=2048,f=2048,$=16384-u-f,h=256;t&&(r=this,r.rom=t,r.format=e,i=t.content,r.bytes=i)},jt.Cartridge16K_E7.prototype=jt.Cartridge.base,jt.Cartridge16K_E7.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge16K_E7;return n.loadState(t),n},jt.Cartridge10K_DPCa=function(t,e){"use strict";this.powerOn=function(){C=_,A=0},this.connectBus=function(t){d=t.getTia().getAudioOutput().getChannel0()},this.needsAudioClock=function(){return!0},this.read=function(t){var e=n(t);return e<=63||e>=2048&&e<=2111?r(255&e):u[g+e]},this.write=function(t,e){var i=n(t);(i>=64&&i<=127||i>=2112&&i<=2175)&&o(255&i,e)},this.audioClockPulse=function(){if((A+C|0)>(0|A))for(var t=5;t<=7;t++)b[t]&&(S[t]--,255==(255&S[t])&&a(t,65280&S[t]|m[t]),l(t),O||(O=!0));A+=C,O&&(i(),d.setVolume(y))};var n=function(t){var e=t&h;return 4088===e?g=0:4089===e&&(g=4096),e},i=function(){y=$[(b[5]?4&T[5]:0)|(b[6]?2&T[6]:0)|(b[7]?1&T[7]:0)],O=!1},r=function(t){var e;return t>=0&&t<=3?(c(),v):t>=4&&t<=7?(O&&i(),y):t>=8&&t<=15?(e=u[p-S[t-8]],s(t-8),e):t>=16&&t<=23?(e=u[p-S[t-16]]&T[t-16],s(t-16),e):t>=24&&t<=31?(e=u[p-S[t-24]]&T[t-24],s(t-24),e=240&e|15&e):t>=32&&t<=39?(e=u[p-S[t-32]]&T[t-32],s(t-32),e=128&e|64&e|32&e|16&e|8&e|4&e|2&e|1&e):t>=40&&t<=47?(e=u[p-S[t-40]]&T[t-40],s(t-40),e=255&(e>>>1|e<<7)):t>=48&&t<=55?(e=u[p-S[t-48]]&T[t-48],s(t-48),e=255&(e<<1|e>>7&1)):t>=56&&t<=63?T[t-56]:0},o=function(t,e){if(t>=64&&t<=71){var n=t-64;return m[n]=e,void((255&S[n])===m[n]&&(T[n]=255))}return t>=72&&t<=79?(E[t-72]=e,void(T[t-72]=0)):t>=80&&t<=87?void a(t-80,65280&S[t-80]|255&e):t>=88&&t<=91?void a(t-88,255&S[t-88]|(7&e)<<8):92==t?void a(4,255&S[4]|(7&e)<<8):t>=93&&t<=95?(a(t-88,(255&S[t-88])+((7&e)<<8)),void(b[t-88]=(16&e)>>>4)):void(t>=96&&t<=103||t>=112&&t<=119&&(v=0))},a=function(t,e){S[t]=e},s=function(t){var e=S[t]-1;e<0&&(e=2047),a(t,e),l(t)},l=function(t){var e=255&S[t];e==m[t]?T[t]=255:e==E[t]&&(T[t]=0)},c=function(){255==(v=255&(v<<1|1&~(v>>7^v>>5^v>>4^v>>3)))&&(v=0)};this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(u),bo:g,rn:v,fp:jt.Util.compressInt8BitArrayToStringBase64(S),fs:jt.Util.compressInt8BitArrayToStringBase64(m),fe:jt.Util.compressInt8BitArrayToStringBase64(E),fm:jt.Util.compressInt8BitArrayToStringBase64(T),a:jt.Util.compressInt8BitArrayToStringBase64(b)}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),u=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,u),this.bytes=u,g=t.bo,v=t.rn,S=jt.Util.uncompressStringBase64ToInt8BitArray(t.fp,S),m=jt.Util.uncompressStringBase64ToInt8BitArray(t.fs,m),E=jt.Util.uncompressStringBase64ToInt8BitArray(t.fe,E),T=jt.Util.uncompressStringBase64ToInt8BitArray(t.fm,T),b=jt.Util.uncompressStringBase64ToInt8BitArray(t.a,b)};var d,u,f,$=[0,5,5,10,5,10,10,15],h=4095,_=.62,p=10239,g=0,v=0,S=jt.Util.arrayFill(Array(8),0),m=jt.Util.arrayFill(Array(8),0),E=jt.Util.arrayFill(Array(8),0),T=jt.Util.arrayFill(Array(8),0),b=jt.Util.arrayFill(Array(8),0),C=_,A=0,O=!0,y=0;t&&(f=this,f.rom=t,f.format=e,u=t.content,f.bytes=u)},jt.Cartridge10K_DPCa.prototype=jt.Cartridge.base,jt.Cartridge10K_DPCa.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge10K_DPCa;return n.loadState(t),n},jt.Cartridge24K_28K_32K_FA2=function(t,e,n){"use strict";var i=this;this.connectBus=function(t){d=t},this.connectSaveStateSocket=function(t){u=t},this.read=function(t){var e,n=r(t);if(e=n>=256&&n<512?v[n-256]:f[p+n],n!==C)return e;if(0===m){var i=v[A];if(1===i||2===i)return o(i),64|e}return 0===m?191&e:(l(),0!==m?64|e:191&e)},this.write=function(t,e){var n=r(t);n<256&&(v[n]=e)};var r=function(t){var e=t&T;return e>=g&&e<=$&&(p=_+b*(e-g)),e},o=function(t){m=t,S=0,1===t?a():2===t&&s()},a=function(){if(d.getTia().getVideoOutput().showOSD("Reading from Cartridge Flash Memory...",!0),u){var t=u.getMedia().loadResource(c());t&&(E=jt.Util.uncompressStringBase64ToInt8BitArray(t,E))}jt.Util.arrayCopy(E,0,v)},s=function(){d.getTia().getVideoOutput().showOSD("Writing to Cartridge Flash Memory...",!0),jt.Util.arrayCopy(v,0,E),u&&u.getMedia().saveResource(c(),jt.Util.compressInt8BitArrayToStringBase64(E))},l=function(){++S>140&&(S=0,m=0,v[A]=0,d.getTia().getVideoOutput().showOSD("Done.",!0),u&&u.externalStateChange())},c=function(){return"hfm"+i.rom.info.h};this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(f),rs:_,bo:p,tb:$,e:jt.Util.compressInt8BitArrayToStringBase64(v),ho:m,ht:S}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),f=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,f),this.bytes=f,_=t.rs||0,p=t.bo,$=t.tb,v=jt.Util.uncompressStringBase64ToInt8BitArray(t.e,v),m=t.ho||0,S=t.ht||0};var d,u,f,$,h,_=0,p=0,g=4085,v=jt.Util.arrayFill(Array(256),0),S=0,m=0,E=jt.Util.arrayFill(Array(256),0),T=4095,b=4096,C=4084,A=255;t&&(h=this,h.rom=t,h.format=e,f=t.content,h.bytes=f,p=_=n||0,$=g+(f.length-_)/b-1)},jt.Cartridge24K_28K_32K_FA2.prototype=jt.Cartridge.base,jt.Cartridge24K_28K_32K_FA2.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge24K_28K_32K_FA2;return n.loadState(t),n},jt.CartridgeBankedByBusMonitoring=function(t,e){"use strict";this.needsBusMonitoring=function(){return!0},this.monitorBusBeforeRead=function(t){this.performBankSwitchOnMonitoredAccess(t)},this.monitorBusBeforeWrite=function(t,e){this.performBankSwitchOnMonitoredAccess(t)},this.performBankSwitchOnMonitoredAccess=function(t){}},jt.CartridgeBankedByBusMonitoring.prototype=jt.Cartridge.base,jt.CartridgeBankedByBusMonitoring.base=new jt.CartridgeBankedByBusMonitoring,jt.Cartridge8K_512K_3F=function(t,e){"use strict";this.read=function(t){var e=t&s;return e>=c?n[r+e]:n[a+e]},this.monitorBusBeforeWrite=function(t,e){if(t<=63){var n=255&e;n<=i&&(a=n*l)}},this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(n),bo:a,sm:i,fo:r}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),n=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,n),this.bytes=n,a=t.bo,i=t.sm,r=t.fo};var n,i,r,o,a=0,s=4095,l=2048,c=2048;t&&(o=this,o.rom=t,o.format=e,n=t.content,o.bytes=n,i=(n.length-l)/l-1,r=n.length-2*l)},jt.Cartridge8K_512K_3F.prototype=jt.CartridgeBankedByBusMonitoring.base,jt.Cartridge8K_512K_3F.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge8K_512K_3F;return n.loadState(t),n},jt.Cartridge8K_512K_3E=function(t,e){"use strict";this.read=function(t){var e=n(t);return e>=$?i[o+e]:c>=0&&e<1024?d[c+e]||0:i[l+e]},this.write=function(t,e){if(!(c<0)){var i=n(t);i>=1024&&i<=2047&&(d[c+i-1024]=e)}};var n=function(t){return t&u};this.monitorBusBeforeWrite=function(t,e){if(63===t){var n=255&e;return void(n<=r&&(l=n*f,c=-1))}62===t&&(c=(255&e)*s)},this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(i),bo:l,sm:r,fo:o,ro:c,ra:jt.Util.compressInt8BitArrayToStringBase64(d)}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),i=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,i),this.bytes=i,l=t.bo,r=t.sm,o=t.fo,c=t.ro,d=jt.Util.uncompressStringBase64ToInt8BitArray(t.ra,d)};var i,r,o,a,s=1024,l=0,c=-1,d=jt.Util.arrayFill(Array(s),0),u=4095,f=2048,$=2048;t&&(a=this,a.rom=t,a.format=e,i=t.content,a.bytes=i,r=(i.length-f)/f-1,o=i.length-2*f)},jt.Cartridge8K_512K_3E.prototype=jt.CartridgeBankedByBusMonitoring.base,jt.Cartridge8K_512K_3E.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge8K_512K_3E;return n.loadState(t),n},jt.Cartridge8K_256K_SB=function(t,e){"use strict";this.read=function(t){return n[o+(t&a)]},this.performBankSwitchOnMonitoredAccess=function(t){if(2048==(6144&t)){var e=127&t;e>i||(o=e*s)}},this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(n),bo:o,m:i}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),n=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,n),this.bytes=n,o=t.bo,i=t.m};var n,i,r,o=0,a=4095,s=4096;t&&(r=this,r.rom=t,r.format=e,n=t.content,r.bytes=n,i=n.length/s-1)},jt.Cartridge8K_256K_SB.prototype=jt.CartridgeBankedByBusMonitoring.base,jt.Cartridge8K_256K_SB.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge8K_256K_SB;return n.loadState(t),n},jt.Cartridge8K_64K_AR=function(t,e){"use strict";this.powerOn=function(){a(0),R=0},this.connectBus=function(t){n=t},this.read=function(t){return o<F?i[h+o]:i[_+o-F]},this.write=function(t,e){_===U&&o>=N&&o<N+256&&s(o-N)},this.performBankSwitchOnMonitoredAccess=function(t){return o=t&K,8184==(t&=8191)?void a(p):S>0?void(t!==v&&(v=t,0==--S&&(t&V)===H&&(o<F?i[h+o]=p:_<U&&(i[_+o-F]=p)))):void((t&V)===H&&o<=255&&(p=o,g&&(v=t,S=5)))};var n,i,r,o,a=function(t){switch(t>>2&7){case 0:case 4:h=2*F,_=U;break;case 1:h=0*F,_=U;break;case 2:h=2*F,_=0*F;break;case 3:h=0*F,_=2*F;break;case 5:h=1*F,_=U;break;case 6:h=2*F,_=1*F;break;case 7:h=1*F,_=2*F;break;default:throw Error("Invalid bank configuration")}S=0,g=0!=(2&t),m=0==(1&t)},s=function(e){for(var i=!1;;){if(R>t.content.length-1){if(i)return 0===e?n.getTia().getVideoOutput().showOSD("Could not load Tape from Start. Not a Start Tape ROM!",!0):n.getTia().getVideoOutput().showOSD("Could not find next Part to load in Tape!",!0),void f(!1);R=0,i=!0}if(jt.Cartridge8K_64K_AR.peekPartNoOnTape(t.content,R)===e)return 0===e?n.getTia().getVideoOutput().showOSD("Loaded Tape from Start",!0):n.getTia().getVideoOutput().showOSD("Loaded next Part from Tape",!0),void l();R+=M}},l=function(){c(),d(),u()},c=function(){jt.Util.arrayCopy(t.content,R+4*F,w,0,w.length),E=w[1]<<8|255&w[0],T=w[2],b=w[3],C=w[4],A=w[5],O=w[7]<<8|255&w[6],r=jt.Util.arrayFill(Array(b),0),jt.Util.arrayCopy(w,16,r,0,b)},d=function(){jt.Util.arrayFillSegment(i,7*P,8*P-1,0);for(var e=R,n=0,o=r.length;n<o;n++){var a=r[n],s=(3&a)*F,l=(a>>2)*P;s+l+255<U&&jt.Util.arrayCopy(t.content,e,i,s+l,P),e+=P}R+=M},u=function(){i[U+D-63488]=T,i[U+j-63488]=A,i[U+I-63488]=y[L++],L>30&&(L=0),i[U+x-63488]=255&E,i[U+x+1-63488]=E>>8&255,f(!0)},f=function(t){i[U+k-63488]=t?1:0},$=function(){var t=jt.Util.uncompressStringBase64ToInt8BitArray(B);jt.Util.arrayCopy(t,0,i,U,F)},h=0,_=0,p=0,g=!1,v=-1,S=0,m=!1,E=0,T=0,b=0,C=0,A=0,O=0,y=Array(31),L=0,R=0,w=jt.Util.arrayFill(Array(256),0),j=64256,D=64257,x=64258,I=64260,k=64261,N=3072,P=256,F=8*P,U=3*F,M=4*F+256,B="7dSxCsIwEAbgv6niGkeddPVZ8kCOXc43yCIokkGIUN+gLxAoZHTxHRxjYq2xk7vSIPS75bb7uYNTuOJWu/bod3iU42BzUTiBe9sTzSjToBnNBVxfQz/nQ+2NhA2a05KYmhhjmxhoQZymxGil8gpeesOdyioW5DN25yxsiri3chQOUO1WeCSI/hPx9AJ/m/576KROMUhlfdE4dQ+AfJoPNBikgOZdLw==",K=4095,V=4096,H=4096;this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(!0),b:jt.Util.compressInt8BitArrayToStringBase64(i),b0o:h,b1o:_,vw:p,we:g,la:v,ac:S,bp:m,rs:E,rc:T,rp:b,rk:C,rm:A,rb:O,ro:r,to:R,rnd:jt.Util.storeInt8BitArrayToStringBase64(y),rnc:L}},this.loadState=function(e){this.format=jt.CartridgeFormats[e.f],this.rom=t=jt.ROM.loadState(e.r),i=jt.Util.uncompressStringBase64ToInt8BitArray(e.b,i),this.bytes=i,h=e.b0o,_=e.b1o,p=e.vw,g=e.we,v=e.la,S=e.ac,m=e.bp,E=e.rs,T=e.rc,b=e.rp,C=e.rk,A=e.rm,O=e.rb,r=e.ro,R=e.to,jt.Util.restoreStringBase64ToInt8BitArray(e.rnd,y),L=e.rnc},t&&function(n){n.rom=t,n.format=e,i=jt.Util.arrayFill(Array(4*F)),n.bytes=i,$();for(var r=0;r<31;++r)y[r]=256*Math.random()|0}(this)},jt.Cartridge8K_64K_AR.prototype=jt.CartridgeBankedByBusMonitoring.base,jt.Cartridge8K_64K_AR.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge8K_64K_AR;return n.loadState(t),n},jt.Cartridge8K_64K_AR.HEADER_SIZE=256,jt.Cartridge8K_64K_AR.PAGE_SIZE=256,jt.Cartridge8K_64K_AR.BANK_SIZE=8*jt.Cartridge8K_64K_AR.PAGE_SIZE,jt.Cartridge8K_64K_AR.PART_SIZE=4*jt.Cartridge8K_64K_AR.BANK_SIZE+jt.Cartridge8K_64K_AR.HEADER_SIZE,jt.Cartridge8K_64K_AR.peekPartNoOnTape=function(t,e){return t[e+4*jt.Cartridge8K_64K_AR.BANK_SIZE+5]},jt.Cartridge8K_64K_AR.checkTape=function(t){return 0===jt.Cartridge8K_64K_AR.peekPartNoOnTape(t.content,0)||(jt.Util.warning("Wrong Supercharger Tape Part ROM! Please load a Full Tape ROM file"),!1)},jt.Cartridge64K_X07=function(t,e){"use strict";this.read=function(t){return n[r+(t&o)]},this.performBankSwitchOnMonitoredAccess=function(t){2061==(6159&t)?r=((240&t)>>4)*a:r>=s&&0==(6272&t)&&(r=(0==(64&t)?14:15)*a)},this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(n),bo:r}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),n=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,n),this.bytes=n,r=t.bo};var n,i,r=0,o=4095,a=4096,s=14*a;t&&(i=this,i.rom=t,i.format=e,n=t.content,i.bytes=n)},jt.Cartridge64K_X07.prototype=jt.CartridgeBankedByBusMonitoring.base,jt.Cartridge64K_X07.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge64K_X07;return n.loadState(t),n},jt.Cartridge8K_0840=function(t,e){"use strict";this.read=function(t){return n[r+(t&o)]},this.performBankSwitchOnMonitoredAccess=function(t){var e=6208&t;2048===e?0!==r&&(r=0):2112===e&&r!==a&&(r=a)},this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(n),bo:r}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),n=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,n),this.bytes=n,r=t.bo};var n,i,r=0,o=4095,a=4096;t&&(i=this,i.rom=t,i.format=e,n=t.content,i.bytes=n)},jt.Cartridge8K_0840.prototype=jt.CartridgeBankedByBusMonitoring.base,jt.Cartridge8K_0840.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge8K_0840;return n.loadState(t),n},jt.Cartridge8K_UA=function(t,e){"use strict";this.read=function(t){return n[r+(t&o)]},this.performBankSwitchOnMonitoredAccess=function(t){544===t?0!==r&&(r=0):576===t&&r!==a&&(r=a)},this.saveState=function(){return{f:this.format.name,r:this.rom.saveState(),b:jt.Util.compressInt8BitArrayToStringBase64(n),bo:r}},this.loadState=function(t){this.format=jt.CartridgeFormats[t.f],this.rom=jt.ROM.loadState(t.r),n=jt.Util.uncompressStringBase64ToInt8BitArray(t.b,n),this.bytes=n,r=t.bo};var n,i,r=0,o=4095,a=4096;t&&(i=this,i.rom=t,i.format=e,n=t.content,i.bytes=n)},jt.Cartridge8K_UA.prototype=jt.CartridgeBankedByBusMonitoring.base,jt.Cartridge8K_UA.recreateFromSaveState=function(t,e){var n=e||new jt.Cartridge8K_UA;return n.loadState(t),n},jt.CartridgeFormats={"4K":{name:"4K",desc:"4K Atari",priority:101,tryFormat:function(t){if(t.content.length>=8&&t.content.length<=4096&&4096%t.content.length==0)return this},createCartridgeFromRom:function(t){return new jt.Cartridge4K(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge4K.recreateFromSaveState(t,e)}},CV:{name:"CV",desc:"2K Commavid +RAM",priority:102,tryFormat:function(t){if(2048===t.content.length||4096===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge2K_CV(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge2K_CV.recreateFromSaveState(t,e)}},E0:{name:"E0",desc:"8K Parker Bros.",priority:102,tryFormat:function(t){if(8192===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge8K_E0(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge8K_E0.recreateFromSaveState(t,e)}},F0:{name:"F0",desc:"64K Dynacom Megaboy",priority:101,tryFormat:function(t){if(65536===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge64K_F0(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge64K_F0.recreateFromSaveState(t,e)}},FE:{name:"FE",desc:"8K Robotank/Decathlon",priority:103,tryFormat:function(t){if(8192===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge8K_FE(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge8K_FE.recreateFromSaveState(t,e)}},E7:{name:"E7",desc:"16K M-Network",priority:102,tryFormat:function(t){if(16384===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge16K_E7(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge16K_E7.recreateFromSaveState(t,e)}},F8:{name:"F8",desc:"8K Atari (+RAM)",priority:101,tryFormat:function(t){if(8192===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.CartridgeBankedByMaskedRange(t,this,4088,null,128)},recreateCartridgeFromSaveState:function(t,e){return jt.CartridgeBankedByMaskedRange.recreateFromSaveState(t,e)}},F6:{name:"F6",desc:"16K Atari (+RAM)",priority:101,tryFormat:function(t){if(16384===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.CartridgeBankedByMaskedRange(t,this,4086,null,128)},recreateCartridgeFromSaveState:function(t,e){return jt.CartridgeBankedByMaskedRange.recreateFromSaveState(t,e)}},F4:{name:"F4",desc:"32K Atari (+RAM)",priority:101,tryFormat:function(t){if(32768===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.CartridgeBankedByMaskedRange(t,this,4084,null,128)},recreateCartridgeFromSaveState:function(t,e){return jt.CartridgeBankedByMaskedRange.recreateFromSaveState(t,e)}},FA2cu:{name:"FA2cu",desc:"32K CBS RAM+ CU Image",priority:103,tryFormat:function(t){if(32768===t.content.length){var e=jt.Util.arraysEqual(t.content.slice(32,36),this.cuMagicWord);return this.priority=103-(e?30:0),this}},createCartridgeFromRom:function(t){return new jt.Cartridge24K_28K_32K_FA2(t,this,1024)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge24K_28K_32K_FA2.recreateFromSaveState(t,e)},cuMagicWord:[30,171,173,16]},FA2:{name:"FA2",desc:"24K/28K/32K CBS RAM+",priority:102,tryFormat:function(t){if(24576===t.content.length||28672===t.content.length||32768===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge24K_28K_32K_FA2(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge24K_28K_32K_FA2.recreateFromSaveState(t,e)}},FA:{name:"FA",desc:"12K CBS RAM Plus",priority:101,tryFormat:function(t){if(12288===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.CartridgeBankedByMaskedRange(t,this,4088,!0,256)},recreateCartridgeFromSaveState:function(t,e){return jt.CartridgeBankedByMaskedRange.recreateFromSaveState(t,e)}},EF:{name:"EF",desc:"8K-64K H. Runner (+RAM)",priority:114,tryFormat:function(t){if(t.content.length%4096==0&&t.content.length>=8192&&t.content.length<=65536)return this},createCartridgeFromRom:function(t){return new jt.CartridgeBankedByMaskedRange(t,this,4064,null,128)},recreateCartridgeFromSaveState:function(t,e){return jt.CartridgeBankedByMaskedRange.recreateFromSaveState(t,e)}},DPC:{name:"DPC",desc:"10K DPC Pitfall 2 (Enhanced)",priority:101,tryFormat:function(t){if(t.content.length>=10240&&t.content.length<=10496)return this},createCartridgeFromRom:function(t){return new jt.Cartridge10K_DPCa(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge10K_DPCa.recreateFromSaveState(t,e)}},"3F":{name:"3F",desc:"8K-512K Tigervision",priority:112,tryFormat:function(t){if(t.content.length%2048==0&&t.content.length>=2048&&t.content.length<=524288)return this},createCartridgeFromRom:function(t){return new jt.Cartridge8K_512K_3F(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge8K_512K_3F.recreateFromSaveState(t,e)}},"3E":{name:"3E",desc:"8K-512K Tigervision (+RAM)",priority:111,tryFormat:function(t){if(t.content.length%2048==0&&t.content.length>=2048&&t.content.length<=524288)return this},createCartridgeFromRom:function(t){return new jt.Cartridge8K_512K_3E(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge8K_512K_3E.recreateFromSaveState(t,e)}},X07:{name:"X07",desc:"64K AtariAge",priority:102,tryFormat:function(t){if(65536===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge64K_X07(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge64K_X07.recreateFromSaveState(t,e)}},840:{name:"0840",desc:"8K Econobanking",priority:116,tryFormat:function(t){if(8192===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge8K_0840(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge8K_0840.recreateFromSaveState(t,e)}},UA:{name:"UA",desc:"8K UA Limited",priority:115,tryFormat:function(t){if(8192===t.content.length)return this},createCartridgeFromRom:function(t){return new jt.Cartridge8K_UA(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge8K_UA.recreateFromSaveState(t,e)}},SB:{name:"SB",desc:"8K-256K Superbanking",priority:113,tryFormat:function(t){if(t.content.length%4096==0&&t.content.length>=8192&&t.content.length<=262144)return this},createCartridgeFromRom:function(t){return new jt.Cartridge8K_256K_SB(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge8K_256K_SB.recreateFromSaveState(t,e)}},AR:{name:"AR",desc:"8K-64K Arcadia/Supercharger",priority:101,tryFormat:function(t){if(t.content.length%jt.Cartridge8K_64K_AR.PART_SIZE==0&&t.content.length/jt.Cartridge8K_64K_AR.PART_SIZE>=1&&t.content.length/jt.Cartridge8K_64K_AR.PART_SIZE<=8&&jt.Cartridge8K_64K_AR.checkTape(t))return this},createCartridgeFromRom:function(t){return new jt.Cartridge8K_64K_AR(t,this)},recreateCartridgeFromSaveState:function(t,e){return jt.Cartridge8K_64K_AR.recreateFromSaveState(t,e)}}},jt.CartridgeFormatsUserOptions=["4K","CV","E0","F0","FE","E7","F8","F6","F4","FA2cu","FA2","FA","EF","DPC","3F","3E","X07","0840","UA","SB","AR"],jt.CartridgeCreatorImpl=function(){"use strict";this.createCartridgeFromRom=function(e){var n=t.getForROM(e);if(n){var i=jt.CartridgeFormats[n];if(i.tryFormat(e))return jt.Util.log("USER Format selected: "+i.desc),i.createCartridgeFromRom(e)}var r=this.getBestFormatOption(e);if(r)return jt.Util.log("AUTO Format selected: "+r.name+": "+r.desc+", priority: "+r.priority+(r.priorityBoosted?" ("+r.priorityBoosted+")":"")),r.createCartridgeFromRom(e)},this.recreateCartridgeFromSaveState=function(t,e){var n=jt.CartridgeFormats[t.f];if(!n)throw Error("Unsupported ROM Format: "+t.f);return e&&e.format!==n&&(e=null),n.recreateCartridgeFromSaveState(t,e)},this.changeCartridgeFormat=function(t,e){return e.createCartridgeFromRom(t.rom)},this.getBestFormatOption=function(t){var n=e(t);return 0===n.length?void 0:n[0]},this.getUserFormatOptionNames=function(t){for(var e=[],n=0,i=jt.CartridgeFormatsUserOptions.length;n<i;++n){var r=jt.CartridgeFormatsUserOptions[n];jt.CartridgeFormats[r].tryFormat(t)&&e.push(r)}return e},this.produceInfo=function(t,e){var r=t.content.length,o=jt.MD5(t.content);t.content.length>r&&t.content.splice(r);var a=jt.CartridgeDatabase[o];return a?jt.Util.log(a.n+" ("+o+")"):(a=n(t.source),jt.Util.log("Unknown ROM: "+a.n+" ("+o+")")),i(a,t.source,o,e),a},this.setUserROMFormats=function(e){t=e};var t,e=function(t){var e,n,i=[];for(var o in jt.CartridgeFormats)try{if(!(e=jt.CartridgeFormats[o].tryFormat(t)))continue;r(e,t.info),i.push(e)}catch(a){if(!a.formatDenial)throw a;n||(n=a)}return i.sort(function(t,e){return(t.priorityBoosted||t.priority)-(e.priorityBoosted||e.priority)}),i},n=function(t){var e={n:"Unknown"};if(!t||!t.trim())return e;var n,i=t,r=i.lastIndexOf("/"),o=Math.max(r,Math.max(i.lastIndexOf("\\"),i.lastIndexOf("?")));o>=0&&o<i.length-1&&(i=i.substring(o+1));var a=i.lastIndexOf(".");return a>=0&&(i=i.substring(0,a)),e.n=i.trim()||"Unknown",e},i=function(t,e,n,i){t.h=n,t.l||(t.l=o(t.n));var r=t.n.toUpperCase();a:if(!t.p&&(t.p=0,!r.match(u+"JOYSTICK(S)?"+f))){if(r.match(u+"PADDLE(S)?"+f))t.p=1;else for(var $=0;$<c.length;$++)if(r.match(c[$])){t.p=1;break a}}a:if(!t.c){if(r.match(u+"CRT(_|-)?MODE"+f))t.c=1;else for($=0;$<d.length;$++)if(r.match(d[$])){t.c=1;break a}}if(i){for(var h in i=i.trim().toUpperCase(),jt.CartridgeFormats)if(h.toUpperCase()===i){t.f=h;break}}a:if(!t.f){var _=e.toUpperCase();for(h in jt.CartridgeFormats)if(a(h,r)||a(h,_)){t.f=h;break a}for(h in l)if(s(h,r)){t.f=h;break a}}},r=function(t,e){e.f&&t.name===e.f?t.priorityBoosted=t.priority-$:t.priorityBoosted=void 0},o=function(t){return t.split(/(\(|\[)/)[0].trim()},a=function(t,e){return e.match(u+t+f)},s=function(t,e){var n=l[t];if(!n)return!1;for(var i=0;i<n.length;i++)if(e.match(n[i]))return!0;return!1},l={E0:["^.*MONTEZUMA.*$","^.*MONTZREV.*$","^.*GYRUS.*$","^.*TOOTH.*PROTECTORS.*$","^.*TOOTHPRO.*$","^.*DEATH.*STAR.*BATTLE.*$","^.*DETHSTAR.*$","^.*JAMES.*BOND.*$","^.*JAMEBOND.*$","^.*SUPER.*COBRA.*$","^.*SPRCOBRA.*$","^.*TUTANKHAM.*$","^.*TUTANK.*$","^.*POPEYE.*$","^.*(SW|STAR.?WARS).*ARCADE.*GAME.*$","^.*SWARCADE.*$","^.*Q.*BERT.*QUBES.*$","^.*QBRTQUBE.*$","^.*FROGGER.?(2|II).*$","^.*DO.*CASTLE.*$"],FE:["^.*ROBOT.*TANK.*$","^.*ROBOTANK.*$","^.*DECATHLON.*$","^.*DECATHLN.*$"],E7:["^.*BUMP.*JUMP.*$","^.*BNJ.*$","^.*BURGER.*TIME.*$","^.*BURGTIME.*$","^.*POWER.*HE.?MAN.*$","^.*HE_MAN.*$"],"3F":["^.*POLARIS.*$","^.*RIVER.*PATROL.*$","^.*RIVERP.*$","^.*SPRINGER.*$","^.*MINER.*2049.*$","^.*MNR2049R.*$","^.*MINER.*2049.*VOLUME.*$","^.*MINRVOL2.*$","^.*ESPIAL.*$","^.*ANDREW.*DAVIE.*$","^.*DEMO.*IMAGE.*AD.*$"],"3E":["^.*BOULDER.*DASH.*$","^.*BLDRDASH.*$"],DPC:["^.*PITFALL.*II.*$"]},c=["^.*PADDLES.*$","^.*BREAKOUT.*$","^.*SUPER.*BREAKOUT.*$","^.*SUPERB.*$","^.*WARLORDS.*$","^.*STEEPLE.*CHASE.*$","^.*STEPLCHS.*$","^.*VIDEO.*OLYMPICS.*$","^.*VID(|_)OLYM(|P).*$","^.*CIRCUS.*ATARI.*$","^.*CIRCATRI.*$","^.*KABOOM.*$","^.*BUGS((?!BUNNY).)*","^.*BACHELOR.*PARTY.*$","^.*BACHELOR.*$","^.*BACHELORETTE.*PARTY.*$","^.*BACHLRTT.*$","^.*BEAT.*EM.*EAT.*EM.*$","^.*BEATEM.*$","^.*PHILLY.*FLASHER.*$","^.*PHILLY.*$","^.*JEDI.*ARENA.*$","^.*JEDIAREN.*$","^.*EGGOMANIA.*$","^.*EGGOMANA.*$","^.*PICNIC.*$","^.*PIECE.*O.*CAKE.*$","^.*PIECECKE.*$","^.*BACKGAMMON.*$","^.*BACKGAM.*$","^.*BLACKJACK.*$","^.*BLACK(|_)J.*$","^.*CANYON.*BOMBER.*$","^.*CANYONB.*$","^.*CASINO.*$","^.*DEMONS.*DIAMONDS.*$","^.*DEMONDIM.*$","^.*DUKES.*HAZZARD.*2.*$","^.*STUNT.?2.*$","^.*ENCOUNTER.*L.?5.*$","^.*ENCONTL5.*$","^.*G.*I.*JOE.*COBRA.*STRIKE.*$","^.*GIJOE.*$","^.*GUARDIAN.*$","^.*MARBLE.*CRAZE.*$","^.*MARBCRAZ.*$","^.*MEDIEVAL.*MAYHEM.*$","^.*MONDO.*PONG.*$","^.*NIGHT.*DRIVER.*$","^.*NIGHTDRV.*$","^.*PARTY.*MIX.*$","^.*POKER.*PLUS.*$","^.*PONG.*SPORTS.*$","^.*SCSICIDE.*$","^.*SECRET.*AGENT.*$","^.*SOLAR.*STORM.*$","^.*SOLRSTRM.*$","^.*SPEEDWAY.*$","^.*STREET.*RACER.*$","^.*STRTRACE.*$","^.*STUNT.*CYCLE.*$","^.*STUNT.?1.*$","^.*TAC.?SCAN.*$","^.*MUSIC.*MACHINE.*$","^.*MUSCMACH.*$","^.*VONG.*$","^.*WARPLOCK.*$"],d=["^.*STAR.*CASTLE.*$","^.*SEAWEED.*$","^.*ANDREW.*DAVIE.*$","^.*DEMO.*IMAGE.*AD.*$"],u="^(|.*?(\\W|_|%20))",f="(|(\\W|_|%20).*)$",$=50},jt.CartridgeCreator=new jt.CartridgeCreatorImpl,jt.Images={embedded:!1,count:5,urls:{logo:Javatari.IMAGES_PATH+"logo.png",loading:Javatari.IMAGES_PATH+"loading.gif",mouseCursor:Javatari.IMAGES_PATH+"mouse-cursor.png",panel:Javatari.IMAGES_PATH+"panel.jpg",panelSprites:Javatari.IMAGES_PATH+"panel-sprites.jpg",controllers:Javatari.IMAGES_PATH+"controllers.jpg",iconSprites:Javatari.IMAGES_PATH+"icon-sprites.png"}},jt.Clock=function(clockPulse){"use strict";this.connect=function(t){t.connectClock(this)},this.go=function(){running||(useRequestAnimationFrame=vSynch&&cyclesPerSecond===this.getVSynchNativeFrequency(),running=!0,useRequestAnimationFrame?animationFrame=requestAnimationFrame(pulse):interval=setInterval(pulse,cycleTimeMs))},this.pause=function(){running=!1,animationFrame&&(cancelAnimationFrame(animationFrame),animationFrame=null),interval&&(clearInterval(interval),interval=null)},this.setFrequency=function(t,e){running?(this.pause(),internalSetFrequency(t,e),this.go()):internalSetFrequency(t,e)},this.setVSynch=function(t){running?(this.pause(),vSynch=t,this.go()):vSynch=t},this.getVSynchNativeFrequency=function(){return vSynchAltNativeFrequency||vSynchNativeFrequency},this.setVSynchAltNativeFrequency=function(t){vSynchAltNativeFrequency=t};var internalSetFrequency=function(t,e){cyclesPerSecond=t,cycleTimeMs=1e3/t,dividerCounter>(divider=e>=1?e:1)&&(dividerCounter=divider)},pulse=function(){animationFrame=null,divider>1?--dividerCounter<=0&&(dividerCounter=divider,clockPulse()):clockPulse(),useRequestAnimationFrame&&!animationFrame&&(animationFrame=requestAnimationFrame(pulse))};this.detectHostNativeFPSAndCallback=function(t){function e(){vSynchNativeFrequency=-1,jt.Util.error("Could not detect video native frequency. V-Synch DISABLED!"),t&&t(vSynchNativeFrequency)}if(-1===Javatari.SCREEN_VSYNCH_MODE)return jt.Util.warning("Video native V-Synch disabled in configuration"),void(t&&t(vSynchNativeFrequency));if(-1!==Javatari.SCREEN_FORCE_HOST_NATIVE_FPS)return jt.Util.warning("Host video frequency forced in configuration: "+Javatari.SCREEN_FORCE_HOST_NATIVE_FPS),void(t&&t(vSynchNativeFrequency));if(!window.requestAnimationFrame)return e();var n=0,i=0,r=0,o=0,a=0,s=0,l=function(){if(r>=12||o>=18||a>=14||s>=18)return vSynchNativeFrequency=r>=12?60:o>=18?50:a>=14?120:100,jt.Util.log("Video native frequency detected: "+vSynchNativeFrequency+"Hz"),void(t&&t(vSynchNativeFrequency));if(!(++n<=70))return e();var c=jt.Util.performanceNow(),d=1e3/(c-i);i=c,d>=47&&d<=53&&o++,d>=56.4&&d<=63.6&&r++,d>=112.8&&d<=127.2&&a++,d>=94&&d<=106&&s++,requestAnimationFrame(l)};l()},this.eval=function(str){return eval(str)};var useRequestAnimationFrame,running=!1,cyclesPerSecond=1,cycleTimeMs=1e3,divider=1,dividerCounter=1,animationFrame=null,interval=null,vSynch=!0,vSynchNativeFrequency=-1===Javatari.SCREEN_VSYNCH_MODE?-1:Javatari.SCREEN_FORCE_HOST_NATIVE_FPS,vSynchAltNativeFrequency=void 0},jt.RecentStoredROMs=function(){function t(){if(!r){try{r=JSON.parse(localStorage.javataristoredromsdata)}catch(t){}r||e()}return r}function e(){i=[],localStorage.javataristoredromsicatalog=JSON.stringify(i),r=[],localStorage.javataristoredromsdata=JSON.stringify(r)}this.getCatalog=function(){if(!i){try{i=JSON.parse(localStorage.javataristoredromsicatalog)}catch(t){}i||e()}return i},this.storeROM=function(e){this.getCatalog();var n=i.find(function(t){return t&&t.h===e.info.h});if(n&&n.n==e.info.l&&n.f==e.info.f)this.lastROMLoadedIndex=i.indexOf(n);else{if(t(),n){var a=i.indexOf(n);i.splice(a,1),r.splice(a,1)}else i.length>=o&&(i=i.slice(0,o-1),r=r.slice(0,o-1));i.unshift({n:e.info.l,h:e.info.h,f:e.info.f});for(var s=0;s<i.length;++s)i[s].i=s;localStorage.javataristoredromsicatalog=JSON.stringify(i),r.unshift(e.saveState(!0)),localStorage.javataristoredromsdata=JSON.stringify(r),this.lastROMLoadedIndex=0,jt.Util.log("New ROM stored: "+e.info.n+", "+e.info.h)}localStorage.javataristoredromslastindex=this.lastROMLoadedIndex},this.getROM=function(e){this.lastROMLoadedIndex=e,localStorage.javataristoredromslastindex=e;var n=t()[e];return n?jt.ROM.loadState(n):null};var n=localStorage.javataristoredromslastindex;this.lastROMLoadedIndex=void 0!==n?Number.parseInt(n):-1;var i,r,o=10},jt.FileLoader=function(t,e,n){"use strict";function i(t,e,n,i,o,a,s){for(var l=0;l<t.length;l++)if(r(t[l],e,n,i,o,a,s))return!0;return!1}function r(t,e,n,i,a,s,l,c){try{l&&!t.content&&(t.content=t.asUint8Array());var d=t.content;if(!c){var u=jt.Util.checkContentIsZIP(d);if(u){for(var f=jt.Util.getZIPFilesSorted(u),$=0;$<f.length;$++)if(r(f[$],e,n,i,a,s,!0,!0))return!0;return!1}}var h=jt.Util.checkContentIsGZIP(d);if(h)return r({name:t.name,content:h},e,n,i,a,s,!1,!0)}catch(_){return jt.Util.error(_),!1}return o(t.name,d,e,n,i,a,s)}function o(t,e,n,i,r,o,a){if(((n=n||C.AUTO)===C.STATE||n===C.AUTO)&&h.loadStateFile(e)||(n===C.CART_DATA||n===C.AUTO)&&$.loadCartridgeData(i,t,e))return!0;if(n===C.ROM||n===C.AUTO){var s=new jt.ROM(t,e,null,a);return u.loadROM(s,i,r,o)}return!1}function a(t){if(t.returnValue=!1,t.preventDefault(),t.stopPropagation(),t.target.focus(),this.files&&0!==this.files.length){var e=jt.Util.asNormalArray(this.files);try{_.value=""}catch(n){}var i=f.systemPause(!0),r=function(t){i||f.systemPause(!1)};return e&&e.length>0&&(1===e.length?u.readFromFile(e[0],g,v,S,m,r):u.readFromFiles(e,g,v,S,m,r)),!1}}function s(t){t.returnValue=!1,t.preventDefault(),t.stopPropagation(),t.dataTransfer&&(Javatari.CARTRIDGE_CHANGE_DISABLED?t.dataTransfer.dropEffect="none":t.ctrlKey?t.dataTransfer.dropEffect="copy":t.altKey&&(t.dataTransfer.dropEffect="link")),E=t.buttons>0?t.buttons:T}function l(t){if(t.returnValue=!1,t.preventDefault(),t.stopPropagation(),t.target.focus(),t.dataTransfer&&!n.mediaChangeDisabledWarning()){var e=f.systemPause(!0),i=t.shiftKey?1:0,r=E&b,o=t.ctrlKey,a=C.AUTO,s=t.dataTransfer&&t.dataTransfer.files,l=function(t){e||f.systemPause(!1)};if(s&&s.length>0)1===s.length?u.readFromFile(s[0],a,i,r,o,l):u.readFromFiles(s,a,i,r,o,l);else{var c=t.dataTransfer.getData("text");c&&c.length>0?u.readFromURL(c,a,i,r,o,l):l()}}}function c(t){jt.Util.message("Could not load file(s):\n\n"+t+"\n")}function d(){(_=document.createElement("input")).id="jt-file-loader-input",_.type="file",_.multiple=!0,_.accept=A.AUTO,_.style.display="none",_.addEventListener("change",a),p.appendChild(_)}var u=this;this.connect=function(t){$=(f=t).getCartridgeSocket(),h=f.getSavestateSocket()},this.registerForDnD=function(t){t.addEventListener("dragover",s,!1),t.addEventListener("drop",l,!1)},this.registerForFileInputElement=function(t){p=t},this.openFileChooserDialog=function(t,e,n,i){_||d(),_.multiple=O[C[t]||C.AUTO],_.accept=A[C[t]||C.AUTO],g=t,v=n?1:0,S=e,m=i,_.click()},this.openURLChooserDialog=function(t,e,n,i){var r,o=n?1:0;try{r=localStorage&&localStorage[L]}catch(a){}var s=f.systemPause(!0);if(r=(r=prompt("Load file from URL:",r||""))&&r.toString().trim()){try{localStorage[L]=r}catch(l){}console.log(r,t,o,e,i),this.readFromURL(r,t,o,e,i,function(){s||f.systemPause(!1)})}else s||f.systemPause(!1)},this.openURLChooserDialog2=function(t,e,n,i,r){var o=r,a=0;this.readFromURL(o,t,a,e,i,function(){f.systemPause(!1),f.powerOff()})},this.readFromFile=function(t,e,n,i,r,o){jt.Util.log("Reading file: "+t.name);var a=new FileReader;a.onload=function(a){var s=new Uint8Array(a.target.result),l={name:t.name,content:s,lastModifiedDate:t.lastModified?new Date(t.lastModified):t.lastModifiedDate};u.loadFromFile(l,e,n,i,r),o&&o(!0)},a.onerror=function(t){c("File reading error: "+t.target.error.name+R),o&&o(!1)},a.readAsArrayBuffer(t)},this.readFromURL=function(t,e,n,i,r,o){new jt.MultiDownloader([{url:t}],function(a){var s={name:t,content:a[0].content,lastModifiedDate:null};u.loadFromFile(s,e,n,i,r),o&&o(!0)},function(t){c("URL reading error: "+t[0].error),o&&o(!1)}).start()},this.readFromFiles=function(t,e,n,i,r,o){new jt.MultiFileReader(t,function(t){u.loadFromFiles(t,e,n,i,r),o&&o(!0)},function(t,e,n){n||(e+=R),c("File reading error: "+e),o&&o(!1)}).start()},this.loadFromContent=function(t,e,n,i,r,o,a){return this.loadFromFile({name:t,content:e},n,i,r,o,a)},this.loadFromFile=function(t,e,n,r,o,a){var s;if(s=jt.Util.checkContentIsZIP(t.content))try{if(i(jt.Util.getZIPFilesSorted(s),e,n,r,o,a,!0))return}catch(l){jt.Util.error(l)}else if(i([t],e,n,r,o,a,!1))return;c("No valid "+y[e]+" found.")},this.loadFromFiles=function(t,e,n,r,o){(t=jt.Util.asNormalArray(t).slice(0)).sort(function(t,e){return t.name<e.name?-1:t.name>e.name?1:0}),i(t,e,n,r,o,null,!1)||c("No valid "+y[e]+" found.")},this.loadROM=function(t,n,i,r){var o=jt.CartridgeCreator.createCartridgeFromRom(t);return!!o&&($.insert(o,!i),e.storeROM(t),!0)};var f,$,h,_,p,g,v=0,S=!1,m=!1,E=1,T=1,b=2,C=jt.FileLoader.OPEN_TYPE;this.OPEN_TYPE=C;var A={ROM:".bin,.BIN,.rom,.ROM,.a26,.A26,.zip,.ZIP,.gz,.GZ,.gzip,.GZIP",STATE:".jst,.JST",CART_DATA:".dat,.DAT,.sram,.SRAM",AUTO:".bin,.BIN,.rom,.ROM,.a26,.A26,.jst,.JST,.zip,.ZIP,.gz,.GZ,.gzip,.GZIP"},O={ROM:!1,STATE:!1,CART_DATA:!1,AUTO:!1},y={ROM:"ROM",STATE:"Savestate",CART_DATA:"Cartridge Data",AUTO:"ROM"},L="javatarilasturl",R="\n\nIMPORTANT: Directories are not supported for loading!";Javatari.fileLoader=this},jt.FileLoader.OPEN_TYPE={AUTO:"AUTO",ROM:"ROM",STATE:"STATE",CART_DATA:"CART_DATA"},jt.FileDownloader=function(){"use strict";var t,e,n,i;function r(){if("NONE"===t)return alert("Unfortunately file saving in WebApps is broken in this version of iOS. The file could not be saved. If you really need to save a file, you must run Javatari on the official homepage."),!0}function o(){"NONE"!=(t=jt.Util.isIOSDevice()?jt.Util.isBrowserStandaloneMode()?"NONE":"DATA":"SAFARI"===jt.Util.browserInfo().name?"DATA":"BLOB")&&((e=document.createElement("a")).style.display="none",e.target="_blank",e.href="#",n.appendChild(e))}this.connectPeripherals=function(t){i=t},this.registerForDownloadElement=function(t){n=t},this.startDownloadBinary=function(n,a,s){try{if(t||o(),r())return;if("BLOB"===t){e.href&&(window.URL||window.webkitURL).revokeObjectURL(e.href);var l,c=new Blob([a],{type:"data:application/octet-stream"});l=(window.URL||window.webkitURL).createObjectURL(c)}else l="data:application/octet-stream;base64,"+btoa("string"==typeof a?a:jt.Util.int8BitArrayToByteString(a));e.download=n&&n.trim(),e.href=l,e.click(),i.showOSD(s+" saved",!0)}catch(d){i.showOSD(s+" save FAILED!",!0,!0),jt.Util.error(d)}},this.startDownloadURL=function(n,a,s){try{if(t||o(),r())return;"BLOB"===t&&e.href&&(window.URL||window.webkitURL).revokeObjectURL(e.href),e.download=n&&n.trim(),e.href=a,e.click(),i.showOSD(s+" saved",!0)}catch(l){i.showOSD(s+" save FAILED!",!0,!0),jt.Util.error(l)}}},jt.DOMKeys={},jt.DOMKeys.MOD_SHIFT=16,jt.DOMKeys.LOC_SHIFT=24,jt.DOMKeys.SHIFT=65536,jt.DOMKeys.CONTROL=131072,jt.DOMKeys.ALT=262144,jt.DOMKeys.META=524288,jt.DOMKeys.LOCNONE=0,jt.DOMKeys.LOCLEFT=16777216,jt.DOMKeys.LOCRIGHT=33554432,jt.DOMKeys.LOCNUM=50331648,jt.DOMKeys.IGNORE_ALL_MODIFIERS_MASK=~(jt.DOMKeys.SHIFT|jt.DOMKeys.CONTROL|jt.DOMKeys.ALT|jt.DOMKeys.META),function(t,e,n,i){t.VK_F1={c:112,n:"F1"},t.VK_F2={c:113,n:"F2"},t.VK_F3={c:114,n:"F3"},t.VK_F4={c:115,n:"F4"},t.VK_F5={c:116,n:"F5"},t.VK_F6={c:117,n:"F6"},t.VK_F7={c:118,n:"F7"},t.VK_F8={c:119,n:"F8"},t.VK_F9={c:120,n:"F9"},t.VK_F10={c:121,n:"F10"},t.VK_F11={c:122,n:"F11"},t.VK_F12={c:123,n:"F12"},t.VK_1={c:49,n:"1"},t.VK_2={c:50,n:"2"},t.VK_3={c:51,n:"3"},t.VK_4={c:52,n:"4"},t.VK_5={c:53,n:"5"},t.VK_6={c:54,n:"6"},t.VK_7={c:55,n:"7"},t.VK_8={c:56,n:"8"},t.VK_9={c:57,n:"9"},t.VK_0={c:48,n:"0"},t.VK_Q={c:81,n:"Q"},t.VK_W={c:87,n:"W"},t.VK_E={c:69,n:"E"},t.VK_R={c:82,n:"R"},t.VK_T={c:84,n:"T"},t.VK_Y={c:89,n:"Y"},t.VK_U={c:85,n:"U"},t.VK_I={c:73,n:"I"},t.VK_O={c:79,n:"O"},t.VK_P={c:80,n:"P"},t.VK_A={c:65,n:"A"},t.VK_S={c:83,n:"S"},t.VK_D={c:68,n:"D"},t.VK_F={c:70,n:"F"},t.VK_G={c:71,n:"G"},t.VK_H={c:72,n:"H"},t.VK_J={c:74,n:"J"},t.VK_K={c:75,n:"K"},t.VK_L={c:76,n:"L"},t.VK_Z={c:90,n:"Z"},t.VK_X={c:88,n:"X"},t.VK_C={c:67,n:"C"},t.VK_V={c:86,n:"V"},t.VK_B={c:66,n:"B"},t.VK_N={c:78,n:"N"},t.VK_M={c:77,n:"M"},t.VK_ESCAPE={c:27,n:"Esc"},t.VK_ENTER={c:13,n:"Enter"},t.VK_SPACE={c:32,n:"Space"},t.VK_TAB={c:9,n:"Tab"},t.VK_BACKSPACE={c:8,n:"BackSpc"},t.VK_CONTEXT={c:93,n:"Context"},t.VK_LSHIFT={c:16|e,n:"L-Shift"},t.VK_LCONTROL={c:17|e,n:"L-Control"},t.VK_LALT={c:18|e,n:"L-Alt"},t.VK_LMETA={c:91|e,n:"L-Meta"},t.VK_RSHIFT={c:16|n,n:"R-Shift"},t.VK_RCONTROL={c:17|n,n:"R-Control"},t.VK_RALT={c:18|n,n:"R-Alt"},t.VK_RMETA={c:91|n,n:"R-Meta"},t.VK_CAPS_LOCK={c:20,n:"CapsLock"},t.VK_PRINT_SCREEN={c:44,n:"PrtScr"},t.VK_SCROLL_LOCK={c:145,n:"ScrLck"},t.VK_PAUSE={c:19,n:"Pause"},t.VK_BREAK={c:3,n:"Break"},t.VK_INSERT={c:45,n:"Ins"},t.VK_DELETE={c:46,n:"Del"},t.VK_HOME={c:36,n:"Home"},t.VK_END={c:35,n:"End"},t.VK_PAGE_UP={c:33,n:"PgUp"},t.VK_PAGE_DOWN={c:34,n:"PgDown"},t.VK_NUM_INSERT={c:45|i,n:"Num Ins"},t.VK_NUM_DELETE={c:46|i,n:"Num Del"},t.VK_NUM_HOME={c:36|i,n:"Num Home"},t.VK_NUM_END={c:35|i,n:"Num End"},t.VK_NUM_PAGE_UP={c:33|i,n:"Num PgUp"},t.VK_NUM_PAGE_DOWN={c:34|i,n:"Num PgDown"},t.VK_UP={c:38,n:"Up"},t.VK_DOWN={c:40,n:"Down"},t.VK_LEFT={c:37,n:"Left"},t.VK_RIGHT={c:39,n:"Right"},t.VK_NUM_UP={c:38|i,n:"Num Up"},t.VK_NUM_DOWN={c:40|i,n:"Num Down"},t.VK_NUM_LEFT={c:37|i,n:"Num Left"},t.VK_NUM_RIGHT={c:39|i,n:"Num Right"},t.VK_NUMLOCK={c:144,n:"NumLock"},t.VK_NUM_COMMA={c:110|i,n:"Num ,"},t.VK_NUM_DIVIDE={c:111|i,n:"Num /"},t.VK_NUM_MULTIPLY={c:106|i,n:"Num *"},t.VK_NUM_MINUS={c:109|i,n:"Num -"},t.VK_NUM_PLUS={c:107|i,n:"Num +"},t.VK_NUM_PERIOD={c:194|i,n:"Num ."},t.VK_NUM_0={c:96|i,n:"Num 0"},t.VK_NUM_1={c:97|i,n:"Num 1"},t.VK_NUM_2={c:98|i,n:"Num 2"},t.VK_NUM_3={c:99|i,n:"Num 3"},t.VK_NUM_4={c:100|i,n:"Num 4"},t.VK_NUM_5={c:101|i,n:"Num 5"},t.VK_NUM_6={c:102|i,n:"Num 6"},t.VK_NUM_7={c:103|i,n:"Num 7"},t.VK_NUM_8={c:104|i,n:"Num 8"},t.VK_NUM_9={c:105|i,n:"Num 9"},t.VK_NUM_CLEAR={c:12|i,n:"Num Clear"},t.VK_NUM_ENTER={c:13|i,n:"Num Enter"},t.VK_QUOTE={c:222,n:"'"},t.VK_BACKQUOTE={c:192,n:"`"},t.VK_MINUS={c:189,n:"-"},t.VK_EQUALS={c:187,n:"="},t.VK_OPEN_BRACKET={c:219,n:"["},t.VK_CLOSE_BRACKET={c:221,n:"]"},t.VK_COMMA={c:188,n:","},t.VK_PERIOD={c:190,n:"."},t.VK_SEMICOLON={c:186,n:";"},t.VK_SLASH={c:191,n:"/"},t.VK_BACKSLASH={c:220,n:"\\"},t.VK_ALTERNATE_ESC={c:t.VK_F1.c|jt.DOMKeys.ALT,n:["Alt","F1"]},t.VK_FF_MINUS={c:173,n:"-"},t.VK_FF_EQUALS={c:61,n:"="},t.VK_FF_SEMICOLON={c:59,n:";"},t.VK_BR_QUOTE={c:192,n:"'"},t.VK_BR_OPEN_BRACKET={c:221,n:"["},t.VK_BR_CLOSE_BRACKET={c:220,n:"]"},t.VK_BR_SEMICOLON={c:191,n:";"},t.VK_BR_SLASH={c:193,n:"/"},t.VK_BR_BACKSLASH={c:226,n:"\\"},t.VK_BR_CEDILLA={c:186,n:"\xc7"},t.VK_BR_TILDE={c:222,n:"~"},t.VK_BR_ACUTE={c:219,n:"\xb4"},t.VK_FF_BR_TILDE={c:176,n:"~"},t.VK_VOID={c:-1,n:""}}(jt.DOMKeys,jt.DOMKeys.LOCLEFT,jt.DOMKeys.LOCRIGHT,jt.DOMKeys.LOCNUM),jt.DOMKeys.forcedNames={27:"Esc",13:"Enter",32:"Space",9:"Tab",8:"BkSpc",16:"Shift",17:"Ctrl",18:"Alt",91:"Meta",93:"Context",20:"Caps",44:"PrtScr",145:"ScrLck",19:"Pause",3:"Break",45:"Ins",46:"Del",36:"Home",35:"End",33:"PgUp",34:"PgDown",38:"Up",40:"Down",37:"Left",39:"Right"},jt.DOMKeys.isModifierKeyCode=function(t){return 16===t||17===t||18===t||91===t},jt.DOMKeys.codeForKeyboardEvent=function(t){var e=t.keyCode;return this.isModifierKeyCode(e)?e&this.IGNORE_ALL_MODIFIERS_MASK|t.location<<this.LOC_SHIFT:e|t.location<<this.LOC_SHIFT|(t.shiftKey?this.SHIFT:0)|(t.ctrlKey?this.CONTROL:0)|(t.altKey?this.ALT:0)|(t.metaKey?this.META:0)},jt.DOMKeys.nameForKeyboardEvent=function(t){var e=t.keyCode,n=this.forcedNames[e]||t.key,i=n&&n.toUpperCase();switch(i&&"UNIDENTIFIED"!==i&&"UNDEFINED"!==i&&"UNKNOWN"!==i?"DEAD"===i&&(n="Dead#"+e):n="#"+e,1===n.length?n=n.toUpperCase():n.length>12&&(n=n.substr(0,12)),t.location){case 1:n="L-"+n;break;case 2:n="R-"+n;break;case 3:n="Num "+n}return(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey)&&(n=[n],t.metaKey&&n.unshift("Meta"),t.altKey&&n.unshift("Alt"),t.ctrlKey&&n.unshift("Ctrl"),t.shiftKey&&n.unshift("Shift")),n},jt.DOMKeys.nameForKeyboardEventSingle=function(t){var e=t.keyCode,n=this.forcedNames[e]||t.key,i=n&&n.toUpperCase();switch(i&&"UNIDENTIFIED"!==i&&"UNDEFINED"!==i&&"UNKNOWN"!==i?"DEAD"===i&&(n="Dead#"+e):n="#"+e,1===n.length?n=n.toUpperCase():n.length>12&&(n=n.substr(0,12)),t.location){case 1:n="L-"+n;break;case 2:n="R-"+n;break;case 3:n="Num "+n}return n},jt.GamepadButtons={GB_1:{b:0,n:"1"},GB_2:{b:1,n:"2"},GB_3:{b:2,n:"3"},GB_4:{b:3,n:"4"},GB_L1:{b:4,n:"L1"},GB_R1:{b:5,n:"R1"},GB_L2:{b:6,n:"L2"},GB_R2:{b:7,n:"R2"},GB_BACK:{b:8,n:"BACK"},GB_START:{b:9,n:"START"},GB_S1:{b:10,n:"S1"},GB_S2:{b:11,n:"S2"},GB_UP:{b:12,n:"&#9650;"},GB_DOWN:{b:13,n:"&#9660;"},GB_LEFT:{b:14,n:"&#9668;"},GB_RIGHT:{b:15,n:"&#9658;"},GB_LOGO:{b:16,n:"LOGO"},GB_VOID:{b:-1,n:"Unbound"}},jt.TouchControls={buttons:["T_B","T_A"]},jt.GamepadConsoleControls=function(t){"use strict";function e(t,e){this.index=t,this.update=function(e){return!!(n=e[t])},this.hasMoved=function(){var t=n.timestamp;return!t||t>f&&(f=t,!0)},this.getButtonDigital=function(t){var e=n.buttons[t];return"object"==typeof e?e.pressed||e.value>.5:e>.5},this.getDPadDirection=function(){return this.getButtonDigital(12)?this.getButtonDigital(15)?1:this.getButtonDigital(14)?7:0:this.getButtonDigital(13)?this.getButtonDigital(15)?3:this.getButtonDigital(14)?5:4:this.getButtonDigital(14)?6:this.getButtonDigital(15)?2:-1},this.getStickDirection=function(){var t=n.axes[i],e=n.axes[r];if((t<0?-t:t)<u?t=0:t*=o,(e<0?-e:e)<u?e=0:e*=a,0===t&&0===e)return -1;var s=(1-Math.atan2(t,e)/Math.PI)/2;return(s+=1/16)>=1&&(s-=1),8*s|0},this.getPaddlePosition=function(){var t=n.axes[s]*l*c+d|0;return t<0?t=0:t>380&&(t=380),t};var n,i=e.xAxis,r=e.yAxis,o=e.xAxisSig,a=e.yAxisSig,s=e.paddleAxis,l=e.paddleAxisSig,c=-190*e.paddleSens,d=-190*e.paddleCenter+190-5,u=e.deadzone,f=Number.MIN_VALUE}this.connect=function(t){s=t},this.connectScreen=function(t){l=t},this.powerOn=function(){(g=!!navigator.getGamepads)&&(this.applyPreferences(),r())},this.powerOff=function(){g=!1},this.toggleMode=function(){if(!g)return void l.showOSD("Joysticks unavailable (not supported by browser)",!0,!0);++m>0&&(m=-2),-2===m?c=d=null:-1===m&&(v=60,this.controlsClockPulse()),T=0===m,this.applyPreferences(),r(),l.showOSD("Gamepads "+this.getModeDesc(),!0)},this.setPaddleMode=function(t){g&&(E=t,u.xPosition=f.xPosition=-1)},this.setP1ControlsMode=function(t){b=t,this.applyPreferences()},this.controlsClockPulse=function(){if(g&&-2!==m&&(++v>=60&&(v=0),c||d||0===v)){var t=navigator.getGamepads();c?c.update(t)?c.hasMoved()&&o(c,u,$,_):(c=null,n(!0,!1)):0===v&&(c=i($,h,t))&&n(!0,!0),d?d.update(t)?d.hasMoved()&&o(d,f,h,p):(d=null,n(!1,!1)):0===v&&(d=i(h,$,t))&&n(!1,!0)}};var n=function(t,e){l.showOSD((t^b^T?"P1":"P2")+" Gamepad "+(e?"connected":"disconnected"),t)},i=function(t,n,i){if(i&&0!==i.length){var r=t.device;if(r>=0)return i[r]&&i[r].buttons.length>0?new e(r,t):null;for(var o=0,a=i.length;o<a;o++)if(i[o]&&i[o].buttons.length>0&&!(o===n.device||c&&c.index===o||d&&d.index===o))return new e(o,t)}},r=function(){u=a(),f=a()},o=function(e,n,i,r){if(E&&0!==i.paddleSens){var o=e.getPaddlePosition();o!==n.xPosition&&(n.xPosition=o,t.processControlValue(i.player?S.PADDLE1_POSITION:S.PADDLE0_POSITION,o))}var a=e.getDPadDirection();if(-1!==a||E&&0!==i.paddleSens||(a=e.getStickDirection()),a!==n.direction){var s=!1,l=!1,c=!1,d=!1;switch(a){case 0:s=!0;break;case 1:s=l=!0;break;case 2:l=!0;break;case 3:c=l=!0;break;case 4:c=!0;break;case 5:c=d=!0;break;case 6:d=!0;break;case 7:s=d=!0}t.processKey(r.up.c,s),t.processKey(r.right.c,l),t.processKey(r.down.c,c),t.processKey(r.left.c,d),n.direction=a}var u=e.getButtonDigital(i.button);u!==n.button&&(t.processKey(r.button.c,u),n.button=u),(u=e.getButtonDigital(i.buttonT))!==n.buttonT&&(t.processKey(r.buttonT.c,u),n.buttonT=u);var f=e.getButtonDigital(i.select);f!==n.select&&(t.processControlState(S.SELECT,f),n.select=f);var $=e.getButtonDigital(i.reset);$!==n.reset&&(t.processControlState(S.RESET,$),n.reset=$);var h=e.getButtonDigital(i.pause);h!==n.pause&&(t.processControlState(S.PAUSE,h),n.pause=h);var _=e.getButtonDigital(i.fastSpeed);_!==n.fastSpeed&&(t.processControlState(S.FAST_SPEED,_),n.fastSpeed=_);var p=e.getButtonDigital(i.slowSpeed);p!==n.slowSpeed&&(t.processControlState(S.SLOW_SPEED,p),n.slowSpeed=p)},a=function(){return{direction:-1,button:!1,buttonT:!1,select:!1,reset:!1,fastSpeed:!1,pause:!1,xPosition:-1}};this.getModeDesc=function(){switch(m){case -1:return"AUTO";case 0:return"AUTO (swapped)";default:return g?"DISABLED":"NOT SUPPORTED"}},this.applyPreferences=function(){var t=T?1:0,e=t?0:1;($=C.joystickGamepads[t]).player=b^T?1:0,(h=C.joystickGamepads[e]).player=b^T?0:1,_=C.joystickKeys[t],p=C.joystickKeys[e]};var s,l,c,d,u,f,$,h,_,p,g=!1,v=-1,S=jt.ConsoleControls,m=-1,E=!1,T=!1,b=!1,C=Javatari.userPreferences.current},jt.DOMTouchControls=function(t){"use strict";function e(){T.classList.toggle("jt-poweroff",!k),T.classList.toggle("jt-paused",N)}function n(){var t=O>0;document.documentElement.classList.toggle("jt-touch-active",t),document.documentElement.classList.toggle("jt-dir-big",L),S.touchControlsActiveUpdate(t,L)}function i(t){if(jt.Util.blockEvent(t),null===w){void 0===m&&l();var e=t.changedTouches[0];w=e.identifier,a(e.pageX,e.pageY)}}function r(t){jt.Util.blockEvent(t),null!==w&&(w=null,s(-1))}function o(t){if(jt.Util.blockEvent(t),null!==w){for(var e=t.changedTouches,n=0;n<e.length;++n)if(e[n].identifier===w)return void a(e[n].pageX,e[n].pageY)}}function a(t,e){var n=-1,i=t-m,r=e-E;Math.sqrt(i*i+r*r)>D&&(n=(1-Math.atan2(i,r)/Math.PI)/2,(n+=1/16)>=1&&(n-=1),n=8*n|0),s(n)}function s(e){if(j!==e){e>=0&&t.hapticFeedback();var n=!1,i=!1,r=!1,o=!1;switch(e){case 0:n=!0;break;case 1:n=i=!0;break;case 2:i=!0;break;case 3:r=i=!0;break;case 4:r=!0;break;case 5:r=o=!0;break;case 6:o=!0;break;case 7:n=o=!0}t.processKey(b.up.c,n),t.processKey(b.right.c,i),t.processKey(b.down.c,r),t.processKey(b.left.c,o),j=e}}function l(){var t=R.getBoundingClientRect();D=.14*(t.right-t.left)|0,m=((t.left+t.right)/2|0)+window.pageXOffset,E=((t.top+t.bottom)/2|0)+window.pageYOffset}function c(t){jt.Util.blockEvent(t),u(t.target.jtControl,!0)}function d(t){jt.Util.blockEvent(t),u(t.target.jtControl,!1)}function u(e,n){e&&(n&&t.hapticFeedback(),t.processKey(b[e].c,n))}function f(e){jt.Util.blockEvent(e),t.hapticFeedback(),t.processControlState(k?jt.ConsoleControls.PAUSE:jt.ConsoleControls.POWER,!0)}function $(e){jt.Util.blockEvent(e),t.processControlState(k?jt.ConsoleControls.PAUSE:jt.ConsoleControls.POWER,!1)}function h(e){jt.Util.blockEvent(e),t.processControlState(N?jt.ConsoleControls.FRAME:jt.ConsoleControls.FAST_SPEED,!0)}function _(e){jt.Util.blockEvent(e),t.processControlState(N?jt.ConsoleControls.FRAME:jt.ConsoleControls.FAST_SPEED,!1)}function p(){I.reset(),m=E=void 0,w=null,s(-1)}function g(){this.reset=function(){this.portValue=63},this.reset()}this.connect=function(t){v=t},this.connectScreen=function(t){S=t},this.powerOn=function(){this.applyPreferences(),p(),n()},this.powerOff=function(){},this.releaseControllers=function(){p()},this.updateConsolePanelSize=function(t,e,n,i,r){if(T&&i){var o=!r&&(t-e-10)/2<F;T.classList.toggle("jt-center",o),o?T.style.bottom=jt.ScreenGUI.BAR_HEIGHT+n+3+"px":T.style.removeProperty("bottom")}},this.toggleMode=function(){if(!C)return void S.showOSD("Touch Controls unavailable. Not a touch device!",!0,!0);++O>2&&(O=0),p(),this.applyPreferences(),n(),S.showOSD("Touch Controls "+this.getModeDesc(),!0)},this.setP1ControlsMode=function(t){y=t,this.applyPreferences()},this.getModeDesc=function(){switch(O){case -1:return"AUTO";case 0:return"DISABLED";case 1:return"ENABLED";case 2:return"ENABLED (swapped)"}},this.toggleTouchDirBig=function(){L=!L,P.touch.directionalBig=L,Javatari.userPreferences.setDirty(),n()},this.isDirBig=function(){return L},this.setupTouchControlsIfNeeded=function(t){function n(t,e){var n=document.createElement("div");n.id="jt-touch-"+e,n.classList.add("jt-touch-button"),n.classList.add("jt-touch-button-joy"),n.classList.add("jt-touch-button-joy-"+e),n.jtControl=e,n.addEventListener("touchstart",c),n.addEventListener("touchmove",jt.Util.blockEvent),n.addEventListener("touchend",d),n.addEventListener("touchcancel",d),n.addEventListener("mousedown",c),n.addEventListener("mouseup",d),x[e]=n,t.appendChild(n)}if(!(R||O<=0)){(T=document.createElement("div")).id="jt-touch-speed";var a=document.createElement("div");a.id="jt-touch-pause",a.addEventListener("touchstart",f),a.addEventListener("touchend",$),T.appendChild(a);var s=document.createElement("div");s.id="jt-touch-fast",s.addEventListener("touchstart",h),s.addEventListener("touchend",_),T.appendChild(s),t.appendChild(T);var l=document.createElement("div");l.id="jt-touch-left",(R=function(){function t(t){var n=document.createElement("div");n.classList.add("jt-touch-dir-"+t),e.appendChild(n);var i=document.createElement("div");i.classList.add("jt-arrow-"+t),e.appendChild(i)}var e=document.createElement("div");return e.classList.add("jt-touch-dir"),e.classList.add("jt-touch-dir-joy"),t("left"),t("right"),t("up"),t("down"),e}()).addEventListener("touchstart",i),R.addEventListener("touchmove",o),R.addEventListener("touchend",r),R.addEventListener("touchcancel",r),l.appendChild(R),t.appendChild(l),(l=document.createElement("div")).id="jt-touch-right",n(l,"buttonT"),n(l,"button"),t.appendChild(l),e()}},this.consolePowerAndUserPauseStateUpdate=function(t,n){k=t,N=n,T&&e()},this.applyPreferences=function(){L=!!P.touch.directionalBig;var t=2===O?1:0;b=P.joystickKeys[t]};var v,S,m,E,T,b,C=jt.Util.isTouchDevice(),A=jt.Util.isMobileDevice(),O=Javatari.TOUCH_MODE>=0?Javatari.TOUCH_MODE:C&&A?1:0,y=!1,L=!1,R=null,w=null,j=-1,D=0,x={},I=new g,k=!1,N=!1,P=Javatari.userPreferences.current,F=84;this.saveState=function(){return{}},this.loadState=function(t){p()}},jt.DOMConsoleControls=function(t,e){"use strict";function n(t){x=(j=(w=t)?60/I[w]|0:0)/2|0,D=0}function i(t,e){t.returnValue=!1,t.preventDefault(),t.stopPropagation();var n=jt.DOMKeys.codeForKeyboardEvent(t);return c.processKey(n,e),!1}function r(e,n){if(!y||!f(e=u(e),n)){if(2===t.netPlayMode&&tO.has(e))return t.showOSD("Function not available in NetPlay Client mode",!0,!0);1===t.netPlayMode&&tO.has(e)||V.push(e<<4|n),2!==t.netPlayMode&&o(e,n)}}function o(t,e){p.controlStateChanged(t,e)}function a(e,n){V.push(e+(n+10)),2!==t.netPlayMode&&s(e,n)}function s(t,e){p.controlValueChanged(t,e)}function l(){g.controlsModeStateUpdate()}var c=this;this.connect=function(t){(p=t).connectControls(this),E.connect(t),T.connect(t)},this.connectPeripherals=function(t){g=t,E.connectScreen(t),T.connectScreen(t)},this.addKeyInputElement=function(t){t.addEventListener("keydown",this.keyDown),t.addEventListener("keyup",this.keyUp)},this.setupTouchControlsIfNeeded=function(t){T.setupTouchControlsIfNeeded(t)},this.powerOn=function(){d(),E.powerOn(),T.powerOn(),0===H?$(!1,!1):1===H&&$(!0,!1)},this.powerOff=function(){$(!1,!1),E.powerOff(),T.powerOff()},this.releaseControllers=function(){for(var t in S)S[t]&&(r(t,!1),S[t]=!1);P=F=B=K=!1,C[b.JOY0_BUTTON]=C[b.JOY1_BUTTON]=!1,T.releaseControllers()},this.getTouchControls=function(){return T},this.toggleP1ControlsMode=function(){this.setP1ControlsMode(!O),h(),l()},this.setP1ControlsMode=function(t){O=t,E.setP1ControlsMode(t),T.setP1ControlsMode(t),this.releaseControllers(),_()},this.isP1ControlsMode=function(){return O},this.togglePaddleMode=function(){$(!y,!0),l()},this.isPaddleMode=function(){return y},this.setP1ControlsAndPaddleMode=function(t,e){this.setP1ControlsMode(t),$(e,!1),l()},this.toggleGamepadMode=function(){E.toggleMode(),l()},this.getGamepadModeDesc=function(){return E.getModeDesc()},this.toggleTouchControlsMode=function(){T.toggleMode(),l()},this.toggleTouchDirBig=function(){T.toggleTouchDirBig()},this.toggleTurboFireSpeed=function(){n((w+1)%11),g.showOSD("Turbo Fire"+(w?" speed: "+this.getTurboFireSpeedDesc():": OFF"),!0),A.turboFireSpeed=w,Javatari.userPreferences.setDirty(),Javatari.userPreferences.save()},this.getTurboFireSpeedDesc=function(){return w?w+"x":"OFF"},this.getControlReport=function(t){switch(t){case jt.PeripheralControls.P1_CONTROLS_TOGGLE:return{label:O?"ON":"OFF",active:O};case jt.PeripheralControls.PADDLES_TOGGLE_MODE:return{label:y?"ON":"OFF",active:y};case jt.PeripheralControls.TOUCH_TOGGLE_DIR_BIG:return{label:T.isDirBig()?"ON":"OFF",active:T.isDirBig()};case jt.PeripheralControls.HAPTIC_FEEDBACK_TOGGLE_MODE:return{label:R?"ON":"OFF",active:!!R};case jt.PeripheralControls.TURBO_FIRE_TOGGLE:return{label:this.getTurboFireSpeedDesc(),active:!!w}}return{label:"Unknown",active:!1}},this.consolePowerAndUserPauseStateUpdate=function(t,e){T.consolePowerAndUserPauseStateUpdate(t,e)},this.keyDown=function(t){return i(t,!0)},this.keyUp=function(t){return i(t,!1)},this.controlsClockPulse=function(){if(j){if(--D===x||0===D){var t=D>0;C[b.JOY0_BUTTON]&&r(b.JOY0_BUTTON,t),C[b.JOY1_BUTTON]&&r(b.JOY1_BUTTON,t)}D<=0&&(D=j)}E.controlsClockPulse(),y&&(F?P||((k-=N)<0&&(k=0),a(b.PADDLE0_POSITION,k)):P&&((k+=N)>380&&(k=380),a(b.PADDLE0_POSITION,k)),K?B||((U-=M)<0&&(U=0),a(b.PADDLE1_POSITION,U)):B&&((U+=M)>380&&(U=380),a(b.PADDLE1_POSITION,U)))},this.toggleHapticFeedback=function(){L?(R=!R,A.hapticFeedback=R,Javatari.userPreferences.setDirty()):g.showOSD("Haptic Feedback not available",!0,!0)},this.hapticFeedback=function(){R&&navigator.vibrate(8)},this.hapticFeedbackOnTouch=function(t){R&&("touchstart"===t.type||"touchend"===t.type||"touchmove"===t.type)&&navigator.vibrate(8)},this.cartridgeInserted=function(t){if(t&&!(H>=0)){var e=1===t.rom.info.p;y!==e&&$(e,!1)}},this.processKey=function(t,n){var i=m[t];if(i){if(n===C[i])return;n&&(D=x),C[i]=n}else{if(!(i=v[t]))return e.processKey(t,n);if(n===S[i])return;S[i]=n}r(i,n)},this.applyPreferences=function(){_(),n(A.turboFireSpeed),T.applyPreferences(),E.applyPreferences()},window.CTRL=this.processControlState=r,this.processControlValue=a;var d=function(){window.onhelp=function(){return!1}},u=function(t){switch(t){case b.JOY0_BUTTON:return b.PADDLE0_BUTTON;case b.JOY1_BUTTON:return b.PADDLE1_BUTTON;default:return t}},f=function(t,e){if(e)switch(t){case b.JOY0_LEFT:return P=!0,!0;case b.JOY0_RIGHT:return F=!0,!0;case b.JOY0_UP:return N<10&&N++,g.showOSD("P1 Paddle speed: "+N,!0),!0;case b.JOY0_DOWN:return N>1&&N--,g.showOSD("P1 Paddle speed: "+N,!0),!0;case b.JOY1_LEFT:return B=!0,!0;case b.JOY1_RIGHT:return K=!0,!0;case b.JOY1_UP:return M<10&&M++,g.showOSD("P2 Paddle speed: "+M,!0),!0;case b.JOY1_DOWN:return M>1&&M--,g.showOSD("P2 Paddle speed: "+M,!0),!0}else switch(t){case b.JOY0_LEFT:return P=!1,!0;case b.JOY0_RIGHT:return F=!1,!0;case b.JOY1_LEFT:return B=!1,!0;case b.JOY1_RIGHT:return K=!1,!0}return!1},$=function(e,n){y!==e&&c.releaseControllers(),y=e,N=M=2,k=U=y?190:-1,2!==t.netPlayMode&&(a(b.PADDLE0_POSITION,k),a(b.PADDLE1_POSITION,U)),E.setPaddleMode(y),n&&h()},h=function(){g.showOSD("Controllers: "+(y?"Paddles":"Joysticks")+(O?", Swapped":""),!0)},_=function(){var t=jt.DOMKeys;S={},m={},(v={})[G]=b.POWER,v[G|t.ALT]=b.POWER,v[G|t.SHIFT]=b.POWER_FRY,v[G|t.SHIFT|t.ALT]=b.POWER_FRY,v[z]=b.BLACK_WHITE,v[z|t.ALT]=b.BLACK_WHITE,v[J]=b.SELECT,v[J|t.ALT]=b.SELECT,v[W]=b.RESET,v[W|t.ALT]=b.RESET,v[Y]=b.DIFFICULTY0,v[Y|t.ALT]=b.DIFFICULTY0,v[Z]=b.DIFFICULTY1,v[Z|t.ALT]=b.DIFFICULTY1,v[X]=b.FAST_SPEED,v[X|t.ALT]=b.FAST_SPEED,v[X|t.SHIFT]=b.SLOW_SPEED,v[X|t.SHIFT|t.ALT]=b.SLOW_SPEED,v[q|t.SHIFT|t.ALT]=b.INC_SPEED,v[Q|t.SHIFT|t.ALT]=b.DEC_SPEED,v[tt|t.SHIFT|t.ALT]=b.NORMAL_SPEED,v[te|t.SHIFT|t.ALT]=b.MIN_SPEED,v[tn|t.ALT]=b.PAUSE,v[tn|t.SHIFT|t.ALT]=b.PAUSE_AUDIO_ON,v[ti|t.ALT]=b.FRAME,v[tr|t.ALT]=b.FRAME,v[ta|t.ALT]=b.TRACE,v[ts|t.ALT]=b.SHOW_INFO,v[to|t.ALT]=b.DEBUG,v[tl|t.ALT]=b.NO_COLLISIONS,v[tc|t.ALT]=b.VIDEO_STANDARD,v[td|t.ALT]=b.VIDEO_STANDARD,v[tu|t.ALT]=b.VSYNCH,v[tf|t.CONTROL]=b.SAVE_STATE_0,v[t$|t.CONTROL]=b.SAVE_STATE_0,v[tf|t.CONTROL|t.ALT]=b.SAVE_STATE_0,v[t$|t.CONTROL|t.ALT]=b.SAVE_STATE_0,v[th|t.CONTROL]=b.SAVE_STATE_1,v[th|t.CONTROL|t.ALT]=b.SAVE_STATE_1,v[t_|t.CONTROL]=b.SAVE_STATE_2,v[t_|t.CONTROL|t.ALT]=b.SAVE_STATE_2,v[tp|t.CONTROL]=b.SAVE_STATE_3,v[tp|t.CONTROL|t.ALT]=b.SAVE_STATE_3,v[tg|t.CONTROL]=b.SAVE_STATE_4,v[tg|t.CONTROL|t.ALT]=b.SAVE_STATE_4,v[t0|t.CONTROL]=b.SAVE_STATE_5,v[t0|t.CONTROL|t.ALT]=b.SAVE_STATE_5,v[tv|t.CONTROL]=b.SAVE_STATE_6,v[tv|t.CONTROL|t.ALT]=b.SAVE_STATE_6,v[t8|t.CONTROL]=b.SAVE_STATE_7,v[t8|t.CONTROL|t.ALT]=b.SAVE_STATE_7,v[tS|t.CONTROL]=b.SAVE_STATE_8,v[tS|t.CONTROL|t.ALT]=b.SAVE_STATE_8,v[tm|t.CONTROL]=b.SAVE_STATE_9,v[tm|t.CONTROL|t.ALT]=b.SAVE_STATE_9,v[tE|t.CONTROL]=b.SAVE_STATE_10,v[tE|t.CONTROL|t.ALT]=b.SAVE_STATE_10,v[tT|t.CONTROL]=b.SAVE_STATE_11,v[tb|t.CONTROL]=b.SAVE_STATE_11,v[tT|t.CONTROL|t.ALT]=b.SAVE_STATE_11,v[tb|t.CONTROL|t.ALT]=b.SAVE_STATE_11,v[tC|t.CONTROL]=b.SAVE_STATE_12,v[tA|t.CONTROL]=b.SAVE_STATE_12,v[tC|t.CONTROL|t.ALT]=b.SAVE_STATE_12,v[tA|t.CONTROL|t.ALT]=b.SAVE_STATE_12,v[tf|t.ALT]=b.LOAD_STATE_0,v[t$|t.ALT]=b.LOAD_STATE_0,v[th|t.ALT]=b.LOAD_STATE_1,v[t_|t.ALT]=b.LOAD_STATE_2,v[tp|t.ALT]=b.LOAD_STATE_3,v[tg|t.ALT]=b.LOAD_STATE_4,v[t0|t.ALT]=b.LOAD_STATE_5,v[tv|t.ALT]=b.LOAD_STATE_6,v[t8|t.ALT]=b.LOAD_STATE_7,v[tS|t.ALT]=b.LOAD_STATE_8,v[tm|t.ALT]=b.LOAD_STATE_9,v[tE|t.ALT]=b.LOAD_STATE_10,v[tT|t.ALT]=b.LOAD_STATE_11,v[tb|t.ALT]=b.LOAD_STATE_11,v[tC|t.ALT]=b.LOAD_STATE_12,v[tA|t.ALT]=b.LOAD_STATE_12,v[tf|t.SHIFT|t.CONTROL]=b.SAVE_STATE_0,v[t$|t.SHIFT|t.CONTROL]=b.SAVE_STATE_0,v[tf|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_0,v[t$|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_0,v[th|t.SHIFT|t.CONTROL]=b.SAVE_STATE_1,v[th|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_1,v[t_|t.SHIFT|t.CONTROL]=b.SAVE_STATE_2,v[t_|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_2,v[tp|t.SHIFT|t.CONTROL]=b.SAVE_STATE_3,v[tp|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_3,v[tg|t.SHIFT|t.CONTROL]=b.SAVE_STATE_4,v[tg|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_4,v[t0|t.SHIFT|t.CONTROL]=b.SAVE_STATE_5,v[t0|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_5,v[tv|t.SHIFT|t.CONTROL]=b.SAVE_STATE_6,v[tv|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_6,v[t8|t.SHIFT|t.CONTROL]=b.SAVE_STATE_7,v[t8|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_7,v[tS|t.SHIFT|t.CONTROL]=b.SAVE_STATE_8,v[tS|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_8,v[tm|t.SHIFT|t.CONTROL]=b.SAVE_STATE_9,v[tm|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_9,v[tE|t.SHIFT|t.CONTROL]=b.SAVE_STATE_10,v[tE|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_10,v[tT|t.SHIFT|t.CONTROL]=b.SAVE_STATE_11,v[tb|t.SHIFT|t.CONTROL]=b.SAVE_STATE_11,v[tT|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_11,v[tb|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_11,v[tC|t.SHIFT|t.CONTROL]=b.SAVE_STATE_12,v[tA|t.SHIFT|t.CONTROL]=b.SAVE_STATE_12,v[tC|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_12,v[tA|t.SHIFT|t.CONTROL|t.ALT]=b.SAVE_STATE_12,v[tf|t.SHIFT|t.ALT]=b.LOAD_STATE_0,v[t$|t.SHIFT|t.ALT]=b.LOAD_STATE_0,v[th|t.SHIFT|t.ALT]=b.LOAD_STATE_1,v[t_|t.SHIFT|t.ALT]=b.LOAD_STATE_2,v[tp|t.SHIFT|t.ALT]=b.LOAD_STATE_3,v[tg|t.SHIFT|t.ALT]=b.LOAD_STATE_4,v[t0|t.SHIFT|t.ALT]=b.LOAD_STATE_5,v[tv|t.SHIFT|t.ALT]=b.LOAD_STATE_6,v[t8|t.SHIFT|t.ALT]=b.LOAD_STATE_7,v[tS|t.SHIFT|t.ALT]=b.LOAD_STATE_8,v[tm|t.SHIFT|t.ALT]=b.LOAD_STATE_9,v[tE|t.SHIFT|t.ALT]=b.LOAD_STATE_10,v[tT|t.SHIFT|t.ALT]=b.LOAD_STATE_11,v[tb|t.SHIFT|t.ALT]=b.LOAD_STATE_11,v[tC|t.SHIFT|t.ALT]=b.LOAD_STATE_12,v[tA|t.SHIFT|t.ALT]=b.LOAD_STATE_12;var e=O?1:0,n=O?0:1;v[A.joystickKeys[e].left.c]=b.JOY0_LEFT,v[A.joystickKeys[e].up.c]=b.JOY0_UP,v[A.joystickKeys[e].right.c]=b.JOY0_RIGHT,v[A.joystickKeys[e].down.c]=b.JOY0_DOWN,v[A.joystickKeys[e].button.c]=b.JOY0_BUTTON,v[A.joystickKeys[n].left.c]=b.JOY1_LEFT,v[A.joystickKeys[n].up.c]=b.JOY1_UP,v[A.joystickKeys[n].right.c]=b.JOY1_RIGHT,v[A.joystickKeys[n].down.c]=b.JOY1_DOWN,v[A.joystickKeys[n].button.c]=b.JOY1_BUTTON,m[A.joystickKeys[e].buttonT.c]=b.JOY0_BUTTON,m[A.joystickKeys[n].buttonT.c]=b.JOY1_BUTTON};this.netGetControlsToSend=function(){return V.length?V:void 0},this.netClearControlsToSend=function(){V.length=0},this.netServerProcessControlsChanges=function(t){for(var e=0,n=t.length;e<n;++e){var i=t[e];i<16e3?(tO.has(i>>4)||V.push(i),o(i>>4,1&i)):s(-16384&i,(16383&i)-10)}},this.netClientApplyControlsChanges=function(t){for(var e=0,n=t.length;e<n;++e){var i=t[e];i<16e3?o(i>>4,1&i):s(-16384&i,(16383&i)-10)}};var p,g,v,S,m,E,T,b=jt.ConsoleControls,C={},A=Javatari.userPreferences.current,O=!1,y=!1,L=!!navigator.vibrate,R=L&&!!A.hapticFeedback,w=0,j=0,D=0,x=0,I=[0,1,2,2.4,3,4,5,6,7.5,10,12],k=0,N=3,P=!1,F=!1,U=0,M=3,B=!1,K=!1,V=Array(100);V.length=0;var H=Javatari.PADDLES_MODE,G=jt.DOMKeys.VK_F1.c,z=jt.DOMKeys.VK_F2.c,J=jt.DOMKeys.VK_F11.c,W=jt.DOMKeys.VK_F12.c,Y=jt.DOMKeys.VK_F4.c,Z=jt.DOMKeys.VK_F9.c,X=jt.DOMKeys.VK_TAB.c,q=jt.DOMKeys.VK_UP.c,Q=jt.DOMKeys.VK_DOWN.c,tt=jt.DOMKeys.VK_RIGHT.c,te=jt.DOMKeys.VK_LEFT.c,tn=jt.DOMKeys.VK_P.c,ti=jt.DOMKeys.VK_O.c,tr=jt.DOMKeys.VK_F.c,to=jt.DOMKeys.VK_D.c,ta=jt.DOMKeys.VK_VOID,ts=jt.DOMKeys.VK_I.c,tl=jt.DOMKeys.VK_C.c,tc=jt.DOMKeys.VK_V.c,td=jt.DOMKeys.VK_Q.c,tu=jt.DOMKeys.VK_W.c,tf=jt.DOMKeys.VK_QUOTE.c,t$=jt.DOMKeys.VK_BACKQUOTE.c,th=jt.DOMKeys.VK_1.c,t_=jt.DOMKeys.VK_2.c,tp=jt.DOMKeys.VK_3.c,tg=jt.DOMKeys.VK_4.c,t0=jt.DOMKeys.VK_5.c,tv=jt.DOMKeys.VK_6.c,t8=jt.DOMKeys.VK_7.c,tS=jt.DOMKeys.VK_8.c,tm=jt.DOMKeys.VK_9.c,tE=jt.DOMKeys.VK_0.c,tT=jt.DOMKeys.VK_MINUS.c,tb=jt.DOMKeys.VK_FF_MINUS.c,tC=jt.DOMKeys.VK_EQUALS.c,tA=jt.DOMKeys.VK_FF_EQUALS.c,tO=new Set([b.SAVE_STATE_0,b.SAVE_STATE_1,b.SAVE_STATE_2,b.SAVE_STATE_3,b.SAVE_STATE_4,b.SAVE_STATE_5,b.SAVE_STATE_6,b.SAVE_STATE_7,b.SAVE_STATE_8,b.SAVE_STATE_9,b.SAVE_STATE_10,b.SAVE_STATE_11,b.SAVE_STATE_12,b.SAVE_STATE_FILE,b.LOAD_STATE_0,b.LOAD_STATE_1,b.LOAD_STATE_2,b.LOAD_STATE_3,b.LOAD_STATE_4,b.LOAD_STATE_5,b.LOAD_STATE_6,b.LOAD_STATE_7,b.LOAD_STATE_8,b.LOAD_STATE_9,b.LOAD_STATE_10,b.LOAD_STATE_11,b.LOAD_STATE_12,b.POWER_FRY,b.VSYNCH,b.TRACE,b.CARTRIDGE_FORMAT]);E=new jt.GamepadConsoleControls(c),T=new jt.DOMTouchControls(c),c.applyPreferences(),jt.DOMConsoleControls.hapticFeedback=this.hapticFeedback,jt.DOMConsoleControls.hapticFeedbackOnTouch=this.hapticFeedbackOnTouch},jt.ScreenGUI=jt.Util.isMobileDevice()?{BAR_HEIGHT:29,BAR_MENU_WIDTH:150,BAR_MENU_ITEM_HEIGHT:33,BAR_MENU_ITEM_FONT_SIZE:14,LOGO_SCREEN_WIDTH:618,LOGO_SCREEN_HEIGHT:455,TOUCH_CONTROLS_LEFT_WIDTH:119,TOUCH_CONTROLS_LEFT_WIDTH_BIG:143,TOUCH_CONTROLS_RIGHT_WIDTH:80}:{BAR_HEIGHT:29,BAR_MENU_WIDTH:140,BAR_MENU_ITEM_HEIGHT:29,BAR_MENU_ITEM_FONT_SIZE:13,LOGO_SCREEN_WIDTH:618,LOGO_SCREEN_HEIGHT:455,TOUCH_CONTROLS_LEFT_WIDTH:119,TOUCH_CONTROLS_LEFT_WIDTH_BIG:143,TOUCH_CONTROLS_RIGHT_WIDTH:80},jt.ScreenGUI.html=function(){return'<div id="jt-screen-fs" tabindex="0"> <div id="jt-screen-fs-center" tabindex="-1"> <div id="jt-screen-canvas-outer"> <canvas id="jt-screen-canvas" tabindex="-1"></canvas> <img id="jt-canvas-loading-icon" draggable="false" src="#"> <div id="jt-unmute-message"></div> <div id="jt-logo"> <div id="jt-logo-center"> <img id="jt-logo-loading-icon" draggable="false" src="#"> <img id="jt-logo-image" draggable="false" src="#"> <div id="jt-logo-message"> <div id="jt-logo-message-text"></div> <div id="jt-logo-message-ok"> <div id="jt-logo-message-ok-text"></div> </div> </div> </div> </div> <div id="jt-osd"></div> </div> <div id="jt-bar"> <div id="jt-bar-inner"></div> </div> <div id="jt-console-panel" class="jt-console-panel" tabindex="-1"> </div> </div> <div id="jt-screen-scroll-message"> Swipe up/down on the Screen <br>to hide the browser bars! </div> </div>'},jt.ScreenGUI.htmlConsolePanel='<div id="jt-console-panel-p0-diff-label" class="jt-console-panel-p0-diff-label jt-console-panel-icon"></div> <div id="jt-console-panel-p1-diff-label" class="jt-console-panel-p1-diff-label jt-console-panel-icon"></div> <div id="jt-console-panel-power-labels" class="jt-console-panel-power-labels jt-console-panel-icon"></div> <div id="jt-console-panel-reset-labels" class="jt-console-panel-reset-labels jt-console-panel-icon"></div> <div id="jt-console-panel-power" class="jt-console-panel-power jt-console-panel-lever"></div> <div id="jt-console-panel-color" class="jt-console-panel-color jt-console-panel-lever"></div> <div id="jt-console-panel-select" class="jt-console-panel-select jt-console-panel-lever"></div> <div id="jt-console-panel-reset" class="jt-console-panel-reset jt-console-panel-lever"></div> <div id="jt-console-panel-p0-diff" class="jt-console-panel-p0-diff jt-console-panel-switch"></div> <div id="jt-console-panel-p1-diff" class="jt-console-panel-p1-diff jt-console-panel-switch"></div> <div id="jt-console-panel-cart-image" class="jt-console-panel-cart-image"></div> <div id="jt-console-panel-cart-load" class="jt-console-panel-cart-load"></div> <div id="jt-console-panel-cart-file" class="jt-console-panel-cart-file jt-console-panel-icon"></div> <div id="jt-console-panel-cart-url" class="jt-console-panel-cart-url jt-console-panel-icon"></div> <div id="jt-console-panel-cart-label" class="jt-console-panel-cart-label"></div>',jt.ScreenGUI.css=function(){return"html.jt-full-screen-scroll-hack body { position: absolute; width: 100%; height: "+Math.max(1280,1.4*Math.max(screen.width,screen.height)|0)+"px; top: 0; left: 0; margin: 0; padding: 0; border: none; overflow-x: hidden; overflow-y: auto; } #jt-screen-fs, #jt-screen-fs div, #jt-screen-fs canvas { outline: none; } #"+Javatari.SCREEN_ELEMENT_ID+" { display: inline-block; visibility: hidden; font-family: sans-serif; font-weight: normal; margin: 0; padding: 0; border: 1px solid black; background: black; overflow: visible; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-touch-callout: none; touch-callout: none; -webkit-tap-highlight-color: transparent; tap-highlight-color: transparent; -webkit-text-size-adjust: none; -moz-text-size-adjust: none; text-size-adjust: none; } html.jt-full-screen #"+Javatari.SCREEN_ELEMENT_ID+" { display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; box-shadow: none; z-index: 2147483646;    /* one behind fsElement */ } html.jt-started #"+Javatari.SCREEN_ELEMENT_ID+" { visibility: visible; } #jt-screen-scroll-message { position: absolute; bottom: 150%; left: 50%; height: 0; width: 0; margin: 0; padding: 0; font-size: 16px; line-height: 28px; white-space: nowrap; color: hsl(0, 0%, 4%); background: hsl(0, 0%, 92%); border-radius: 15px; transform: translate(-50%, 0); box-shadow: 2px 2px 9px rgba(0, 0, 0, 0.7); transition: all 1.7s step-end, opacity 1.6s linear; overflow: hidden; opacity: 0; z-index: -1; } html.jt-full-screen-scroll-hack #jt-screen-fs.jt-scroll-message #jt-screen-scroll-message { opacity: 1; bottom: 23%; width: 215px; height: 56px; padding: 13px 20px; z-index: 60; transition: none; } #jt-screen-fs { position: relative; background: black; text-align: center; -webkit-tap-highlight-color: rgba(0,0,0,0); tap-highlight-color: rgba(0,0,0,0) } html.jt-full-screen #jt-screen-fs { position: absolute; width: 100%; height: 100%; left: 0; bottom: 0; right: 0; z-index: 2147483647; } html.jt-full-screen-scroll-hack #jt-screen-fs { position: fixed; bottom: 0; height: 100vh; } html.jt-full-screen #jt-screen-fs-center {      /* Used to center and move things horizontally in Landscape Full Screen */ position: absolute; top: 0; bottom: 0; left: 0; right: 0; } #jt-screen-canvas-outer { display: inline-block; position: relative; overflow: hidden; vertical-align: top; line-height: 1px; z-index: 3; } #jt-screen-canvas { display: block; } #jt-bar { position: relative; left: 0; right: 0; height: "+this.BAR_HEIGHT+"px; margin: 0 auto; border-top: 1px solid black; background: hsl(0, 0%, 16%); overflow: visible;                    /* for the Menu to show through */ box-sizing: content-box; z-index: 40; } #jt-bar-inner { position: absolute; overflow: hidden; top: 0; bottom: 0; left: 0; right: 0; text-align: left; } html.jt-bar-auto-hide #jt-bar, html.jt-full-screen #jt-bar { position: absolute; bottom: 0; transition: height 0.08s ease-in-out; } html.jt-bar-auto-hide #jt-bar.jt-hidden { transition: height 0.5s ease-in-out; height: 0; bottom: -1px; } @media only screen and (orientation: landscape) { html.jt-full-screen #jt-bar.jt-hidden { transition: height 0.5s ease-in-out; height: 0; bottom: -1px; } } #jt-bar.jt-narrow .jt-narrow-hidden { display: none; } .jt-bar-button { display: inline-block; width: 24px; height: 28px; margin: 0 1px;  background-repeat: no-repeat; background-size: 264px 82px; cursor: pointer; } /* Firefox-specific rules */ @-moz-document url-prefix() { .jt-bar-button { image-rendering: optimizequality; } } /* .jt-bar-button { border: 1px solid yellow; background-origin: border-box; box-sizing: border-box; } */ #jt-bar-power { margin: 0 3px 0 6px; } #jt-bar-netplay.jt-hidden { display: none; } #jt-bar-select { margin: 0 2px 0 9px; width: 50px; } #jt-bar-reset { margin: 0 2px; width: 50px; } html.jt-console-panel-active #jt-bar-select, html.jt-console-panel-active #jt-bar-reset { display: none; } #jt-bar-settings, #jt-bar-full-screen, #jt-bar-scale-plus, #jt-bar-scale-minus { float: right; margin: 0; } #jt-bar-settings { margin-right: 5px; } #jt-bar-full-screen.jt-mobile { margin: 0 6px; } #jt-bar-scale-plus { width: 21px; } #jt-bar-scale-minus { width: 18px; } #jt-bar-text { float: right; width: 32px; } #jt-bar-text.jt-mobile { margin: 0 0 0 6px; } #jt-bar-console-panel { position: absolute; left: 2px; right: 0; width: 39px; margin: 0 auto; } #jt-bar.jt-narrow #jt-bar-console-panel { position: static; float: right; margin-right: 3px; } #jt-bar-logo { position: absolute; left: 0; right: 0; width: 34px; margin: 0 auto; } html:not(.jt-console-panel-active) #jt-bar.jt-narrow #jt-bar-logo { display: none; } #jt-bar-menu { position: absolute; display: none; bottom: "+this.BAR_HEIGHT+"px; font-size: "+this.BAR_MENU_ITEM_FONT_SIZE+"px; line-height: 1px; overflow: hidden; transform-origin: bottom center; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; } #jt-bar-menu-inner { display: inline-block; padding-bottom: 2px; border: 1px solid black; background: hsl(0, 0%, 16%); } .jt-bar-menu-item, #jt-bar-menu-title { position: relative; display: none; width: "+this.BAR_MENU_WIDTH+"px; height: "+this.BAR_MENU_ITEM_HEIGHT+"px; color: rgb(205, 205, 205); border: none; padding: 0; line-height: "+this.BAR_MENU_ITEM_HEIGHT+'px; text-shadow: 1px 1px 1px black; background: transparent; outline: none; overflow: hidden; backface-visibility: hidden; -webkit-backface-visibility: hidden; cursor: pointer; box-sizing: border-box; } #jt-bar-menu-title { display: block; color: white; font-weight: bold; border-bottom: 1px solid black; margin-bottom: 1px; text-align: center; background: rgb(70, 70, 70); cursor: auto; } .jt-bar-menu-item.jt-hover:not(.jt-bar-menu-item-disabled):not(.jt-bar-menu-item-divider) { color: white; background: hsl(358, 67%, 46%); } .jt-bar-menu-item-disabled { color: rgb(110, 110, 110); } .jt-bar-menu-item-divider { height: 1px; margin: 1px 0; background: black; } .jt-bar-menu-item-toggle { text-align: left; padding-left: 30px; } .jt-bar-menu-item-toggle::after { content: ""; position: absolute; width: 6px; height: 19px; top: '+((this.BAR_MENU_ITEM_HEIGHT-21)/2|0)+"px; left: 10px; background: rgb(70, 70, 70); box-shadow: black 1px 1px 1px; } .jt-bar-menu-item-toggle.jt-bar-menu-item-toggle-checked { color: white; } .jt-bar-menu-item-toggle.jt-bar-menu-item-toggle-checked::after { background: rgb(248, 33, 28); } #jt-console-panel { display: none; position: absolute; bottom: -"+(jt.ConsolePanel.DEFAULT_HEIGHT+2)+"px; left: 50%; transform: translate(-50%, 0); transform-origin: center top; margin: 0 auto; border: 1px solid black; z-index: 30; } html.jt-console-panel-active #jt-console-panel { display: block; } html.jt-full-screen #jt-console-panel { bottom: "+(jt.ScreenGUI.BAR_HEIGHT+2)+'px; border: none; transform-origin: center bottom; } .jt-select-dialog { position: absolute; overflow: hidden; display: none; top: 0; bottom: 0; left: 0; right: 0; width: 540px; max-width: 92%; height: 297px; margin: auto; color: white; font-size: 18px; line-height: 21px; background: hsl(0, 0%, 16%); padding: 11px 0 0; text-align: center; border: 1px solid black; box-sizing: initial; text-shadow: 1px 1px 1px black; box-shadow: 3px 3px 15px 2px rgba(0, 0, 0, .4); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; cursor: auto; z-index: 50; } .jt-select-dialog.jt-show { display: block; } .jt-select-dialog > .jt-footer { position: absolute; width: 100%; bottom: 7px; font-size: 13px; text-align: center; color: rgb(170, 170, 170); } .jt-select-dialog > ul { position: relative; width: 88%; top: 5px; margin: auto; padding: 0; list-style: none; font-size: 14px; color: hsl(0, 0%, 88%); } .jt-select-dialog > ul li { display: none; position: relative; overflow: hidden; height: 26px; background: rgb(70, 70, 70); margin: 7px 0; padding: 11px 10px 0 18px;       /* Space on the left for the toggle mark for all lines */ line-height: 0; text-align: left; text-overflow: ellipsis; border: 2px dashed transparent; box-shadow: 1px 1px 1px rgba(0, 0, 0, .5); white-space: nowrap; box-sizing: border-box; cursor: pointer; } .jt-select-dialog > ul li.jt-visible { display: block; } .jt-select-dialog > ul li.jt-selected { color: white; background: hsl(358, 67%, 46%); } .jt-select-dialog > ul li.jt-droptarget { color: white; border-color: lightgray; } .jt-select-dialog > ul li.jt-toggle::after { content: ""; position: absolute; width: 6px; height: 17px; top: 2px; left: 6px; background: rgb(60, 60, 60); box-shadow: black 1px 1px 1px; } .jt-select-dialog > ul li.jt-toggle-checked::after { background: rgb(248, 33, 28); } #jt-cartridge-format.jt-select-dialog > ul { width: 100%; height: 226px; margin: 7px auto 0; padding: 0 0 0 30px; overflow-y: auto; box-sizing: border-box; } #jt-cartridge-format.jt-select-dialog > ul li { width: 280px; margin: 7px 0 2px 0; } #jt-cartridge-format.jt-select-dialog > ul li:first-child { margin-top: 0; } #jt-cartridge-format ::-webkit-scrollbar { width: 12px; } #jt-cartridge-format ::-webkit-scrollbar-track { background: transparent; } #jt-cartridge-format ::-webkit-scrollbar-thumb { border: solid transparent; border-width: 1px 1px 1px 2px; background: rgb(80, 80, 80); background-clip: content-box; } #jt-cartridge-format ul.jt-quick-options-list { width: 230px; margin: 18px 0 0 52px; } #jt-cartridge-format ul.jt-quick-options-list li div { height: 24px; line-height: 24px; } #jt-cartridge-format .jt-control { width: 60px; line-height: 24px; } /* Firefox-specific rules */ @-moz-document url-prefix() { /* Try to hide scrollbar, since we cant style it :-( */ #jt-cartridge-format.jt-select-dialog > ul { width: 304px; } } #jt-logo { position: absolute; display: none; top: 0; bottom: 0; left: 0; right: 0; background: black; } #jt-logo.jt-show { display: block; } #jt-logo-center { position: absolute; top: 50%; left: 50%; width: 598px; height: 456px; transform: translate(-50%, -50%); } #jt-logo-image { position: absolute; top: 50%; left: 50%; width: 335px; max-width: 57%; transform: translate(-50%, -50%); -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } #jt-screen-fs.jt-logo-message-active #jt-logo-image { top: 128px; width: 37%; max-width: initial; } #jt-logo-loading-icon, #jt-canvas-loading-icon { display: none; position: absolute; top: 79%; left: 0; right: 0; width: 14%; height: 3%; margin: 0 auto; background-color: rgba(0, 0, 0, .8); border: solid transparent; border-width: 8px 30px; border-radius: 3px; box-sizing: content-box; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } #jt-screen-fs.jt-logo-message-active #jt-logo-loading-icon { top: 204px; } #jt-unmute-message { display: none; position: absolute; left: 50%; bottom: 5px; height: 30px; padding: 0 10px; margin: 0 auto; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 500; font-size: 15px; line-height: 30px; color: rgb(210, 210, 210); background: rgba(0, 0, 0, 0.7); transform-origin: bottom center; transform: translate(-50%, 0); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; } #jt-unmute-message::before { content: ""; display: inline-block; width: 24px; height: 20px; margin: 5px 9px 0 0;  background-repeat: no-repeat; background-size: 24px 20px; vertical-align: top; } #jt-unmute-message::after { content: "Audio is muted. Click to unmute"; } #jt-unmute-message.jt-show { display: inline-block; } #jt-logo-message { display: none; position: absolute; top: 226px; width: 100%; color: hsl(0, 0%, 97%); font-size: 29px; line-height: 34px; } #jt-screen-fs.jt-logo-message-active #jt-logo-message { display: block; } #jt-logo-message-ok { display: block; position: absolute; top: 91px; left: 193px; width: 214px; height: 130px; } #jt-logo-message-ok.jt-higher { top: 74px; } #jt-logo-message-ok-text { position: absolute; top: 49%; left: 50%; width: 120px; height: 47px; font-size: 23px; line-height: 47px; background: hsl(358, 67%, 46%); border-radius: 6px; color: white; transform: translate(-50%, -50%); } #jt-osd { position: absolute; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; top: -29px; right: 16px; height: 29px; padding: 0 12px; margin: 0; font-weight: bold; font-size: 15px; line-height: 29px; color: rgb(0, 255, 0); background: rgba(0, 0, 0, 0.7); transform-origin: top right; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; opacity: 0; } .jt-arrow-up, .jt-arrow-down, .jt-arrow-left, .jt-arrow-right { border: 0px solid transparent; box-sizing: border-box; } .jt-arrow-up    { border-bottom-color: inherit; } .jt-arrow-down  { border-top-color: inherit; } .jt-arrow-left  { border-right-color: inherit; } .jt-arrow-right { border-left-color: inherit; } .jt-quick-options-list { margin-top: 12px; padding: 0; list-style: none; color: hsl(0, 0%, 88%); } .jt-quick-options-list li { margin-top: 8px; line-height: 1px; text-align: left; } .jt-quick-options-list li div { display: inline-block; overflow: hidden; height: 26px; font-size: 14px; line-height: 26px; text-overflow: ellipsis; white-space: nowrap; box-sizing: border-box; } .jt-quick-options-list .jt-control { float: right; width: 86px; font-size: 15px; line-height: 25px; color: hsl(0, 0%, 70%); background: black; text-align: center; cursor: pointer; } .jt-quick-options-list .jt-control.jt-selected { color: white; background: hsl(358, 67%, 46%); box-shadow: 1px 1px 1px rgba(0, 0, 0, .5); } .jt-quick-options-list .jt-control.jt-selected.jt-inactive { line-height: 21px; border: 2px dashed hsl(358, 67%, 46%); background: black; } #jt-quick-options { display: none; position: absolute; top: 0; bottom: 0; left: 0; right: 0; width: 233px; height: 345px; margin: auto; padding: 11px 14px 0; color: white; font-size: 18px; line-height: 22px; background: hsl(0, 0%, 16%); text-align: center; border: 1px solid black; box-sizing: initial; text-shadow: 1px 1px 1px black; box-shadow: 3px 3px 15px 2px rgba(0, 0, 0, .4); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; cursor: auto; z-index: 50; } #jt-quick-options.jt-show { display: block; } #jt-quick-options::before { content: "Quick Options"; display: block; } #jt-netplay { display: none; position: absolute; top: 0; bottom: 0; left: 0; right: 0; width: 390px; height: 220px; margin: auto; padding-top: 11px; color: white; font-size: 18px; line-height: 22px; background: hsl(0, 0%, 16%); text-align: center; border: 1px solid black; box-sizing: initial; text-shadow: 1px 1px 1px black; box-shadow: 3px 3px 15px 2px rgba(0, 0, 0, .4); transform-origin: left center; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; cursor: auto; z-index: 50; } #jt-netplay.jt-show { display: block; } #jt-netplay::before { content: "Net Play!"; display: block; } #jt-netplay-status-box { position: relative; margin-top: 17px; } #jt-netplay-status { display: inline-block; position: relative; width: 340px; font-size: 15px; line-height: 27px; background: black; vertical-align: top; text-shadow: none; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; box-sizing: border-box; cursor: auto; } #jt-netplay-status-box.jt-active #jt-netplay-status { padding: 0 16px 0 12px; } #jt-netplay-status-box.jt-active #jt-netplay-status::after { content: ""; position: absolute; width: 6px; height: 18px; top: 4px; left: 7px; background: rgb(248, 33, 28); } #jt-netplay-link { display: none; position: absolute; right: 25px; top: 0; width: 26px; height: 27px; color: white; font-size: 15px; font-weight: 600; line-height: 27px; text-decoration: none; background: black; text-align: center; } #jt-netplay-link:hover { background: hsl(358, 67%, 46%); cursor: pointer; } #jt-netplay-status-box.jt-active #jt-netplay-link { display: block; } .jt-netplay-button { display: inline-block; width: 86px; padding: 0; margin: 0; font-size: 15px; line-height: 26px; color: white; background: hsl(358, 67%, 46%); text-shadow: 1px 1px 1px black; border: none; box-shadow: 1px 1px 1px rgba(0, 0, 0, .5); cursor: pointer; } #jt-netplay-session-box { margin-top: 18px; } #jt-netplay-session-label, #jt-netplay-nick-label { font-size: 15px; margin-bottom: 4px; } #jt-netplay-session-label::before { content: "Session Name"; } #jt-netplay-session-box input { width: 150px; height: 26px; padding: 0 10px; margin: 0 8px; font-size: 15px; line-height: 26px; background: rgb(240, 240, 240); border: none; border-radius: 0; box-sizing: border-box; outline: none; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; cursor: auto; } #jt-netplay-nick-label { margin-top: 10px; } #jt-netplay-nick-label::before { content: "User Nickname"; } .jt-netplay-button:disabled { color: rgb(130, 130, 130); background: rgb(70, 70, 70); cursor: default; } #jt-netplay input:disabled { color: black; background: rgb(180, 180, 180); cursor: default; } #jt-netplay-session-box.jt-disabled div { color: rgb(130, 130, 130); } input#jt-netplay-link-text { position: absolute; top: 8px; left: 50px; width: 1px; height: 1px; padding: 0; margin: 0; border: none; color: transparent; background: transparent; opacity: 0; z-index: -10; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; } #jt-touch-left, #jt-touch-right, #jt-touch-speed { display: none; position: absolute; z-index: 1; } html.jt-full-screen.jt-touch-active #jt-touch-left, html.jt-full-screen.jt-touch-active #jt-touch-right, html.jt-full-screen.jt-touch-active #jt-touch-speed { display: block; } .jt-touch-dir { width: 130px; height: 130px; color: hsl(0, 0%, 75%); border-radius: 100%; } .jt-touch-dir::before { content: ""; position: absolute; top: 14px; left: 14px; right: 14px; bottom: 14px; border: 1px solid hsl(0, 0%, 26%); border-radius: 100%; } .jt-touch-dir-joy .jt-touch-dir-up, .jt-touch-dir-joy .jt-touch-dir-left { position: absolute; background: hsl(0, 0%, 31%); border-radius: 2px 2px 0 0; box-shadow: inset 1px 2px 0px hsl(0, 0%, 43%), inset -1px -1px hsl(0, 0%, 19%), 0 3px 0 1px hsl(0, 0%, 21%); } .jt-touch-dir-joy .jt-touch-dir-up { width: 26px; height: 78px; top: 24px; left: 52px; } .jt-touch-dir-joy .jt-touch-dir-left { width: 78px; height: 25px; top: 51px; left: 26px; } .jt-touch-dir-joy .jt-touch-dir-left::before { content: ""; position: absolute; top: 2px; left: 23px; width: 33px; height: 22px; background: inherit; z-index: 1; } .jt-touch-dir-joy .jt-touch-dir-left::after { content: ""; position: absolute; top: 4px; left: 30px; height: 17px; width: 17px; border-radius: 100%; box-shadow:  inset 0 0 2px hsl(0, 0%, 22%), inset 1px 2px 3px 1px hsl(0, 0%, 26%), inset -1px -2px 1px hsl(0, 0%, 64%); z-index: 2; } .jt-touch-dir .jt-arrow-up, .jt-touch-dir .jt-arrow-down, .jt-touch-dir .jt-arrow-left, .jt-touch-dir .jt-arrow-right { position: absolute; border-width: 5px; z-index: 2; } .jt-touch-dir .jt-arrow-up { top: 26px; left: 60px; border-bottom-width: 11px; } .jt-touch-dir .jt-arrow-down { bottom: 29px; left: 60px; border-top-width: 11px; } .jt-touch-dir .jt-arrow-left { top: 58px; left: 26px; border-right-width: 11px; } .jt-touch-dir .jt-arrow-right { top: 58px; right: 26px; border-left-width: 11px; } .jt-touch-button { position: relative; display: block; width: 72px; height: 72px; font-size: 20px; line-height: 67px; color: hsl(0, 0%, 79%); border-radius: 100%; cursor: default; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; z-index: 0; } .jt-touch-button::before { content: ""; position: absolute; box-sizing: border-box; z-index: -1; } .jt-touch-button-joy::before, .jt-touch-button-none::before { width: 50px; height: 48px; top: 9px; left: 11px; border-radius: 100%; } #jt-screen-fs.jt-touch-config-active .jt-touch-button-none::before { border: 2px solid hsl(0, 0%, 30%); } .jt-touch-button-joy.jt-touch-button-joy-button::before { border: none; background: hsl(1, 70%, 37%); box-shadow: inset -2px -7px 3px 1px hsl(1, 68%, 43%), inset 0px 0px 1px 9px hsl(1, 72%, 33%), 0px -1px 0px 1px hsl(1, 70%, 47%), 0px 1px 0px 2px hsl(1, 70%, 29%); } .jt-touch-button-joy.jt-touch-button-joy-buttonT::before { border: none; background: hsl(220, 72%, 39%); box-shadow: inset -2px -7px 3px 1px hsl(220, 70%, 43%), inset 0px 0px 1px 9px hsl(220, 75%, 34%), 0px -1px 0px 1px hsl(220, 72%, 50%), 0px 1px 0px 2px hsl(220, 72%, 28%); } #jt-touch-button  { z-index: 7 } #jt-touch-buttonT { z-index: 6 } #jt-touch-speed.jt-center { width: 84px; left: 0; right: 0; margin: 0 auto; } #jt-touch-speed.jt-center.jt-poweroff #jt-touch-pause { margin-left: 21px } #jt-touch-pause, #jt-touch-fast { float: left; width: 42px; height: 42px; border-color: hsl(0, 0%, 70%); } #jt-touch-pause::after, #jt-touch-fast::before, #jt-touch-fast::after { content: ""; display: inline-block; border: 0 solid transparent; box-sizing: border-box; } #jt-touch-pause::after { margin-top: 14px; width: 13px; height: 14px; border-width: 0; border-left-width: 4px; border-left-color: inherit; border-right-width: 4px; border-right-color: inherit; } #jt-touch-fast::before, #jt-touch-fast::after { margin-top: 14px; width: 11px; height: 14px; border-width: 7px; border-left-width: 11px; border-left-color: inherit; border-right-width: 0; } #jt-touch-speed.jt-paused #jt-touch-pause::after, #jt-touch-speed.jt-poweroff #jt-touch-pause::after { margin: 12px 0 0 3px; width: 15px; height: 18x; border-width: 9px; border-left-width: 15px; border-right-width: 0; } #jt-touch-speed.jt-paused  #jt-touch-fast::after { width: 7px; border-width: 0; border-left-width: 3px; } #jt-touch-speed.jt-poweroff #jt-touch-fast { display: none; } .jt-console-panel { width:'+jt.ConsolePanel.DEFAULT_WIDTH+"px; height:"+jt.ConsolePanel.DEFAULT_HEIGHT+"px; background-size: 460px 134px; box-shadow: "+jt.ConsolePanel.sameBoxShadowAsScreen()+'; outline: none; } html.jt-full-screen .jt-console-panel { box-shadow: none; } .jt-console-panel-icon { position: absolute; background-size: 264px 82px; } .jt-console-panel-switch { position: absolute; bottom: 107px; width: 50px; height: 26px; opacity: 0; cursor: pointer; } .jt-console-panel-switch:after { content: ""; position: absolute; left: 11px; bottom: 5px; width: 27px; height: 16px; background-size: 256px 93px; } .jt-console-panel-lever { position: absolute; bottom: 30px; width: 44px; height: 72px; cursor: pointer; } .jt-console-panel-lever:after { content: ""; position: absolute; left: 12px; bottom: 8px; width: 20px; height: 46px; background-size: 256px 93px; } .jt-console-panel-power { left: 19px; } .jt-console-panel-power:after { background-position: 0px 0px; } .jt-console-panel-color { left: 84px; } .jt-console-panel-color:after { background-position: -21px 0px; } .jt-console-panel-select { left: 340px; } .jt-console-panel-select:after { background-position: 0px -47px; } .jt-console-panel-reset { left: 403px; } .jt-console-panel-reset:after { background-position: -21px -47px; } .jt-console-panel-p0-diff { left: 152px; } .jt-console-panel-p0-diff:after { background-position: -229px -17px; } .jt-console-panel-p1-diff { left: 265px; } .jt-console-panel-p1-diff:after { background-position: -229px 0px; } .jt-console-panel-cart-image { position: absolute; left: 140px; bottom: 9px; width: 186px; height: 82px; background-size: 256px 93px; background-position: -42px 0px; } .jt-console-panel-cart-load { position: absolute; left: 141px; bottom: 36px; width: 184px; height: 55px; cursor: pointer; } .jt-console-panel-cart-file { left: 170px; bottom: 3px; width: 31px; height: 30px; background-position: -132px -6px; cursor: pointer; } .jt-console-panel-cart-url { left: 266px; bottom: 3px; width: 31px; height: 30px; background-position: -161px -6px; cursor: pointer; } .jt-console-panel-cart-label { position: absolute; top: 51px; left: 156px; width: 148px; height: 25px; padding: 0px 2px; margin: 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 14px; line-height: 25px; font-family: sans-serif; text-align: center; color: black; background: black; border: 1px solid transparent; opacity: 1; cursor: pointer; } .jt-console-panel-power-labels { left: 31px; bottom: 9px; width: 88px; height: 15px; background-position: -135px -37px; } .jt-console-panel-reset-labels { right: 16px; bottom: 9px; width: 96px; height: 15px; background-position: -135px -55px; } .jt-console-panel-p0-diff-label { left: 128px; top: 8px; width: 29px; height: 15px; background-position: -233px -37px; } .jt-console-panel-p1-diff-label { left: 313px; top: 8px; width: 28px; height: 15px; background-position: -233px -55px; } .jt-hide-labels .jt-console-panel-p0-diff-label, .jt-hide-labels .jt-console-panel-p1-diff-label, .jt-hide-labels .jt-console-panel-power-labels, .jt-hide-labels .jt-console-panel-reset-labels, .jt-hide-labels .jt-console-panel-cart-file, .jt-hide-labels .jt-console-panel-cart-url { visibility: hidden; } @media only screen and (orientation: landscape) {    /* Landscape */ #jt-touch-left { left: calc(-6px - '+this.TOUCH_CONTROLS_LEFT_WIDTH+"px); bottom: 50%; transform: translateY(50%); } html.jt-full-screen.jt-touch-active.jt-dir-big  #jt-touch-left { left: calc(-6px - "+this.TOUCH_CONTROLS_LEFT_WIDTH_BIG+"px); transform: translateY(50%) scale(1.2); transform-origin: left center; } #jt-touch-right { right: calc(5px - "+this.TOUCH_CONTROLS_RIGHT_WIDTH+"px); bottom: 50%; transform: translateY(50%); } #jt-touch-speed { position: absolute; left: -103px; top: 10px; } html.jt-full-screen.jt-touch-active.jt-dir-big  #jt-touch-speed { left: -118px; } /* Adjust centered elements leaving space to the touch controls on both sides */ html.jt-full-screen.jt-touch-active #jt-screen-fs-center { left: "+this.TOUCH_CONTROLS_LEFT_WIDTH+"px; right: "+this.TOUCH_CONTROLS_RIGHT_WIDTH+"px; } html.jt-full-screen.jt-touch-active.jt-dir-big #jt-screen-fs-center { left: "+this.TOUCH_CONTROLS_LEFT_WIDTH_BIG+"px; } } @media only screen and (orientation: portrait) {    /* Portrait */ #jt-touch-left { left: 2px; bottom: 200px; } html.jt-full-screen.jt-touch-active.jt-dir-big  #jt-touch-left { transform: scale(1.2); transform-origin: left center; } #jt-touch-right { right: 5px; bottom: 144px; width: 112px; height: 112px; } #jt-touch-speed { position: absolute; left: 19px; bottom: "+(this.BAR_HEIGHT+12)+"px; } .jt-touch-button { position: absolute; } #jt-touch-button { bottom: 50%; right: 50%; } #jt-touch-buttonT { bottom: 100%; right: 0%; } } @media only screen and (orientation: portrait) and (max-device-height: 638px) {    /* Medium Portrait. Like iPhone 5 */ #jt-touch-left { bottom: 156px; } #jt-touch-right { bottom: 100px; } } @media only screen and (orientation: portrait) and (max-device-height: 518px) {    /* Short Portrait. Like iPhone 4 */ #jt-touch-left { bottom: 98px; } #jt-touch-right { bottom: 42px; } html.jt-console-panel-active #jt-touch-left { bottom: 106px; } html.jt-console-panel-active #jt-touch-right { bottom: 52px; } html.jt-full-screen.jt-console-panel-active #jt-touch-speed { display: none; } } "},jt.Monitor=function(t){"use strict";function e(t){return Math.round(10*(t<.5?.5:t>2.5?2.5:t))/10}function n(t){return Math.round(10*(t<.5?.5:t))/10}var i=this;this.connect=function(t){(g=t).connectMonitor(this)},this.nextLine=function(t,e){var n=!1;return x<S?x>=O&&x<O+b&&p.set(t,(x-O)*v):n=o(),x++,w||N++,e&&(w||a(),n|=r()),n};var r=function(){return!(x<m)&&(F&&t.showOSD(D.name+"  "+x+" lines",!0),x=0,I++,!0)},o=function(){return x>E&&r()};this.setVideoStandard=function(t){D=t,v=t.totalWidth,m=(S=t.totalHeight)-K,E=S+K+V,k&&(C=D.defaultHeightPct,y=D.defaultOriginYPct),c(T,C),l(A,y)};var a=function(){var t=N;N=0,(t>=250&&t<=281||t>=300&&t<=325)&&++j>=5&&s(t)},s=function(t){w=t<290?jt.VideoStandard.NTSC:jt.VideoStandard.PAL;var e=P,n=t-w.totalHeight;(n=n>2?(n>6?6:n)-2:0)!=e&&(P=n,i.setVideoStandard(w))};this.videoSignalOff=function(){x=0,t.videoSignalOff()};var l=function(t,e){(A=t)<0?A=0:A>v-T&&(A=v-T),(y=e)<0?y=0:y/100*S>S-b&&(y=(S-b)/S*100),(O=y/100*S+P/2|0)+b>S&&(O=S-b)},c=function(t,e){(T=t)<10?T=10:T>v&&(T=v),(C=e)<10?C=10:C>100&&(C=100),(b=C/100*(S+P)|0)>S&&(b=S),$.width=T,$.height=b,l(A,y),d()},d=function(){t&&t.displayMetrics(T,b)},u=function(){k=!0,A=B,y=D.defaultOriginYPct,c(U,D.defaultHeightPct)},f=function(){($=document.createElement("canvas")).width=U,$.height=M,(h=$.getContext("2d",{alpha:!1,antialias:!1})).globalCompositeOperation="copy",h.globalAlpha=1,_=h.createImageData(jt.VideoStandard.PAL.totalWidth,jt.VideoStandard.PAL.totalHeight),p=new Uint32Array(_.data.buffer)};this.currentLine=function(){return x},this.refresh=function(){h.putImageData(_,-A,0,A,0,T,b),t.refresh($,T,b)},this.videoStandardDetectionStart=function(){w=null,j=0,N=0},this.getVideoStandardDetected=function(){return w},this.toggleShowInfo=function(){(F=!F)||t.showOSD(null,!0)},this.signalOff=function(){t.videoSignalOff()},this.showOSD=function(e,n,i){t.showOSD(e,n,i)},this.setDefaults=function(){u(),t.crtModeSetDefault(),t.crtFilterSetDefault(),t.requestReadjust(!0)},this.setDebugMode=function(e){t.setDebugMode(e)},this.crtModeToggle=function(){t.crtModeToggle()},this.crtFilterToggle=function(){t.crtFilterToggle()},this.fullscreenToggle=function(){t.displayToggleFullscreen()},this.displayAspectDecrease=function(){this.displayScale(e(L-H),R),this.showOSD("Display Aspect: "+L.toFixed(2)+"x",!0)},this.displayAspectIncrease=function(){this.displayScale(e(L+H),R),this.showOSD("Display Aspect: "+L.toFixed(2)+"x",!0)},this.displayScaleDecrease=function(){this.displayScale(L,n(R-H)),this.showOSD("Display Size: "+R.toFixed(2)+"x",!0)},this.displayScaleIncrease=function(){this.displayScale(L,n(R+H)),this.showOSD("Display Size: "+R.toFixed(2)+"x",!0)},this.viewportOriginDecrease=function(){k=!1,l(A,y+G),this.showOSD("Viewport Origin: "+O,!0)},this.viewportOriginIncrease=function(){k=!1,l(A,y-G),this.showOSD("Viewport Origin: "+O,!0)},this.viewportSizeDecrease=function(){u(),this.showOSD("Viewport Size: Standard",!0)},this.viewportSizeIncrease=function(){k=!1,c(v,100),this.showOSD("Viewport Size: Full Signal",!0)},this.displayScale=function(e,n){L=e,R=n,t.displayScale(L,R)},this.controlStateChanged=function(e,n){t.controlStateChanged(e,n)},this.controlsStatesRedefined=function(){t.controlsStatesRedefined()},this.consolePowerAndUserPauseStateUpdate=function(e,n){t.consolePowerAndUserPauseStateUpdate(e,n)},this.cartridgeInserted=function(e){t.cartridgeInserted(e)};var $,h,_,p,g,v,S,m,E,T,b,C,A,O,y,L,R,w,j,D=jt.VideoStandard.NTSC,x=0,I=0,k=!0,N=0,P=0,F=!1,U=160,M=213,B=68,K=16,V=5,H=.1,G=.4;f(),u(),i.setVideoStandard(D)},jt.ConsolePanel=function(t,e){"use strict";function n(){d(),u(),p()}function i(e){jt.Util.blockEvent(e),k||(v.hapticFeedbackOnTouch(e),t.closeAllOverlays(),e.target.jtPressed=!0,v.processControlState(e.target.jtControl,!0))}function r(t){jt.Util.blockEvent(t),t.target.jtPressed=!1,k||(v.hapticFeedbackOnTouch(t),v.processControlState(t.target.jtControl,!1))}function o(t){t.target.jtPressed&&r(t)}function a(e,n,i){i||v.hapticFeedbackOnTouch(e),n||(t.closeAllOverlays(),S.controlActivated(e.target.jtControl))}this.connectPeripherals=function(t,n,i){v=n,S=i,t.registerForDnD(e)},this.connect=function(t){m=t},this.setActive=function(t){(x=t)&&(T||n(),l(),c()),document.documentElement.classList.toggle("jt-console-panel-active",x)},this.setLogoMessageActive=function(t){k=t},this.updateScale=function(t,n,i){var r=0,o=0;if(x){var a=Math.min(1,(t=n?i?.85*t:t-36:.85*t)/jt.ConsolePanel.DEFAULT_WIDTH);e.style.transform=a<1?"translateX(-50%) scale("+a.toFixed(8)+")":"translateX(-50%)",r=Math.ceil(a*jt.ConsolePanel.DEFAULT_HEIGHT),o=Math.ceil(a*jt.ConsolePanel.DEFAULT_WIDTH)}return v&&v.getTouchControls().updateConsolePanelSize(t,o,r,n,i),r};var s=function(){h(T,!I[g.POWER]),h(b,I[g.BLACK_WHITE]),h(C,I[g.SELECT]),h(A,I[g.RESET]),h(O,I[g.DIFFICULTY0]),h(y,I[g.DIFFICULTY1]),l()},l=function(){if(h(L,E),h(D,E),D.innerHTML=E&&E.rom.info.l||P,E&&E.rom.info.lc){var t=E.rom.info.lc.trim().split(/\s+/);D.style.color=t[0]||F,D.style.background=t[1]||U,D.style.borderColor=t[2]||M}else D.style.color=F,D.style.background=U,D.style.borderColor=M},c=function(){m.controlsStateReport(I),s()},d=function(){e.innerHTML=jt.ScreenGUI.htmlConsolePanel,delete jt.ScreenGUI.htmlConsolePanel,jt.Util.isMobileDevice()&&e.classList.add("jt-hide-labels")},u=function(){f(T=document.getElementById("jt-console-panel-power"),g.POWER,!0),f(b=document.getElementById("jt-console-panel-color"),g.BLACK_WHITE,!0),f(C=document.getElementById("jt-console-panel-select"),g.SELECT,!0),f(A=document.getElementById("jt-console-panel-reset"),g.RESET,!0),f(O=document.getElementById("jt-console-panel-p0-diff"),g.DIFFICULTY0,!0),f(y=document.getElementById("jt-console-panel-p1-diff"),g.DIFFICULTY1,!0),L=document.getElementById("jt-console-panel-cart-image"),$(R=document.getElementById("jt-console-panel-cart-load"),jt.PeripheralControls.CARTRIDGE_LOAD_RECENT),w=document.getElementById("jt-console-panel-cart-file"),j=document.getElementById("jt-console-panel-cart-url"),Javatari.CARTRIDGE_CHANGE_DISABLED?(_(w),_(j)):($(w,jt.PeripheralControls.CARTRIDGE_LOAD_RECENT),$(j,jt.PeripheralControls.AUTO_LOAD_URL))},f=function(t,e,n){t.jtControl=e,n?(t.jtPressed=!1,jt.Util.addEventsListener(t,"mousedown touchstart",i),jt.Util.addEventsListener(t,"mouseup touchend touchcancel",r),jt.Util.addEventsListener(t,"mouseleave",o)):jt.Util.onTapOrMouseDown(t,i)},$=function(t,e){t.jtControl=e,t.jtNeedsUIG=!0,jt.Util.onTapOrMouseDownWithBlockUIG(t,a)},h=function(t,e){t.style.opacity=e?1:0},_=function(t,e){t.style.display="none"},p=function(){var t=(Javatari.CARTRIDGE_LABEL_COLORS||"").trim().split(/\s+/);t[0]&&(F=t[0]),t[1]&&(U=t[1]),t[2]&&(M=t[2]),$(D=document.getElementById("jt-console-panel-cart-label"),jt.PeripheralControls.CARTRIDGE_LOAD_RECENT)},g=jt.ConsoleControls;this.controlStateChanged=function(t,e){x&&N[t]&&c()},this.controlsStatesRedefined=function(){x&&c()},this.cartridgeInserted=function(t){E=t,x&&l()};var v,S,m,E,T,b,C,A,O,y,L,R,w,j,D,x=!1,I={},k=!1,N={};N[g.POWER]=1,N[g.BLACK_WHITE]=1,N[g.SELECT]=1,N[g.RESET]=1,N[g.DIFFICULTY0]=1,N[g.DIFFICULTY1]=1;var P="JAVATARI",F="#fa2525",U="#101010",M="transparent"},jt.ConsolePanel.DEFAULT_WIDTH=460,jt.ConsolePanel.DEFAULT_HEIGHT=134,jt.ConsolePanel.shouldStartActive=function(){return!Javatari.SCREEN_CONSOLE_PANEL_DISABLED&&(-1===Javatari.CONSOLE_PANEL_ELEMENT_ID||document.getElementById(Javatari.CONSOLE_PANEL_ELEMENT_ID))},jt.ConsolePanel.sameBoxShadowAsScreen=function(){var t=document.getElementById(Javatari.SCREEN_ELEMENT_ID);return t?window.getComputedStyle(t,null).getPropertyValue("box-shadow"):"none"},jt.CanvasDisplay=function(room,mainElement){"use strict";function init(){jt.Util.insertCSS(jt.ScreenGUI.css()),delete jt.ScreenGUI.css,setupMain(),setupBar(),setupFullscreen(),consolePanel=new jt.ConsolePanel(self,consolePanelElement),monitor=new jt.Monitor(self)}function consolePanelUpdateForOrientation(){setConsolePanelActive(isFullscreen&&isLandscape?consolePanelActiveLandscape:consolePanelActivePortrait)}function setConsolePanelActive(t){consolePanelActive!==t&&(consolePanelActive=t,consolePanel.setActive(consolePanelActive),updateScale(),consolePanelActive?showBar():cursorHideFrameCountdown=CURSOR_HIDE_FRAMES)}function hideOSD(){osd.style.transition="all 0.15s linear",osd.style.top="-29px",osd.style.opacity=0,osdShowing=!1}function releaseControllersOnLostFocus(){consoleControlsSocket.releaseControllers()}function hideCursorAndBar(){hideCursor(),hideBar(),cursorHideFrameCountdown=-1}function showCursorAndBar(t){showCursor(),!t&&mousePointerLocked||showBar(),cursorHideFrameCountdown=CURSOR_HIDE_FRAMES}function showCursor(){cursorShowing||(fsElement.style.cursor=cursorType,cursorShowing=!0)}function hideCursor(){cursorShowing&&(fsElement.style.cursor="none",cursorShowing=!1)}function fullscreenByAPIChanged(){var t=isFullscreen,e=isFullScreenByAPI();e||fullScreenAPIExitUserRequested||!isBrowserStandalone?setFullscreenState(e):self.requestReadjust(),t&&!e&&!fullScreenAPIExitUserRequested&&isMobileDevice&&(isBrowserStandalone?setEnterFullscreenByAPIOnFirstTouch():(atariConsole.systemPause(!0),showLogoMessage("<br>Emulation suspended","RESUME",!0,function(){self.setFullscreen(!0),atariConsole.systemPause(!1)}))),fullScreenAPIExitUserRequested=!1}function isFullScreenByAPI(){return!!document[fullScreenAPIQueryProp]}function enterFullScreenByAPI(){if(fullscreenAPIEnterMethod)try{fullscreenAPIEnterMethod.call(fsElement)}catch(t){}}function exitFullScreenByAPI(){if(fullScreenAPIExitMethod)try{fullScreenAPIExitUserRequested=!0,fullScreenAPIExitMethod.call(document)}catch(t){}}function updateScale(){var t=Math.round(targetWidth*scaleY*aspectX*2),e=Math.round(targetHeight*scaleY);canvas.style.width=t+"px",canvas.style.height=e+"px",updateBarWidth(t),signalIsOn||updateLogoScale(),settingsDialog&&settingsDialog.isVisible()&&settingsDialog.position(),updateConsolePanelScale(t)}function updateBarWidth(t){var e=buttonsBarDesiredWidth>0?buttonsBarDesiredWidth:t;buttonsBar.style.width=-1===buttonsBarDesiredWidth?"100%":e+"px",buttonsBar.classList.toggle("jt-narrow",e<NARROW_WIDTH)}function updateConsolePanelScale(t){var e=consolePanel.updateScale(t,isFullscreen,isLandscape);mainElement.style.marginBottom=!isFullscreen&&e>0?Math.ceil(e+3)+"px":"initial"}function updateCanvasContentSize(){var t=crtFilterEffective>0?CANVAS_SIZE_FACTOR:1;canvas.width=targetWidth*t,canvas.height=targetHeight*t,canvasContext=null}function setCRTFilter(t){crtFilterEffective=-2===(crtFilter=t)?null:-1===crtFilter?crtFilterAutoValue():t,updateCanvasContentSize()}function crtFilterAutoValue(){return isMobileDevice&&!isIOSDevice&&"FIREFOX"===browserName?0:1}function setCRTMode(t){crtModeEffective=-1===(crtMode=t)?crtModeAutoValue():crtMode,canvasContext=null}function crtModeAutoValue(){return isMobileDevice?0:1}function updateLogo(){signalIsOn||(updateLogoScale(),showCursorAndBar(!0),canvasContext&&canvasContext.clearRect(0,0,canvas.width,canvas.height)),logo.classList.toggle("jt-show",!signalIsOn)}function updateLoading(){var t=isLoading?"block":"none";logoLoadingIcon.style.display=t,canvasLoadingIcon.style.display=t}function createCanvasContext(){canvasContext=canvas.getContext("2d",{alpha:!1,antialias:!1}),setImageComposition(),setImageSmoothing()}function setImageComposition(){crtModeEffective>0&&!debugMode?(canvasContext.globalCompositeOperation="source-over",canvasContext.globalAlpha=.8):(canvasContext.globalCompositeOperation="copy",canvasContext.globalAlpha=1)}function setImageSmoothing(){if(canvas.style.imageRendering=0===crtFilterEffective||2===crtFilterEffective?canvasImageRenderingValue:"initial",null!==crtFilterEffective){var t=crtFilterEffective>=2;void 0!==canvasContext.imageSmoothingEnabled?canvasContext.imageSmoothingEnabled=t:(canvasContext.webkitImageSmoothingEnabled=t,canvasContext.mozImageSmoothingEnabled=t,canvasContext.msImageSmoothingEnabled=t)}}function suppressContextMenu(t){t.addEventListener("contextmenu",jt.Util.blockEvent)}function preventDrag(t){t.ondragstart=jt.Util.blockEvent}function setupMain(){switch(mainElement.innerHTML=jt.ScreenGUI.html(),mainElement.tabIndex=-1,delete jt.ScreenGUI.html,fsElement=document.getElementById("jt-screen-fs"),fsElementCenter=document.getElementById("jt-screen-fs-center"),canvasOuter=document.getElementById("jt-screen-canvas-outer"),canvas=document.getElementById("jt-screen-canvas"),canvasLoadingIcon=document.getElementById("jt-canvas-loading-icon"),osd=document.getElementById("jt-osd"),logo=document.getElementById("jt-logo"),logoCenter=document.getElementById("jt-logo-center"),logoImage=document.getElementById("jt-logo-image"),logoLoadingIcon=document.getElementById("jt-logo-loading-icon"),logoMessage=document.getElementById("jt-logo-message"),logoMessageText=document.getElementById("jt-logo-message-text"),logoMessageOK=document.getElementById("jt-logo-message-ok"),logoMessageOKText=document.getElementById("jt-logo-message-ok-text"),scrollMessage=document.getElementById("jt-screen-scroll-message"),unmuteMessage=document.getElementById("jt-unmute-message"),consolePanelElement=document.getElementById("jt-console-panel"),suppressContextMenu(mainElement),preventDrag(logoImage),preventDrag(logoLoadingIcon),preventDrag(canvasLoadingIcon),updateCanvasContentSize(),browserName){case"CHROME":case"EDGE":case"OPERA":default:canvasImageRenderingValue="pixelated";break;case"FIREFOX":canvasImageRenderingValue="-moz-crisp-edges";break;case"SAFARI":canvasImageRenderingValue="-webkit-optimize-contrast"}setupMainEvents()}function setupMainEvents(){(isMobileDevice?canvasOuter:fsElement).addEventListener("mousemove",function(){showCursorAndBar()}),"onblur"in document?fsElement.addEventListener("blur",releaseControllersOnLostFocus,!0):fsElement.addEventListener("focusout",releaseControllersOnLostFocus,!0),window.addEventListener("orientationchange",function(){closeAllOverlays(),signalIsOn?hideCursorAndBar():showCursorAndBar(),self.requestReadjust()}),mainElement.addEventListener("drop",closeAllOverlays,!0),logoMessageOK.jtNeedsUIG=logoMessageOKText.jtNeedsUIG=!0,jt.Util.onTapOrMouseDownWithBlockUIG(logoMessageOK,self.closeLogoMessage),jt.Util.addEventsListener(fsElementCenter,"touchstart touchend mousedown",function(t){"touchend"!==t.type?(closeAllOverlays(),showCursorAndBar()):t.cancelable&&t.preventDefault()})}function setupBar(){buttonsBar=document.getElementById("jt-bar"),buttonsBarInner=document.getElementById("jt-bar-inner"),BAR_AUTO_HIDE&&(document.documentElement.classList.add("jt-bar-auto-hide"),fsElement.addEventListener("mouseleave",hideBar),hideBar());var t=[{label:"Power",clickModif:0,control:jt.PeripheralControls.CONSOLE_POWER_TOGGLE},{label:"Fry Console",control:jt.PeripheralControls.CONSOLE_POWER_FRY},{label:"",divider:!0},{label:"Net Play!",control:jt.PeripheralControls.SCREEN_OPEN_NETPLAY},{label:"",divider:!0},{label:"Select Cartridge",control:jt.PeripheralControls.CARTRIDGE_LOAD_RECENT},{label:"Set ROM Format",clickModif:KEY_SHIFT_MASK,control:jt.PeripheralControls.CARTRIDGE_CHOOSE_FORMAT},{label:"",divider:!0},{label:"Open File",clickModif:KEY_CTRL_MASK,control:jt.PeripheralControls.AUTO_LOAD_FILE,needsUIG:!0},{label:"Open URL",clickModif:KEY_CTRL_MASK|KEY_ALT_MASK,control:jt.PeripheralControls.AUTO_LOAD_URL,needsUIG:!0},{label:"",divider:!0},{label:"Load State",control:jt.PeripheralControls.CONSOLE_LOAD_STATE_MENU},{label:"Save State",control:jt.PeripheralControls.CONSOLE_SAVE_STATE_MENU}];powerButton=addBarButton("jt-bar-power",-5,-26,"System Power",null,!1,t,"System"),barMenuSystem=t,self.consolePowerAndUserPauseStateUpdate(!1,!1),(netplayButton=addBarButton("jt-bar-netplay",-192,-1,"NetPlay!",jt.PeripheralControls.SCREEN_OPEN_NETPLAY)).classList.add("jt-hidden"),settingsButton=isMobileDevice?addBarButton("jt-bar-settings",-33,-26,"Quick Options",jt.PeripheralControls.SCREEN_OPEN_QUICK_OPTIONS,!1):addBarButton("jt-bar-settings",-33,-26,"Settings",null,!1,t=[{label:"Help & Settings",clickModif:0,control:jt.PeripheralControls.SCREEN_OPEN_SETTINGS},{label:"Quick Options",control:jt.PeripheralControls.SCREEN_OPEN_QUICK_OPTIONS},{label:"Defaults",control:jt.PeripheralControls.SCREEN_DEFAULTS}],"Settings"),gameSelectButton=addBarButton("jt-bar-select",-78,-51,"Game Select",jt.ConsoleControls.SELECT,!0),gameResetButton=addBarButton("jt-bar-reset",-33,-51,"Game Reset",jt.ConsoleControls.RESET,!0),-2!==FULLSCREEN_MODE&&((fullscreenButton=addBarButton("jt-bar-full-screen",-103,-1,"Full Screen",jt.PeripheralControls.SCREEN_FULLSCREEN,!1)).jtNeedsUIG=!0,isMobileDevice&&fullscreenButton.classList.add("jt-mobile")),Javatari.SCREEN_RESIZE_DISABLED||isMobileDevice||((scaleUpButton=addBarButton("jt-bar-scale-plus",-80,-1,"Increase Screen",jt.PeripheralControls.SCREEN_SCALE_PLUS,!1)).classList.add("jt-full-screen-hidden"),(scaleDownButton=addBarButton("jt-bar-scale-minus",-58,-1,"Decrease Screen",jt.PeripheralControls.SCREEN_SCALE_MINUS,!1)).classList.add("jt-full-screen-hidden")),addBarButton("jt-bar-console-panel",-61,-25,"Toggle Console Panel",jt.PeripheralControls.SCREEN_CONSOLE_PANEL_TOGGLE,!1).classList.add("jt-full-screen-only"),(logoButton=addBarButton("jt-bar-logo",-99,-26,"About Javatari",jt.PeripheralControls.SCREEN_OPEN_ABOUT,!1)).classList.add("jt-full-screen-hidden"),jt.Util.onTapOrMouseDownWithBlockUIG(buttonsBar,barElementTapOrMouseDown),jt.Util.addEventsListener(buttonsBar,"touchmove",barElementTouchMove),jt.Util.addEventsListener(buttonsBar,"mouseup touchend",barElementTouchEndOrMouseUp)}function addBarButton(t,e,n,i,r,o,a,s){var l=document.createElement("div");return l.id=t,l.classList.add("jt-bar-button"),l.jtBarElementType=1,l.jtControl=r,l.jtIsConsoleControl=o,l.style.backgroundPosition=e+"px "+n+"px",l.jtBX=e,a&&(l.jtMenu=a,a.jtTitle=s,a.jtRefElement=l,a.jtMenuIndex=barMenus.length,barMenus.push(a)),i&&(l.title=i),l.addEventListener("mouseenter",function(t){barButtonHoverOver(t.target,t)}),o&&l.addEventListener("mouseleave",barButtonMouseLeft),buttonsBarInner.appendChild(l),l}function barButtonTapOrMousedown(t,e,n,i){if(i||consoleControls.hapticFeedbackOnTouch(e),!logoMessageActive&&!n){var r=barMenuActive;if(closeAllOverlays(),t.jtControl)return void(e.button||(t.jtIsConsoleControl?(barConsoleControlPressed=t.jtControl,consoleControls.processControlState(barConsoleControlPressed,!0)):peripheralControls.controlActivated(t.jtControl)));var o=t.jtMenu;if(o){var a=0|(e.altKey&&KEY_ALT_MASK)|(e.ctrlKey&&KEY_CTRL_MASK)|(e.shiftKey&&KEY_SHIFT_MASK);if(0===a&&!e.button)return void(r!==o&&(showBarMenu(o),"touchstart"===e.type&&barButtonLongTouchStart(e)));for(var s=0;s<o.length;++s)if(o[s].clickModif===a)return void peripheralControls.controlActivated(o[s].control,1===e.button,o[s].secSlot);if(a&KEY_SHIFT_MASK){for(a&=~KEY_SHIFT_MASK,s=0;s<o.length;++s)if(o[s].clickModif===a)return void peripheralControls.controlActivated(o[s].control,1===e.button,!0)}}}}function barButtonLongTouchStart(t){barButtonLongTouchTarget=t.target,barButtonLongTouchSelectTimeout=window.setTimeout(function(){if(barMenuActive)for(var t=barMenu.jtItems,e=0;e<t.length;++e){var n=t[e].jtMenuOption;if(n&&0===n.clickModif)return void barMenuItemSetActive(t[e],!0)}},450)}function barButtonLongTouchCancel(){barButtonLongTouchSelectTimeout&&(clearTimeout(barButtonLongTouchSelectTimeout),barButtonLongTouchSelectTimeout=null)}function barButtonHoverOver(t,e){barMenuActive&&t.jtMenu&&barMenuActive!==t.jtMenu&&(consoleControls.hapticFeedbackOnTouch(e),showBarMenu(t.jtMenu))}function barButtonMouseLeft(){barConsoleControlPressed&&(cursorHideFrameCountdown=CURSOR_HIDE_FRAMES,consoleControls.processControlState(barConsoleControlPressed,!1),barConsoleControlPressed=null)}function barButtonTouchEndOrMouseUp(t){if(!logoMessageActive)return barConsoleControlPressed?(consoleControls.hapticFeedbackOnTouch(t),consoleControls.processControlState(barConsoleControlPressed,!1),void(barConsoleControlPressed=null)):void(!barMenuItemActive||t.button>1||barMenuItemFireActive(t.shiftKey,1===t.button||t.ctrlKey))}function barMenuItemTapOrMouseDown(t,e,n){n||barMenuItemSetActive(t,"touchstart"===e.type)}function barMenuItemHoverOver(t,e){barMenuItemSetActive(t,"touchmove"===e.type)}function barMenuItemHoverOut(){barMenuItemSetActive(null)}function barMenuItemTouchEndOrMouseUp(t){logoMessageActive||!barMenuItemActive||t.button>1||barMenuItemFireActive(t.shiftKey,1===t.button||t.ctrlKey)}function barMenuItemFireActive(t,e){var n=barMenuItemActive.jtMenuOption;barMenuItemSetActive(null),n&&!n.disabled&&(n.extension?extensionsSocket.toggleExtension(n.extension,e,t):n.control&&(t|=n.secSlot,closeAllOverlays(),peripheralControls.controlActivated(n.control,e,t)))}function barMenuItemSetActive(t,e){t!==barMenuItemActive&&(barMenuItemActive&&barMenuItemActive.classList.remove("jt-hover"),t&&t.jtMenuOption?(barMenuItemActive=t,e&&consoleControls.hapticFeedback(),barMenuItemActive.classList.add("jt-hover")):barMenuItemActive=null)}function barElementTapOrMouseDown(t,e,n){cursorHideFrameCountdown=CURSOR_HIDE_FRAMES;var i=t.target;1===i.jtBarElementType?barButtonTapOrMousedown(i,t,e,n):2===i.jtBarElementType?barMenuItemTapOrMouseDown(i,t,n):hideBarMenu()}function barElementTouchMove(t){jt.Util.blockEvent(t);var e=t.changedTouches[0],n=e&&document.elementFromPoint(e.clientX,e.clientY);barButtonLongTouchTarget&&n!==barButtonLongTouchTarget&&barButtonLongTouchCancel(),2!==n.jtBarElementType&&n!==barButtonLongTouchTarget&&barMenuItemSetActive(null),1===n.jtBarElementType?barButtonHoverOver(n,t):2===n.jtBarElementType&&barMenuItemHoverOver(n,t)}function barElementTouchEndOrMouseUp(t){cursorHideFrameCountdown=CURSOR_HIDE_FRAMES,jt.Util.blockEvent(t),barButtonLongTouchCancel();var e=t.target;1===e.jtBarElementType?barButtonTouchEndOrMouseUp(t):2===e.jtBarElementType&&barMenuItemTouchEndOrMouseUp(t)}function setupFullscreen(){fullscreenAPIEnterMethod=fsElement.requestFullscreen||fsElement.webkitRequestFullscreen||fsElement.webkitRequestFullScreen||fsElement.mozRequestFullScreen,fullScreenAPIExitMethod=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen,"fullscreenElement"in document?fullScreenAPIQueryProp="fullscreenElement":"webkitFullscreenElement"in document?fullScreenAPIQueryProp="webkitFullscreenElement":"mozFullScreenElement"in document&&(fullScreenAPIQueryProp="mozFullScreenElement"),fullscreenAPIEnterMethod||!isMobileDevice||isBrowserStandalone||(fullScreenScrollHack=!0),"onfullscreenchange"in document?document.addEventListener("fullscreenchange",fullscreenByAPIChanged):"onwebkitfullscreenchange"in document?document.addEventListener("webkitfullscreenchange",fullscreenByAPIChanged):"onmozfullscreenchange"in document&&document.addEventListener("mozfullscreenchange",fullscreenByAPIChanged),fullscreenAPIEnterMethod||(scrollMessage.jtScroll=canvas.jtScroll=logo.jtScroll=logoCenter.jtScroll=logoImage.jtScroll=logoMessage.jtScroll=logoMessageText.jtScroll=logoMessageOK.jtScroll=logoMessageOKText.jtScroll=!0,fsElement.addEventListener("touchmove",function(t){if(isFullscreen){if(!fullScreenScrollHack||!t.target.jtScroll)return jt.Util.blockEvent(t);scrollMessageActive&&setScrollMessage(!1)}}))}function setEnterFullscreenByAPIOnFirstTouch(){if(fullscreenAPIEnterMethod){var t=!1,e=function(){t||(t=!0,jt.Util.removeEventsListener(fsElement,"touchend mousedown",e,!0),enterFullScreenByAPI())};jt.Util.addEventsListener(fsElement,"touchend mousedown",e,!0)}}function setFullscreenState(t){isFullscreen=t,t?(setViewport(),document.documentElement.classList.add("jt-full-screen"),fullScreenScrollHack&&document.documentElement.classList.add("jt-full-screen-scroll-hack"),consoleControls.setupTouchControlsIfNeeded(fsElementCenter),fullScreenScrollHack&&setScrollMessage(!0),fullscreenAPIEnterMethod||tryToFixSafariBugOnFullScreenChange()):(restoreViewport(),document.documentElement.classList.remove("jt-full-screen"),fullScreenScrollHack&&document.documentElement.classList.remove("jt-full-screen-scroll-hack"),fullscreenAPIEnterMethod||tryToFixSafariBugOnFullScreenChange()),closeAllOverlays(),self.requestReadjust()}function tryToFixSafariBugOnFullScreenChange(){var t=document.getElementById("jt-dummy-element");t?mainElement.removeChild(t):((t=document.createElement("div")).id="jt-dummy-element",mainElement.appendChild(t))}function showBar(){buttonsBar.classList.remove("jt-hidden")}function hideBar(){!BAR_AUTO_HIDE&&!isFullscreen||barMenuActive||consolePanelActive||barConsoleControlPressed||(hideBarMenu(),buttonsBar.classList.add("jt-hidden"))}function showBarMenu(t,e){if(t&&barMenuActive!==t){if(!barMenu)return setupBarMenu(),void setTimeout(function(){showBarMenu(t,e)},1);refreshBarMenu(t),barMenuItemSetActive(e?barMenu.jtDefaultItem:null);var n=t.jtRefElement,i=n&&n.offsetLeft-15||0;i+jt.ScreenGUI.BAR_MENU_WIDTH>n.parentElement.clientWidth?(barMenu.style.right=0,barMenu.style.left="auto",barMenu.style.transformOrigin="bottom right"):(i<0&&(i=0),barMenu.style.left=i+"px",barMenu.style.right="auto",barMenu.style.transformOrigin="bottom left"),showCursorAndBar(!0),barMenuActive=t,barMenu.style.display="inline-block",barMenu.jtTitle.focus()}}function refreshBarMenu(t){barMenu.jtTitle.innerHTML=t.jtTitle,barMenu.jtDefaultItem=null;for(var e,n=0,i=Math.min(t.length,BAR_MENU_MAX_ITEMS),r=jt.ScreenGUI.BAR_MENU_ITEM_HEIGHT+3,o=0;o<i;++o){var a=t[o];void 0!==a.label&&((e=barMenu.jtItems[n]).firstChild.textContent=a.label,e.jtMenuOption=null,a.hidden||isFullscreen&&a.fullScreenHidden||!isFullscreen&&a.fullScreenOnly?e.style.display="none":(e.style.display="block",a.divider?e.classList.add("jt-bar-menu-item-divider"):(e.classList.remove("jt-bar-menu-item-divider"),r+=jt.ScreenGUI.BAR_MENU_ITEM_HEIGHT,e.classList.toggle("jt-bar-menu-item-toggle",void 0!==a.toggle),a.disabled?e.classList.add("jt-bar-menu-item-disabled"):(e.classList.remove("jt-bar-menu-item-disabled"),e.jtMenuOption=a,0===a.clickModif&&(barMenu.jtDefaultItem=e),e.jtNeedsUIG=a.needsUIG,void 0!==a.toggle&&e.classList.toggle("jt-bar-menu-item-toggle-checked",!!a.checked)))),++n)}for(var s=n;s<BAR_MENU_MAX_ITEMS;++s)(e=barMenu.jtItems[s]).firstChild.textContent="",e.style.display="none",e.jtMenuOption=null;var l=fsElementCenter.clientHeight-jt.ScreenGUI.BAR_HEIGHT-12,c=r<l?1:l/r;barMenu&&(barMenu.style.transform="scale("+c.toFixed(4)+")")}function hideBarMenu(){barMenuActive&&(barMenuActive=null,barMenu.style.display="none",barMenuItemSetActive(null),cursorHideFrameCountdown=CURSOR_HIDE_FRAMES,self.focus())}function setupBarMenu(){(barMenu=document.createElement("div")).id="jt-bar-menu";var t=document.createElement("div");t.id="jt-bar-menu-inner",barMenu.appendChild(t);var e=document.createElement("div");e.id="jt-bar-menu-title",e.tabIndex=-1,e.innerHTML="Menu Title",t.appendChild(e),barMenu.jtTitle=e,barMenu.jtItems=Array(BAR_MENU_MAX_ITEMS);for(var n=0;n<BAR_MENU_MAX_ITEMS;++n){var i=document.createElement("div");i.classList.add("jt-bar-menu-item"),i.style.display="none",i.innerHTML="Menu Item "+n,i.jtBarElementType=2,i.jtItemIndex=n,i.addEventListener("mouseenter",function(t){barMenuItemHoverOver(t.target,t)}),i.addEventListener("mouseleave",barMenuItemHoverOut),t.appendChild(i),barMenu.jtItems[n]=i}barMenu.addEventListener("keydown",function(t){if(MENU_CLOSE_KEYS[t.keyCode])hideBarMenu();else if(barMenuItemActive&&MENU_EXEC_KEYS[t.keyCode&~KEY_SHIFT_MASK&~KEY_CTRL_MASK])barMenuItemFireActive(t.shiftKey,t.ctrlKey);else if(MENU_SELECT_KEYS[t.keyCode]){if(!barMenuActive)return;showBarMenu(barMenus[(barMenus.length+barMenuActive.jtMenuIndex+MENU_SELECT_KEYS[t.keyCode])%barMenus.length],!0)}else if(MENU_ITEM_SELECT_KEYS[t.keyCode]){var e=barMenu.jtItems,n=barMenuItemActive?barMenuItemActive.jtItemIndex:-1,i=BAR_MENU_MAX_ITEMS+1;do n=(n+e.length+MENU_ITEM_SELECT_KEYS[t.keyCode])%e.length;while(--i>=0&&!e[n].jtMenuOption);i>=0&&barMenuItemSetActive(e[n])}return jt.Util.blockEvent(t)}),buttonsBar.appendChild(barMenu)}function closeAllOverlays(){hideBarMenu(),saveStateDialog&&saveStateDialog.hide(),quickOtionsDialog&&quickOtionsDialog.hide(),netPlayDialog&&netPlayDialog.hide(),cartFormatDialog&&cartFormatDialog.hide(),settingsDialog&&settingsDialog.hide(),recentROMsDialog&&recentROMsDialog.hide()}function showLogoMessage(t,e,n,i){consolePanel.setLogoMessageActive(!0),logoMessageActive||(closeAllOverlays(),i&&(afterMessageAction=i),logoMessageText.innerHTML=t,logoMessageOK.classList.toggle("jt-higher",!!n),logoMessageOKText.innerHTML=e||"OK",fsElement.classList.add("jt-logo-message-active"),logoMessageActive=!0,signalIsOn=!1,updateLogo())}function updateLogoScale(){var t=Math.min(canvasOuter.clientWidth/jt.ScreenGUI.LOGO_SCREEN_WIDTH,1);logoCenter.style.transform=t<1?"translate(-50%, -50%) scale("+t.toFixed(4)+")":"translate(-50%, -50%)"}function setScrollMessage(t){console.error("Scroll Message: "+t),fsElement.classList.toggle("jt-scroll-message",t),scrollMessageActive=t,t&&setTimeout(function(){setScrollMessage(!1)},5e3)}function readjustAll(t){if(isReadjustScreeSizeChanged(t)){if(isFullscreen){buttonsBarDesiredWidth=isLandscape?0:-1;var e=readjustScreenSize.h;isLandscape||(e-=jt.ScreenGUI.BAR_HEIGHT+2),monitor.displayScale(aspectX,displayOptimalScaleY(readjustScreenSize.w,e))}else buttonsBarDesiredWidth=-1,monitor.displayScale(Javatari.SCREEN_DEFAULT_ASPECT,self.displayDefaultScale());self.focus(),consolePanelUpdateForOrientation(),consoleControlsSocket.releaseControllers()}readjustInterval&&jt.Util.performanceNow()-readjustRequestTime>=1e3&&(clearInterval(readjustInterval),readjustInterval=null)}function isReadjustScreeSizeChanged(t){var e=mainElement.parentElement.clientWidth,n=fsElementCenter.clientWidth,i=fsElementCenter.clientHeight;return!(!t&&readjustScreenSize.pw===e&&readjustScreenSize.w===n&&readjustScreenSize.h===i)&&(readjustScreenSize.pw=e,readjustScreenSize.w=n,readjustScreenSize.h=i,isLandscape=n>i,!0)}function displayOptimalScaleY(t,e){var n=2*aspectX,i=e/targetHeight;return targetWidth*n*i>t&&(i=t/(targetWidth*n)),i}function setViewport(){if(isMobileDevice){if(void 0===viewPortOriginalContent&&(viewPortOriginalContent=(viewPortOriginalTag=document.querySelector("meta[name=viewport]"))&&viewPortOriginalTag.content||null),viewportTag||((viewportTag=document.createElement("meta")).name="viewport",viewportTag.content="width = device-width, height = device-height, initial-scale = 1.0, minimum-scale = 1.0, maximum-scale = 1.0, user-scalable = yes",document.head.appendChild(viewportTag)),viewPortOriginalTag)try{document.head.removeChild(viewPortOriginalTag)}catch(t){}viewPortOriginalTag=null}}function restoreViewport(){if(isMobileDevice){if(!viewPortOriginalTag&&viewPortOriginalContent&&((viewPortOriginalTag=document.createElement("meta")).name="viewport",viewPortOriginalTag.content=viewPortOriginalContent,document.head.appendChild(viewPortOriginalTag)),viewportTag)try{document.head.removeChild(viewportTag)}catch(t){}viewportTag=null}}function setPageVisibilityHandling(){var t;function e(){logoMessageActive||(document.hidden?t=!atariConsole.systemPause(!0):t&&atariConsole.systemPause(!1))}document.addEventListener("visibilitychange",e)}window.CTRLR=t=>{peripheralControls.controlActivated(jt.PeripheralControls.AUTO_LOAD_URL2,!1,!1,t)};var self=this;this.connect=function(t){atariConsole=t,monitor.connect(atariConsole.getVideoOutput()),consoleControlsSocket=atariConsole.getConsoleControlsSocket(),cartridgeSocket=atariConsole.getCartridgeSocket(),consolePanel.connect(consoleControlsSocket)},this.connectPeripherals=function(t,e,n,i,r,o){recentROMs=t,fileLoader=e,e.registerForDnD(fsElement),e.registerForFileInputElement(fsElement),(fileDownloader=n).registerForDownloadElement(fsElement),peripheralControls=r,(consoleControls=i).addKeyInputElement(fsElement),stateMedia=o,consolePanel.connectPeripherals(e,consoleControls,peripheralControls)},this.powerOn=function(){monitor.setDefaults(),updateLogo(),document.documentElement.classList.add("jt-started"),setPageVisibilityHandling(),this.focus(),JavatariFullScreenSetup.shouldStartInFullScreen()&&(setFullscreenState(!0),setEnterFullscreenByAPIOnFirstTouch())},this.powerOff=function(){document.documentElement.classList.remove("jt-started")},this.start=function(t){function e(){self.setFullscreen(!0),t()}!isMobileDevice||isBrowserStandalone||isFullscreen?t():jt.Util.isOfficialHomepage()?showLogoMessage("For "+(fullscreenAPIEnterMethod?"the best":"a full-screen")+' experience, use<br>the "Add to Home Screen" function<br>then launch from the Installed App',"NICE!",!1,e):showLogoMessage("For the best experience,<br>Javatari will go full-screen","GO!",!0,e)},this.refresh=function(t,e,n){cursorHideFrameCountdown>0&&--cursorHideFrameCountdown<=0&&hideCursorAndBar(),signalIsOn||(signalIsOn=!0,updateLogo()),canvasContext||createCanvasContext(),canvasContext.drawImage(t,0,0,canvas.width,canvas.height)},this.videoSignalOff=function(){signalIsOn=!1,showCursorAndBar(),updateLogo()},this.mousePointerLocked=function(t){(mousePointerLocked=t)?hideCursorAndBar():showCursorAndBar()},this.openHelp=function(){return self.openSettings("GENERAL"),!1},this.openAbout=function(){return self.openSettings("ABOUT"),!1},this.openSettings=function(t){closeAllOverlays(),settingsDialog||(settingsDialog=new jt.SettingsDialog(fsElementCenter,consoleControls)),settingsDialog.show(t)},this.openSaveStateDialog=function(t){closeAllOverlays(),saveStateDialog||(saveStateDialog=new jt.SaveStateDialog(fsElementCenter,consoleControls,peripheralControls,stateMedia)),saveStateDialog.show(t)},this.openQuickOptionsDialog=function(){closeAllOverlays(),quickOtionsDialog||(quickOtionsDialog=new jt.QuickOptionsDialog(fsElementCenter,consoleControls,consoleControlsSocket,peripheralControls)),quickOtionsDialog.show()},this.openNetPlayDialog=function(){closeAllOverlays(),netPlayDialog||(netPlayDialog=new jt.NetPlayDialog(room,fsElementCenter)),netPlayDialog.show()},this.openCartridgeFormatDialog=function(t){closeAllOverlays(),cartFormatDialog||(cartFormatDialog=new jt.CartridgeFormatDialog(this,fsElementCenter,atariConsole,cartridgeSocket)),cartFormatDialog.show(t)},this.openLoadFileDialog=function(t,e){fileLoader.openFileChooserDialog(jt.FileLoader.OPEN_TYPE.AUTO,t,e,!1)},this.openRecentROMsDialog=function(){closeAllOverlays(),recentROMsDialog||(recentROMsDialog=new jt.RecentROMsDialog(fsElementCenter,this,recentROMs,fileLoader)),recentROMsDialog.show()},this.openCartridgeChooserDialog=function(t,e,n){logoMessageActive&&self.closeLogoMessage(),t||0!==recentROMs.getCatalog().length?this.openRecentROMsDialog():this.openLoadFileDialog(e,n)},this.toggleConsolePanel=function(){isFullscreen&&isLandscape?consolePanelActiveLandscape=!consolePanelActiveLandscape:consolePanelActivePortrait=!consolePanelActivePortrait,consolePanelUpdateForOrientation()},this.getControlReport=function(t){return{label:-2===crtFilter?"Browser":-1===crtFilter?"Auto":0===crtFilter?"OFF":"Level "+crtFilter,active:crtFilter>=0}},this.toggleMenuByKey=function(){barMenuActive?hideBarMenu():(closeAllOverlays(),showBarMenu(barMenuSystem,!0))},this.getScreenCapture=function(){if(signalIsOn)return canvas.toDataURL("image/png")},this.saveScreenCapture=function(){var t=this.getScreenCapture();t&&fileDownloader.startDownloadURL("Javatari Screen",t,"Screen Capture")},this.displayMetrics=function(t,e){targetWidth===t&&targetHeight===e||(targetWidth=t,targetHeight=e,updateCanvasContentSize(),isFullscreen?this.requestReadjust(!0):updateScale())},this.displayScale=function(t,e){aspectX=t,scaleY=e,updateScale()},this.getMonitor=function(){return monitor},this.showOSD=function(t,e,n){if(osdTimeout&&clearTimeout(osdTimeout),!t)return osd.style.transition="all 0.15s linear",osd.style.top="-29px",osd.style.opacity=0,void(osdShowing=!1);!e&&osdShowing||(osd.innerHTML=t,osd.style.color=n?"rgb(255, 60, 40)":"rgb(0, 255, 0)"),osd.style.transition="none",osd.style.top="15px",osd.style.opacity=1,osdShowing=!0;var i=canvasOuter.clientWidth-30,r=osd.clientWidth,o=r<i?1:i/r;osd.style.transform="scale("+o.toFixed(4)+")",osdTimeout=setTimeout(hideOSD,OSD_TIME)},this.displayDefaultScale=function(){if(Javatari.SCREEN_DEFAULT_SCALE>0)return Javatari.SCREEN_DEFAULT_SCALE;var t=Number.parseFloat(window.getComputedStyle(mainElement.parentElement).width);return t>=640?2:t>=540?1.65:t>=420?1.25:t>=355?1.05:t>=340?1:t>=300?.9:.8},this.setDebugMode=function(t){debugMode=!!t,canvasContext=null},this.crtFilterToggle=function(){var t=crtFilter+1;t>3&&(t=-2),setCRTFilter(t);var e=null===crtFilterEffective?"browser default":crtFilterEffective<1?"OFF":"level "+crtFilterEffective;this.showOSD("CRT filter: "+(-1===crtFilter?"AUTO ("+e+")":e),!0),Javatari.userPreferences.current.crtFilter!==crtFilter&&(Javatari.userPreferences.current.crtFilter=crtFilter,Javatari.userPreferences.setDirty(),Javatari.userPreferences.save())},this.crtFilterSetDefault=function(){var t=Javatari.userPreferences.current.crtFilter;setCRTFilter(-3!==Javatari.SCREEN_FILTER_MODE?Javatari.SCREEN_FILTER_MODE:null!==t&&t>-3?t:-1)},this.crtModeToggle=function(){var t=crtMode+1;t>1&&(t=-1),setCRTMode(t);var e=1===crtModeEffective?"Phosphor":"OFF";this.showOSD("CRT mode: "+(-1===crtMode?"AUTO ("+e+")":e),!0)},this.crtModeSetDefault=function(){setCRTMode(Javatari.SCREEN_CRT_MODE)},this.displayToggleFullscreen=function(){if(-2!==FULLSCREEN_MODE)return fullscreenAPIEnterMethod&&!isFullScreenByAPI()?void enterFullScreenByAPI():void this.setFullscreen(!isFullscreen)},this.setFullscreen=function(t){fullscreenAPIEnterMethod?t?enterFullScreenByAPI():exitFullScreenByAPI():setFullscreenState(t)},this.focus=function(){canvas.focus()},this.consolePowerAndUserPauseStateUpdate=function(t,e){isLoading&&(t=!1),powerButton.style.backgroundPosition=powerButton.jtBX+"px "+mediaButtonBackYOffsets[t?2:1]+"px",powerButton.jtMenu[0].label="Power "+(t?"OFF":"ON");var n=2===room.netPlayMode;powerButton.jtMenu[1].disabled=powerButton.jtMenu[12].disabled=n||!t,powerButton.jtMenu[6].disabled=n||!(cartridgeSocket&&cartridgeSocket.inserted()),powerButton.jtMenu[5].disabled=powerButton.jtMenu[8].disabled=powerButton.jtMenu[9].disabled=powerButton.jtMenu[11].disabled=n},this.cartridgeInserted=function(t){consolePanel.cartridgeInserted(t),powerButton.jtMenu[6].disabled=!t||2===room.netPlayMode},this.controlsModeStateUpdate=function(){settingsDialog&&settingsDialog.controlsModeStateUpdate(),quickOtionsDialog&&quickOtionsDialog.controlsModeStateUpdate()},this.touchControlsActiveUpdate=function(t,e){touchControlsActive===t&&touchControlsDirBig===e||(touchControlsActive=t,touchControlsDirBig=e,isFullscreen&&(touchControlsActive&&consoleControls.setupTouchControlsIfNeeded(fsElementCenter),this.requestReadjust(!0)))},this.roomNetPlayStatusChangeUpdate=function(t){netPlayDialog&&netPlayDialog.isVisible()||closeAllOverlays(),netPlayDialog&&netPlayDialog.roomNetPlayStatusChangeUpdate(t),netplayButton.classList.toggle("jt-hidden",room.netPlayMode<1)},this.controlStateChanged=function(t,e){consolePanel.controlStateChanged(t,e),quickOtionsDialog&&quickOtionsDialog.controlStateChanged(t,e)},this.controlsStatesRedefined=function(){consolePanel.controlsStatesRedefined()},this.speakerUnlockStateUpdate=function(t){if(unmuteMessage.classList.toggle("jt-show",!t),!t){var e=canvasOuter.clientWidth-30,n=unmuteMessage.clientWidth,i=n<e?1:e/n;unmuteMessage.style.transform="translate(-50%, 0) scale("+i.toFixed(4)+")"}},this.setLoading=function(t){isLoading=t,updateLoading()},this.requestReadjust=function(t){settingsDialog&&settingsDialog.isVisible()&&settingsDialog.position(),t?readjustAll(!0):(readjustRequestTime=jt.Util.performanceNow(),readjustInterval||(readjustInterval=setInterval(readjustAll,50)))},this.closeAllOverlays=closeAllOverlays,this.closeLogoMessage=function(t,e,n){if(n||consoleControls.hapticFeedbackOnTouch(t),!e&&(consolePanel.setLogoMessageActive(!1),fsElement.classList.remove("jt-logo-message-active"),logoMessageActive=!1,afterMessageAction)){var i=afterMessageAction;afterMessageAction=null,i()}};var afterMessageAction,atariConsole,consoleControlsSocket,monitor,peripheralControls,fileLoader,fileDownloader,consoleControls,cartridgeSocket,stateMedia,recentROMs,fullscreenAPIEnterMethod,fullScreenAPIExitMethod,fullScreenAPIQueryProp,viewportTag,viewPortOriginalTag,viewPortOriginalContent,consolePanel,consolePanelElement,settingsDialog,saveStateDialog,recentROMsDialog,quickOtionsDialog,netPlayDialog,cartFormatDialog,fsElement,fsElementCenter,canvas,canvasOuter,canvasLoadingIcon,canvasContext,canvasImageRenderingValue,buttonsBar,buttonsBarInner,barButtonLongTouchTarget,barButtonLongTouchSelectTimeout,barMenu,barMenuActive,barMenuItemActive,barMenuSystem,barConsoleControlPressed,osd,osdTimeout,logo,logoCenter,logoImage,logoMessage,logoMessageText,logoMessageOK,logoMessageOKText,logoLoadingIcon,scrollMessage,unmuteMessage,powerButton,netplayButton,logoButton,scaleDownButton,scaleUpButton,fullscreenButton,settingsButton,gameSelectButton,gameResetButton,readjustInterval=0,readjustRequestTime=0,readjustScreenSize={w:0,wk:0,h:0,pw:0,l:!1},isFullscreen=!1,isLandscape=!1,isTouchDevice=jt.Util.isTouchDevice(),isMobileDevice=jt.Util.isMobileDevice(),isIOSDevice=jt.Util.isIOSDevice(),isBrowserStandalone=jt.Util.isBrowserStandaloneMode(),browserName=jt.Util.browserInfo().name,fullScreenAPIExitUserRequested=!1,fullScreenScrollHack=!1,touchControlsActive=!1,touchControlsDirBig=!1,consolePanelActive=!1,consolePanelActiveLandscape=!1,consolePanelActivePortrait=jt.ConsolePanel.shouldStartActive(),buttonsBarDesiredWidth=-1,barMenus=[],osdShowing=!1,cursorType="auto",cursorShowing=!0,cursorHideFrameCountdown=-1,signalIsOn=!1,crtFilter=-2,crtFilterEffective=null,crtMode=-1,crtModeEffective=0,debugMode=!1,isLoading=!1,aspectX=Javatari.SCREEN_DEFAULT_ASPECT,scaleY=1,mousePointerLocked=!1,targetWidth=160,targetHeight=213,logoMessageActive=!1,scrollMessageActive=!1,mediaButtonBackYOffsets=[-51,-26,-1],CANVAS_SIZE_FACTOR=Javatari.SCREEN_CANVAS_SIZE,OSD_TIME=3e3,CURSOR_HIDE_FRAMES=180,FULLSCREEN_MODE=Javatari.SCREEN_FULLSCREEN_MODE,BAR_AUTO_HIDE=0===Javatari.SCREEN_CONTROL_BAR,BAR_MENU_MAX_ITEMS=13,NARROW_WIDTH=336,k=jt.DOMKeys,KEY_CTRL_MASK=k.CONTROL,KEY_ALT_MASK=k.ALT,KEY_SHIFT_MASK=k.SHIFT,MENU_CLOSE_KEYS={};MENU_CLOSE_KEYS[k.VK_ESCAPE.c]=1,MENU_CLOSE_KEYS[k.VK_CONTEXT.c]=1;var MENU_EXEC_KEYS={};MENU_EXEC_KEYS[k.VK_ENTER.c]=1,MENU_EXEC_KEYS[k.VK_SPACE.c]=1;var MENU_SELECT_KEYS={};MENU_SELECT_KEYS[k.VK_LEFT.c]=-1,MENU_SELECT_KEYS[k.VK_RIGHT.c]=1;var MENU_ITEM_SELECT_KEYS={};MENU_ITEM_SELECT_KEYS[k.VK_UP.c]=-1,MENU_ITEM_SELECT_KEYS[k.VK_DOWN.c]=1,init(),this.eval=function(str){return eval(str)}},jt.RecentROMsDialog=function(t,e,n,i){"use strict";function r(){c.style.height=42+33*(u.length+1)+"px";for(var t=0;t<11;++t){var e=$[t],n=u[t];e.classList.toggle("jt-visible",t<=u.length),e.classList.toggle("jt-toggle",t<u.length),e.classList.toggle("jt-toggle-checked",t<u.length),e.jtNeedsUIG=t===u.length,e.innerHTML=n?n.n:"&nbsp;&nbsp;Open ROM File..."}o()}function o(){for(var t=0;t<$.length;++t)$[t].classList.toggle("jt-selected",t===f)}function a(){(c=document.createElement("div")).id="jt-recent-roms",c.classList.add("jt-select-dialog"),c.style.width="350px",c.tabIndex=-1,c.appendChild(document.createTextNode("Select Cartridge")),(d=document.createElement("ul")).style.width="85%";for(var e=0;e<11;++e){var n=document.createElement("li");n.style.textAlign="center",n.innerHTML="",n.jtItem=e,$.push(n),d.appendChild(n)}c.appendChild(d),s(),t.appendChild(c)}function s(){function t(){l.hide(!1)}function e(){l.hide(!0)}jt.Util.onTapOrMouseDownWithBlock(c,function(){c.focus()}),jt.Util.onTapOrMouseDownWithBlockUIG(c,function(t,n){t.target.jtItem>=0&&(n&&jt.DOMConsoleControls.hapticFeedbackOnTouch(t),f=t.target.jtItem,o(),n||setTimeout(e,120))}),c.addEventListener("keydown",function(n){return n.keyCode===p?t():g.indexOf(n.keyCode)>=0?e():v[n.keyCode]&&((f+=v[n.keyCode])<0?f=0:f>u.length&&(f=u.length),o()),jt.Util.blockEvent(n)})}var l=this;this.show=function(e){if(!c)return a(),setTimeout(function(){l.show(e)},0);(u=n.getCatalog().slice(0)).sort(function(t,e){return t.n>e.n});var i=n.lastROMLoadedIndex;f=(i=u.indexOf(u.find(function(t){return t.i===i})))<0||i>=u.length?u.length:i,h=!0,r(),c.classList.add("jt-show"),c.focus(),jt.Util.scaleToFitParentHeight(c,t,jt.ScreenGUI.BAR_HEIGHT)},this.hide=function(t){if(h&&(c.classList.remove("jt-show"),h=!1,Javatari.room.screen.focus(),t)){if(f===u.length)e.openLoadFileDialog();else{var r=n.getROM(u[f].i);i.loadROM(r)}}};var c,d,u=[],f=0,$=[],h=!1,_=jt.DOMKeys,p=_.VK_ESCAPE.c,g=[_.VK_ENTER.c,_.VK_SPACE.c],v={};v[_.VK_UP.c]=-1,v[_.VK_DOWN.c]=1},jt.SaveStateDialog=function(t,e,n,i){"use strict";function r(){u.textContent="Select Slot to "+(f?"Save":"Load");for(var t=f?"Save to ":"Load from ",e=0;e<h.length;++e){var n=h[e];n.innerHTML=t+v[e].d,n.classList.toggle("jt-toggle-checked",i.isSlotUsed(e+1))}o()}function o(){for(var t=0;t<h.length;++t)h[t].classList.toggle("jt-selected",t===$)}function a(){(c=document.createElement("div")).id="jt-savestate",c.classList.add("jt-select-dialog"),c.style.width="280px",c.style.height="404px",c.tabIndex=-1,u=document.createTextNode("Select Slot"),c.appendChild(u),(d=document.createElement("ul")).style.width="80%";for(var e=0;e<v.length;++e){var n=document.createElement("li");n.classList.add("jt-visible"),e<v.length-1&&n.classList.add("jt-toggle"),n.style.textAlign="center",n.innerHTML=v[e].d,n.jtSlot=e,n.jtNeedsUIG=!0,h.push(n),d.appendChild(n)}c.appendChild(d),s(),t.appendChild(c)}function s(){function t(){l.hide(!1)}function e(){l.hide(!0)}jt.Util.onTapOrMouseDownWithBlock(c,function(){c.focus()}),jt.Util.onTapOrMouseDownWithBlockUIG(c,function(t,n){t.target.jtSlot>=0&&(n&&jt.DOMConsoleControls.hapticFeedbackOnTouch(t),$=t.target.jtSlot,o(),n||setTimeout(e,120))}),c.addEventListener("keydown",function(n){return n.keyCode===m?t():E.indexOf(n.keyCode)>=0?e():T[n.keyCode]&&(($+=T[n.keyCode])<0?$=0:$>10&&($=10),o()),jt.Util.blockEvent(n)})}var l=this;this.show=function(e){if(!c)return a(),setTimeout(function(){l.show(e)},0);f=e,_=!0,r(),c.classList.add("jt-show"),c.focus(),jt.Util.scaleToFitParentHeight(c,t,jt.ScreenGUI.BAR_HEIGHT)},this.hide=function(t){if(_&&(c.classList.remove("jt-show"),_=!1,Javatari.room.screen.focus(),t)){var i=v[$],r=f?i.save:i.load;i.peripheral?n.controlActivated(r):e.processControlState(r,!0)}};var c,d,u,f=!1,$=0,h=[],_=!1,p=jt.ConsoleControls,g=jt.PeripheralControls,v=[{d:"Slot 1",load:p.LOAD_STATE_1,save:p.SAVE_STATE_1},{d:"Slot 2",load:p.LOAD_STATE_2,save:p.SAVE_STATE_2},{d:"Slot 3",load:p.LOAD_STATE_3,save:p.SAVE_STATE_3},{d:"Slot 4",load:p.LOAD_STATE_4,save:p.SAVE_STATE_4},{d:"Slot 5",load:p.LOAD_STATE_5,save:p.SAVE_STATE_5},{d:"Slot 6",load:p.LOAD_STATE_6,save:p.SAVE_STATE_6},{d:"Slot 7",load:p.LOAD_STATE_7,save:p.SAVE_STATE_7},{d:"Slot 8",load:p.LOAD_STATE_8,save:p.SAVE_STATE_8},{d:"Slot 9",load:p.LOAD_STATE_9,save:p.SAVE_STATE_9},{d:"Slot 10",load:p.LOAD_STATE_10,save:p.SAVE_STATE_10},{d:"File...",load:g.CONSOLE_LOAD_STATE_FILE,save:g.CONSOLE_SAVE_STATE_FILE,peripheral:!0}],S=jt.DOMKeys,m=S.VK_ESCAPE.c,E=[S.VK_ENTER.c,S.VK_SPACE.c],T={};T[S.VK_UP.c]=-1,T[S.VK_DOWN.c]=1},jt.QuickOptionsDialog=function(t,e,n,i){"use strict";function r(){for(var t=0;t<c.length;++t){var e=c[t],r=e.peripheral?i.getControlReport(e.control):n.getControlReport(e.control);e.value=r.label,e.selected=r.active,u[t].innerHTML=e.value,u[t].classList.toggle("jt-selected",!!e.selected)}}function o(){(l=document.createElement("div")).id="jt-quick-options",l.tabIndex=-1;var e=jt.PeripheralControls;c=[{label:"Paddles",control:e.PADDLES_TOGGLE_MODE,peripheral:!0},{label:"Swap Controllers",control:e.P1_CONTROLS_TOGGLE,peripheral:!0},{label:"No Collisions",control:f.NO_COLLISIONS},{label:"&#128190;&nbsp; V-Synch",control:f.VSYNCH},{label:"&#128190;&nbsp; CRT Filter",control:e.SCREEN_CRT_FILTER,peripheral:!0},{label:"&#128190;&nbsp; Audio Buffer",control:e.SPEAKER_BUFFER_TOGGLE,peripheral:!0},{label:"&#128190;&nbsp; Big Directionals",control:e.TOUCH_TOGGLE_DIR_BIG,peripheral:!0},{label:"&#128190;&nbsp; TurboFire Speed",control:e.TURBO_FIRE_TOGGLE,peripheral:!0},{label:"&#128190;&nbsp; Haptic Feedback",control:e.HAPTIC_FEEDBACK_TOGGLE_MODE,peripheral:!0}];var n=document.createElement("ul");n.classList.add("jt-quick-options-list");for(var i=0;i<c.length;++i){var r=document.createElement("li"),o=document.createElement("div");o.innerHTML=c[i].label,r.appendChild(o);var s=document.createElement("div");s.classList.add("jt-control"),s.jtControlItem=c[i],r.appendChild(s),n.appendChild(r),u.push(s)}l.appendChild(n),a(),t.appendChild(l)}function a(){jt.Util.onTapOrMouseDownWithBlock(l,function(t){if(t.target.jtControlItem){jt.DOMConsoleControls.hapticFeedbackOnTouch(t);var n=t.target.jtControlItem;n.peripheral?(i.controlActivated(n.control,!1,!1),r()):e.processControlState(n.control,!0)}else l.focus()}),l.addEventListener("keydown",function(t){return h.indexOf(t.keyCode)>=0&&s.hide(),jt.Util.blockEvent(t)})}var s=this;this.show=function(){if(!l)return o(),setTimeout(s.show,0);r(),d=!0,l.classList.add("jt-show"),l.focus(),jt.Util.scaleToFitParentHeight(l,t,jt.ScreenGUI.BAR_HEIGHT)},this.hide=function(){d&&(Javatari.userPreferences.save(),l.classList.remove("jt-show"),d=!1,Javatari.room.screen.focus())},this.controlsModeStateUpdate=function(){d&&r()},this.controlStateChanged=function(t,e){d&&(t===f.NO_COLLISIONS||t===f.VSYNCH)&&r()};var l,c,d=!1,u=[],f=jt.ConsoleControls,$=jt.DOMKeys,h=[$.VK_ESCAPE.c,$.VK_ENTER.c,$.VK_SPACE.c]},jt.NetPlayDialog=function(t,e){"use strict";function n(){switch(t.netPlayMode){case 0:h.textContent="STANDALONE",f.textContent="HOST",$.textContent="JOIN",f.disabled=!1,$.disabled=!1,g.disabled=!1,v.disabled=!1,d.classList.remove("jt-active"),u.classList.remove("jt-disabled"),g.setAttribute("placeholder","Enter a name");break;case 1:var e=t.getNetServer();h.textContent="HOSTING Session: "+e.getSessionID(),f.textContent="STOP",$.textContent="JOIN",f.disabled=!1,$.disabled=!0,g.disabled=!0,v.disabled=!0,d.classList.add("jt-active"),u.classList.add("jt-disabled"),g.setAttribute("placeholder","Automatic"),_.href=r();break;case 2:var n=t.getNetClient();h.textContent="JOINED Session: "+n.getSessionID(),f.textContent="HOST",$.textContent="LEAVE",f.disabled=!0,$.disabled=!1,g.disabled=!0,v.disabled=!0,d.classList.add("jt-active"),u.classList.remove("jt-disabled"),u.classList.add("jt-disabled"),g.setAttribute("placeholder","Enter a name"),_.href=r();break;case -1:case -2:h.textContent="Establishing connection...",g.disabled=!0,v.disabled=!0,d.classList.remove("jt-active"),u.classList.add("jt-disabled"),-1===t.netPlayMode?(f.textContent="CANCEL",$.textContent="JOIN",f.disabled=!1,$.disabled=!0,g.setAttribute("placeholder","Automatic")):(f.textContent="HOST",$.textContent="CANCEL",f.disabled=!0,$.disabled=!1,g.setAttribute("placeholder","Enter a name"))}}function i(){g.value=m.netPlaySessionName,v.value=m.netPlayNick}function r(){return jt.Util.browserCurrentURL()+"?JOIN="+t.netController.getSessionID()}function o(e){var n=e.target;if(!n.disabled){jt.DOMConsoleControls.hapticFeedbackOnTouch(e);var i=!1,r=t.netPlayMode;if(n!==f||0!==r&&1!==r&&-1!==r?n!==$||0!==r&&2!==r&&-2!==r||(0===r?(t.getNetClient().joinSession(g.value,v.value),i=!0):t.getNetClient().leaveSession(!1,-2===r?"NetPlay connection aborted":void 0)):0===r?(t.getNetServer().startSession(g.value),i=!0):t.getNetServer().stopSession(!1,-1===r?"NetPlay connection aborted":void 0),i){var o=g.value.trim(),a=v.value.trim();m.netPlaySessionName===o&&m.netPlayNick===a||(m.netPlaySessionName=o,m.netPlayNick=a,Javatari.userPreferences.setDirty(),Javatari.userPreferences.save())}}}function a(){(c=document.createElement("div")).id="jt-netplay",c.tabIndex=-1,(d=document.createElement("div")).id="jt-netplay-status-box",c.appendChild(d),(p=document.createElement("input")).id="jt-netplay-link-text",d.appendChild(p),(h=document.createElement("div")).id="jt-netplay-status",h.textContent="STANDALONE",d.appendChild(h),(_=document.createElement("a")).id="jt-netplay-link",_.textContent="\uD83D\uDD17",_.setAttribute("title","Copy Join Session link to clipboard"),d.appendChild(_),(u=document.createElement("div")).id="jt-netplay-session-box",c.appendChild(u);var t=document.createElement("div");t.id="jt-netplay-session-label",u.appendChild(t),(f=document.createElement("button")).id="jt-netplay-start",f.jtCommand=!0,f.classList.add("jt-netplay-button"),f.textContent="HOST",u.appendChild(f),(g=document.createElement("input")).id="jt-netplay-session-name",g.setAttribute("placeholder","Enter a name"),g.setAttribute("maxlength",12),g.spellcheck=!1,g.autocorrect=!1,g.autocapitalize=!1,u.appendChild(g),($=document.createElement("button")).id="jt-netplay-join",$.jtCommand=!0,$.classList.add("jt-netplay-button"),$.textContent="JOIN",u.appendChild($);var n=document.createElement("div");n.id="jt-netplay-nick-label",u.appendChild(n),(v=document.createElement("input")).id="jt-netplay-nick",v.setAttribute("placeholder","Automatic"),v.setAttribute("maxlength",12),v.spellcheck=!1,v.autocorrect=!1,v.autocapitalize=!1,u.appendChild(v),s(),e.appendChild(c)}function s(){function e(t){var e=t.target,n=e.value;return!n||n.match(/^[A-Za-z0-9]+[A-Za-z0-9_\-]*@?$/)?e.jtLastValidValue=n:e.value=e.jtLastValidValue||""}jt.Util.onTapOrMouseDownWithBlock(c,function(t){t.target.jtCommand?o(t):c.focus()}),c.addEventListener("keydown",function(t){return E.indexOf(t.keyCode)>=0&&l.hide(),jt.Util.blockEvent(t)}),g.addEventListener("input",e),v.addEventListener("input",e),jt.Util.addEventsListener(h,"touchstart touchmove touchend mousedown mousemove mouseup keydown keyup",function(t){t.stopPropagation()}),jt.Util.addEventsListener(g,"touchstart touchmove touchend mousedown mousemove mouseup keydown keyup",function(t){t.stopPropagation()}),jt.Util.addEventsListener(v,"touchstart touchmove touchend mousedown mousemove mouseup keydown keyup",function(t){t.stopPropagation()}),c.ondragstart=jt.Util.blockEvent,d.addEventListener("contextmenu",function(t){t.stopPropagation()}),jt.Util.addEventsListener(_,"click",function(e){if(jt.Util.blockEvent(e),!document.queryCommandSupported||!document.queryCommandSupported("copy"))return t.showOSD("Copy to Clipboard not supported by the browser!",!0,!0);p.value=r(),p.focus(),p.select(),document.execCommand("copy"),c.focus()})}var l=this;this.show=function(){if(!c)return a(),setTimeout(l.show,0);n(),i(),S=!0,c.classList.add("jt-show"),c.focus(),jt.Util.scaleToFitParentWidth(c,e,12)},this.hide=function(){S&&(c.classList.remove("jt-show"),S=!1,t.screen.focus())},this.roomNetPlayStatusChangeUpdate=function(e){if(S&&n(),2===t.netPlayMode&&e<0&&S)return setTimeout(function(){l.hide()},2e3);0===t.netPlayMode&&e>0&&!S&&l.show()},this.isVisible=function(){return S};var c,d,u,f,$,h,_,p,g,v,S=!1,m=Javatari.userPreferences.current,E=[jt.DOMKeys.VK_ESCAPE.c]},jt.CartridgeFormatDialog=function(t,e,n,i){"use strict";function r(){p=0,d.reinsertROMContent(),g=jt.CartridgeCreator.getUserFormatOptionNames(d.rom);var t=jt.CartridgeCreator.getBestFormatOption(d.rom);t||(t=jt.CartridgeFormats["4K"]),g.unshift(t.name);for(var e=0;e<v.length;++e)e<g.length?(g[e]===_&&(p=e),v[e].innerHTML=0===e?"AUTO: "+t.name+": "+t.desc:g[e]+": "+jt.CartridgeFormats[g[e]].desc,v[e].classList.add("jt-visible")):v[e].classList.remove("jt-visible");d.format===t&&(p=0),o(),a()}function o(){for(var t,e=0;e<g.length;++e)e===p?(t=v[e]).classList.add("jt-selected"):v[e].classList.remove("jt-selected");f.scrollTop>t.offsetTop?f.scrollTop=t.offsetTop:f.scrollTop+f.offsetHeight<t.offsetTop+26+2&&(f.scrollTop=t.offsetTop-(f.offsetHeight-26-2))}function a(){$.textContent=E?m?"YES":"NO":"- -",$.classList.toggle("jt-selected",m)}function s(){(u=document.createElement("div")).id="jt-cartridge-format",u.classList.add("jt-select-dialog"),u.style.width="340px",u.style.height="310px",u.tabIndex=-1;var t=document.createTextNode("Select ROM Format");u.appendChild(t),f=document.createElement("ul");for(var n=0,i=jt.CartridgeFormatsUserOptions.length+1;n<i;++n){var r=document.createElement("li");r.jtIndex=n,r.classList.add("jt-visible"),r.style.textAlign="center",v.push(r),f.appendChild(r)}u.appendChild(f);var o=document.createElement("div"),a=document.createElement("ul");a.classList.add("jt-quick-options-list"),r=document.createElement("li");var s=document.createElement("div");s.innerHTML="&#128190;&nbsp; Remember Choice",r.appendChild(s),($=document.createElement("div")).innerHTML="NO",$.classList.add("jt-control"),r.appendChild($),a.appendChild(r),o.appendChild(a),u.appendChild(o),l(),e.appendChild(u)}function l(){function t(){c.hide(!1)}function e(){c.hide(!0)}function n(t){p=t,o()}jt.Util.onTapOrMouseDownWithBlock(u,function(){f.focus()}),jt.Util.addEventsListener(f,"touchstart touchmove touchend",function(t){t.stopPropagation()}),jt.Util.addEventsListener(f,"mousedown",function(t){t.stopPropagation(),jt.DOMConsoleControls.hapticFeedbackOnTouch(t),t.target.jtIndex>=0&&n(t.target.jtIndex)}),jt.Util.addEventsListener(f,"click",function(t){if(jt.Util.blockEvent(t),t.target.jtIndex>=0){var i=t.target.jtIndex===p;n(t.target.jtIndex),setTimeout(e,i?0:120)}}),jt.Util.onTapOrMouseDownWithBlock($,function(t){E&&(jt.DOMConsoleControls.hapticFeedbackOnTouch(t),m=!m,a())}),u.addEventListener("keydown",function(n){var i=b.codeForKeyboardEvent(n);return i===C?t():A.indexOf(i)>=0?e():O[i]&&((p+=O[i])<0?p=0:p>=g.length&&(p=g.length-1),o()),jt.Util.blockEvent(n)})}var c=this;this.show=function(t){if(!u)return s(),setTimeout(function(){c.show(t)},0);h=t,(d=i.inserted())&&(_=d.format.name,m=!!T.getForROM(d.rom),E=!!d.rom.info.h,S=!0,u.classList.add("jt-show"),r(),u.focus(),jt.Util.scaleToFitParentHeight(u,e,jt.ScreenGUI.BAR_HEIGHT))},this.hide=function(e){if(S){if(u.classList.remove("jt-show"),S=!1,Javatari.room.screen.focus(),e){var r=g[p],o=r===g[0],a=jt.CartridgeCreator.changeCartridgeFormat(d,jt.CartridgeFormats[r]);m&&T.setForROM(d.rom,r,o),i.insert(a,!h&&n.powerIsOn,!0),t.showOSD("ROM Format: "+r+(o?" (Auto)":""),!0)}d=void 0}};var d,u,f,$,h=!1,_="",p=0,g=[],v=[],S=!1,m=!1,E=!1,T=Javatari.userROMFormats,b=jt.DOMKeys,C=b.VK_ESCAPE.c,A=[b.VK_ENTER.c,b.VK_SPACE.c],O={};O[b.VK_UP.c]=-1,O[b.VK_DOWN.c]=1},jt.SettingsGUI={WIDTH:600,HEIGHT:450},jt.SettingsGUI.html=function(){return'<div id="jt-modal" tabindex="-1"> <div id="jt-menu"> <div id="jt-back" jt-var="true"> <div class="jt-back-arrow"> </div> </div> <div class="jt-caption"> Help & Settings </div> <div class="jt-items"> <div id="jt-menu-console" class="jt-item" jt-var="true"> CONSOLE </div> <div id="jt-menu-ports" class="jt-item" jt-var="true"> CONTROLLERS </div> <div id="jt-menu-general" class="jt-item jt-selected" jt-var="true"> EMULATION </div> <div id="jt-menu-about" class="jt-item" jt-var="true"> ABOUT </div> <div id="jt-menu-selection" jt-var="true"> </div> </div> </div> <div id="jt-content" jt-var="true"> <div id="jt-console"> <div class="jt-left"> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F1 </div> </div> <div class="jt-desc"> POWER </div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F2 </div> </div> <div class="jt-desc"> TV TYPE </div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F4 </div> </div> <div class="jt-desc"> P1 Difficulty </div> </div> </div> <div class="jt-middle"> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F5 </div> </div> <div class="jt-desc"> Load Cartridge File </div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F6 </div> </div> <div class="jt-desc"> Load Cartridge URL </div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F7 </div> </div> <div class="jt-desc"> Remove Cartridge </div> </div> </div> <div class="jt-right"> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F12 </div> </div> <div class="jt-desc"> RESET </div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F11 </div> </div> <div class="jt-desc"> SELECT </div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F9 </div> </div> <div class="jt-desc"> P2 Difficulty </div> </div> </div> <div class="jt-full-divider"></div> <div class="jt-console-panel"> <div class="jt-console-panel-cart-file jt-console-panel-icon"></div> <div class="jt-console-panel-cart-url jt-console-panel-icon"></div> <div class="jt-console-panel-p0-diff-label jt-console-panel-icon"></div> <div class="jt-console-panel-p1-diff-label jt-console-panel-icon"></div> <div class="jt-console-panel-power-labels jt-console-panel-icon"></div> <div class="jt-console-panel-reset-labels jt-console-panel-icon"></div> </div> <div class="jt-footer"> Drag & Drop Files or URLs to load Cartridge ROMs and State Files </div> </div> <div id="jt-ports"> <div class="jt-left"> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> L </div> </div> <div class="jt-desc">Toggle Paddles</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> K </div> </div> <div class="jt-desc">Toggle Swap Sides</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> J </div> </div> <div class="jt-desc">Toggle Gamepads</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> H </div> </div> <div class="jt-desc">Adjust Turbo Fire speed</div> </div> </div> <div class="jt-right"> <div id="jt-ports-paddles-mode" class="jt-hotkey jt-link jt-joystick-device" jt-var="true">Controllers: JOYSTICKS</div> <div id="jt-ports-p1-mode" class="jt-hotkey jt-link jt-mouse-device" jt-var="true">Swap Mode: NORMAL</div> <div id="jt-ports-gamepads-mode" class="jt-hotkey jt-link jt-joykeys-device" jt-var="true">Gamepads: AUTO (swapped)</div> </div> <div class="jt-full-divider"></div> <div class="jt-player jt-p1"> <div id="jt-control-p1-label" class="jt-title" jt-var="true"> PLAYER 1 </div> <div class="jt-command jt-fire1"> Fire<br> <div id="jt-control-p1-button" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-up"> <div id="jt-control-p1-up-label" jt-var="true"> Up </div> <div id="jt-control-p1-up" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-fire2"> Turbo Fire<br> <div id="jt-control-p1-buttonT" class="jt-key" jt-var="true" > </div> </div> <div class="jt-command jt-left"> Left<br> <div id="jt-control-p1-left" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-controller"> <div id="jt-control-p1-controller" jt-var="true"> </div> </div> <div class="jt-command jt-right"> Right<br> <div id="jt-control-p1-right" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-down"> <div id="jt-control-p1-down-label" jt-var="true"> Down </div> <div id="jt-control-p1-down" class="jt-key" jt-var="true"> </div> </div> </div> <div class="jt-player jt-p2"> <div id="jt-control-p2-label" class="jt-title" jt-var="true"> PLAYER 2 </div> <div class="jt-command jt-fire1"> Fire<br> <div id="jt-control-p2-button" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-up"> <div id="jt-control-p2-up-label" jt-var="true"> Up </div> <div id="jt-control-p2-up" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-fire2"> Turbo Fire<br> <div id="jt-control-p2-buttonT" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-left"> Left<br> <div id="jt-control-p2-left" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-controller"> <div id="jt-control-p2-controller" jt-var="true"> </div> </div> <div class="jt-command jt-right"> Right<br> <div id="jt-control-p2-right" class="jt-key" jt-var="true"> </div> </div> <div class="jt-command jt-down"> <div id="jt-control-p2-down-label" jt-var="true"> Down </div> <div id="jt-control-p2-down" class="jt-key" jt-var="true"> </div> </div> </div> <div id="jt-ports-revert" class="jt-link" jt-var="true"> REVERT </div> <div id="jt-ports-defaults" class="jt-link" jt-var="true"> DEFAULTS </div> </div> <div id="jt-general"> <div class="jt-left"> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> C </div> </div> <div class="jt-desc">Collisions</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> Shift </div>&nbsp;+&nbsp;<div class="jt-key"> F1 </div> </div> <div class="jt-desc">Fry Console</div> </div> <div class="jt-full-divider"></div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> Q </div> </div> <div class="jt-desc">NTSC/PAL</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> W </div> </div> <div class="jt-desc">V-Synch Modes</div> </div> <div class="jt-divider"></div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> R </div> </div> <div class="jt-desc">CRT Modes</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> T </div> </div> <div class="jt-desc">CRT Filters</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> D </div> </div> <div class="jt-desc">Debug Modes</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> I </div> </div> <div class="jt-desc">Show Info</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> G </div> </div> <div class="jt-desc">Capture Screen</div> </div> <div class="jt-full-divider"></div> <div class="jt-hotkey"> <div class="jt-desc">Right-Click Bar Icons: Default Action</div> </div> </div> <div class="jt-right"> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> 0 - 9 </div> </div> <div class="jt-desc">Load State</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Ctrl </div>&nbsp;+&nbsp;<div class="jt-key"> 0 - 9 </div> </div> <div class="jt-desc">Save State</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F8 </div> </div> <div class="jt-desc">Save State File</div> </div> <div class="jt-full-divider"></div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> F12 </div>&nbsp;&nbsp;/&nbsp;&nbsp;<div class="jt-key"> Shift </div>&nbsp;+&nbsp;<div class="jt-key"> F12 </div> </div> <div class="jt-desc">Fast / Slow Speed</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> Shift </div>&nbsp;<div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> Arrows </div> </div> <div class="jt-desc">Adjust Speed</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> P </div> </div> <div class="jt-desc">Toggle Pause</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> O </div>&nbsp;/&nbsp;<div class="jt-key"> F </div> </div> <div class="jt-desc">Next Frame</div> </div> <div class="jt-full-divider"></div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> Enter </div> </div> <div class="jt-desc">Full Screen</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key jt-key-fixed"> Ctrl </div>&nbsp;<div class="jt-key jt-key-fixed"> Alt </div>&nbsp;+&nbsp;<div class="jt-key"> Arrows </div> </div> <div class="jt-desc">Screen Size / Width</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> Shift </div>&nbsp;<div class="jt-key jt-key-fixed"> Ctrl </div>&nbsp;+&nbsp;<div class="jt-key"> Arrows </div> </div> <div class="jt-desc">Viewport Size / Origin</div> </div> <div class="jt-hotkey"> <div class="jt-command"> <div class="jt-key"> Backspace </div> </div> <div class="jt-desc">Defaults</div> </div> </div> </div> <div id="jt-about"> <div id="jt-logo-version">version&nbsp'+Javatari.VERSION+'</div> <div class="jt-info">'+atob("Q3JlYXRlZCBieSBQYXVsbyBBdWd1c3RvIFBlY2Npbg==")+"<br>"+atob("PGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9Imh0dHA6Ly9qYXZhdGFyaS5vcmciPmh0dHA6Ly9qYXZhdGFyaS5vcmc8L2E+")+' </div> <div id="jt-browserinfo" jt-var="true"> </div> </div> </div> </div>'},jt.SettingsGUI.css=function(){return"#jt-modal * { outline: none; box-sizing: border-box; } #jt-modal { position: absolute; overflow: hidden; width: "+jt.SettingsGUI.WIDTH+"px; height: 0; opacity: 0; visibility: hidden; top: 50%; left: 50%; color: hsl(0, 0%, 10%); font: normal 13px sans-serif; white-space: nowrap; text-align: initial; box-shadow: 3px 3px 15px 2px rgba(0, 0, 0, .4); transform: scale(0.85); transition: visibility .2s ease-out, opacity .2s ease-out, transform .2s ease-out, height .25s step-end; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; z-index: 50; } #jt-modal.jt-show { transform: scale(1); transition: visibility .2s ease-out, opacity .2s ease-out, transform .2s ease-out; height: "+jt.SettingsGUI.HEIGHT+'px; visibility: visible; opacity: 1; } #jt-modal .jt-heading { font-weight: 700; color: hsl(0, 0%, 30%); } #jt-modal .jt-link { font-weight: 700; line-height: 21px; color: hsl(228, 90%, 40%); cursor: pointer; } #jt-modal .jt-link:hover { outline: 1px solid; } .jt-command { position: relative; display: inline-block; font-weight: 600; color: hsl(0, 0%, 48%); } .jt-hotkey { height: 27px; padding: 3px 5px; box-sizing: border-box; } .jt-hotkey .jt-desc { display: inline-block; line-height: 21px; } .jt-key { position: relative; display: inline-block; top: -1px; min-width: 25px; height: 21px; padding: 4px 6px 3px; box-sizing: border-box; font-weight: 600; font-size: 12px; line-height: 12px; color: hsl(0, 0%, 42%); background: white; border-radius: 3px; border: 1px solid rgb(210, 210, 210); box-shadow: 0 1px 0 1px hsl(0, 0%, 47%); text-align: center; } .jt-key-fixed { width: 31px; padding-left: 0; padding-right: 2px; } .jt-footer { margin-top: 16px; text-align: center; } #jt-menu { position: relative; background: white; border-bottom: 1px solid hsl(0, 0%, 72%); } #jt-menu #jt-back { position: absolute; width: 40px; height: 34px; margin: 3px 1px; padding: 16px 12px; cursor: pointer; } #jt-menu #jt-back:hover { background: rgba(0, 0, 0, .12); } .jt-back-arrow { display: block; width: 16px; height: 2px; border-radius: 1000px; background: hsl(0, 0%, 98%); } .jt-back-arrow:before { content: ""; display: block; position: absolute; width: 10px; height: 2px; border-radius: inherit; background: inherit; transform: rotate(-45deg); transform-origin: 1px 1px; } .jt-back-arrow:after { content: ""; display: block; position: absolute; width: 10px; height: 2px; border-radius: inherit; background: inherit; transform: rotate(45deg); transform-origin: 1px 1px; } #jt-menu .jt-caption { height: 29px; margin: 0 -1px; padding: 10px 0 0 48px; font-size: 18px; color: white; background: hsl(358, 66%, 50%); box-shadow: 0 1px 3px rgba(0, 0, 0, .9); vertical-align: middle; box-sizing: content-box; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; } #jt-menu .jt-items { position: relative; width: 84%; height: 39px; margin: 0 auto; font-weight: 600; } #jt-menu .jt-item { float: left; width: 25%; height: 100%; padding-top: 13px; font-size: 14px; color: rgba(0, 0, 0, .43); text-align: center; cursor: pointer; } #jt-menu .jt-selected { color: hsl(358, 67%, 46%); } #jt-menu #jt-menu-selection { position: absolute; left: 0; bottom: 0; width: 25%; height: 3px; background: hsl(358, 67%, 46%); transition: left 0.3s ease-in-out; } #jt-content { position: relative; left: 0; width: 3000px; height: 371px; background: rgb(218, 218, 218); transition: left 0.3s ease-in-out } #jt-console, #jt-ports, #jt-general, #jt-about { position: absolute; width: '+jt.SettingsGUI.WIDTH+"px; height: 100%; box-sizing: border-box; } #jt-console { padding-top: 35px; } #jt-console .jt-hotkey { height: 29px; } #jt-console .jt-command { width: 42px; } #jt-console .jt-left, #jt-console .jt-middle, #jt-console .jt-right { float: left; } #jt-console .jt-left { width: 160px; margin-left: 58px; } #jt-console .jt-middle { width: 204px; } #jt-console .jt-right .jt-command { width: 46px; } #jt-console .jt-console-panel { position: relative; margin: 18px auto 0; box-shadow: rgba(0, 0, 0, 0.6) 2px 2px 4px; } #jt-console .jt-console-panel * { cursor: auto; } #jt-console .jt-footer { margin: 20px auto; } #jt-ports { left: "+jt.SettingsGUI.WIDTH+"px; padding: 18px 0 0 27px; } #jt-ports > .jt-left { float: left; width: 335px; padding-left: 26px; } #jt-ports > .jt-right { float: left; } #jt-ports .jt-command { width: 91px; } #jt-ports .jt-bottom { width: 546px; text-align: center; } #jt-ports .jt-player { position: absolute; top: 146px; width: 217px; color: rgba(0, 0, 0, .8); } #jt-ports .jt-p1 { left: 47px; } #jt-ports .jt-p2 { right: 47px; } #jt-ports .jt-title { margin-bottom: 09px; font-size: 14px; line-height: 14px; font-weight: bold; color: hsl(0, 0%, 35%); text-align: center; } #jt-ports .jt-player .jt-command { display: block; position: relative; float: left; width: 33%; height: 45px; font-size: 13px; text-align: center; } #jt-ports .jt-command.jt-fire1, #jt-ports .jt-command.jt-fire2 { top: 14px; } #jt-ports .jt-command.jt-left, #jt-ports .jt-command.jt-right { top: 27px; } #jt-ports .jt-command.jt-down { float: none; clear: both; margin: 0 auto; } #jt-ports .jt-command.jt-controller { height: 90px; } #jt-ports #jt-control-p1-controller, #jt-ports #jt-control-p2-controller { width: 70px; height: 89px; margin-left: 1px;  background-size: 73px 179px; } #jt-ports .jt-player .jt-key { min-width: 33px; height: 23px; padding: 5px 6px 4px; margin-top: 2px; cursor: pointer; } #jt-ports .jt-player .jt-key:hover { box-shadow: 0 1px 0 1px rgba(0, 0, 0, .5), 1px 2px 6px 4px rgb(170, 170, 170); } #jt-ports .jt-player .jt-key.jt-redefining { color: white; background-color: rgb(87, 128, 255); border-color: rgb(71, 117, 255); } #jt-ports .jt-player .jt-key.jt-undefined { background-color: rgb(255, 150, 130); border-color: rgb(255, 130, 90); } #jt-ports-defaults, #jt-ports-revert { position: absolute; left: 260px; width: 82px; text-align: center; padding: 3px 0 1px; font-size: 12px; } #jt-ports-defaults { bottom: 47px; } #jt-ports-revert { bottom: 21px; } #jt-general { left: "+2*jt.SettingsGUI.WIDTH+"px; padding-top: 18px; padding-left: 34px; } #jt-general .jt-left { float: left; width: 245px; } #jt-general .jt-left .jt-command { width: 99px; } #jt-general .jt-right { float: left; } #jt-general .jt-right .jt-command { width: 160px; } #jt-about { left: "+3*jt.SettingsGUI.WIDTH+"px; font-size: 18px; } #jt-about #jt-logo-version { width: 300px; height: 238px; margin: 26px auto 19px; color: hsl(0, 0%, 98%); padding-top: 200px; box-sizing: border-box; text-align: center; background-size: 233px 173px; box-shadow: 3px 3px 14px rgb(75, 75, 75); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; } #jt-about .jt-info { line-height: 30px; text-align: center; } #jt-about a { color: rgb(0, 40, 200); text-decoration: none; } #jt-about a:hover { text-decoration: underline; } #jt-about #jt-browserinfo { position: absolute; left: 0; right: 0; bottom: 7px; font-size: 10px; text-align: center; color: transparent; } .jt-clear { clear: both; } .jt-divider { clear: both; height: 27px; } .jt-full-divider { clear: both; height: 21px; } #jt-general .jt-full-divider { clear: both; height: 18px; }"},jt.SettingsDialog=function(t,e){"use strict";function n(){jt.Util.insertCSS(jt.SettingsGUI.css()),t.insertAdjacentHTML("beforeend",jt.SettingsGUI.html()),c=document.getElementById("jt-modal"),delete jt.SettingsGUI.html,delete jt.SettingsGUI.css,i(),r()}function i(){function t(e,n){n(e);for(var i=e.childNodes,r=0;r<i.length;r++)t(i[r],n)}t(c,function(t){t.id&&t.getAttribute&&t.getAttribute("jt-var")&&(l[t.id]=t)})}function r(){for(var t in jt.Util.onTapOrMouseDownWithBlock(c,function(){c.focus()}),jt.Util.onTapOrMouseDownWithBlock(l["jt-back"],l.hide),c.addEventListener("keydown",function(t){s(t,!0)}),c.addEventListener("keyup",function(t){s(t,!1)}),jt.Util.onTapOrMouseDownWithBlock(l["jt-menu-console"],function(){l.setPage("CONSOLE")}),jt.Util.onTapOrMouseDownWithBlock(l["jt-menu-ports"],function(){l.setPage("PORTS")}),jt.Util.onTapOrMouseDownWithBlock(l["jt-menu-general"],function(){l.setPage("GENERAL")}),jt.Util.onTapOrMouseDownWithBlock(l["jt-menu-about"],function(){l.setPage("ABOUT")}),g)!function(t){jt.Util.onTapOrMouseDownWithBlock(l[t],function(){d(t)})}(t);jt.Util.onTapOrMouseDownWithBlock(l["jt-ports-paddles-mode"],function(){e.togglePaddleMode()}),jt.Util.onTapOrMouseDownWithBlock(l["jt-ports-p1-mode"],function(){e.toggleP1ControlsMode()}),jt.Util.onTapOrMouseDownWithBlock(l["jt-ports-gamepads-mode"],function(){e.toggleGamepadMode()}),jt.Util.onTapOrMouseDownWithBlock(l["jt-ports-defaults"],h),jt.Util.onTapOrMouseDownWithBlock(l["jt-ports-revert"],_)}function o(){l["jt-browserinfo"].innerHTML=navigator.userAgent}function a(){var t=e.isPaddleMode(),n=e.isP1ControlsMode();l["jt-ports-paddles-mode"].innerHTML="Controllers: "+(t?"PADDLES":"JOYSTICKS"),l["jt-ports-p1-mode"].innerHTML="Swap Mode: "+(n?"SWAPPED":"NORMAL"),l["jt-ports-gamepads-mode"].innerHTML="Gamepads: "+e.getGamepadModeDesc(),t?(l["jt-control-p1-controller"].style.backgroundPositionY="-91px",l["jt-control-p2-controller"].style.backgroundPositionY="-91px",l["jt-control-p1-up-label"].innerHTML=l["jt-control-p2-up-label"].innerHTML="+ Speed",l["jt-control-p1-down-label"].innerHTML=l["jt-control-p2-down-label"].innerHTML="- Speed"):(l["jt-control-p1-controller"].style.backgroundPositionY="0",l["jt-control-p2-controller"].style.backgroundPositionY="0",l["jt-control-p1-up-label"].innerHTML=l["jt-control-p2-up-label"].innerHTML="Up",l["jt-control-p1-down-label"].innerHTML=l["jt-control-p2-down-label"].innerHTML="Down"),l["jt-control-p1-label"].innerHTML="PLAYER "+(n?"2":"1"),l["jt-control-p2-label"].innerHTML="PLAYER "+(n?"1":"2");var i=E.joystickKeys;for(var r in g){var o=l[r];if(r===v)o.classList.add("jt-redefining"),o.classList.remove("jt-undefined"),o.innerHTML="?";else{o.classList.remove("jt-redefining");var a=g[r],s=i[a.player][a.control];s.c===jt.DOMKeys.VK_VOID.c?(o.classList.add("jt-undefined"),o.innerHTML=""):(o.classList.remove("jt-undefined"),o.innerHTML=s.n)}}}function s(t,e){var n=jt.DOMKeys.codeForKeyboardEvent(t);if(e&&n===T)return $(),jt.Util.blockEvent(t);v&&f(t)}var l=this;this.show=function(t){if(!c)return n(),void setTimeout(function(){l.show(t)},0);this.position()&&(v=null,this.setPage(t||S),c.classList.add("jt-show"),c.classList.add("jt-show"),m=!0,setTimeout(function(){c.focus()},50))},this.hide=function(){m&&(l.hideLesser(),Javatari.room.screen.focus())},this.hideLesser=function(){Javatari.userPreferences.isDirty&&p(),c.classList.remove("jt-show"),c.classList.remove("jt-show"),m=!1},this.setPage=function(t){var e={CONSOLE:"0",PORTS:"-600px",GENERAL:"-1200px",ABOUT:"-1800px"}[S=t],n={CONSOLE:"0",PORTS:"25%",GENERAL:"50%",ABOUT:"75%"}[S];switch(e&&(l["jt-content"].style.left=e),n&&(l["jt-menu-selection"].style.left=n),l["jt-menu-console"].classList.toggle("jt-selected","CONSOLE"===S),l["jt-menu-ports"].classList.toggle("jt-selected","PORTS"===S),l["jt-menu-general"].classList.toggle("jt-selected","GENERAL"===S),l["jt-menu-about"].classList.toggle("jt-selected","ABOUT"===S),S){case"ABOUT":o();break;case"PORTS":a()}},this.isVisible=function(){return m},this.position=function(){var e=t.clientWidth,n=t.clientHeight;return e<575||n<400?(this.hide(),!1):(c.style.top=((n-jt.SettingsGUI.HEIGHT)/2|0)+"px",c.style.left=((e-jt.SettingsGUI.WIDTH)/2|0)+"px",!0)},this.controlsModeStateUpdate=function(){m&&"PORTS"===S&&a()};var c,d=function(t){v=t,a()},u=function(){v=null,a()},f=function(t){if(v){var e=jt.DOMKeys.codeForKeyboardEvent(t),n=jt.DOMKeys.nameForKeyboardEventSingle(t);if(e!==jt.DOMKeys.VK_VOID.c&&n){var i={c:e,n:n},r=g[v],o=E.joystickKeys;for(var a in g){var s=g[a];a!==v&&o[s.player][s.control].c===i.c&&(o[s.player][s.control]=jt.DOMKeys.VK_VOID)}o[r.player][r.control]=i,Javatari.userPreferences.setDirty(),u()}}},$=function(){v?u():l.hide()},h=function(){Javatari.userPreferences.setDefaultJoystickKeys(),u()},_=function(){Javatari.userPreferences.load(),u()},p=function(){Javatari.userPreferences.save(),e.applyPreferences()},g={"jt-control-p1-button":{player:0,control:"button"},"jt-control-p1-buttonT":{player:0,control:"buttonT"},"jt-control-p1-up":{player:0,control:"up"},"jt-control-p1-left":{player:0,control:"left"},"jt-control-p1-right":{player:0,control:"right"},"jt-control-p1-down":{player:0,control:"down"},"jt-control-p2-button":{player:1,control:"button"},"jt-control-p2-buttonT":{player:1,control:"buttonT"},"jt-control-p2-up":{player:1,control:"up"},"jt-control-p2-left":{player:1,control:"left"},"jt-control-p2-right":{player:1,control:"right"},"jt-control-p2-down":{player:1,control:"down"}},v=null,S="CONSOLE",m=!1,E=Javatari.userPreferences.current,T=jt.DOMKeys.VK_ESCAPE.c},jt.WebAudioSpeaker=function(t){"use strict";function e(){return jt.Util.isMobileDevice()?"CHROME"!==jt.Util.browserInfo().name||jt.Util.isIOSDevice()?3:4:2}function n(){return"SAFARI"===jt.Util.browserInfo().name||jt.Util.isIOSDevice()?e():0}function i(){function e(){t.removeEventListener("touchend",e,!0),t.removeEventListener("mousedown",e,!0),t.removeEventListener("keydown",e,!0);try{d.resume().then(function(){jt.Util.log("Speaker Audio Context resumed!")})}catch(n){i=n}var i,r=d.createBufferSource();r.buffer=d.createBuffer(1,1,22050),r.connect(d.destination),r.start(0),i&&jt.Util.log("Audio Context unlocked!"),a.speakerUnlockStateUpdate(!0)}!f||d.state&&"suspended"!==d.state||(t.addEventListener("touchend",e,!0),t.addEventListener("mousedown",e,!0),t.addEventListener("keydown",e,!0),jt.Util.log("Speaker Audio Context resume event registered"),a.speakerUnlockStateUpdate(!1))}function r(){if(f){$.length=c.length,h.length=c.length;for(var t=0;t<c.length;t++)$[t]=c[t].getSampleRate()/d.sampleRate,h[t]=0,c[t].setAudioMonitorBufferSize($[t]*u|0)}}function o(t){for(var e=t.outputBuffer.getChannelData(0),n=e.length,i=n-1;i>=0;i-=1)e[i]=0;if(0!==c.length)for(var r=c.length-1;r>=0;r-=1){for(var o=$[r],a=c[r].retrieveSamples(n*o+h[r]|0,g),s=a.buffer,l=a.bufferSize,d=a.start+h[r],u=0;u<n;)e[u]+=s[0|d],u+=1,(d+=o)>=l&&(d-=l);h[r]=d-(0|d)}}this.connect=function(t){t.connectMonitor(this)},this.connectPeripherals=function(t){a=t},this.connectAudioSignal=function(t){c.indexOf(t)>=0||(jt.Util.arrayAdd(c,t),r())},this.disconnectAudioSignal=function(t){0>c.indexOf(t)||(jt.Util.arrayRemoveAllElement(c,t),r())},this.powerOn=function(){s(),f&&(i(),this.unpause())},this.powerOff=function(){this.pause(),d&&d.close(),d=f=void 0},this.mute=function(){g=!0},this.unMute=function(){g=!1},this.pause=function(){f&&f.disconnect()},this.unpause=function(){f&&f.connect(d.destination)},this.toggleBufferBaseSize=function(){if(!d)return a.showOSD("Audio is DISABLED",!0,!0);p=(p+2)%8-1,this.pause(),l(),this.unpause(),a.showOSD("Audio Buffer size: "+(-1===p?"Auto ("+u+")":0===p?"Browser ("+u+")":u),!0),_.audioBufferBase=p,Javatari.userPreferences.setDirty()},this.getControlReport=function(t){return{label:-2===p?"OFF":-1===p?"Auto":0===p?"Browser":u,active:p>0}};var a,s=function(){if(-2===p||0===Javatari.AUDIO_MONITOR_BUFFER_SIZE)return void jt.Util.warning("Audio disabled in configuration");try{var t=window.AudioContext||window.webkitAudioContext||window.WebkitAudioContext;if(!t)throw Error("WebAudio API not supported by the browser");d=new t,jt.Util.log("Speaker AudioContext created. Sample rate: "+d.sampleRate+(d.state?", "+d.state:"")),l(),CTRAC=d}catch(e){jt.Util.error("Could not create AudioContext. Audio DISABLED!\n"+e)}},l=function(){try{var t=-1===p?e():0===p?n():p,i=Javatari.AUDIO_MONITOR_BUFFER_SIZE>0?Javatari.AUDIO_MONITOR_BUFFER_SIZE:t>0?jt.Util.exp2(0|jt.Util.log2((d.sampleRate+14e3)/22050))*jt.Util.exp2(t-1)*256:0;(f=d.createScriptProcessor(i,1,1)).onaudioprocess=o,u=f.bufferSize,r(),jt.Util.log("Audio Processor buffer size: "+f.bufferSize)}catch(a){jt.Util.error("Could not create ScriptProcessorNode. Audio DISABLED!\n"+a)}},c=[];this.signals=c;var d,u,f,$=[],h=[],_=Javatari.userPreferences.current,p=-3===Javatari.AUDIO_MONITOR_BUFFER_BASE?_.audioBufferBase:Javatari.AUDIO_MONITOR_BUFFER_BASE,g=!1},jt.LocalStorageSaveStateMedia=function(t){"use strict";function e(){return 2===t.netPlayMode}this.connect=function(t){t.connectMedia(this)},this.connectPeripherals=function(t){n=t},this.isSlotUsed=function(t){return void 0!==localStorage["javatarisave"+t]},this.saveState=function(t,e){var n=o(e);return n&&i("save"+t,n)},this.loadState=function(t){return a(r("save"+t))},this.saveStateFile=function(t,i){if(!e()){var r=o(i);r&&n.startDownloadBinary((t||"Javatari SaveState")+c,r,"System State file")}},this.loadStateFile=function(t){if(!e())return a(t)},this.saveResource=function(t,e){try{var n=e&&JSON.stringify(e);return i("res"+t,n)}catch(r){}},this.loadResource=function(t){try{var e=r("res"+t);return e&&JSON.parse(e)}catch(n){}},this.externalStateChange=function(){1===t.netPlayMode&&t.netController.processExternalStateChange()};var n,i=function(t,n){if(e())return!0;try{return localStorage["javatari"+t]=n,!0}catch(i){return jt.Util.error(i),!1}},r=function(t){if(!e())try{return localStorage["javatari"+t]}catch(n){jt.Util.warning(n)}},o=function(t){try{return s+JSON.stringify(t)}catch(e){jt.Util.error(e)}},a=function(t){try{var e,n;if((e="string"==typeof t?t.substr(0,s.length):jt.Util.int8BitArrayToByteString(t,0,s.length))!==s&&e!==l)return;return(n="string"==typeof t?t.slice(s.length):jt.Util.int8BitArrayToByteString(t,s.length))&&JSON.parse(n)}catch(i){jt.Util.error(i)}},s=String.fromCharCode(0,0)+"javataristate!",l="javatarijsstate!",c=".jst"},jt.PeripheralControls={SCREEN_ASPECT_PLUS:1,SCREEN_ASPECT_MINUS:2,SCREEN_SCALE_PLUS:3,SCREEN_SCALE_MINUS:4,VIEWPORT_ORIGIN_PLUS:5,VIEWPORT_ORIGIN_MINUS:6,VIEWPORT_SIZE_PLUS:7,VIEWPORT_SIZE_MINUS:8,SCREEN_FULLSCREEN:10,SCREEN_CRT_FILTER:11,SCREEN_CRT_MODE:12,SCREEN_TOGGLE_MENU:13,SCREEN_OPEN_HELP:14,SCREEN_OPEN_ABOUT:15,SCREEN_OPEN_SETTINGS:16,SCREEN_OPEN_QUICK_OPTIONS:17,SCREEN_DEFAULTS:18,SCREEN_CONSOLE_PANEL_TOGGLE:19,SPEAKER_BUFFER_TOGGLE:20,CONSOLE_POWER_TOGGLE:102,CONSOLE_POWER_FRY:103,CONSOLE_LOAD_STATE_FILE:104,CONSOLE_SAVE_STATE_FILE:105,CONSOLE_LOAD_STATE_MENU:106,CONSOLE_SAVE_STATE_MENU:107,P1_CONTROLS_TOGGLE:201,JOYSTICKS_TOGGLE_MODE:202,PADDLES_TOGGLE_MODE:203,TOUCH_TOGGLE_MODE:204,TOUCH_TOGGLE_DIR_BIG:205,TURBO_FIRE_TOGGLE:206,HAPTIC_FEEDBACK_TOGGLE_MODE:207,CAPTURE_SCREEN:304,CARTRIDGE_LOAD_RECENT:40,CARTRIDGE_LOAD_FILE:41,CARTRIDGE_LOAD_URL:42,CARTRIDGE_REMOVE:43,CARTRIDGE_LOAD_DATA_FILE:44,CARTRIDGE_SAVE_DATA_FILE:45,CARTRIDGE_CHOOSE_FORMAT:46,AUTO_LOAD_FILE:47,AUTO_LOAD_URL:48,SCREEN_OPEN_NETPLAY:500,AUTO_LOAD_URL2:501},jt.DOMPeripheralControls=function(t){"use strict";var e=this;this.connect=function(t){l=t},this.connectPeripherals=function(t,e,n,l){i=t,o=e,r=t.getMonitor(),a=n,s=l},this.getControlReport=function(t){switch(t){case d.PADDLES_TOGGLE_MODE:case d.P1_CONTROLS_TOGGLE:case d.TURBO_FIRE_TOGGLE:case d.TOUCH_TOGGLE_DIR_BIG:case d.HAPTIC_FEEDBACK_TOGGLE_MODE:return a.getControlReport(t);case d.SCREEN_CRT_FILTER:return i.getControlReport(t);case d.SPEAKER_BUFFER_TOGGLE:return o.getControlReport(t)}return{label:"Unknown",active:!1}},this.processKey=function(t,n){if(!n)return!1;var i=u[t]||u[t&f];return!!i&&(e.controlActivated(i,!!(t&$),!1),!0)},this.controlActivated=function(e,c,u,f){if(2===t.netPlayMode&&U.has(e))return t.showOSD("Function not available in NetPlay Client mode",!0,!0);switch(e){case d.AUTO_LOAD_URL2:n()||s.openURLChooserDialog2(h.ROM,c,u,!1,f);break;case d.CONSOLE_POWER_TOGGLE:a.processControlState(jt.ConsoleControls.POWER,!0);break;case d.CONSOLE_POWER_FRY:a.processControlState(jt.ConsoleControls.POWER_FRY,!0);break;case d.CONSOLE_LOAD_STATE_FILE:s.openFileChooserDialog(h.STATE,!1,!1,!1);break;case d.CONSOLE_SAVE_STATE_FILE:a.processControlState(jt.ConsoleControls.SAVE_STATE_FILE,!0);break;case d.CONSOLE_LOAD_STATE_MENU:i.openSaveStateDialog(!1);break;case d.CONSOLE_SAVE_STATE_MENU:i.openSaveStateDialog(!0);break;case d.CARTRIDGE_LOAD_RECENT:n()||i.openCartridgeChooserDialog(!1,c,u);break;case d.CARTRIDGE_LOAD_FILE:n()||s.openFileChooserDialog(h.ROM,c,u,!1);break;case d.CARTRIDGE_LOAD_URL:n()||s.openURLChooserDialog(h.ROM,c,u);break;case d.CARTRIDGE_REMOVE:n()||l.insert(null,!1);break;case d.CARTRIDGE_LOAD_DATA_FILE:case d.CARTRIDGE_SAVE_DATA_FILE:break;case d.CARTRIDGE_CHOOSE_FORMAT:n()||i.openCartridgeFormatDialog(c);break;case d.AUTO_LOAD_FILE:n()||s.openFileChooserDialog(h.AUTO,c,u,!1);break;case d.AUTO_LOAD_URL:n()||s.openURLChooserDialog(h.AUTO,c,u,!1);break;case d.SCREEN_CRT_MODE:r.crtModeToggle();break;case d.SCREEN_CRT_FILTER:r.crtFilterToggle();break;case d.SCREEN_FULLSCREEN:r.fullscreenToggle();break;case d.SCREEN_DEFAULTS:a.processControlState(jt.ConsoleControls.DEFAULTS,!0),r.setDefaults();break;case d.SCREEN_TOGGLE_MENU:i.toggleMenuByKey();break;case d.SCREEN_OPEN_HELP:i.openHelp();break;case d.SCREEN_OPEN_ABOUT:i.openAbout();break;case d.SCREEN_OPEN_SETTINGS:if(c)return this.controlActivated(d.SCREEN_DEFAULTS);i.openSettings();break;case d.SCREEN_OPEN_QUICK_OPTIONS:i.openQuickOptionsDialog();break;case d.SCREEN_CONSOLE_PANEL_TOGGLE:i.toggleConsolePanel();break;case d.SCREEN_OPEN_NETPLAY:i.openNetPlayDialog();break;case d.P1_CONTROLS_TOGGLE:a.toggleP1ControlsMode();break;case d.JOYSTICKS_TOGGLE_MODE:a.toggleGamepadMode();break;case d.PADDLES_TOGGLE_MODE:a.togglePaddleMode();break;case d.TOUCH_TOGGLE_MODE:a.toggleTouchControlsMode();break;case d.TOUCH_TOGGLE_DIR_BIG:a.toggleTouchDirBig();break;case d.TURBO_FIRE_TOGGLE:a.toggleTurboFireSpeed();break;case d.HAPTIC_FEEDBACK_TOGGLE_MODE:a.toggleHapticFeedback();break;case d.CAPTURE_SCREEN:i.saveScreenCapture();break;case d.SPEAKER_BUFFER_TOGGLE:o.toggleBufferBaseSize();break;case d.VIEWPORT_ORIGIN_MINUS:r.viewportOriginDecrease();break;case d.VIEWPORT_ORIGIN_PLUS:r.viewportOriginIncrease()}if(!F)switch(e){case d.SCREEN_ASPECT_MINUS:r.displayAspectDecrease();break;case d.SCREEN_ASPECT_PLUS:r.displayAspectIncrease();break;case d.SCREEN_SCALE_MINUS:r.displayScaleDecrease();break;case d.SCREEN_SCALE_PLUS:r.displayScaleIncrease();break;case d.VIEWPORT_SIZE_MINUS:r.viewportSizeDecrease();break;case d.VIEWPORT_SIZE_PLUS:r.viewportSizeIncrease()}};var n=function(){return Javatari.CARTRIDGE_CHANGE_DISABLED?(r.showOSD("Cartridge change is disabled!",!0,!0),!0):2===t.netPlayMode&&(r.showOSD("Cartridge change is disabled in NetPlay Client mode!",!0,!0),!0)};this.mediaChangeDisabledWarning=n;var i,r,o,a,s,l,c=function(){var t=jt.DOMKeys;u[b]=d.CARTRIDGE_LOAD_RECENT,u[b|t.ALT]=d.CARTRIDGE_LOAD_RECENT,u[C]=d.AUTO_LOAD_URL,u[C|t.ALT]=d.AUTO_LOAD_URL,u[A]=d.CARTRIDGE_REMOVE,u[A|t.ALT]=d.CARTRIDGE_REMOVE,u[P]=d.CONSOLE_SAVE_STATE_FILE,u[P|t.ALT]=d.CONSOLE_SAVE_STATE_FILE,u[O|t.ALT]=d.P1_CONTROLS_TOGGLE,u[L|t.ALT]=d.PADDLES_TOGGLE_MODE,u[y|t.ALT]=d.JOYSTICKS_TOGGLE_MODE,u[R|t.ALT]=d.TOUCH_TOGGLE_MODE,u[w|t.ALT]=d.TURBO_FIRE_TOGGLE,u[D|t.ALT]=d.SCREEN_CRT_FILTER,u[j|t.ALT]=d.SCREEN_CRT_MODE,u[x|t.ALT]=d.SCREEN_OPEN_SETTINGS,u[I|t.ALT]=d.SCREEN_OPEN_QUICK_OPTIONS,u[k|t.ALT]=d.SCREEN_CONSOLE_PANEL_TOGGLE,u[N|t.ALT]=d.SCREEN_FULLSCREEN,u[p|t.CONTROL|t.ALT]=d.SCREEN_SCALE_MINUS,u[v|t.CONTROL|t.ALT]=d.SCREEN_SCALE_PLUS,u[_|t.CONTROL|t.ALT]=d.SCREEN_ASPECT_MINUS,u[g|t.CONTROL|t.ALT]=d.SCREEN_ASPECT_PLUS,u[p|t.SHIFT|t.CONTROL]=d.VIEWPORT_ORIGIN_MINUS,u[v|t.SHIFT|t.CONTROL]=d.VIEWPORT_ORIGIN_PLUS,u[_|t.SHIFT|t.CONTROL]=d.VIEWPORT_SIZE_MINUS,u[g|t.SHIFT|t.CONTROL]=d.VIEWPORT_SIZE_PLUS,u[S]=d.SCREEN_TOGGLE_MENU,u[m]=d.SCREEN_DEFAULTS,u[m|t.ALT]=d.SCREEN_DEFAULTS,u[E|t.ALT]=d.CAPTURE_SCREEN,u[T|t.ALT]=d.SPEAKER_BUFFER_TOGGLE},d=jt.PeripheralControls,u={},f=~jt.DOMKeys.SHIFT,$=jt.DOMKeys.SHIFT,h=jt.FileLoader.OPEN_TYPE,_=jt.DOMKeys.VK_LEFT.c,p=jt.DOMKeys.VK_UP.c,g=jt.DOMKeys.VK_RIGHT.c,v=jt.DOMKeys.VK_DOWN.c,S=jt.DOMKeys.VK_CONTEXT.c,m=jt.DOMKeys.VK_BACKSPACE.c,E=jt.DOMKeys.VK_G.c,T=jt.DOMKeys.VK_A.c,b=jt.DOMKeys.VK_F5.c,C=jt.DOMKeys.VK_F6.c,A=jt.DOMKeys.VK_F7.c,O=jt.DOMKeys.VK_K.c,y=jt.DOMKeys.VK_J.c,L=jt.DOMKeys.VK_L.c,R=jt.DOMKeys.VK_N.c,w=jt.DOMKeys.VK_H.c,j=jt.DOMKeys.VK_R.c,D=jt.DOMKeys.VK_T.c,x=jt.DOMKeys.VK_Y.c,I=jt.DOMKeys.VK_U.c,k=jt.DOMKeys.VK_S.c,N=jt.DOMKeys.VK_ENTER.c,P=(jt.DOMKeys.VK_F1.c,jt.DOMKeys.VK_F8.c),F=Javatari.SCREEN_RESIZE_DISABLED,U=new Set([d.CONSOLE_POWER_FRY,d.CONSOLE_LOAD_STATE_FILE,d.CONSOLE_SAVE_STATE_FILE,d.CONSOLE_LOAD_STATE_MENU,d.CONSOLE_SAVE_STATE_MENU,d.CARTRIDGE_LOAD_RECENT,d.CARTRIDGE_LOAD_FILE,d.CARTRIDGE_LOAD_URL,d.CARTRIDGE_REMOVE,d.CARTRIDGE_LOAD_DATA_FILE,d.CARTRIDGE_SAVE_DATA_FILE,d.AUTO_LOAD_FILE,d.AUTO_LOAD_URL]);c()},jt.NetServer=function(t){"use strict";function e(){void 0===E&&(E=setInterval(_,3e4));var t={sessionControl:"createSession",sessionType:"javatari",wsOnly:R,queryVariables:["RTC_CONFIG","RTC_DATA_CHANNEL_CONFIG"]};m&&(t.sessionID=m),v.send(JSON.stringify(t))}function n(){g.stopSession(!0,E?"NetPlay Session stopped: Connection lost":"NetPlay: Connection error")}function i(t){var e=JSON.parse(t.data);if(e.javatariUpdate)return h(e.javatariUpdate);if(e.sessionControl)switch(e.sessionControl){case"sessionCreated":return void r(e);case"clientJoined":return void o(e);case"clientLeft":return void a(e);case"createError":return void g.stopSession(!0,"NetPlay: "+e.errorMessage)}else e.clientSDP&&s(e)}function r(e){try{T=JSON.parse(e.queriedVariables.RTC_CONFIG||"{}")}catch(n){}try{b=JSON.parse(e.queriedVariables.RTC_DATA_CHANNEL_CONFIG||"{}")}catch(i){}S=e.sessionID,A.netClearControlsToSend(),t.enterNetServerMode(g),t.showOSD('NetPlay session "'+e.sessionID+'" started',!0),jt.Util.log('NetPlay session "'+e.sessionID+'" started')}function o(e){var n={nick:e.clientNick,justJoined:!0,wsOnly:R||!!e.wsOnly};if(L[n.nick]=n,t.showOSD('NetPlay client "'+n.nick+'" joined',!0),jt.Util.log('NetPlay client "'+n.nick+'" joined'),!n.wsOnly){var i=new RTCPeerConnection(T);n.rtcConnection=i,i.onicecandidate=function(t){t.candidate||(jt.Util.log("Server SDP for client "+n.nick+":",i.localDescription),v.send(JSON.stringify({toClientNick:n.nick,serverSDP:i.localDescription})))};var r=i.createDataChannel("dataChannel",b);n.dataChannel=r,r.onopen=function(t){l(n,t)},r.onclose=function(t){c(n,t)},r.onmessage=function(t){d(n,t)},i.createOffer().then(function(t){return i.setLocalDescription(t)}).catch(function(t){u(n,t)})}}function a(t){var e=L[t.clientNick];e&&$(e,!0,!1,'NetPlay client "'+e.nick+'" left')}function s(t){var e=L[t.fromClientNick];e&&(jt.Util.log("Client SDP from client "+e.nick+":",t.clientSDP),e.rtcConnection.setRemoteDescription(new RTCSessionDescription(t.clientSDP)).catch(u))}function l(t,e){jt.Util.log("Client "+t.nick+" dataChannel open"),t.dataChannelActive=!0}function c(t,e){jt.Util.error("NetPlay Client "+t.nick+" dataChannel closed"),$(t,!0,!0,'NetPlay client "'+t.nick+'" dropped: P2P connection lost')}function d(t,e){h(JSON.parse(e.data))}function u(t,e){jt.Util.error("NetPlay Client "+t.nick+" RTC error:",e),$(t,!0,!0,'NetPlay client "'+t.nick+'" dropped: P2P connection error')}function f(){for(var t in L)$(L[t],!1)}function $(e,n,i,r){n&&(t.showOSD(r||'NetPlay client "'+e.nick+'" left',!0,i),(i?jt.Util.error:jt.Util.log)(r||'NetPlay client "'+e.nick+'" left')),e.dataChannel&&(e.dataChannel.onopen=e.dataChannel.onclose=e.dataChannel.onmessage=void 0,e.dataChannel.close()),e.rtcConnection&&(e.rtcConnection.onicecandidate=void 0,e.rtcConnection.close()),delete L[e.nick]}function h(t){t.c&&A.netServerProcessControlsChanges(t.c)}function _(){try{v.send('{ "sessionControl": "keep-alive" }')}catch(t){jt.Util.error("NetPlay error sending keep-alive"),g.stopSession(!0,"NetPlay Session stopped: connection error")}}function p(t,e){var n=e.length;if(n<w)return t.send(e);for(var i=0,r=0;;){var o=e.substr(r,j);if(r+=j,i++,!(r<n))return void t.send(x+o);t.send(D+o)}}var g=this;this.startSession=function(r){var o;(m=r?(""+r).trim():void 0)&&"@"===m[m.length-1]?(m=m.substr(0,m.length-1),o=!0):o=!1,m&&S===m&&R===o||(S&&this.stopSession(!0),t.enterNetPendingMode(this),R=o,v?e():((v=new WebSocket("wss://"+Javatari.SERVER_ADDRESS)).onmessage=i,v.onopen=e,v.onclose=n))},this.stopSession=function(e,n){clearInterval(E),E=void 0,v&&(v.onmessage=v.onopen=v.onclose=void 0,v.close(),v=void 0),e?f():setTimeout(f,300),t.showOSD(n||'NetPlay Session "'+S+'" stopped',!0,e),(e?jt.Util.error:jt.Util.log)(n||'NetPlay Session "'+S+'" stopped'),S=void 0,t.enterStandaloneMode()},this.getSessionID=function(){return S},this.netVideoClockPulse=function(){C.getConsoleControlsSocket().controlsClockPulse();var e,n,i,r=C.videoClockPulseGetNextPulldowns();for(var o in C.videoClockPulseApplyPulldowns(r),L){var a=L[o];if(a.wsOnly||a.dataChannelActive){a.justJoined||y?(a.justJoined=!1,!n&&(n=JSON.stringify({s:C.saveState(!0),cm:{p1:t.consoleControls.isP1ControlsMode(),pd:t.consoleControls.isPaddleMode()}})),e=n):(i||(O.c=A.netGetControlsToSend(),O.v=r,i=JSON.stringify(O)),e=i);try{a.dataChannelActive?p(a.dataChannel,e):v.send(JSON.stringify({toClientNick:a.nick,javatariUpdate:e}))}catch(s){$(a,!0,!0,'NetPlay client "'+a.nick+'" dropped: P2P error sending data')}}}y=!1,A.netClearControlsToSend()},this.processExternalStateChange=function(){y=!0};var v,S,m,E,T,b,C=t.console,A=t.consoleControls,O={v:0,c:void 0},y=!1,L={},R=!1,w=16300,j=16200,D="#@FrgS@#",x="#@FrgE@#"},jt.NetClient=function(t){"use strict";function e(){void 0===E&&(E=setInterval($,3e4)),p.send(JSON.stringify({sessionControl:"joinSession",sessionType:"javatari",sessionID:v,clientNick:m,wsOnly:y,queryVariables:["RTC_CONFIG"]}))}function n(){_.leaveSession(!0,E?"NetPlay session ended: Connection lost":"NetPlay: Connection error")}function i(t){var e=JSON.parse(t.data);if(e.javatariUpdate)return f(JSON.parse(e.javatariUpdate));if(e.sessionControl)switch(e.sessionControl){case"sessionJoined":return void r(e);case"sessionDestroyed":return void _.leaveSession(!1,'NetPlay Session "'+g+'" ended');case"joinError":return void _.leaveSession(!0,"NetPlay: "+e.errorMessage)}else e.serverSDP&&a(e)}function r(t){if(g=t.sessionID,S=t.clientNick,R=y||t.wsOnly,L=!0,R)return o();try{T=JSON.parse(t.queriedVariables.RTC_CONFIG||"{}")}catch(e){}(b=new RTCPeerConnection(T)).onicecandidate=function(t){t.candidate||p.send(JSON.stringify({clientSDP:b.localDescription}))},b.ondatachannel=function(t){(C=t.channel).onopen=s,C.onclose=l,C.onmessage=c}}function o(){t.showOSD('NetPlay Session "'+g+'" joined as "'+S+'"',!0),jt.Util.log('NetPlay Session "'+g+'" joined as "'+S+'"'),O.netClearControlsToSend(),t.enterNetClientMode(_)}function a(t){b.setRemoteDescription(new RTCSessionDescription(t.serverSDP)).then(function(){return b.createAnswer()}).then(function(t){return b.setLocalDescription(t)}).catch(d)}function s(t){w=!0,j="",o()}function l(t){jt.Util.error("NetPlay dataChannel closed"),_.leaveSession(!0,"NetPlay session ended: P2P connection lost")}function c(t){var e=h(t);e&&f(JSON.parse(e))}function d(t){jt.Util.error("NetPlay RTC error:",t),_.leaveSession(!0,"NetPlay session ended: P2P connection error")}function u(){C&&(C.onpen=C.onclose=C.onmessage=void 0,C.close(),C=void 0),b&&(b.onicecandidate=b.ondatachannel=void 0,b.close(),b=void 0)}function f(e){e.s?(A.loadState(e.s),L&&(t.consoleControls.setP1ControlsAndPaddleMode(!e.cm.p1,e.cm.pd),L=!1)):(e.c&&O.netClientApplyControlsChanges(e.c),A.videoClockPulseApplyPulldowns(e.v)),A.getConsoleControlsSocket().controlsClockPulse();var n={c:O.netGetControlsToSend()};w?C.send(JSON.stringify(n)):p.send(JSON.stringify({javatariUpdate:n})),O.netClearControlsToSend()}function $(){try{p.send('{ "sessionControl": "keep-alive" }')}catch(t){jt.Util.error("NetPlay error sending keep-alive"),_.leaveSession(!0,"NetPlay session ended: Connection error")}}function h(t){var e=t.data,n=e.substr(0,8);return n!==D&&n!==x?(j="",e):(j+=e.substr(8),n===x?(e=j,j="",e):void 0)}var _=this;this.joinSession=function(r,o){var a;if(!(v=(""+r).trim()))return t.showOSD("Must enter Session Name for joining NetPlay session",!0,!0);"@"===v[v.length-1]?(v=v.substr(0,v.length-1),a=!0):a=!1,m=o,y=a,g===v&&S===m&&R===y||(g&&this.leaveSession(!0),t.enterNetPendingMode(this),p?e():((p=new WebSocket("wss://"+Javatari.SERVER_ADDRESS)).onmessage=i,p.onopen=e,p.onclose=n))},this.leaveSession=function(e,n){clearInterval(E),E=void 0,g=S=void 0,R=!1,p&&(p.onpen=p.onclose=p.onmessage=void 0,p.close(),p=void 0),C&&(C.onpen=C.onclose=C.onmessage=void 0),b&&(b.onicecandidate=b.ondatachannel=void 0),w=!1,j="",e?u():setTimeout(u,300),t.showOSD(n||"NetPlay session ended",!0,e),(e?jt.Util.error:jt.Util.log)(n||"NetPlay session ended"),t.enterStandaloneMode()},this.getSessionID=function(){return g},this.netVideoClockPulse=function(){};var p,g,v,S,m,E,T,b,C,A=t.console,O=t.consoleControls,y=!1,L=!1,R=!1,w=!1,j="",D="#@FrgS@#",x="#@FrgE@#"},jt.NetClient.initKeepAlive=function(){Javatari.SERVER_ADDRESS&&Javatari.SERVER_KEEPALIVE&&jt.NetClient.sendKeepAlive()},jt.NetClient.sendKeepAlive=function(){fetch("https://"+Javatari.SERVER_ADDRESS+"/keepalive",{mode:"no-cors"}).catch(function(t){jt.Util.error("Sending KeepAlive: ",t)}).finally(function(){Javatari.SERVER_KEEPALIVE>0&&setTimeout(jt.NetClient.sendKeepAlive,Javatari.SERVER_KEEPALIVE)})},jt.Room=function(t,e){"use strict";function n(t){var e=Javatari.AUTO_POWER_ON_DELAY;e>=0&&JavatariFullScreenSetup.shouldStartInFullScreen()&&(e+=1400),(e-=Date.now()-s)<1&&(e=1),setTimeout(t,e)}function i(){e&&(l.console.getCartridgeSocket().inserted()?l.console.userPowerOn():Javatari.CARTRIDGE_SHOW_RECENT&&!Javatari.CARTRIDGE_CHANGE_DISABLED&&l.screen.openCartridgeChooserDialog(!0))}function r(){l.mainVideoClock=new jt.Clock(l.mainVideoClockPulse)}function o(){l.peripheralControls=new jt.DOMPeripheralControls(l),l.consoleControls=new jt.DOMConsoleControls(l,l.peripheralControls),l.fileDownloader=new jt.FileDownloader,l.stateMedia=new jt.LocalStorageSaveStateMedia(l),l.recentROMs=new jt.RecentStoredROMs,l.fileLoader=new jt.FileLoader(l,l.recentROMs,l.peripheralControls),l.speaker=new jt.WebAudioSpeaker(t),l.screen=new jt.CanvasDisplay(l,t),l.fileDownloader.connectPeripherals(l.screen),l.screen.connectPeripherals(l.recentROMs,l.fileLoader,l.fileDownloader,l.consoleControls,l.peripheralControls,l.stateMedia),l.speaker.connectPeripherals(l.screen),l.consoleControls.connectPeripherals(l.screen),l.stateMedia.connectPeripherals(l.fileDownloader),l.peripheralControls.connectPeripherals(l.screen,l.speaker,l.consoleControls,l.fileLoader)}function a(){l.console=new jt.AtariConsole,l.mainVideoClock.connect(l.console.getVideoClockSocket()),l.stateMedia.connect(l.console.getSavestateSocket()),l.fileLoader.connect(l.console),l.screen.connect(l.console),l.speaker.connect(l.console.getAudioSocket()),l.consoleControls.connect(l.console.getConsoleControlsSocket()),l.peripheralControls.connect(l.console.getCartridgeSocket()),l.console.socketsConnected()}var s,l=this;this.powerOn=function(){l.screen.powerOn(),l.speaker.powerOn(),l.consoleControls.powerOn(),l.setLoading(!0),l.enterStandaloneMode(),s=Date.now()},this.powerOff=function(){l.console.powerOff(),l.consoleControls.powerOff(),l.speaker.powerOff(),l.screen.powerOff()},this.getNetServer=function(){return this.netServer||(this.netServer=new jt.NetServer(this)),this.netServer},this.getNetClient=function(){return this.netClient||(this.netClient=new jt.NetClient(this)),this.netClient},this.setLoading=function(t){this.isLoading!==t&&(this.isLoading=t,this.console.setLoading(this.isLoading),this.screen.setLoading(this.isLoading))},this.start=function(t){this.mainVideoClock.detectHostNativeFPSAndCallback(function(e){l.console.vSynchSetSupported(e>0),n(function(){l.setLoading(!1),l.screen.start(t||i)})})},this.showOSD=function(t,e,n){this.console.showOSD(t,e,n)},this.mainVideoClockPulse=function(){l.console.isSystemPaused()||(l.netController?l.netController.netVideoClockPulse():(l.console.getConsoleControlsSocket().controlsClockPulse(),l.console.videoClockPulse()))},this.enterStandaloneMode=function(){var t=this.netPlayMode;this.netPlayMode=0,this.netController=void 0,l.mainVideoClock.go(),this.netPlayStateBeforeClientMode&&(this.console.loadState(this.netPlayStateBeforeClientMode),this.consoleControls.setP1ControlsAndPaddleMode(this.netPlayControlsModeBeforeClientMode.p1,this.netPlayControlsModeBeforeClientMode.pd),this.netPlayStateBeforeClientMode=void 0),t!==this.netPlayMode&&this.screen.roomNetPlayStatusChangeUpdate(t)},this.enterNetServerMode=function(t){var e=this.netPlayMode;this.netPlayMode=1,this.netController=t,l.mainVideoClock.go(),e!==this.netPlayMode&&this.screen.roomNetPlayStatusChangeUpdate(e)},this.enterNetClientMode=function(t){var e=this.netPlayMode;this.netPlayMode=2,this.netController=t,l.mainVideoClock.pause(),this.netPlayStateBeforeClientMode=this.console.saveState(!0),this.netPlayControlsModeBeforeClientMode={p1:this.consoleControls.isP1ControlsMode(),pd:this.consoleControls.isPaddleMode()},e!==this.netPlayMode&&this.screen.roomNetPlayStatusChangeUpdate(e)},this.enterNetPendingMode=function(t){var e=this.netPlayMode;this.netPlayMode=t===this.netServer?-1:-2,this.netController=void 0,l.mainVideoClock.go(),e!==this.netPlayMode&&this.screen.roomNetPlayStatusChangeUpdate(e)},this.mainVideoClock=null,this.console=null,this.screen=null,this.speaker=null,this.consoleControls=null,this.fileDownloader=null,this.stateMedia=null,this.recentROMs=null,this.fileLoader=null,this.peripheralControls=null,this.netPlayMode=0,this.netController=void 0,this.netServer=void 0,this.netClient=void 0,this.netPlayStateBeforeClientMode=void 0,this.netPlayControlsModeBeforeClientMode=void 0,this.isLoading=!1,this.runFramesAtTopSpeed=function(t){this.mainVideoClock.pause();for(var e=jt.Util.performanceNow(),n=0;n<t;n++)l.mainVideoClockPulse();var i=jt.Util.performanceNow()-e;jt.Util.log("Done running "+t+" frames in "+(0|i)+" ms"),jt.Util.log((t/(i/1e3)).toFixed(2)+"  frames/sec"),this.mainVideoClock.go()},r(),o(),a(),Javatari.userROMFormats.init()},Javatari.userPreferences={},Javatari.userPreferences.currentVersion=1,Javatari.userPreferences.compatibleVersions=new Set([1]),Javatari.userPreferences.defaults=function(){"use strict";var t=jt.DOMKeys;return{joystickKeys:[{left:t.VK_LEFT,up:t.VK_UP,right:t.VK_RIGHT,down:t.VK_DOWN,button:t.VK_SPACE,buttonT:t.VK_DELETE},{left:t.VK_F,up:t.VK_T,right:t.VK_H,down:t.VK_G,button:t.VK_A,buttonT:t.VK_PERIOD}],joystickGamepads:[{button:0,buttonT:1,select:8,reset:9,pause:4,fastSpeed:7,slowSpeed:6,device:-1,xAxis:0,xAxisSig:1,yAxis:1,yAxisSig:1,paddleAxis:0,paddleAxisSig:1,paddleCenter:.3,paddleSens:.75,deadzone:.3},{button:0,buttonT:1,select:8,reset:9,pause:4,fastSpeed:7,slowSpeed:6,device:-1,xAxis:0,xAxisSig:1,yAxis:1,yAxisSig:1,paddleAxis:0,paddleAxisSig:1,paddleCenter:.3,paddleSens:.75,deadzone:.3}],touch:{directionalBig:!1},hapticFeedback:!0,turboFireSpeed:6,vSynch:1,crtFilter:-1,audioBufferBase:-1,netPlaySessionName:"",netPlayNick:""}},Javatari.userPreferences.load=function(){try{(e=JSON.parse(localStorage.javatari4prefs||"{}")).version&&delete e.version}catch(t){}e&&Javatari.userPreferences.compatibleVersions.has(e.prefsVersion)||(e={});var e,n=Javatari.userPreferences.defaults();for(var i in n)void 0===e[i]&&(e[i]=n[i]);e.prefsVersion=Javatari.userPreferences.currentVersion,Javatari.userPreferences.current||(Javatari.userPreferences.current={});var r=Javatari.userPreferences.current;for(i in e)r[i]=e[i];Javatari.userPreferences.isDirty=!1},Javatari.userPreferences.setDefaultJoystickKeys=function(){Javatari.userPreferences.current.joystickKeys=Javatari.userPreferences.defaults().joystickKeys,Javatari.userPreferences.setDirty()},Javatari.userPreferences.save=function(){if(Javatari.userPreferences.isDirty)try{Javatari.userPreferences.current.javatariVersion=Javatari.VERSION,localStorage.javatari4prefs=JSON.stringify(Javatari.userPreferences.current),Javatari.userPreferences.isDirty=!1,jt.Util.log("Preferences saved!")}catch(t){}},Javatari.userPreferences.setDirty=function(){Javatari.userPreferences.isDirty=!0},Javatari.userROMFormats={init:function(){jt.CartridgeCreator.setUserROMFormats(this),this.userFormats=JSON.parse(localStorage.javatariuserformats||"{}")},getForROM:function(t){return this.userFormats[t.info.h]},setForROM:function(t,e,n){t.info.h&&(n?delete this.userFormats[t.info.h]:this.userFormats[t.info.h]=e,localStorage.javatariuserformats=JSON.stringify(this.userFormats))}},jt.Images.embedded=!0,jt.Configurator={applyConfig:function(){var t={};for(var e in Javatari.ALLOW_URL_PARAMETERS&&(t=function(){for(var t,e=(window.location.search||"").split("+").join(" "),n=/[?&]?([^=]+)=([^&]*)/g,i={};t=n.exec(e);){var r=decodeURIComponent(t[1]).trim().toUpperCase();i[r=jt.Configurator.abbreviations[r]||r]=decodeURIComponent(t[2]).trim()}return i}()).PRESETS&&(this.applyParam("PRESETS",t.PRESETS),delete t.PRESETS),t.RESET&&this.applyReset(),this.applyPresets(Javatari.PRESETS),t)this.applyParam(e,t[e]);Javatari.AUTO_POWER_ON_DELAY|=0,Javatari.CARTRIDGE_CHANGE_DISABLED=!0===Javatari.CARTRIDGE_CHANGE_DISABLED||"true"==Javatari.CARTRIDGE_CHANGE_DISABLED,Javatari.SCREEN_RESIZE_DISABLED=!0===Javatari.SCREEN_RESIZE_DISABLED||"true"==Javatari.SCREEN_RESIZE_DISABLED,Javatari.SCREEN_FULLSCREEN_MODE=Javatari.SCREEN_FULLSCREEN_MODE|=0,Javatari.SCREEN_FILTER_MODE|=0,Javatari.SCREEN_CRT_MODE|=0,Javatari.SCREEN_DEFAULT_SCALE=parseFloat(Javatari.SCREEN_DEFAULT_SCALE),Javatari.SCREEN_DEFAULT_ASPECT=parseFloat(Javatari.SCREEN_DEFAULT_ASPECT),Javatari.SCREEN_CANVAS_SIZE=0|Javatari.SCREEN_CANVAS_SIZE,Javatari.SCREEN_CONTROL_BAR|=0,Javatari.SCREEN_FORCE_HOST_NATIVE_FPS|=0,Javatari.SCREEN_VSYNCH_MODE|=0,Javatari.AUDIO_MONITOR_BUFFER_BASE|=0,Javatari.AUDIO_MONITOR_BUFFER_SIZE|=0,Javatari.AUDIO_SIGNAL_BUFFER_RATIO=parseFloat(Javatari.AUDIO_SIGNAL_BUFFER_RATIO),Javatari.AUDIO_SIGNAL_ADD_FRAMES|=0,Javatari.PAGE_BACK_CSS&&(document.body.style.background=Javatari.PAGE_BACK_CSS)},applyPresets:function(t){for(var e=(t||"").trim().toUpperCase().split(","),n=0;n<e.length;n++)this.applyPreset(e[n].trim())},applyPreset:function(t){if(t){var e=Javatari.PRESETS_CONFIG[t];if(e)for(var n in jt.Util.log("Applying preset: "+t),e){var i=n.trim().toUpperCase();"_"!==i[0]?this.applyParam(i,e[n]):"_INCLUDE"===i&&this.applyPresets(e[n])}else jt.Util.warning('Preset "'+t+'" not found, skipping...')}},applyParam:function(t,e){if(0>t.indexOf("."))Javatari[t]=e;else{for(var n=Javatari,i=t.split("."),r=0;r<i.length-1;++r)n=n[i[r]];n[i[i.length-1]]=e}},mediaURLSpecs:function(){var t=jt.FileLoader.OPEN_TYPE;return[Javatari.AUTODETECT_URL&&{url:Javatari.AUTODETECT_URL,onSuccess:function(e){Javatari.room.fileLoader.loadFromContent(e.url,e.content,t.AUTO,0,!0,!1)}},Javatari.CARTRIDGE_URL&&{url:Javatari.CARTRIDGE_URL,onSuccess:function(e){Javatari.room.fileLoader.loadFromContent(e.url,e.content,t.ROM,0,!0,!1,Javatari.CARTRIDGE_FORMAT)}}]},applyReset:function(){for(var t in jt.Util.warning("Removing all data saved on this client"),localStorage)0===t.indexOf("javatari")&&delete localStorage[t]},abbreviations:{P:"PRESETS",PRESET:"PRESETS",ROM:"CARTRIDGE_URL",CART:"CARTRIDGE_URL",FORMAT:"CARTRIDGE_FORMAT",ROM_FORMAT:"CARTRIDGE_FORMAT",CART_FORMAT:"CARTRIDGE_FORMAT",ANY:"AUTODETECT_URL",AUTO:"AUTODETECT_URL",AUTODETECT:"AUTODETECT_URL",STATE:"STATE_URL",SAVESTATE:"STATE_URL",JOIN:"NETPLAY_JOIN",NICK:"NETPLAY_NICK",VERSION:"VERSION_CHANGE_ATTEMPTED"}},Javatari.start=function(t){"use strict";if(delete Javatari.start,delete Javatari.preLoadImagesAndStart,Javatari.userPreferences.load(),!Javatari.screenElement&&(Javatari.screenElement=document.getElementById(Javatari.SCREEN_ELEMENT_ID),!Javatari.screenElement))throw Error('Javatari cannot be started. HTML document is missing screen element with id "'+Javatari.SCREEN_ELEMENT_ID+'"');jt.Configurator.applyConfig(),void 0===t&&(t=Javatari.AUTO_POWER_ON_DELAY>=0),Javatari.room=new jt.Room(Javatari.screenElement,t),Javatari.room.powerOn(),jt.Util.log("version "+Javatari.VERSION+" started"),jt.CartridgeDatabase.uncompress(),jt.NetClient.initKeepAlive();var e=Javatari.NETPLAY_JOIN;if(!e&&Javatari.STATE_URL)new jt.MultiDownloader([{url:Javatari.STATE_URL}],function(t){Javatari.room.start(function(){Javatari.room.fileLoader.loadFromContent(t[0].url,t[0].content,jt.FileLoader.OPEN_TYPE.STATE,0,!1)})}).start();else{var n=e?[]:jt.Configurator.mediaURLSpecs();new jt.MultiDownloader(n,function(){Javatari.room.start(e?function(){Javatari.room.getNetClient().joinSession(e,Javatari.NETPLAY_NICK)}:void 0)}).start()}Javatari.shutdown=function(){Javatari.room&&Javatari.room.powerOff(),jt.Util.log("shutdown")}},Javatari.preLoadImagesAndStart=function(){function t(t){Javatari.start&&Javatari.AUTO_START&&(t||e&&0===n)&&Javatari.start()}var e=!1,n=jt.Images.embedded?0:jt.Images.count;if(document.addEventListener("DOMContentLoaded",function(){e=!0,t(!1)}),n>0)for(var i in jt.Images.urls){var r=new Image;r.src=jt.Images.urls[i],r.onload=function(){n--,t(!1)}}window.addEventListener("load",function(){t(!0)})},window.applicationCache&&(window.applicationCache.status===window.applicationCache.UPDATEREADY?onUpdateReady():window.applicationCache.addEventListener("updateready",onUpdateReady)),Javatari.VERSION="5.0.4",Javatari.preLoadImagesAndStart();
